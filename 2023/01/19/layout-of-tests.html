<!DOCTYPE html> <html xmlns="https://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="What is the right way to keep test classes in a repository? There is no single canonical approach, but a few principles may help you keep test files in order." /> <meta name="keywords" content="how to structure test classes, java test organization, layout of tests classes, test methods, test methods design" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2023-01-19 00:00:00 +0000"> <meta name="yandex-verification" content="7d2a0afee14d72bc" /> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="On the Layout of Tests"/> <meta name="twitter:description" property="og:description" content="What is the right way to keep test classes in a repository? There is no single canonical approach, but a few principles may help you keep test files in order."/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2023/01/19/layout-of-tests.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?c674060c47c"/> <link rel="apple-touch-icon" href="/favicon.ico?c674060c47c"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?c674060c47c"/> <link rel="stylesheet" href="/css/icons.css?c674060c47c"/> <link rel="canonical" href="https://www.yegor256.com/2023/01/19/layout-of-tests.html" /> <title>On the Layout of Tests</title> <meta name='og:image' content='https://www.yegor256.com/images/2022/11/mimino.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2022/11/mimino.jpg'/><meta name='og:image:width' content='1643'/> <meta name='twitter:image:width' content='1643'/><meta name='og:image:height' content='924'/> <meta name='twitter:image:height' content='924'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='Мимино (1977) by Георгий Данелия'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My Stack Overflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/yegor256news" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;471</a></li> <li ><a href="/teaching.html" title="My courses and lectures">Teaching</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/research.html" title="My research directions and progress">Research</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="https://www.iccq.ru" title="International Conference on Code Quality">ICCQ</a></li> <li ><a href="https://www.kaicode.org" title="Open Source Festival">KaiCode</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Art</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> If you have an open source repository designed right, there is a chance to win up to $4,096 at <a href="https://www.kaicode.org">KaiCode'25</a>, our 8th annual open source festival. <a href="https://docs.google.com/forms/d/1nUlL2xvL1OOy3LoVF-g7MfB-9yeG68XB2wXW4MAoWrY">Submit</a> your project now, it's free! </li> <li> Are you a Java developer? Ready to move to Moscow (Russia) and join my team for a full-time employment in Fortune-100 company? We are working with <a href="https://www.eolang.org">EO</a>, a new programming language. <a href="mailto:job@yegor256.com">Email me</a>, we'll discuss. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2023/01/19/layout-of-tests.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2023/01/19/layout-of-tests.html</code></p><h1 itemprop="name headline mainEntityOfPage">On the Layout of Tests</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2023-01-19T00:00:00+00:00"> 19 January 2023 </time> </li> <li class="desktop-only" itemprop="locationCreated">Moscow, Russia</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="https://www.yegor256.com/2023/01/19/layout-of-tests.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><ul class="subline"> <li title="The page is translated by ChatGPT from English to a few languages"> Translated by <i class="icon icon-chatgpt notranslate" aria-hidden="true"></i> to </li> <li title="Click to see this page translated to Chinese"> <a href='https://www.yegor256.com/zh/2023/01/19/layout-of-tests.html'>中文</a> </li> <li title="Click to see this page translated to Russian"> <a href='https://www.yegor256.com/ru/2023/01/19/layout-of-tests.html'>русский</a> </li></ul><p class="unprintable"><a href='/tag/testing.html' class='tag notranslate'>testing</a></p><nav class="buttons notranslate desktop-only"> <a href="https://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2023/01/19/layout-of-tests.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2023/01/19/layout-of-tests.html&amp;text=On+the+Layout+of+Tests" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2023/01/19/layout-of-tests.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="https://reddit.com/submit?url=https://www.yegor256.com/2023/01/19/layout-of-tests.html%3F2023-03&amp;title=On+the+Layout+of+Tests" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="https://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2023/01/19/layout-of-tests.html%3F2023-03&amp;t=On+the+Layout+of+Tests" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> <a href="#" title="Cite it via BibTeX" class="button" onclick="$('#bibtex').toggle(); return false;"> <i class="icon icon-tex notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><div id="bibtex" style="display: none"><p>Please, cite this blog post via <a href="https://www.bibtex.org/">BibTeX</a> as such:</p><pre style="color:#053c5e;">@misc&#123;bugayenko2023blog0119,
  author = &#123;Bugayenko, Yegor&#125;,
  title = &#123;&#123;On the Layout of Tests&#125;&#125;,
  howpublished = &#123;\url&#123;https://www.yegor256.com/230119.html&#125;&#125;,
  year = &#123;2023&#125;,
  month = &#123;jan&#125;,
  note = &#123;[Online; accessed 12-04-2025]&#125;
&#125;</pre></div><p>I don’t know what programming language you use, but my experience of recent coding in Java, Ruby, JavaScript, PHP, Python, C++, and Rust tells me that the principle, which I will try to convince you to adhere to—is universal for all languages. It’s about the naming of test files. It may look to you like a question of low importance, but let me try to demonstrate that it’s not. How do you name your files with test classes? How many of them do you create in the src/test/java directory? Where do you place a class that is used only in a test but is not a test by itself? To most of these questions, the answer most of you would give is “Whatever!” So let’s try to find a better answer.</p><figure class="jb_picture"><img itemprop="image" alt="Мимино (1977) by Георгий Данелия" src="/images/2022/11/mimino.jpg" longdesc="#06bd8b4f" /><figcaption id="06bd8b4f">Мимино (1977) by Георгий Данелия</figcaption></figure><p>The primary purpose of my unit tests is to help me code. They are the <a href="/2022/07/05/safety-net.html">safety net</a>—they catch me when I make a mistake. For example, let’s say I go back and edit a few files that I edited a few years ago and, of course, I do it wrong this time. Then, I run all 500 unit tests in the project, and … ten of them turn red. Pay attention, I don’t say “fail” because, just like a safety net around a building, failed tests are the tests that didn’t catch a falling hammer and didn’t spot a bug just introduced. Thus, 490 of them <em>failed</em>, but ten of them <em>succeeded</em>.</p><h2 id="assertions">Assertions</h2><p>Next, I scratch my head and think—what exactly did I do wrong? Which file did I break? I just changed a few dozen code lines. Where exactly was the mistake? In order to find out, I read the output of the tests. I expect the messages they print to the console to be descriptive enough to help me understand the problem. I don’t want to revert all my changes and start from scratch, right? I want to quickly jump to the line with the bug, fix it, rerun all 500 tests, see all of them green, commit my changes and call it a day.</p><p>Needless to say, descriptive messages of test assertions and proper naming of test methods are the recipe for success. Let’s consider simple object Phrases, where we add a few English phrases, and it magically understands which of them are greetings (obviously, using ML). For such a class, this Java/JUnit5 test would be very bad:</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">org.junit.jupiter.api.Test</span><span class="o">;</span>

<span class="nd">@Test</span>
<span class="kt">void</span> <span class="nf">test1</span><span class="o">()</span> <span class="o">{</span>
  <span class="nc">Phrases</span> <span class="n">p</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Phrases</span><span class="o">();</span>
  <span class="n">p</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"Hello, world!"</span><span class="o">);</span>
  <span class="n">p</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"London is a capital of Great Britain"</span><span class="o">);</span>
  <span class="k">assert</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">greetings</span><span class="o">().</span><span class="na">count</span><span class="o">()</span> <span class="o">==</span> <span class="mi">1</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div><p>While this test is much better, thanks to <a href="https://www.hamcrest.org">Hamcrest</a> assertions (how to name test methods—is a separate story explained in detail <a href="https://stackoverflow.com/questions/155436/">here</a>):</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">hamcrest</span><span class="o">.</span><span class="na">MatcherAssert</span><span class="o">.</span><span class="na">assertThat</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">hamcrest</span><span class="o">.</span><span class="na">Matchers</span><span class="o">.</span><span class="na">equalTo</span><span class="o">;</span>

<span class="nd">@Test</span>
<span class="kt">void</span> <span class="nf">countsSimpleGreetings</span><span class="o">()</span> <span class="o">{</span>
  <span class="nc">Phrases</span> <span class="n">p</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Phrases</span><span class="o">();</span>
  <span class="n">p</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"Hello, world!"</span><span class="o">);</span>
  <span class="n">p</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"London is a capital of Great Britain"</span><span class="o">);</span>
  <span class="n">assertThat</span><span class="o">(</span>
    <span class="s">"Total count of greetings"</span><span class="o">,</span>
    <span class="n">p</span><span class="o">.</span><span class="na">greetings</span><span class="o">().</span><span class="na">count</span><span class="o">(),</span> <span class="n">equalTo</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span>
  <span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div><p>The first snippet will print a pretty obscure error message, while the second one will help me a lot in my struggle with the bug I just made: The message will be self-explanatory. I will quickly understand what the problem is.</p><h2 id="test-classes">Test Classes</h2><p>Descriptive messages will help me understand what the problem is. However, will I know <em>where</em> the problem is? In which Java class? Not really. Is it in <code class="language-plaintext highlighter-rouge">Phrases.java,</code> or maybe in <code class="language-plaintext highlighter-rouge">Greetings.java,</code> which is returned by <code class="language-plaintext highlighter-rouge">Phrases.greetings()</code>? I can only get this information from the <em>name</em> of the test class. If it’s called <code class="language-plaintext highlighter-rouge">PhrasesTest.java</code>—all bugs that it catches <em>are most probably</em> located in <code class="language-plaintext highlighter-rouge">Phrases.java.</code> If it’s called <code class="language-plaintext highlighter-rouge">GreetingsTest.java</code>—… well, you get the idea.</p><p>My point is that the name of a test class is not just a name. It’s an instruction for a wondering programmer: “Go look into the source file, the name of which you can derive from my name, removing the <code class="language-plaintext highlighter-rouge">Test</code> suffix.” If I try to follow this instruction and it leads me nowhere, I get very frustrated, especially if the project is not mine. I can’t get the required information from anywhere else. The name of the test class is my last hope.</p><h2 id="very-long-test-classes">Very Long Test Classes</h2><p>What if a test class gets too long? It may have a few dozen or more test methods. We don’t want a class to be too big, right? Wrong! A test class is not a class. It’s not even a utility class. It’s a container for test scripts. It’s called a class because Java (and many other languages) do not have alternative code organization instruments. So don’t worry about your test classes getting excessively long. 5000 lines of code in a test class is <em>not a problem</em> at all. Again, because it’s not a class, it’s only a collection of test scripts.</p><h2 id="test-prerequisites-wrong-way">Test Prerequisites (Wrong Way)</h2><p>Very often some classes or functions are not tests, but must be shared among tests. (I’m sure you know that sharing tests is an <a href="/2018/12/11/unit-testing-anti-patterns.html">anti-pattern</a>. Do you?) Look at how I refactored the unit test from above (it’s not elegant at all, but bear with me for a moment!):</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">PhrasesTest</span> <span class="o">{</span>
  <span class="nd">@Test</span>
  <span class="kt">void</span> <span class="nf">countsSimpleGreetings</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">Phrases</span> <span class="n">p</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Phrases</span><span class="o">();</span>
    <span class="n">prepare</span><span class="o">(</span><span class="n">p</span><span class="o">);</span>
    <span class="n">assertThat</span><span class="o">(</span>
      <span class="s">"Total count of greetings"</span><span class="o">,</span>
      <span class="n">p</span><span class="o">.</span><span class="na">greetings</span><span class="o">().</span><span class="na">count</span><span class="o">(),</span> <span class="n">equalTo</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span>
    <span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">prepare</span><span class="o">(</span><span class="nc">Phrases</span> <span class="n">p</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">p</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"Hello, world!"</span><span class="o">);</span>
    <span class="n">p</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"London is a capital of Great Britain"</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><p>Here, in private method <code class="language-plaintext highlighter-rouge">prepare(),</code> I have a convenient builder of the object of class <code class="language-plaintext highlighter-rouge">Phrases.</code> This builder may be beneficial for other tests, such as <code class="language-plaintext highlighter-rouge">GreetingsTest.</code> I don’t want to copy it from <code class="language-plaintext highlighter-rouge">PhrasesTest</code> to <code class="language-plaintext highlighter-rouge">GreetingsTest.</code> Instead, I want to put it somewhere where it can be reused. This would be the right place for it (<code class="language-plaintext highlighter-rouge">foo</code> is the Java package that all our classes belong to):</p><div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>src/
  main/
    java/
      foo/
        Phrases.java
        Greetings.java
  test/
    java/
      foo/
        support/
          FooUtils.java
        PhrasesTest.java
        GreetingsTest.java
</code></pre></div></div><p>Static method <code class="language-plaintext highlighter-rouge">FooUtils.prepare()</code> now sits in the <code class="language-plaintext highlighter-rouge">FooUtils</code> utility class (a terrible <a href="/2014/05/05/oop-alternative-to-utility-classes.html">anti-pattern</a>!), which is in the package <code class="language-plaintext highlighter-rouge">foo.support</code>. But, pay attention, not in the <code class="language-plaintext highlighter-rouge">foo</code> package, but in the sub-package that doesn’t have a counterpart in the live code block: there is no directory <code class="language-plaintext highlighter-rouge">src/main/java/foo/support.</code> This is a clear message to a programmer who would meet this repository in a few years: all classes that stay in <code class="language-plaintext highlighter-rouge">foo.support</code> belong to the test pipeline only and are not tests by themselves.</p><h2 id="test-prerequisites-right-way">Test Prerequisites (Right Way)</h2><p>As <a href="/2014/05/05/oop-alternative-to-utility-classes.html">you know</a>, utility classes and <a href="/2017/02/07/private-method-is-new-class.html">private static methods</a> are the rudiments of imperative programming. The object-oriented world has better alternatives. JUnit5, in particular, offers pretty elegant mechanisms for creating test prerequisites: <a href="https://junit.org/junit5/docs/current/user-guide/#extensions-registration">test extensions</a>. Everything that a test method needs we supply through its parameters, which are instantiated by extensions, for example:</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">org.junit.jupiter.api.extension.*</span><span class="o">;</span>

<span class="kd">class</span> <span class="nc">PhrasesExtension</span> <span class="kd">implements</span> <span class="nc">ParameterResolver</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">supportsParameter</span><span class="o">(</span>
    <span class="nc">ParameterContext</span> <span class="n">pctx</span><span class="o">,</span> <span class="nc">ExtensionContext</span> <span class="n">ectx</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">pctx</span><span class="o">.</span><span class="na">getParameter</span><span class="o">().</span><span class="na">getType</span><span class="o">()</span> <span class="o">==</span> <span class="nc">Phrases</span><span class="o">.</span><span class="na">class</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="nc">Object</span> <span class="nf">resolveParameter</span><span class="o">(</span>
    <span class="nc">ParameterContext</span> <span class="n">pctx</span><span class="o">,</span> <span class="nc">ExtensionContext</span> <span class="n">ectx</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Phrases</span> <span class="n">p</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Phrases</span><span class="o">();</span>
    <span class="n">p</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"Hello, world!"</span><span class="o">);</span>
    <span class="n">p</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"London is a capital of Great Britain"</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">p</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><p>Then, the test will look like this:</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">org.junit.jupiter.api.extension.ExtendWith</span><span class="o">;</span>

<span class="nd">@ExtendWith</span><span class="o">(</span><span class="nc">PhrasesExtension</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">class</span> <span class="nc">PhrasesTest</span> <span class="o">{</span>
  <span class="nd">@Test</span>
  <span class="kt">void</span> <span class="nf">countsSimpleGreetings</span><span class="o">(</span><span class="nc">Phrases</span> <span class="n">p</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">assertThat</span><span class="o">(</span>
      <span class="s">"Total count of greetings"</span><span class="o">,</span>
      <span class="n">p</span><span class="o">.</span><span class="na">greetings</span><span class="o">().</span><span class="na">count</span><span class="o">(),</span> <span class="n">equalTo</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><p>Now, the test and its prerequisites stay in two different places and are not as tightly coupled as they were before. Moreover, the prerequisites may be easily reused. The magic <code class="language-plaintext highlighter-rouge">@ExtendWith</code> annotation may be attached to other tests. The implementation of <code class="language-plaintext highlighter-rouge">PhrasesExtension</code> may become smarter: it may start paying attention not only to the type of argument of a test method but also to a custom annotation attached to it (this is how <a href="https://junit.org/junit5/docs/5.4.1/api/org/junit/jupiter/api/io/TempDir.html"><code class="language-plaintext highlighter-rouge">@TempDir</code></a> works).</p><h2 id="fake-objects-best-way">Fake Objects (Best Way)</h2><p>Despite the beauty of JUnit extensions, I don’t think they are the best way to decouple prerequisites from test methods. JUnit extensions are still pretty coupled … not to test methods, but to the entire test suite of a project. If you decide to use them somewhere else, in another project, you won’t be able to do so.</p><p>Also, if you decide to test your prerequisites, you won’t be able to do it elegantly. Of course, you could write tests for them in the same directory, but in this case, you will break the principle: one test per one live class.</p><p>The solution is: <a href="/2014/09/23/built-in-fake-objects.html">fake objects</a>. They stay together with other live objects, but have special “fake” behavior, for example (BTW, I <a href="/2017/11/14/static-factory-methods.html">don’t like factories</a>, but in this case, it’s OK):</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">FactoryOfPhrases</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="nc">Phrases</span> <span class="nf">aboutLondon</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">Phrases</span> <span class="n">p</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Phrases</span><span class="o">();</span>
    <span class="n">p</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"Hello, world!"</span><span class="o">);</span>
    <span class="n">p</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"London is a capital of Great Britain"</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">p</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><p>Then, the test will look like this:</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">PhrasesTest</span> <span class="o">{</span>
  <span class="nd">@Test</span>
  <span class="kt">void</span> <span class="nf">countsSimpleGreetings</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">assertThat</span><span class="o">(</span>
      <span class="s">"Total count of greetings"</span><span class="o">,</span>
      <span class="k">new</span> <span class="nf">FactoryOfPhrases</span><span class="o">().</span><span class="na">aboutLondon</span><span class="o">()</span>
        <span class="o">.</span><span class="na">greetings</span><span class="o">().</span><span class="na">count</span><span class="o">(),</span>
      <span class="n">equalTo</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><p>Repository layout would look like this:</p><div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>src/
  main/
    java/
      foo/
        FactoryOfPhrases.java
        Phrases.java
        Greetings.java
  test/
    java/
      foo/
        FactoryOfPhrasesTest.java
        PhrasesTest.java
        GreetingsTest.java
</code></pre></div></div><p>Pay attention to the test <code class="language-plaintext highlighter-rouge">FactoryOfPhrasesTest.</code> It tests the “fake” object <code class="language-plaintext highlighter-rouge">FactoryOfPhrases,</code> which is part of the live classes collection. The factory of phrases is shipped together with all other classes. Therefore, it can be used by other projects and not only for test purposes.</p><p>To summarize, as a rule, I suggest keeping test classes clean: only test methods belong there. No attributes and, of course, no static private methods. Everything that is a prerequisite must be a “fake” object.</p><h2 id="integration-tests">Integration Tests</h2><p>In the Maven world, there are unit test classes (<code class="language-plaintext highlighter-rouge">Test</code> suffix), and integration test classes (<code class="language-plaintext highlighter-rouge">ITCase</code> suffix). The difference is huge. While both are compiled at the <code class="language-plaintext highlighter-rouge">test-compile</code> phase by the same <code class="language-plaintext highlighter-rouge">maven-compiler-plugin,</code> they are not executed together. Instead, unit tests are executed at the <code class="language-plaintext highlighter-rouge">test</code> phase. The build fails immediately if any unit test is red. It’s a pretty straightforward approach, which is similar to other build automation engines.</p><p>Integration tests are executed in four steps (these are the names of Maven phases):</p><div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pre-integration-test
integration-test
post-integration-test
verify
</code></pre></div></div><p>First, the resources needed for integration testing are acquired at the <code class="language-plaintext highlighter-rouge">pre-integration-test</code> phase. For example, a test instance of MySQL database may be started. Then, the tests with <code class="language-plaintext highlighter-rouge">ITCase</code> are executed at the ‘integration-test’ phase. The result of their execution is ignored for now but only recorded in a file. Then, the resources are released at the <code class="language-plaintext highlighter-rouge">post-integration-test</code> phase. For example, the MySQL server is shut down. Finally, at the <code class="language-plaintext highlighter-rouge">verify</code> phase, the results of the tests are verified, and the build fails if some of them are not green.</p><p>I keep <code class="language-plaintext highlighter-rouge">ITCase</code> files together with <code class="language-plaintext highlighter-rouge">Test</code> files only when they are integration tests for specific live classes. Very often, they are not—that’s why they are integration tests. They may integrate and test a number of classes together. In this case, I put them in a separate package and gave them arbitrary names that don’t match with the names of live classes:</p><div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>src/
  main/
    java/
      foo/
        Phrases.java
        Greetings.java
  test/
    java/
      foo/
        it/
          SimpleGuessingITCase.java
        PhrasesTest.java
        GreetingsTest.java
        GreetingsITCase.java
</code></pre></div></div><p>Here, <code class="language-plaintext highlighter-rouge">GreetingsITCase.java</code> is an integration test for <code class="language-plaintext highlighter-rouge">Greetings.java,</code> while <code class="language-plaintext highlighter-rouge">SimpleGuessingITCase.java</code> is an integration test for no particular class. Obviously, the package <code class="language-plaintext highlighter-rouge">foo.it</code> only exists in tests and is not present in <code class="language-plaintext highlighter-rouge">src/main/java.</code></p><p><br /></p><p>Thus, there is the first rule: a test class may only have methods annotated with <code class="language-plaintext highlighter-rouge">@Test</code> (in the case of Java).</p><p>Then, there is the second rule: a package with tests may only have classes with <code class="language-plaintext highlighter-rouge">Test</code> or <code class="language-plaintext highlighter-rouge">ITCase</code> suffices that map one-to-one to live classes and nothing else.</p></div></article></div><script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script><div class="disqus" role="complementary" aria-hidden="true"><p class="disqus_hint" > Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0]; this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span>, 2014&ndash;<span itemprop="copyrightYear">2025</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="https://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge" /></a> &nbsp; <a href="https://github.com/yegor256/blog/stargazers"> <img src="//img.shields.io/github/stars/yegor256/blog.svg?style=flat-square" alt="GitHub stars" /></a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?c674060c47c"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "https://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html>
