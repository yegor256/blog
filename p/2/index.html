<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta charset="utf-8"/><meta name="description" content="Personal blog of Yegor Bugayenko about programming, mostly in Java, bug also in PHP, JavaScript, Ruby, Python and Lisp"/><meta name="keywords" content="java blog, java, software development blog, programming blog, yegor bugayenko blog, quality of software, software blog, high quality programming, static analysis, software testing, ruby blog, javascript blog, php blog"/><meta name="viewport" content="width=device-width"/><link rel="icon" type="image/gif" href="http://img.yegor256.com/icon-64x64.png"><link rel="shortcut icon" href="http://img.yegor256.com/icon-64x64.png"/><link rel="alternate" type="application/rss+xml" title="RSS" href="http://www.yegor256.com/rss.xml"/><link rel="author" href="https://plus.google.com/u/0/114792568016408327418?rel=author"/><link href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet"><link rel="stylesheet" href="/css/layout.css?cf23f35"/><link rel="canonical" href="http://www.yegor256.com/p/2/index.html"/> <script src="https://code.jquery.com/jquery-2.1.0.min.js"></script><title>Yegor Bugayenko About Programming</title></head><body><div class="wrapper"><div class="content"> <nav class="top" class="navigation"> <a class="item" href="/">home</a> <a class="item" href="/about-me.html">about me</a> <a class="item" href="http://feeds.feedburner.com/yegor256"><i class="fa fa-rss"></i></a> <a class="item" href="http://feedburner.google.com/fb/a/mailverify?uri=yegor256&amp;loc=en_US">subscribe</a><div class="gcse" role="search"><div class="gcse-search"></div></div> </nav> <section class="front"><p> <time datetime="2014-04-06T00:00:00+00:00"> 6 April 2014 </time></p> <header><h1> <a href="/2014/04/06/phandom.html"> Phantomjs as an HTML Validator </a></h1> </header> <article> <figure class='badge'><img src='http://img.phandom.org/logo.png' style='width:64px' alt='badge'/></figure><p>I created <a href="http://www.phandom.org">phandom.org</a> a few months ago, but yesterday finally found the time to make some needed changes to it. So, now is a good time to explain how I'm using Phandom in some of my unit tests.</p><p>Before I get started, though, I should say a few words about <a href="http://phantomjs.org/">phantomjs</a>, which is a JavaScript interface for WebKit. WebKit, on the other hand, is a web browser without a user interface. WebKit is a C++ library that enables manipulation of HTML content, through DOM calls. For example, this is a simple JavaScript located code in <code>example.js</code>:</p><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><code class="javascript">1
2
3
4
5
6
7
8</code></pre></div></td><td class="code"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">page</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'webpage'</span><span class="p">).</span><span class="nx">create</span><span class="p">();</span>
<span class="nx">page</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span>
  <span class="s1">'http://google.com'</span><span class="p">,</span>
  <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'loaded!'</span><span class="p">);</span>
    <span class="nx">phantom</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">);</span></pre></div></td></tr></table><p>We run phantomjs from the command line with the following code:</p><div class="highlight"><pre><code class="bash"><span class="nv">$ </span>phantomjs example.js
</code></pre></div><p>Phantomjs creates a <code>page</code> object (provided by <a href="https://github.com/ariya/phantomjs/wiki/API-Reference-WebPage">webpage</a> module inside phantomjs), and then asks it to <code>open()</code> a Web page. The object communicates with WebKit and converts this call into DOM instructions. After which, the page loads. The phantomjs engine then terminates on line 6.</p><p>WebKit renders a web page with all neccessary components such as CSS, JavaScript, ActionScript, etc, just as any standard Web browser would.</p><p>So far so good, and this is the traditional way of using phantomjs. Now, on to giving you an idea of how <a href="http://www.phandom.org">Phandom</a> (which stands for "PhantomJS DOM") works inside Java unit tests:</p><p>To test this, let's give <code>phantomjs</code> an HTML page and ask him to render it. When the page is ready, we'll ask phantomjs to show us how this HTML looks in WebKit. If we see the elements we need and desire, — we're good to go. Let's use the following example:</p><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><code class="java"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</code></pre></div></td><td class="code"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">com.rexsl.test.XhtmlMatchers</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hamcrest.MatcherAssert</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.phandom.Phandom</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">DocumentTest</span> <span class="o">{</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">rendersValidHtml</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">Document</span> <span class="n">doc</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Document</span><span class="o">();</span>
    <span class="c1">// This is the method we're testing. It is supposed</span>
    <span class="c1">// to return a valid HTML without broken JavaScript</span>
    <span class="c1">// and with all required HTML elements.</span>
    <span class="kd">final</span> <span class="n">String</span> <span class="n">html</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="na">html</span><span class="o">();</span>
    <span class="n">MatcherAssert</span><span class="o">.</span><span class="na">assertThat</span><span class="o">(</span>
      <span class="n">XhtmlMatchers</span><span class="o">.</span><span class="na">xhtml</span><span class="o">(</span><span class="k">new</span> <span class="n">Phandom</span><span class="o">(</span><span class="n">html</span><span class="o">).</span><span class="na">dom</span><span class="o">()),</span>
      <span class="n">XhtmlMatchers</span><span class="o">.</span><span class="na">hasXPath</span><span class="o">(</span><span class="s">"//p[.='Hello, world!']"</span><span class="o">)</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></pre></div></td></tr></table><p>When we use the above code, here is what happens. First, we get HTML <code>html</code> as a <code>String</code> from <code>doc</code> object, and then pass it to <a href="http://www.phandom.org/apidocs-0.2.1/org/phandom/Phandom.html"><code>Phandom</code></a> as an argument. Then, on line 13, we call the <code>Phandom.dom()</code> method to get an instance of the class <code>org.w3c.dom.Document</code>.</p><p>If our HTML contains any broken JavaScript code, method <code>dom()</code> produces a runtime exception and the unit test faila. If HTML is clean and WebKit is able to render it without problems, the test passes.</p><p>I'm using this mechanism in a few different projects,and it works quite well. Therefore, I highly recommend it.</p><p>Of course, you shouldn't forget that you must have phantomjs installed on your build machine. In order to avoid unit test failures when phantomjs is not available or present, I've created the following supplementary method:</p><div class="highlight"><pre><code class="java"><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">DocumentTest</span> <span class="o">{</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">rendersValidHtml</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">Assume</span><span class="o">.</span><span class="na">assumeTrue</span><span class="o">(</span><span class="n">Phandom</span><span class="o">.</span><span class="na">installed</span><span class="o">());</span>
    <span class="c1">// the rest of the unit test method body...</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><p>Enjoy and feel free to report any bugs or problems you encounter to: <a href="https://github.com/yegor256/phandom/issues">Github issues</a> :)</p></article> <a href="/2014/04/06/phandom.html#disqus_thread">comments</a> </section><section class="front"><p> <time datetime="2014-04-06T00:00:00+00:00"> 6 April 2014 </time></p> <header><h1> <a href="/2014/04/06/movies-for-thanasis.html"> Movies for Thanasis </a></h1> </header> <article><p>Sometime ago, I recommended a list of movies to a friend of mine after he told me was losing all interest in "Hollywood."</p><p>Level C titles are supposed to be impossible to understand unless you've seen (and understood) their prequels -- listed in sections A and B. So, start browsing the lists in sections A and post your comments if you have any. :)</p><p>Level A</p><ul><li><a href="http://www.imdb.com/title/tt0108399/">True Romance (1993)</a></li><li><a href="http://www.imdb.com/title/tt0110912/">Pulp Fiction (1994)</a></li><li><a href="http://www.imdb.com/title/tt0266697/">Kill Bill (2003)</a></li><li><a href="http://www.imdb.com/title/tt0118996/">Doberman (1997)</a></li><li><a href="http://www.imdb.com/title/tt0144201/">La fille sur le pont (1999)</a></li><li><a href="http://www.imdb.com/title/tt0290673/">Irreversible (2002)</a></li><li><a href="http://www.imdb.com/title/tt0120669/">Fear and Loathing in Las Vegas (1998)</a></li><li><a href="http://www.imdb.com/title/tt0119879/">Perdita Durango (1997)</a></li><li><a href="http://www.imdb.com/title/tt0107165/">Golden Balls (1993)</a></li><li><a href="http://www.imdb.com/title/tt0120753/">The Million Dollar Hotel (2000)</a></li><li><a href="http://www.imdb.com/title/tt0245574/">Y Tu Mamá También (2001)</a></li><li><a href="http://www.imdb.com/title/tt0105236/">Reservoir Dogs (1992)</a></li><li><a href="http://www.imdb.com/title/tt0117951/">Trainspotting (1996)</a></li><li><a href="http://www.imdb.com/title/tt0137523/">Fight Club (1999)</a></li><li><a href="http://www.imdb.com/title/tt0106307/">Arizona Dream (1992)</a></li><li><a href="http://www.imdb.com/title/tt0118843/">Black Cat, White Cat (1998)</a></li><li><a href="http://www.imdb.com/title/tt0118789/">Buffalo '66 (1998)</a></li><li><a href="http://www.imdb.com/title/tt0104545/">Jamon Jamon (1992)</a></li><li><a href="http://www.imdb.com/title/tt0110632/">Natural Born Killers (1994)</a></li><li><a href="http://www.imdb.com/title/tt0124901/">Thursday (1998)</a></li><li><a href="http://www.imdb.com/title/tt0115781/">Bullet (1996)</a></li></ul><p>Level B</p><ul><li><a href="http://www.imdb.com/title/tt0101700/">Delicatessen (1991)</a></li><li><a href="http://www.imdb.com/title/tt0115658/">Bernie (1996)</a></li><li><a href="http://www.imdb.com/title/tt0119257/">Hardmen (1996)</a></li><li><a href="http://www.imdb.com/title/tt0365686/">Revolver (2005)</a></li><li><a href="http://www.imdb.com/title/tt0354899/">Science of Sleep (2006)</a></li><li><a href="http://www.imdb.com/title/tt0460740/">Cashback (2006)</a></li><li><a href="http://www.imdb.com/title/tt0395125/">El Crimen Perfecto (2004)</a></li><li><a href="http://www.imdb.com/title/tt0112922/">El día de la bestia (1995)</a></li><li><a href="http://www.imdb.com/title/tt0255067/">La comunidad (2000)</a></li><li><a href="http://www.imdb.com/title/tt0304262/">The Happiness of the Katakuris (2001)</a></li><li><a href="http://www.imdb.com/title/tt0875113/">99 francs (2007)</a></li><li><a href="http://www.imdb.com/title/tt0420555/">Combien tu m'aimes? (2005)</a></li><li><a href="http://www.imdb.com/title/tt0299977/">Ying xiong (2002)</a></li><li><a href="http://www.imdb.com/title/tt0074252/">Brutti, sporchi e cattivi (1976)</a></li></ul><p>Level C</p><ul><li><a href="http://www.imdb.com/title/tt0486674/">What Just Happened (2008)</a></li><li><a href="http://www.imdb.com/title/tt0147612/">Happiness (1998)</a></li><li><a href="http://www.imdb.com/title/tt0292963/">Before the Devil Knows You Are Dead (2007)</a></li><li><a href="http://www.imdb.com/title/tt0477348/">No Country for Old Men (2007)</a></li><li><a href="http://www.imdb.com/title/tt1019452/">A Serious Man (2009)</a></li></ul></article> <a href="/2014/04/06/movies-for-thanasis.html#disqus_thread">comments</a> </section><section class="front"><p> <time datetime="2014-04-06T00:00:00+00:00"> 6 April 2014 </time></p> <header><h1> <a href="/2014/04/06/introduction.html"> First Post </a></h1> </header> <article><p>This is the first post on my new blog. Therefore, it's not about anything in particular - just an introduction and my way of saying hello. This blog will be primarily about software development ideas. As my <a href="/about-me.html">About Me</a> page says, I'm passionate about software quality, and will write solely about my ideas and views on it.</p><p>Anyway, welcome to my new blog. Together, let's see how this works out! :)</p><p>ps. BTW, I purchased the <a href="http://www.myfonts.com/fonts/ascender/cambria/">Cambria font</a> just for this new blog. It cost, €98. Nevertheless, I think its a good investment for this new venture.</p></article> <a href="/2014/04/06/introduction.html#disqus_thread">comments</a> </section><div class="pagination"><div style="float:left"> <a href="/">home</a></div> page 2 of 2<div style="float:right"> <span class="mute">next</span></div></div></div></div></body> <script src="/js/all.js?cf23f35"></script></html>