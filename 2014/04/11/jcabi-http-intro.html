<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta charset="utf-8"/><meta name="description" content="I created a simple fluent Java HTTP client to make things easier with HTTP interactions; the article explains its benefits comparing with native Java and Apache HttpClient"/><meta name="keywords" content="alternative to apache http client, best java http client library, http client java, httpclient fluent, httpclient java, java http client, java httpclient, sample http client in java, simple http client in java"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta property="twitter:account_id" content="4503599630178231"/><link rel="shortcut icon" href="/favicon.ico?b42e7c2"><link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="http://www.yegor256.com/rss.xml"/><link rel="author" href="//plus.google.com/u/0/114792568016408327418?rel=author"/><link rel="stylesheet" href="/css/layout.css?b42e7c2"/><link rel="canonical" href="http://www.yegor256.com/2014/04/11/jcabi-http-intro.html"/> <script src="//code.jquery.com/jquery-2.1.0.min.js"></script><title>Fluent Java HTTP Client</title></head><body><div class="wrapper"> <header class="header"><div> <a href="/about-me.html"> <img src="/images/yegor-bugayenko.png" class="photo" alt="photo"/> </a></div> <nav role="navigation"><ul class="menu social"><li><a href="http://www.twitter.com/yegor256" title="follow me in Twitter"><i class="icon icon-twitter"></i></a></li><li><a href="/rss" title="RSS feed"><i class="icon icon-rss"></i></a></li><li><a href="https://github.com/yegor256" title="my Github profile"><i class="icon icon-github"></i></a></li><li><a href="http://stackoverflow.com/users/187141/yegor256" title="my StackOverflow profile"><i class="icon icon-stackoverflow"></i></a></li><li><a href="https://www.facebook.com/yegor.bugayenko" title="follow me in Facebook"><i class="icon icon-facebook"></i></a></li><li><a href="https://plus.google.com/+YegorBugayenko/posts" title="follow me in Google+"><i class="icon icon-googleplus"></i></a></li><li><a href="https://www.linkedin.com/in/yegor256" title="my LinkedIn profile"><i class="icon icon-linkedin"></i></a></li><li><a href="http://www.youtube.com/user/yegor256a" title="my Youtube video channel"><i class="icon icon-youtube"></i></a></li><li><a href="mailto:yegor@teamed.io" title="yegor@teamed.io"><i class="icon icon-mail"></i></a></li></ul><ul class="menu"><li> <a href="/best.html" title="best articles to read">12 best articles</a> (out of <a href="/contents.html" title="blog contents">75</a>) <a href="/" title="home page">home</a></li></ul> </nav><div id="search"> <input id="search-query" class="field field-text" name="q" placeholder="Search" autocomplete="off"/><div id="search-results" style="display:none"><div class="entries"></div></div></div> <script id="search-results-template" type="text/mustache">
          {{#entries}}
            <div>
              <a href="{{url}}">{{title}}</a>
            </div>
          {{/entries}}
        </script></header></div> <section itemscope itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <code>http://www.yegor256.com/2014/04/11/jcabi-http-intro.html</code></p><h1 itemprop="name">Fluent Java HTTP Client</h1><ul class="subline"><li> <time itemprop="datePublished" datetime="2014-04-11T00:00:00+00:00"> 11 April 2014 </time></li><li class="printable">Yegor Bugayenko</li><li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2014/04/11/jcabi-http-intro.html#disqus_thread">comments</a></li></ul><p class="unprintable"><a href='/tag/jcabi.html' class='tag'>jcabi</a> <a href='/tag/http.html' class='tag'>http</a> <a href='/tag/java.html' class='tag'>java</a></p><div class="buttons"> <nav class="share" role="navigation"> <a href="http://www.facebook.com/sharer/sharer.php?u=http://www.yegor256.com/2014/04/11/jcabi-http-intro.html" title="Share on Facebook" class="button"> <span class="count count-facebook">0</span> <i class="icon icon-facebook"></i> </a> <a href="https://twitter.com/share?url=http://www.yegor256.com/2014/04/11/jcabi-http-intro.html&amp;text=Fluent+Java+HTTP+Client" title="Share on Twitter" class="button"> <span class="count count-twitter">0</span> <i class="icon icon-twitter"></i> </a> <a href="https://plus.google.com/share?url=http://www.yegor256.com/2014/04/11/jcabi-http-intro.html" title="Share on Google+" class="button"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus"></i> </a> <a href="https://www.linkedin.com/cws/share?url=http://www.yegor256.com/2014/04/11/jcabi-http-intro.html" title="Share on LinkedIn" class="button"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin"></i> </a> <a href="http://www.stumbleupon.com/submit?url=http://www.yegor256.com/2014/04/11/jcabi-http-intro.html&amp;title=Fluent+Java+HTTP+Client" title="Share on StumbleUpon" class="button"> <span class="count count-stumbleupon">0</span> <i class="icon icon-stumbleupon"></i> </a> <a href="http://del.icio.us/post?url=http://www.yegor256.com/2014/04/11/jcabi-http-intro.html&amp;title=Fluent+Java+HTTP+Client" title="Share on Delicious" class="button"> <span class="count count-delicious">0</span> <i class="icon icon-delicious"></i> </a> <a href="http://digg.com/submit?phase=2&amp;url=http://www.yegor256.com/2014/04/11/jcabi-http-intro.html&amp;title=Fluent+Java+HTTP+Client" title="Share on Digg" class="button"> <span class="count count-digg">0</span> <i class="icon icon-digg"></i> </a> <a href="http://reddit.com/submit?url=http://www.yegor256.com/2014/04/11/jcabi-http-intro.html%3F2014-14&amp;title=Fluent+Java+HTTP+Client" title="Share on Reddit" class="button"> <span class="count count-reddit">0</span> <i class="icon icon-reddit"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=http://www.yegor256.com/2014/04/11/jcabi-http-intro.html%3F2014-14&amp;t=Fluent+Java+HTTP+Client" title="Share on Hacker News" class="button"> <i class="icon icon-hackernews"></i> </a> </nav></div> </header> <main role="main"> <article class="main" role="article" itemprop="articleBody"> <figure class='badge'><a href='http://http.jcabi.com'><img src='http://img.jcabi.com/logo-square.svg' style='width:64px' alt='badge'/></a></figure><p>In the world of Java, there are plenty of HTTP clients from which to choose. Nevertheless, I decided to create a new one because none of the other clients satisfied fully all of my requirements. Maybe, I'm too demanding. Still, this is how my <a href="http://http.jcabi.com/">jcabi-http</a> client interacts when you make an HTTP request and expect a successful HTML page in return:</p><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><code class="language-java" data-lang="java">1
2
3
4
5
6
7
8</code></pre></div></td><td class="code"><div class="highlight"><pre><span class="n">String</span> <span class="n">html</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">JdkRequest</span><span class="o">(</span><span class="s">"https://www.google.com"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">uri</span><span class="o">().</span><span class="na">path</span><span class="o">(</span><span class="s">"/users"</span><span class="o">).</span><span class="na">queryParam</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="mi">333</span><span class="o">).</span><span class="na">back</span><span class="o">()</span>
  <span class="o">.</span><span class="na">method</span><span class="o">(</span><span class="n">Request</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
  <span class="o">.</span><span class="na">header</span><span class="o">(</span><span class="s">"Accept"</span><span class="o">,</span> <span class="s">"text/html"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">fetch</span><span class="o">()</span>
  <span class="o">.</span><span class="na">as</span><span class="o">(</span><span class="n">RestResponse</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
  <span class="o">.</span><span class="na">assertStatus</span><span class="o">(</span><span class="n">HttpURLConnection</span><span class="o">.</span><span class="na">HTTP_OK</span><span class="o">)</span>
  <span class="o">.</span><span class="na">body</span><span class="o">();</span></pre></div></td></tr></table><p>I designed this new client with the following requirements in mind:</p><h2 id="simplicity">Simplicity</h2><p>For me, this was the most important requirement. The client must be simple and easy to use. In most cases, I need only to make an HTTP request and parse the JSON response to return a value. For example, this is how I use the new client to return a current EUR rate:</p><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><code class="language-java" data-lang="java">1
2
3
4
5
6</code></pre></div></td><td class="code"><div class="highlight"><pre><span class="n">String</span> <span class="n">rate</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">JdkRequest</span><span class="o">(</span><span class="s">"http://www.getexchangerates.com/api/latest.json"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">header</span><span class="o">(</span><span class="s">"Accept"</span><span class="o">,</span> <span class="s">"application/json"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">fetch</span><span class="o">()</span>
  <span class="o">.</span><span class="na">as</span><span class="o">(</span><span class="n">JsonResponse</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
  <span class="o">.</span><span class="na">json</span><span class="o">().</span><span class="na">readArray</span><span class="o">().</span><span class="na">getJsonObject</span><span class="o">(</span><span class="mi">0</span><span class="o">)</span>
  <span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">"EUR"</span><span class="o">);</span></pre></div></td></tr></table><p>I assume that the above is easy to understand and maintain.</p><h2 id="fluent-interface">Fluent Interface</h2><p>The new client has to be fluent, which means that the entire server interaction fits into one Java statement. Why is this important? I think that <a href="http://martinfowler.com/bliki/FluentInterface.html">fluent interface</a> is the most compact and expressive way to perform multiple imperative calls. To my knowledge, none of the existing libraries enable this type of fluency.</p><h2 id="testable-and-extendable">Testable and Extendable</h2><p>I'm a big fan of interfaces, mostly because they make your designs both cleaner and highly extendable at the same time. In <a href="http://http.jcabi.com/">jcabi-http</a>, there are five interfaces extended by 20 classes.</p><p><a href="http://http.jcabi.com/apidocs-1.3/com/jcabi/http/Request.html"><code>Request</code></a> is an interface, as well as <a href="http://http.jcabi.com/apidocs-1.3/com/jcabi/http/Response.html"><code>Response</code></a>, <a href="http://http.jcabi.com/apidocs-1.3/com/jcabi/http/RequestURI.html"><code>RequestURI</code></a>, and <a href="http://http.jcabi.com/apidocs-1.3/com/jcabi/http/RequestBody.html"><code>RequestBody</code></a> exposed by it.</p><p>Use of interfaces makes the library highly extendable. For example, we have <a href="http://http.jcabi.com/apidocs-1.3/com/jcabi/http/request/JdkRequest.html"><code>JdkRequest</code></a> and <a href="http://http.jcabi.com/apidocs-1.3/com/jcabi/http/request/ApacheRequest.html"><code>ApacheRequest</code></a>, which make actual HTTP calls to the server using two completely different technologies: (JDK <code>HttpURLConnection</code> and Apache Http Client, respectively). In the future, it will be possible to introduce new implementations without breaking existing code.</p><p>Say, for instance, I want to fetch a page and then do something with it. These two calls perform the task differently, but the end results are the same:</p><div class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">String</span> <span class="n">uri</span> <span class="o">=</span> <span class="s">"http://www.google.com"</span><span class="o">;</span>
<span class="n">Response</span> <span class="n">page</span><span class="o">;</span>
<span class="n">page</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">JdkRequest</span><span class="o">(</span><span class="n">uri</span><span class="o">).</span><span class="na">fetch</span><span class="o">();</span>
<span class="n">page</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">ApacheRequest</span><span class="o">(</span><span class="n">uri</span><span class="o">).</span><span class="na">fetch</span><span class="o">();</span></code></pre></div><h2 id="xml-and-json-out-of-the-box">XML and JSON Out-of-the-Box</h2><p>There are two common standards that I wanted the library to support right out of the box. In most cases, the response retrieved from a server is in either XML or JSON format. It has always been a hassle, and extra work, for me to parse the output to take care of formatting issues.</p><p><a href="http://http.jcabi.com/">jcabi-http</a> client supports them both out of the box, and it's possible to add more formats in the future as needed. For example, you can fetch XML and retrieve a string value from its element:</p><div class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">String</span> <span class="n">name</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">JdkRequest</span><span class="o">(</span><span class="s">"http://my-api.example.com"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">header</span><span class="o">(</span><span class="s">"Accept"</span><span class="o">,</span> <span class="s">"text/xml"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">fetch</span><span class="o">()</span>
  <span class="o">.</span><span class="na">as</span><span class="o">(</span><span class="n">XmlResponse</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
  <span class="o">.</span><span class="na">xml</span><span class="o">().</span><span class="na">xpath</span><span class="o">(</span><span class="s">"/root/name/text()"</span><span class="o">).</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span></code></pre></div><p>Basically, the response produced by <code>fetch()</code> is decorated by <code>XmlResponse</code>. This then exposes the <code>xml()</code> method that returns an instance of the <a href="http://xml.jcabi.com/apidocs-0.7.7/com/jcabi/xml/XML.html"><code>XML</code></a> interface.</p><p>The same can be done with JSON through the Java JSON API (<a href="https://jcp.org/en/jsr/detail?id=353">JSR-353</a>).</p><p>None of the libraries that I'm aware of or worked with offer this feature.</p><h2 id="immutable">Immutable</h2><p>The last requirement, but certainly not the least important, is that I need all interfaces of the library to be annotated with <a href="http://aspects.jcabi.com/annotation-immutable.html"><code>@Immutable</code></a>. This is important because I need to be able to encapsulate an instance of <code>Request</code> in other immutable classes.</p><p>ps. A short summary of this article was published at <a href="http://java.dzone.com/articles/jcabi-http-fluent-java-http">JavaLobby</a></p></article> </main><div class="unprintable"><h2>Related Posts</h2><p>You may also find these posts interesting:</p><ul><li><a href="/2014/04/18/jcabi-http-server-mocking.html">Mocking of HTTP Server in Java</a></li><li><a href="/2014/04/21/s3-http-basic-auth.html">Basic HTTP Auth for S3 Buckets</a></li><li><a href="/2014/09/02/java-ssh-client.html">Simple Java SSH Client</a></li><li><a href="/2014/08/18/fluent-jdbc-decorator.html">Fluent JDBC Decorator</a></li><li><a href="/2014/08/15/retry-java-method-on-exception.html">How to Retry Java Method Call on Exception</a></li></ul></div></div><div class="disqus" role="complementary"><div id="disqus_thread"></div> <a href="http://disqus.com" class="dsq-brlink"> comments powered by <span class="logo-disqus">Disqus</span> </a> <script src="//yegor256.disqus.com/embed.js" async></script></div><div class="wrapper"> <footer class="footer"><p> Â© <span itemprop="author">Yegor Bugayenko</span>, 2014</p> </footer></div></section><script src="/js/post.js?b42e7c2"></script><script src="/js/global.js?b42e7c2"></script><script src="//yegor256.disqus.com/count.js" async></script><script src="/js/ext/search.min.js?b42e7c2"></script><script src="//stats.g.doubleclick.net/dc.js" async></script></body></html>