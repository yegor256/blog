<!doctypehtml><html amp lang="en"><meta charset="utf-8"><title>Deployment Script vs. Rultor</title><link rel="canonical"href="https://www.yegor256.com/2014/09/11/deployment-script-vs-rultor.html"><link rel="icon"type="image/png"href="/favicon.ico"><meta name="viewport"content="width=device-width,minimum-scale=1,initial-scale=1"><script type="application/ld+json">{
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "mainEntityOfPage":{
          "@type": "WebPage",
          "@id": "https://www.yegor256.com/2014/09/11/deployment-script-vs-rultor.html"
        },
        "headline": "Deployment Script vs. Rultor",
        "image": {
          "@type": "ImageObject",
          "url": "/images/2014/09/charlie-and-chocolate-factory-father.png",
          "height": 474,
          "width": 850
        },
        "datePublished": "2014-09-11",
        "dateModified": "2014-09-11",
        "author": {
          "@type": "Person",
          "name": "Yegor Bugayenko"
        },
        "publisher": {
          "@type": "Organization",
          "name": "yegor256.com",
          "logo": {
            "@type": "ImageObject",
            "url": "https://www.yegor256.com/images/face-512x512.jpg",
            "width": 512,
            "height": 512
          }
        },
        "description": "Many of us have our own custom release/deployment scripts
which work just fine. What value can Rultor add to them?
",
        "keywords": ["deployment script", "release script", "automate deployment", "fully automated deployment", "how to automate deployment process"]
      }</script><style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript><link rel="stylesheet"href="https://fonts.googleapis.com/css?family=Source+Code+Pro:400,500"><style amp-custom="amp-custom">@font-face{font-family:Cambria;src:url(https://www.yegor256.com/fonts/cambria/2EAA54_2_0.ttf)}body{font-family:Cambria,'Times New Roman',serif;padding:.5em;font-size:1.2em}article{width:600px;max-width:100%;margin-left:auto;margin-right:auto}code,pre{font-family:'Source Code Pro','Courier New',monospace;font-size:.8em}code{padding:0 .3em;background-color:#d3d3d3}a,a:hover,a:visited{color:inherit}.intro{color:red;font-size:.75em}.photo{border-radius:50%}pre{overflow-x:scroll}</style><script async src="https://cdn.ampproject.org/v0.js"></script><article><p class="intro">This is a mobile version, full one is <a href="https://www.yegor256.com/2014/09/11/deployment-script-vs-rultor.html">here</a>.<p><amp-img src="/images/face-256x256.jpg"width="80"height="80"alt="Yegor Bugayenko"class="photo"></amp-img><p>Yegor Bugayenko<br>11 September 2014<h1>Deployment Script vs. Rultor</h1><p>When I explain how <a href="https://www.rultor.com">Rultor</a> automates deployment/release processes, very often I hear something like:<blockquote><p>But I already have a script that deploys everything automatically.</blockquote><p>This response is very common, so I decided to summarize my three main arguments for automated Rultor deployment/release processes in one article: 1) isolated docker containers, 2) visibility of logs and 3) security of credentials.<p>Read about them and see what Rultor gives you on top of <strong>your existing</strong> deployment script(s).</p><amp-img src="/images/2014/09/charlie-and-chocolate-factory-father.png"alt="Charlie and the Chocolate Factory (2005) by Tim Burton"height="474"width="850"layout="responsive"></amp-img><p>Before we start with the arguments, let me emphasize that Rultor is a useful interface to your custom scripts. When you decide to automate deployment with Rultor, you don’t throw away any of your existing scripts. You just teach Rultor how to call them.<h2 id="isolated-docker-containers">Isolated Docker Containers</h2><p>The first advantage you get once you start calling your deployment scripts from Rultor is the <a href="/2014/07/29/docker-in-rultor.html">usage of Docker</a>. I’m sure you know what <a href="https://www.docker.io">Docker</a> is, but for those who don’t—it is a manager of virtual Linux “machines.” It’s a command line script that you call when you need to run some script in a new virtual machine (aka “container”). Docker starts the container almost immediately and runs your script. The beauty of Docker is that every container is a perfectly isolated Linux environment, with its own file system, memory, processes, etc.<p>When you tell Rultor to run your deployment script, it starts a new Docker container and runs your script there. But what benefit does this give me, you ask?<p>The main benefit is that the container gets destroyed right after your script is done. This means that you can do all pre-configuration inside the container without any fear of conflict with your main working platform. Let me give an example.<p>I’m developing on MacBook, where I install and remove packages which I need for development. At the same time, I have a project that, in order to be deployed, requires PHP 5.3, MySQL 5.6, Phing, PHPUnit, PHPCS and xdebug. Every MacOS version needs to be configured specifically to get these applications up and running, and it’s a time-consuming job.<p>I can change laptops, and I can change MacOS versions, but the project stays the same. It still requires the same set of packages in order to run its deployment script successfully. And the project is not in active development any more. I simply don’t need these packages for my day-to-day work, since I’m working with Java more now. But, when I need to make a minor fix to that PHP project and deploy it, I have to install all the required PHP packages and configure them. Only after that can I deploy that minor fix.<p>It is annoying, to say the least.<p>Docker gives me the ability to automate all of this together. My <strong>existing</strong> deployment script will get a preamble, which will install and configure all necessary PHP-related packages in a clean Ubuntu container. This preamble will be executed on every run of my deployment script, <strong>inside</strong> a Docker container. For example, it may look like this:<p>My deployment script looked like this before I started to use Rultor:<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
phing <span class="nb">test
</span>git ftp push <span class="nt">--user</span> <span class="s2">".."</span> <span class="se">\</span>
  <span class="nt">--passwd</span> <span class="s2">".."</span> <span class="se">\</span>
  <span class="nt">--syncroot</span> php/src <span class="se">\</span>
  ftp://ftp.example.com/
</code></pre></div></div><p>Just two lines. The first one is a full run of unit tests. The second one is an FTP deployment to the production server. Very simple. But this script will only work if PHP 5.3, MySQL, Phing, xdebug, PHPCS and PHPUnit are installed. Again, it’s a lot of work to install and configure them every time I upgrade my MacOS or change a laptop.<p>Needless to say, that if/when someone joins the project and tries to run my scripts, he/she will have to do this pre-installation work again.<p>So, here is a new script, which I’m using now. It is being executed inside a new Docker container, every time:<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="c"># First, we install all prerequisites</span>
<span class="nb">sudo </span>apt-get <span class="nb">install</span> <span class="nt">-y</span> php5 php5-mysql mysql
<span class="nb">sudo </span>apt-get <span class="nb">install </span>php-pear
<span class="nb">sudo </span>pear channel-discover pear.phpunit.de
<span class="nb">sudo </span>pear <span class="nb">install </span>phpunit/PHPUnit
<span class="nb">sudo </span>pear <span class="nb">install </span>PHP_CodeSniffer
<span class="nb">sudo </span>pecl <span class="nb">install </span>xdebug
<span class="nb">sudo </span>pear channel-discover pear.phing.info
<span class="nb">sudo </span>pear <span class="nb">install </span>phing/phing
<span class="c"># And now the same script I had before</span>
phing <span class="nb">test
</span>git ftp push <span class="nt">--user</span> <span class="s2">".."</span> <span class="se">\</span>
  <span class="nt">--passwd</span> <span class="s2">".."</span> <span class="se">\</span>
  <span class="nt">--syncroot</span> php/src <span class="se">\</span>
  ftp://ftp.example.com/
</code></pre></div></div><p>Obviously, running this script on my MacBook (without virtualization) would cause a lot of trouble. Well, I don’t even have <code class="language-plaintext highlighter-rouge">apt-get</code> here.<p>Thus, the first benefit that Rultor gives you is an isolation of your deployment script in its own virtual environment. We have this mostly thanks to Docker.<h2 id="visibility-of-logs">Visibility of Logs</h2><p>Traditionally, we keep deployment scripts in some <code class="language-plaintext highlighter-rouge">~/deploy</code> directory and run them with a magic set of parameters. In a small project, you do this yourself and this directory is on your own laptop. In a bigger project, there is a “deployment” server, that has that magic directory with a set of scripts that can be executed only by a few trusted senior developers. I’ve seen this setup many times.<p>The biggest issue here is traceability. It’s almost impossible to find out who deployed what and why some particular deployment failed. The senior deployment gurus simply SSH to the server and run those magic scripts with magic parameters. Logs are usually lost and problem tracking is very difficult or impossible.<p>Rultor offers something different. With Rultor, there is no SSH access to deployment scripts any more. All scripts stay in the <code class="language-plaintext highlighter-rouge">.rultor.yml</code> configuration file, and you start them by posting messages in your issue tracking system (for example GitHub, JIRA or Trac). Rultor runs the script and publishes its full log right to your ticket. The log stays with your project forever. You can always get back to the ticket you were working with and check why deployment failed and what instructions were actually executed.<p>For example, check out this GitHub issue, where I was deploying a new version of Rultor itself, and failed a few times: <a href="https://github.com/yegor256/rultor/issues/563">yegor256/rultor#563</a>. All my failed attempts are protocolled. I can always get back to them and investigate. For a big project this information is vital.<p>Thus, the second benefit of Rultor versus a standalone deployment script is visibility of every single operation.<h2 id="security-of-credentials">Security of Credentials</h2><p>When you have a custom script sitting in your laptop or in that secret team deployment server, your production credentials stay close to it. There is just no other way. If your software works with a database, it has to know login credentials (user name, password, DB name, port number, etc.). Well, in the worst case, some people just hard code that information right into the source code. We aren’t even going to discuss this case, that’s how bad it is.<p>But let’s say you separate your DB credentials from the source code. You will have something like a <code class="language-plaintext highlighter-rouge">db.properties</code> or <code class="language-plaintext highlighter-rouge">db.ini</code> file, which will be attached to the application right before deployment. You can also keep that file directly in the production server, which is even better, but not always possible, especially with PaaS deployments, for example.<p>A similar problem exists with deployments of artifacts to repositories. Say, you’re regularly deploying to RubyGems.org. Your <code class="language-plaintext highlighter-rouge">~/.gem/credentials</code> will contain your secret API key.<p>So, very often, your deployment scripts are accompanied by some files with sensitive and secure information. And these files have this information in a plain, open format. No encryption, no protection. Just user names, passwords, codes and tokens in plain text.<p>Why is this bad? Well, for a single developer with a single laptop this doesn’t sound like a problem. Although, I don’t like the idea of losing a laptop somewhere in an airport with all credentials open and ready to be used. You may argue that there are disc protection tools, like FileVault for MacOS or BestCrypt for Windows. Yes, maybe.<p>But let’s see what happens when we have a team of developers, working together and sharing those deployment scripts <strong>and</strong> files with credentials. Once you give access to your deployment scripts to a new member of the team, you have to share all that sensitive data. There is just no way around it. In order to use the scripts he/she has to be able to open files with credentials.<p>This is a problem, if you care about the security of your data.<p>Rultor solves this problem by offering an on-the-fly GPG decryption of your sensitive data, right before they are used by your deployment scripts. In the <code class="language-plaintext highlighter-rouge">.rultor.yml</code> configuration file you just say:<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>decrypt:
  db.ini: "repo/db.ini.asc"
deploy:
  script:
    ftp put db.ini production
</code></pre></div></div><p>Then, you encrypt your <code class="language-plaintext highlighter-rouge">db.ini</code> using a Rultor GPG key, and fearlessly commit <code class="language-plaintext highlighter-rouge">db.ini.asc</code> to the repository. Nobody will be able to open and read that file, except the Rultor server itself, right before running the deployment script.<p>Thus, the third benefit of Rultor versus a standalone deployment script is proper security of sensitive data.</article>