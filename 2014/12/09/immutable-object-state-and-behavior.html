<!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" itemprop="description" content="Object state and behavior are two very different things, and confusing the two often leads to incorrect design. " /> <meta name="keywords" itemprop="keywords" content="immutable object state, object attributes, object behavior model, object state, object state behavior, object state behavior and methods, object state behavior identity" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="og:site_name" itemprop="name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="How an Immutable Object Can Have State and Behavior?"/> <meta name="twitter:description" property="og:description" content="Object state and behavior are two very different things, and confusing the two often leads to incorrect design. "/> <meta name="twitter:url" property="og:url" content="http://www.yegor256.com/2014/12/09/immutable-object-state-and-behavior.html"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?8743969779"/> <link rel="apple-touch-icon" href="/favicon.ico?8743969779"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="http://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?8743969779"/> <link rel="stylesheet" href="/css/icons.css?8743969779"/> <link rel="canonical" href="http://www.yegor256.com/2014/12/09/immutable-object-state-and-behavior.html" itemprop="url" /> <link rel="amphtml" href="http://www.yegor256.com/2014/12/09/immutable-object-state-and-behavior.amp.html" /> <title>How an Immutable Object Can Have State and Behavior? </title> <meta name='og:image' content='http://www.yegor256.com/images/2014/12/once-upon-a-time-in-the-west.png'/><meta name='twitter:image' content='http://www.yegor256.com/images/2014/12/once-upon-a-time-in-the-west.png'/><meta name='og:image:width' content='1300'/> <meta name='twitter:image:width' content='1300'/><meta name='og:image:height' content='578'/> <meta name='twitter:image:height' content='578'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='Once Upon a Time in the West (1968) by Sergio Leone'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html"> <img src="//cf.jare.io/?u=http://www.yegor256.com/images/yegor-bugayenko-192x192.png" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" re="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://gitter.im/yegor256/elegantobjects" rel="nofollow" title="Our OOP Gitter chat"><i class="icon icon-gitter notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li><a href="/contents.html" title="The contents of the entire blog">All&#160;254</a></li> <li><a href="/webinars.html" title="My webinars">Webinars</a></li> <li><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li><a href="/books.html" title="The books I wrote">Books</a></li> <li><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li><a href="/award.html" title="Software quality award">Award</a></li> <li><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li class="highlighted"><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="https://github.com/itcraftsmanpl">@itcraftsmanpl</a> and <a href="https://github.com/mafagafogigante">@mafagafogigante</a> won <strong>$1,024</strong> each in this year <a href="http://www.yegor256.com/2016/10/23/award-2017.html">Quality Award</a> competition! You can submit your open source project to the <a href="http://www.yegor256.com/2017/10/24/award-2018.html">next year</a> competition right now. </li> <li> At <a href="/webinars.html">Webinar #29</a> we'll discuss the <a href="http://www.yegor256.com/2016/10/23/award-2017.html">Quality Award</a> and its winners by examples; join us on <b>November 1</b>, at 11am PST. </li> <li> Meet me at <a href="https://dotnext-moscow.ru/2017/msk/talks/3ehxgjdfiiws4kkygqa4qc/">DotNext 2017</a> (Moscow/Nov-13), and <a href="https://devternity.com/">DevTernity 2017</a> (Riga/Dec-1). </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div itemprop="review" itemscope="" itemtype="http://schema.org/Review"> <meta itemprop="author" content="Yegor Bugayenko"> <meta itemprop="itemReviewed" content="http://www.yegor256.com/2014/12/09/immutable-object-state-and-behavior.html"><div itemprop="reviewRating" itemscope="" itemtype="http://schema.org/Rating"> <meta itemprop="ratingValue" content="9"/> <meta itemprop="bestRating" content="10"/></div></div><div itemprop="image" itemscope="" itemtype="http://schema.org/ImageObject"> <meta itemprop="url" content="http://www.yegor256.com/images/yegor-bugayenko-192x192.png"/> <meta itemprop="height" content="192"/> <meta itemprop="width" content="192"/></div><div itemscope="" itemprop="publisher" itemtype="http://schema.org/Organization"> <meta itemprop="name" content="yegor256.com"/><div itemprop="logo" itemscope="" itemtype="http://schema.org/ImageObject"> <meta itemprop="url" content="http://www.yegor256.com/images/yegor-bugayenko-192x192.png"/> <meta itemprop="height" content="192"/> <meta itemprop="width" content="192"/></div></div><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=http://www.yegor256.com/2014/12/09/immutable-object-state-and-behavior.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">http://www.yegor256.com/2014/12/09/immutable-object-state-and-behavior.html</code></p><h1 itemprop="name headline mainEntityOfPage">How an Immutable Object Can Have State and Behavior?</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2014-12-09T00:00:00+00:00"> 9 December 2014 </time> </li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2014/12/09/immutable-object-state-and-behavior.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><ul class="subline"> <li>Discussed at:</li> <li><a href="https://www.reddit.com/r/programming/comments/2oqi6h/how_an_immutable_object_can_have_state_and/">reddit</a></li></ul><p class="unprintable"><a href='/tag/oop.html' class='tag notranslate'><img src='/images/books/elegant-objects/cactus.svg' alt='OOP'/>oop</a></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=http://www.yegor256.com/2014/12/09/immutable-object-state-and-behavior.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=http://www.yegor256.com/2014/12/09/immutable-object-state-and-behavior.html&amp;text=How+an+Immutable+Object+Can+Have+State+and+Behavior%3F" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=http://www.yegor256.com/2014/12/09/immutable-object-state-and-behavior.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=http://www.yegor256.com/2014/12/09/immutable-object-state-and-behavior.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://www.stumbleupon.com/submit?url=http://www.yegor256.com/2014/12/09/immutable-object-state-and-behavior.html&amp;title=How+an+Immutable+Object+Can+Have+State+and+Behavior%3F" title="Share on StumbleUpon" class="button" rel="nofollow"> <span class="count count-stumbleupon">0</span> <i class="icon icon-stumbleupon notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=http://www.yegor256.com/2014/12/09/immutable-object-state-and-behavior.html%3F2014-49&amp;title=How+an+Immutable+Object+Can+Have+State+and+Behavior%3F" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=http://www.yegor256.com/2014/12/09/immutable-object-state-and-behavior.html%3F2014-49&amp;t=How+an+Immutable+Object+Can+Have+State+and+Behavior%3F" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <main> <article class="main" itemprop="articleBody"><div ><p>I often hear this argument against <a href="/2014/06/09/objects-should-be-immutable.html">immutable objects</a>: &quot;Yes, they are useful when the state doesn&#39;t change. However, in our case, we deal with frequently changing objects. We simply can&#39;t afford to create a new <code>document</code> every time we just need to change its <code>title</code>.&quot; Here is where I disagree: object title is <strong>not a state</strong> of a document, if you need to change it frequently. Instead, it is a document&#39;s <strong>behavior</strong>. A <code>document</code> can and must be <a href="/2016/09/07/gradients-of-immutability.html">immutable</a>, if it is a <a href="/2014/11/20/seven-virtues-of-good-object.html">good object</a>, even when its title is changed frequently. Let me explain how.</p><figure class='jb_picture'><img itemprop='image' alt='Once Upon a Time in the West (1968) by Sergio Leone' src='/images/2014/12/once-upon-a-time-in-the-west.png' longdesc='#e87f3523'/><figcaption id='e87f3523'>Once Upon a Time in the West (1968) by Sergio Leone</figcaption></figure><h2 id="identity-state-and-behavior">Identity, State, and Behavior</h2><p>Basically, there are three elements in every <a href="/2016/07/14/who-is-object.html">object</a>: identity, state, and behavior. <em>Identity</em> is what distinguishes our <code>document</code> from other objects, <em>state</em> is what a document knows about itself (a.k.a. &quot;encapsulated knowledge&quot;), and <em>behavior</em> is what a document can do for us on request. For example, this is a mutable document:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Document</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">id</span><span class="o">;</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">title</span><span class="o">;</span>
  <span class="n">Document</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getTitle</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">title</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">setTitle</span><span class="o">(</span><span class="n">String</span> <span class="n">text</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">title</span> <span class="o">=</span> <span class="n">text</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;doc #%d about &#39;%s&#39;&quot;</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">id</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">text</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Let&#39;s try to use this mutable object:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Document</span> <span class="n">first</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Document</span><span class="o">(</span><span class="mi">50</span><span class="o">);</span>
<span class="n">first</span><span class="o">.</span><span class="na">setTitle</span><span class="o">(</span><span class="s">&quot;How to grill a sandwich&quot;</span><span class="o">);</span>
<span class="n">Document</span> <span class="n">second</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Document</span><span class="o">(</span><span class="mi">50</span><span class="o">);</span>
<span class="n">second</span><span class="o">.</span><span class="na">setTitle</span><span class="o">(</span><span class="s">&quot;How to grill a sandwich&quot;</span><span class="o">);</span>
<span class="k">if</span> <span class="o">(</span><span class="n">first</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">second</span><span class="o">))</span> <span class="o">{</span> <span class="c1">// FALSE</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span>
    <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;%s is equal to %s&quot;</span><span class="o">,</span> <span class="n">first</span><span class="o">,</span> <span class="n">second</span><span class="o">)</span>
  <span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>Here, we&#39;re creating two objects and then modifying their encapsulated states. Obviously, <code>first.equals(second)</code> will return <code>false</code> because the two objects have different identities, even though they encapsulate the same state.</p><p>Method <code>toString()</code> exposes the document&#39;s behavior&mdash;the document can convert itself to a string.</p><p>In order to modify a document&#39;s title, we just call its <code>setTitle()</code> once again:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">first</span><span class="o">.</span><span class="na">setTitle</span><span class="o">(</span><span class="s">&quot;How to cook pasta&quot;</span><span class="o">);</span></code></pre></figure><p>Simply put, we can reuse the object many times, modifying its internal state. It is fast and convenient, isn&#39;t it? Fast, yes. Convenient, not really. Read on.</p><h2 id="immutable-objects-have-no-identity">Immutable Objects Have No Identity</h2><p>As I&#39;ve <a href="/2014/11/20/seven-virtues-of-good-object.html">mentioned before</a>, immutability is one of the virtues of a good object, and a very important one. A good object is immutable, and good software contains only immutable objects. The main difference between immutable and mutable objects is that an immutable one doesn&#39;t have an identity and its state never changes. Here is an immutable variant of the same document:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="nd">@Immutable</span>
<span class="kd">class</span> <span class="nc">Document</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">id</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">title</span><span class="o">;</span>
  <span class="n">Document</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">,</span> <span class="n">String</span> <span class="n">text</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">title</span> <span class="o">=</span> <span class="n">text</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">title</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">title</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">Document</span> <span class="nf">title</span><span class="o">(</span><span class="n">String</span> <span class="n">text</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">Document</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">id</span><span class="o">,</span> <span class="n">text</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">doc</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">doc</span> <span class="k">instanceof</span> <span class="n">Document</span>
      <span class="o">&amp;&amp;</span> <span class="n">Document</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">cast</span><span class="o">(</span><span class="n">doc</span><span class="o">).</span><span class="na">id</span> <span class="o">==</span> <span class="k">this</span><span class="o">.</span><span class="na">id</span>
      <span class="o">&amp;&amp;</span> <span class="n">Document</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">cast</span><span class="o">(</span><span class="n">doc</span><span class="o">).</span><span class="na">title</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">title</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span>
      <span class="s">&quot;doc #%d about &#39;%s&#39;&quot;</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">id</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">text</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>This document is immutable, and its state (<code>id</code> ad <code>title</code>) is its identity. Let&#39;s see how we can use this immutable class (by the way, I&#39;m using <a href="http://aspects.jcabi.com/annotation-immutable.html"><code>@Immutable</code></a> annotation from <a href="http://aspects.jcabi.com">jcabi-aspects</a>):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Document</span> <span class="n">first</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Document</span><span class="o">(</span><span class="mi">50</span><span class="o">,</span> <span class="s">&quot;How to grill a sandwich&quot;</span><span class="o">);</span>
<span class="n">Document</span> <span class="n">second</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Document</span><span class="o">(</span><span class="mi">50</span><span class="o">,</span> <span class="s">&quot;How to grill a sandwich&quot;</span><span class="o">);</span>
<span class="k">if</span> <span class="o">(</span><span class="n">first</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">second</span><span class="o">))</span> <span class="o">{</span> <span class="c1">// TRUE</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span>
    <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;%s is equal to %s&quot;</span><span class="o">,</span> <span class="n">first</span><span class="o">,</span> <span class="n">second</span><span class="o">)</span>
  <span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>We can&#39;t modify a document any more. When we need to change the title, we have to create a new document:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Document</span> <span class="n">first</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Document</span><span class="o">(</span><span class="mi">50</span><span class="o">,</span> <span class="s">&quot;How to grill a sandwich&quot;</span><span class="o">);</span>
<span class="n">first</span> <span class="o">=</span> <span class="n">first</span><span class="o">.</span><span class="na">title</span><span class="o">(</span><span class="s">&quot;How to cook pasta&quot;</span><span class="o">);</span></code></pre></figure><p>Every time we want to modify its encapsulated state, we have to modify its identity too, because there is no identity. State is the identity. Look at the code of the <code>equals()</code> method above&mdash;it compares documents by their IDs and titles. Now ID+title of a document is its identity!</p><h2 id="what-about-frequent-changes">What About Frequent Changes?</h2><p>Now I&#39;m getting to the question we started with: What about performance and convenience? We don&#39;t want to change the entire document every time we have to modify its title. If the document is big enough, that would be a huge obligation. Moreover, if an immutable object encapsulates other immutable objects, we have to change the entire hierarchy when modifying even a single string in one of them.</p><p>The answer is simple. A document&#39;s title should not be part of its <strong>state</strong>. Instead, the title should be its <strong>behavior</strong>. For example, consider this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="nd">@Immutable</span>
<span class="kd">class</span> <span class="nc">Document</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">id</span><span class="o">;</span>
  <span class="n">Document</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">title</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// read title from storage</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">title</span><span class="o">(</span><span class="n">String</span> <span class="n">text</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// save text to storage</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">doc</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">doc</span> <span class="k">instanceof</span> <span class="n">Document</span>
      <span class="o">&amp;&amp;</span> <span class="n">Document</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">cast</span><span class="o">(</span><span class="n">doc</span><span class="o">).</span><span class="na">id</span> <span class="o">==</span> <span class="k">this</span><span class="o">.</span><span class="na">id</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;doc #%d about &#39;%s&#39;&quot;</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">id</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">title</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Conceptually speaking, this document is acting as a proxy of a real-life document that has a title stored somewhere&mdash;in a file, for example. This is what a good object should do&mdash;be a proxy of a real-life entity. The document exposes two features: reading the title and saving the title. Here is how its <a href="/2016/04/26/why-inputstream-design-is-wrong.html">interface</a> would look like:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="nd">@Immutable</span>
<span class="kd">interface</span> <span class="nc">Document</span> <span class="o">{</span>
  <span class="n">String</span> <span class="nf">title</span><span class="o">();</span>
  <span class="kt">void</span> <span class="nf">title</span><span class="o">(</span><span class="n">String</span> <span class="n">text</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p><code>title()</code> reads the title of the document and returns it as a <code>String</code>, and <code>title(String)</code> saves it back into the document. Imagine a real paper document with a title. You ask an object to read that title from the paper or to erase an existing one and write new text over it. This paper is a &quot;copy&quot; utilized in these methods.</p><p>Now we can make frequent changes to the immutable document, and the document stays the same. It doesn&#39;t stop being immutable, since it&#39;s state (<code>id</code>) is not changed. It is the same document, even though we change its title, because the title is not a state of the document. It is something in the real world, outside of the document. The document is just a proxy between us and that &quot;something.&quot; Reading and writing the title <em>are behaviors</em> of the document, not its state.</p><h2 id="mutable-memory">Mutable Memory</h2><p>The only question we still have unanswered is what is that &quot;copy&quot; and what happens if we need to keep the title of the document in memory?</p><p>Let&#39;s look at it from an &quot;object thinking&quot; point of view. We have a <code>document</code> object, which <a href="/2014/11/20/seven-virtues-of-good-object.html">is supposed to represent</a> a real-life entity in an object-oriented world. If such an entity is a file, we can easily implement <code>title()</code> methods. If such an entity is an Amazon S3 object, we also implement title reading and writing methods easily, keeping the object immutable. If such an entity is an HTTP page, we have no issues in the implementation of title reading or writing, keeping the object immutable. We have no issues as long as a real-world document exists and has its own identity. Our title reading and writing methods will communicate with that real-world document and extract or update its title.</p><p>Problems arise when such an entity doesn&#39;t exist in a real world. In that case, we need to create a mutable object property called <code>title</code>, read it via <code>title()</code>, and modify it via <code>title(String)</code>. But an object is immutable, so we can&#39;t have a mutable property in it&mdash;by definition! What do we do?</p><p>Think.</p><p>How could it be that our object doesn&#39;t represent a real-world entity? Remember, the <em>real world</em> is everything around the living environment of an object. Is it possible that an object doesn&#39;t represent anyone and acts on its own? No, it&#39;s not possible. Every object is a representative of a real-world entity. So, who does it represent if we want to keep <code>title</code> inside it and we don&#39;t have any file or HTTP page behind the object?</p><figure class='badge'><img src='http://www.yegor256.com/images/2014/12/memory-stick.png' style='width:200px;max-width:100%;' alt='badge'/></figure><p>It represents <em>computer memory</em>.</p><p>The title of immutable document #50, &quot;How to grill a sandwich,&quot; is stored in the memory, taking up 23 bytes of space. The document should know where those bytes are stored, and it should be able to read them and replace them with something else. Those 23 bytes are the real-world entity that the object represents. The bytes have nothing to do with the state of the object. They are a <em>mutable</em> real-world entity, similar to a file, HTTP page, or an Amazon S3 object.</p><p>Unfortunately, Java (and many other modern languages) do not allow direct access to computer memory. This is how we would design our class if such direct access was possible:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="nd">@Immutable</span>
<span class="kd">class</span> <span class="nc">Document</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">id</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Memory</span> <span class="n">memory</span><span class="o">;</span>
  <span class="n">Document</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">memory</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Memory</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">title</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">memory</span><span class="o">.</span><span class="na">read</span><span class="o">());</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">title</span><span class="o">(</span><span class="n">String</span> <span class="n">text</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">memory</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">text</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>That <code>Memory</code> class would be implemented by JDK natively, and all other classes would be immutable. The class <code>Memory</code> would have direct access to the memory heap and would be responsible for <a href="https://en.wikipedia.org/wiki/C_dynamic_memory_allocation"><code>malloc</code> and <code>free</code></a> operations on the operating system level. Having such a class would allow us to make all Java classes immutable, including <code>StringBuffer</code>, <code>ByteArrayOutputStream</code>, etc.</p><aside class='quote'>The role of an object is to make a piece of data alive, to animate it but not to become a piece of data</aside><p>The <code>Memory</code> class would explicitly emphasize the mission of an object in a software program, which is to be a <em>data animator</em>. An object is not holding data; it is animating it. The data exists somewhere, and it is <a href="/2016/07/06/data-transfer-object.html">anemic</a>, static, motionless, stationary, etc. The data is <strong>dead</strong> while the object is <strong>alive</strong>. The role of an object is to make a piece of data alive, to <em>animate</em> it but not to become a piece of data. An object needs some knowledge in order to gain access to that dead piece of data. An object may need a database unique key, an HTTP address, a file name, or a memory address in order to find the data and animate it. But an object should never think of itself as data.</p><h2 id="what-is-the-practical-solution">What Is the Practical Solution?</h2><p>Unfortunately, we don&#39;t have such a memory-representing class in Java, Ruby, JavaScript, Python, PHP, and many other high-level languages. It looks like language designers didn&#39;t get the idea of alive objects vs. dead data, which is sad. We&#39;re forced to mix data with object states using the same language constructs: object variables and properties. Maybe someday we&#39;ll have that <code>Memory</code> class in Java and other languages, but until then, we have a few options.</p><p><strong>Use C++</strong>. In C++ and similar low-level languages, it is possible to access memory directly and deal with in-memory data the same way we deal with in-file or in-HTTP data. In C++, we can create that <code>Memory</code> class and use it exactly the way we explained above.</p><p><strong>Use Arrays</strong>. In Java, an array is a data structure with a unique property&mdash;it can be modified while being declared as <code>final</code>. You can use an array of bytes as a mutable data structure inside an immutable object. It&#39;s a surrogate solution that conceptually resembles the <code>Memory</code> class but is much more primitive.</p><aside class='quote'>A good object is an immutable animator of mutable data</aside><p><strong>Avoid In-Memory Data</strong>. Try to avoid in-memory data as much as possible. In some domains, it is easy to do; for example, in web apps, file processing, I/O adapters, etc. However, in other domains, it is much easier said than done. For example, in games, data manipulation algorithms, and GUI, most of the objects animate in-memory data mostly because memory is the only resource they have. In that case, without the <code>Memory</code> class, you end up with mutable objects :( There is no workaround.</p><p>To summarize, don&#39;t forget that an object is an <strong>animator</strong> of data. It is using its encapsulated knowledge in order to reach the data. No matter where the data is stored&mdash;in a file, in HTTP, or in memory&mdash;it is conceptually very different from an object state, even though they may look very similar.</p><p>A good object is an immutable animator of mutable data. Even though it is immutable and data is mutable, it is alive and data is dead in the scope of the object&#39;s living environment.</p></div></article> </main></div><div class="wrapper"><div class="youtube"><ul><li><a href='https://www.youtube.com/watch?v=KwP7Ay9Z-hc'><img src='https://i.ytimg.com/vi/KwP7Ay9Z-hc/mqdefault.jpg'/></a>Immutable Objects vs. Common Sense (webinar #2); 6 May 2015; 2657 views; 35 likes</li><li><a href='https://www.youtube.com/watch?v=EnhRgXrHCC4'><img src='https://i.ytimg.com/vi/EnhRgXrHCC4/mqdefault.jpg'/></a>How Immutability Helps in OOP (in Russian with English subtitles); 21 May 2016; 1424 views; 29 likes</li><li><a href='https://www.youtube.com/watch?v=p7m7_iiqaHI'><img src='https://i.ytimg.com/vi/p7m7_iiqaHI/mqdefault.jpg'/></a>How Much Immutability Is Enough?; 19 May 2016; 1367 views; 29 likes</li><li><a href='https://www.youtube.com/watch?v=PVvLQGnyDrQ'><img src='https://i.ytimg.com/vi/PVvLQGnyDrQ/mqdefault.jpg'/></a>Gradients of Immutability (webinar #20); 11 January 2017; 831 views; 20 likes</li></ul></div></div><div class="wrapper"><div class="unprintable"> <hr/><p>If you like this article, you will definitely like these <strong>very relevant</strong> posts too:</p><p><a href='/2014/06/09/objects-should-be-immutable.html'><strong>Objects Should Be Immutable</strong></a> <br/>The article gives arguments about why classes/objects in object-oriented programming have to be immutable, i.e. never modify their encapsulated state</p><p><a href='/2016/09/07/gradients-of-immutability.html'><strong>Gradients of Immutability</strong></a> <br/>There are a few levels and forms of immutability in object-oriented programming, all of which can be used when they seem appropriate.</p><p><a href='/2014/12/22/immutable-objects-not-dumb.html'><strong>Immutable Objects Are Not Dumb</strong></a> <br/>Immutable objects are not the same as passive data structures without setters, despite a very common misbelief.</p></div></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/customer/portal/articles/665057-syntax-highlighting">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0]; this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2017</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="http://www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?8743969779"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script language="javascript" type="text/javascript"> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script language="javascript1.1" type="text/javascript"> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script language="javascript1.2" type="text/javascript"> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script language="javascript" type="text/javascript"> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> </body> </html>
