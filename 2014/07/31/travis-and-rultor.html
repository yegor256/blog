<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebPage"><head><base href="http://www.yegor256.com/2014/07/31/travis-and-rultor.html"/><meta charset="utf-8"/><meta itemprop="name" content="Rultor + Travis"/><meta itemprop="author" content="Yegor Bugayenko"/><meta itemprop="breadcrumb" content="http://www.yegor256.com"/><meta itemprop="keywords" content="continuous delivery, continuous integration, docker continuous delivery, docker continuous integration, hosted continuous integration, java continuous integration"/><meta itemprop="description" content="Rultor is a virtual team assistant that, in tandem with Travis, optimizes your routine merging, releasing and deploying operations"/><meta name="description" content="Rultor is a virtual team assistant that, in tandem with Travis, optimizes your routine merging, releasing and deploying operations"/><meta name="keywords" content="continuous delivery, continuous integration, docker continuous delivery, docker continuous integration, hosted continuous integration, java continuous integration"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="twitter:creator" content="@yegor256"/><meta property="twitter:account_id" content="4503599630178231"/><meta property="og:url" content="http://www.yegor256.com/2014/07/31/travis-and-rultor.html"/><meta property="og:site_name" content="yegor256"/><meta property="og:title" content="Rultor + Travis"/><meta property="og:description" content="Rultor is a virtual team assistant that, in tandem with Travis, optimizes your routine merging, releasing and deploying operations"/><meta property="og:type" content="article"/><meta property="og:locale" content="en_US"/><meta property="fb:admins" content="10203747823006002"/><meta name="twitter:site" content="@yegor256"/><meta name="twitter:creator" content="@yegor256"/><meta name="twitter:url" content="http://www.yegor256.com/2014/07/31/travis-and-rultor.html"/><meta property="article:author" content="https://www.facebook.com/yegor.bugayenko"/><meta name="p:domain_verify" content="61f09f0ef5db665328827225a3fc11bd"/><link rel="search" type="application/opensearchdescription+xml" href="opensearch.xml" title="yegor256"/><link rel="shortcut icon" href="/favicon.ico?8ba6760"/><link rel="apple-touch-icon" href="/favicon.ico?8ba6760"/><link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="http://www.yegor256.com/rss.xml"/><link rel="author" href="http://plus.google.com/u/0/114792568016408327418?rel=author"/><link rel="publisher" href="http://plus.google.com/u/0/114792568016408327418"/><link rel="stylesheet" href="/css/layout.css?8ba6760"/><link rel="canonical" href="http://www.yegor256.com/2014/07/31/travis-and-rultor.html"/><title>Rultor + Travis - Yegor Bugayenko</title></head><body><div class="wrapper"> <aside class="header-toggle" id="header-toggle" title="show head menu" onclick="$('#header').show(),$('#header-toggle').hide()">☰</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html" class="sub"><span>subscribe</span></a> <a href="/about-me.html"> <img src="/images/yegor-bugayenko-192x192.png" class="photo" alt="photo of Yegor Bugayenko"/> </a> <a href="/about-me.html" class="hire"><span>hire me</span></a></div> <nav><ul class="menu social notranslate"><li><a href="http://www.twitter.com/yegor256" title="follow me in Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li><li><a href="/rss" title="RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li><li><a href="https://github.com/yegor256" title="my GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li><li><a href="http://stackoverflow.com/users/187141/yegor256" title="my StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li><li><a href="https://www.facebook.com/yegor.bugayenko" title="follow me in Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li><li><a href="https://plus.google.com/+YegorBugayenko/posts" title="follow me in Google+"><i class="icon icon-googleplus notranslate" aria-hidden="true"></i></a></li><li><a href="https://www.linkedin.com/in/yegor256" title="my LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li><li><a href="http://www.youtube.com/user/technoparkcorp" title="my Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li><li><a href="https://www.pinterest.com/yegor256/" title="my Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li><li><a href="mailto:yegor@teamed.io" title="yegor@teamed.io"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"><li><a href="/" title="home page">home</a></li><li><a href="/best.html" title="best articles to read">12 best</a></li><li><a href="/contents.html" title="blog contents">all 162</a></li><li><a href="/webinars.html" title="webinars">webinars</a></li><li><a href="/talks.html" title="talks">talks</a></li><li><a href="/award.html" title="software quality award">award</a></li></ul> </nav><div id="search"><form action="https://www.google.com/search" style="position:relative"> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input id="search-query" class="field field-text" onfocus="$('#google').css('display','inline-block')" name="q" placeholder="Search" autocomplete="off"/> <span class="desktop-only"> <input type="image" src="/images/google-search-icon.png" id="google" title="search via Google" style="width:3em;height:3em;display:none;position:absolute;margin-left:1em" alt="search via Google"/> </span></form><div id="search-results" style="display:none"><div class="entries"></div></div></div> <script id="search-results-template" type="text/mustache">
          {{#entries}}
            <div>
              <a href="{{url}}">{{title}}</a>
            </div>
          {{/entries}}
        </script><div class="hot"><ul><li> <strong><a href="/elegant-objects.html">Elegant Objects</a></strong> book can be pre-ordered on Amazon for $40.96! It will be published on Feb 22.</li><li> <a href="https://plus.google.com/events/csfss5361pqvfkm8ot47d699cu0">Webinar #11</a> will be about Daily Stand-Up Meetings. They are pure evil! Join us on Feb 3, at 11am PST</li></ul></div> </header></div> <section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=http://www.yegor256.com/2014/07/31/travis-and-rultor.html&amp;format=svg" style="width:125px;height:125px" alt="QR code"/></p><p class="printable"> <code>http://www.yegor256.com/2014/07/31/travis-and-rultor.html</code></p><h1 itemprop="name">Rultor + Travis</h1><ul class="subline"><li> <time itemprop="datePublished" datetime="2014-07-31T00:00:00+00:00"> 31 July 2014 </time></li><li class='unprintable desktop-only'><a href='https://github.com/yegor256/blog/commits/master/_posts/2014/jul/2014-07-31-travis-and-rultor.md'>modified</a> on <time itemprop='dateModified' datetime='2015-12-22T07:26:48+0000'>22 December 2015</time></li><li class="printable">Yegor Bugayenko</li><li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2014/07/31/travis-and-rultor.html#disqus_thread">comments</a></li></ul><p class="unprintable"><a href='/tag/docker.html' class='tag notranslate'>docker</a> <a href='/tag/rultor.html' class='tag notranslate'>rultor</a> <a href='/tag/devops.html' class='tag notranslate'>devops</a></p><div class="buttons notranslate desktop-only"> <nav class="share" role="navigation"> <a href="http://www.facebook.com/sharer/sharer.php?u=http://www.yegor256.com/2014/07/31/travis-and-rultor.html" title="Share on Facebook" class="button"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=http://www.yegor256.com/2014/07/31/travis-and-rultor.html&amp;text=Rultor+%2B+Travis" title="Share on Twitter" class="button"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=http://www.yegor256.com/2014/07/31/travis-and-rultor.html" title="Share on Google+" class="button"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=http://www.yegor256.com/2014/07/31/travis-and-rultor.html" title="Share on LinkedIn" class="button"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://www.stumbleupon.com/submit?url=http://www.yegor256.com/2014/07/31/travis-and-rultor.html&amp;title=Rultor+%2B+Travis" title="Share on StumbleUpon" class="button"> <span class="count count-stumbleupon">0</span> <i class="icon icon-stumbleupon notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=http://www.yegor256.com/2014/07/31/travis-and-rultor.html%3F2014-30&amp;title=Rultor+%2B+Travis" title="Share on Reddit" class="button"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=http://www.yegor256.com/2014/07/31/travis-and-rultor.html%3F2014-30&amp;t=Rultor+%2B+Travis" title="Share on Hacker News" class="button"> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav></div> </header> <main> <article class="main" itemprop="articleBody"> <figure class='badge'><a href='http://www.travis-ci.org'><img src='/images/2014/07/travis-logo.png' style='width:100px' alt='badge'/></a></figure><figure class='badge'><a href='http://www.rultor.com'><img src='http://doc.rultor.com/images/logo.svg' style='width:100px' alt='badge'/></a></figure><p><a href="http://www.rultor.com">Rultor</a> is a coding team assistant. <a href="http://travis-ci.org">Travis</a> is a hosted <a href="/2014/10/08/continuous-integration-is-dead.html">continuous integration</a> system. In this article I'll show how our open source projects are using them in tandem to achieve seamless continuous delivery.</p><p>I'll show a few practical scenarios.</p><h2 id="scenario-#1:-merge-pull-request">Scenario #1: Merge Pull Request</h2><p><a href="https://github.com/jcabi/jcabi-mysql-maven-plugin">jcabi-mysql-maven-plugin</a> is a Maven plugin for <a href="/2014/05/21/mysql-maven-plugin.html">MySQL integration testing</a>. <a href="https://github.com/ChristianRedl">@ChristianRedl</a> submitted pull request <a href="https://github.com/jcabi/jcabi-mysql-maven-plugin/pull/35">#35</a> with a new feature. I reviewed the request and asked Rultor to merge it into <code>master</code>:</p><figure class='unprintable'><img src='/images/2014/07/rultor-mysql-35.png' style='width:600px' alt='figure'/></figure><p>As you can see, an actual merge operation was made by Rultor. I gave him access to the project by adding his GitHub account to the list of project collaborators.</p><p>Before giving a "go ahead" to Rultor I checked the status of the pre-build reported by Travis:</p><figure class='unprintable'><img src='/images/2014/07/rultor-mysql-35-2.png' style='width:600px' alt='figure'/></figure><p>Travis found a new commit in the pull request and immediately (without any interaction from my side) triggered a build in that branch. The build didn't fail, that's why Travis gave me a green sign. I looked at that sign and at the code. Since all problems in the code were corrected by the pull request author and Travis didn't complain — I gave a "go" to Rultor.</p><h2 id="scenario-#2:-continuous-integration">Scenario #2: Continuous Integration</h2><p>Even though the previous step <a href="/2014/07/21/read-only-master-branch.html">guarantees</a> that <code>master</code> branch is always clean and stable, we're using Travis to continuously integrate it. Every commit made to <code>master</code> triggers a new build in Travis. The result of the build changes the status of the project in Travis: either "failing" or "passing".</p><p><a href="http://aspects.jcabi.com">jcabi-aspects</a> is a collection of <a href="/2014/06/01/aop-aspectj-java-method-logging.html">AOP AspectJ aspects</a>. We configured Travis to build it continuously. This is the badge it produces (the left one):</p><figure class='unprintable'><img src='/images/2014/07/rultor-aspects.png' style='width:600px' alt='figure'/></figure><p>Again, let me stress that even through <a href="/2014/07/21/read-only-master-branch.html">read-only master</a> is a strong protection against broken builds, it doesn't guarantee that at any moment master is stable. For example, sometimes unit tests fail sporadically due to changes in calendar, in environment, in dependencies, in network connection qualities, etc.</p><p>Well, ideally, unit tests should either fail or pass because they are environment independent. However, in reality, unit tests are far from being ideal.</p><p>That's why a combination of <a href="/2014/07/21/read-only-master-branch.html">read-only master</a> with Rultor and <a href="/2014/10/08/continuous-integration-is-dead.html">continuous integration</a> with Travis gives us higher stability.</p><h2 id="scenario-#3:-release-to-rubygems">Scenario #3: Release to RubyGems</h2><p><a href="https://github.com/yegor256/jekyll-github-deploy">jekyll-github-deploy</a> is a Ruby gem that <a href="/2014/06/24/jekyll-github-deploy.html">automates deployment of Jekyll sites to GitHub Pages</a>. <a href="https://github.com/leucos">@leucos</a> submitted a pull request <a href="https://github.com/yegor256/jekyll-github-deploy/pull/4">#4</a> with a new feature. The request was merged successfully into <code>master</code> branch.</p><p>Then, Rultor was instructed by myself that <code>master</code> branch should be released to RubyGems and a new version to set is 1.5:</p><figure class='unprintable'><img src='/images/2014/07/rultor-jekyll-4.png' style='width:600px' alt='figure'/></figure><p>Rultor executed a simple script, <a href="http://doc.rultor.com/basics.html#release">pre-configured</a> in its <a href="https://github.com/yegor256/jekyll-github-deploy/blob/master/.rultor.yml"><code>.rultor.yml</code></a>:</p><div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">release</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">script</span><span class="p-Indicator">:</span> <span class="p-Indicator">|</span>
    <span class="no">./test.sh</span>
    <span class="no">rm -rf *.gem</span>
    <span class="no">sed -i "s/2.0-SNAPSHOT/${tag}/g" jgd.gemspec</span>
    <span class="no">gem build jgd.gemspec</span>
    <span class="no">chmod 0600 ../rubygems.yml</span>
    <span class="no">gem push *.gem --config-file ../rubygems.yml</span></code></pre></div><p>The script is parameterized, as you see. There is one parameter that is passed by Rultor into the script: <code>${tag}</code>. This parameter was provided by myself in the GitHub issue, when I submitted a command to Rultor.</p><p>The script tests that the gem works (integration testing) and clean up afterwords:</p><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>./test.sh
<span class="nv">$ </span>rm -rf *.gem</code></pre></div><p>Then, it changes the version of itself in <code>jgd.gemspec</code> to the one provided in the <code>${tag}</code> (it is an environment variable), and builds a new <code>.gem</code>:</p><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>sed -i <span class="s2">"s/2.0-SNAPSHOT/${tag}/g"</span> jgd.gemspec
<span class="nv">$ </span>gem build jgd.gemspec</code></pre></div><p>Finally, it pushes a newly built <code>.gem</code> to <a href="/2014/08/26/publish-to-rubygems.html">RubyGems</a>, using login credentials from <code>../rubygems.yml</code>. This file is created by Rultor right before starting the script (this mechanism is discussed below):</p><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>chmod <span class="m">0600</span> ../rubygems.yml
<span class="nv">$ </span>gem push *.gem --config-file ../rubygems.yml</code></pre></div><p>If everything works fine and RubyGems confirms successful deployment, Rultor reports to GitHub. This is exactly what happened in <a href="https://github.com/yegor256/jekyll-github-deploy/pull/4">pull request #4</a>.</p><h2 id="scenario-#4:-deploy-to-cloudbees">Scenario #4: Deploy to CloudBees</h2><p><a href="http://www.s3auth.com">s3auth.com</a> is a <a href="/2014/04/21/s3-http-basic-auth.html">Basic HTTP authentication gateway for Amazon S3 Buckets</a>. It is a Java web app. In its pull request <a href="https://github.com/yegor256/s3auth/pull/195">#195</a>, a resource leakage problem was fixed by <a href="https://github.com/carlosmiranda">@carlosmiranda</a> and the pull request was merged by Rultor.</p><p>Then, <a href="https://github.com/davvd">@davvd</a> instructed Rultor to deploy <code>master</code> branch to production environment. Rultor created <a href="/2014/07/29/docker-in-rultor.html">a new Docker container</a> and ran <code>mvn clean deploy</code> in it.</p><p>Maven deployed the application to <a href="http://www.cloudbees.com">CloudBees</a>:</p><figure class='unprintable'><img src='/images/2014/07/rultor-s3auth-195.png' style='width:600px' alt='figure'/></figure><p>The overall procedure took 21 minutes, as you see the in the report generated by Rultor.</p><p>There is one important trick worth mentioning. Deployment to production always means using secure credentials, like login, password, SSH keys, etc.</p><p>In this particular example, <a href="https://wiki.cloudbees.com/bin/view/RUN/MavenGuide">Maven CloudBees Plugin</a> needed API key, secret and web application name. These three parameters are kept secure and can't be revealed in an "<a href="/2015/12/22/why-dont-you-contribute-to-open-source.html">open source</a>" way.</p><p>So, there is <a href="http://doc.rultor.com/reference.html#assets">a mechanism</a> that configures Rultor accordingly through its <a href="https://github.com/yegor256/s3auth/blob/master/.rultor.yml"><code>.rultor.yml</code></a> file (pay attention to the first few lines):</p><div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">assets</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">settings.xml</span><span class="p-Indicator">:</span> <span class="s">"yegor256/home#assets/s3auth/settings.xml"</span>
  <span class="l-Scalar-Plain">pubring.gpg</span><span class="p-Indicator">:</span> <span class="s">"yegor256/home#assets/pubring.gpg"</span>
  <span class="l-Scalar-Plain">secring.gpg</span><span class="p-Indicator">:</span> <span class="s">"yegor256/home#assets/secring.gpg"</span></code></pre></div><p>These YAML entries inform Rultor that it has to get <code>assets/s3auth/settings.xml</code> file from <code>yegor256/home</code> private (!) GitHub repository and put it into the working directory of Docker container, right before starting the Maven build.</p><p>This <code>settings.xml</code> file contains that secret data CloudBees plugin needs in order to deploy the application.</p><p><a href="/2014/08/25/deploy-to-cloudbees.html">How to Deploy to CloudBees, in One Click</a> explains this process even better.</p><h2 id="you-can-do-the-same">You Can Do The Same</h2><p>Both Rultor and Travis are free hosted products, provided your projects are open source and hosted at GitHub.</p><p>Other good examples of Rultor+Travis usage can be seen in these GitHub issues: <a href="https://github.com/jcabi/jcabi-http/issues/47">jcabi/jcabi-http#47</a>, <a href="https://github.com/jcabi/jcabi-http/pull/48">jcabi/jcabi-http#48</a></p><p>PS. You can do something similar with AppVeyor, for Windows platform: <a href="/2015/03/29/rultor-with-appveyor.html">How AppVeyor Helps Me to Validate Pull Requests Before Rultor Merges Them</a></p></article> </main><div class="unprintable"><h2>Related Posts</h2><p>You may also find these posts interesting:</p><ul><li><a href="/2014/07/29/docker-in-rultor.html">Every Build in Its Own Docker Container</a></li><li><a href="/2014/08/29/docker-non-root.html">How We Run as a Non-Root Inside Docker Container</a></li><li><a href="/2015/03/29/rultor-with-appveyor.html">How AppVeyor Helps Me to Validate Pull Requests Before Rultor Merges Them</a></li><li><a href="/2014/09/13/deploying-to-heroku.html">Deploying to Heroku, in One Click</a></li><li><a href="/2014/09/11/deployment-script-vs-rultor.html">Deployment Script vs. Rultor</a></li></ul></div><div class="teamed-banner"> <a href="http://www.teamed.io"><img src="/images/teamed-banner.jpg" alt="teamed banner"/></a></div></div><div class="disqus" role="complementary"><div id="disqus_thread" class="disqus-thread"></div> <a href="http://disqus.com" class="dsq-brlink"> comments powered by <span class="logo-disqus">Disqus</span> </a></div><div class="wrapper"> <footer class="footer"><p> © <span itemprop="author">Yegor Bugayenko</span>, 2014-2015</p> </footer></div></section><script src="http://code.jquery.com/jquery-2.1.0.min.js"></script><script src="/js/global.js?8ba6760"></script><script src="/js/post.js?8ba6760"></script><script>!function(e,a,t,n,c,o,s){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,o=a.createElement(t),s=a.getElementsByTagName(t)[0],o.async=1,o.src=n,s.parentNode.insertBefore(o,s)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-1963507-32","auto"),ga("send","pageview")</script></body></html>