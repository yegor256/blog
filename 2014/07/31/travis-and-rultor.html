<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta charset="utf-8"/><meta name="description" content="Rultor is a virtual team assistant that, in tandem with Travis, optimizes your routine merging, releasing and deploying operations"/><meta name="keywords" content="continuous delivery, continuous integration, docker continuous delivery, docker continuous integration, hosted continuous integration, java continuous integration"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta property="twitter:account_id" content="4503599630178231"/><link rel="icon" type="image/png" href="http://img.yegor256.com/icon-128x128.png"><link rel="shortcut icon" href="//img.yegor256.com/icon-128x128.png"/><link rel="alternate" type="application/rss+xml" title="RSS" href="http://www.yegor256.com/rss.xml"/><link rel="author" href="//plus.google.com/u/0/114792568016408327418?rel=author"/><link rel="stylesheet" href="/css/layout.css?b7e2539"/><link rel="canonical" href="http://www.yegor256.com/2014/07/31/travis-and-rultor.html"/> <script src="/js/search.min.js?b7e2539"></script><script src="/js/all.js?b7e2539"></script><title>Rultor + Travis</title></head><body><div class="wrapper"> <header class="header"><div> <a href="/about-me.html"> <img src="//img.yegor256.com/yegor-bugayenko.jpg" class="photo" alt="photo"/> </a></div> <nav role="navigation"><ul class="menu"><li><a href="/" title="home page"><i class="ico ico-home"></i></a></li><li><a href="http://www.twitter.com/yegor256" title="follow me in Twitter"><i class="ico ico-tweet"></i></a></li><li><a href="/rss" title="RSS feed"><i class="ico ico-rss"></i></a></li><li><a href="https://github.com/yegor256" title="my Github profile"><i class="ico ico-x-github"></i></a></li><li><a href="http://stackoverflow.com/users/187141/yegor256" title="my StackOverflow profile"><i class="ico ico-x-stackoverflow"></i></a></li><li><a href="https://www.facebook.com/yegor.bugayenko" title="follow me in Facebook"><i class="ico ico-x-facebook"></i></a></li><li><a href="https://plus.google.com/+YegorBugayenko/posts" title="follow me in Google+"><i class="ico ico-x-google"></i></a></li><li><a href="https://www.linkedin.com/in/yegor256" title="my LinkedIn profile"><i class="ico ico-x-linkedin"></i></a></li><li><a href="mailto:yegor@teamed.io" title="yegor@teamed.io"><i class="ico ico-email"></i></a></li></ul> </nav><div id="search"> <input id="search-query" class="field field-text" name="q" placeholder="Search" autocomplete="off"/><div id="search-results" style="display:none"><div class="entries"></div></div></div> <script id="search-results-template" type="text/mustache">
          {{#entries}}
            <div>
              <a href="{{url}}">{{title}}</a>
            </div>
          {{/entries}}
        </script></header></div> <section itemscope itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><h1 itemprop="name">Rultor + Travis</h1> </header><p> <time itemprop="datePublished" datetime="2014-07-31T00:00:00+00:00"> 31 July 2014 </time></p><div class="buttons"> <nav class="share" role="navigation"> <a href="http://www.facebook.com/sharer/sharer.php?u=http://www.yegor256.com/2014/07/31/travis-and-rultor.html" title="Share on Facebook" class="button"> <i class="ico ico-facebook"></i> </a> <a href="https://twitter.com/share?url=http://www.yegor256.com/2014/07/31/travis-and-rultor.html&amp;text=Rultor+%2B+Travis" title="Share on Twitter" class="button"> <i class="ico ico-twitter"></i> </a> <a href="https://plus.google.com/share?url=http://www.yegor256.com/2014/07/31/travis-and-rultor.html" title="Share on Google+" class="button"> <i class="ico ico-google"></i> </a> <a href="https://www.linkedin.com/cws/share?url=http://www.yegor256.com/2014/07/31/travis-and-rultor.html" title="Share on LinkedIn" class="button"> <i class="ico ico-linkedin"></i> </a> </nav></div> <main role="main"> <article role="article" itemprop="articleBody"> <figure class='badge'><a href='http://www.travis-ci.org'><img src='http://img.yegor256.com/2014/07/travis-logo.png' style='width:100px' alt='badge'/></a></figure><figure class='badge'><a href='http://www.rultor.com'><img src='http://img.rultor.com/logo.svg' style='width:100px' alt='badge'/></a></figure><p><a href="http://www.rultor.com">Rultor</a> is a coding team assistant. <a href="http://travis-ci.org">Travis</a> is a hosted continuous integration system. In this article I'll show how our open source projects are using them in tandem to achieve seamless continuous delivery.</p><p>I'll show a few practical scenarios.</p><h2 id="scenario-#1:-merge-pull-request">Scenario #1: Merge Pull Request</h2><p><a href="https://github.com/jcabi/jcabi-mysql-maven-plugin">jcabi-mysql-maven-plugin</a> is a Maven plugin for <a href="/2014/05/21/mysql-maven-plugin.html">MySQL integration testing</a>. <a href="https://github.com/ChristianRedl">@ChristianRedl</a> submitted pull request <a href="https://github.com/jcabi/jcabi-mysql-maven-plugin/pull/35">#35</a> with a new feature. I reviewed the request and asked Rultor to merge it into <code>master</code>:</p><figure><img src='http://img.yegor256.com/2014/07/rultor-mysql-35.png' style='width:600px' alt='figure'/></figure><p>As you can see, an actual merge operation was made by Rultor. I gave him access to the project by adding his Github account to the list of project collaborators.</p><p>Before giving a "go ahead" to Rultor I checked the status of the pre-build reported by Travis:</p><figure><img src='http://img.yegor256.com/2014/07/rultor-mysql-35-2.png' style='width:600px' alt='figure'/></figure><p>Travis found a new commit in the pull request and immediately (without any interaction from my side) triggered a build in that branch. The build didn't fail, that's why Travis gave me a green sign. I looked at that sign and at the code. Since all problems in the code were corrected by the pull request author and Travis didn't complain — I gave a "go" to Rultor.</p><h2 id="scenario-#2:-continuous-integration">Scenario #2: Continuous Integration</h2><p>Even though the previous step <a href="/2014/07/21/read-only-master-branch.html">guarantees</a> that <code>master</code> branch is always clean and stable, we're using Travis to continuously integrate it. Every commit made to <code>master</code> triggers a new build in Travis. The result of the build changes the status of the project in Travis: either "failing" or "passing".</p><p><a href="http://aspects.jcabi.com">jcabi-aspects</a> is a collection of <a href="/2014/06/01/aop-aspectj-java-method-logging.html">AOP AspectJ aspects</a>. We configured Travis to build it continuously. This is the badge it produces (the left one):</p><figure><img src='http://img.yegor256.com/2014/07/rultor-aspects.png' style='width:600px' alt='figure'/></figure><p>Again, let me stress that even through <a href="/2014/07/21/read-only-master-branch.html">read-only master</a> is a strong protection against broken builds, it doesn't guarantee that at any moment master is stable. For example, sometimes unit tests fail sporadically due to changes in calendar, in environment, in dependencies, in network connection qualities, etc.</p><p>Well, ideally, unit tests should either fail or pass because they are environment independent. However, in reality, unit tests are far from being ideal.</p><p>That's why a combination of <a href="/2014/07/21/read-only-master-branch.html">read-only master</a> with Rultor and continuous integration with Travis gives us higher stability.</p><h2 id="scenario-#3:-release-to-rubygems">Scenario #3: Release to RubyGems</h2><p><a href="https://github.com/yegor256/jekyll-github-deploy">jekyll-github-deploy</a> is a Ruby gem that <a href="/2014/06/24/jekyll-github-deploy.html">automates deployment of Jekyll sites to Github Pages</a>. <a href="https://github.com/leucos">@leucos</a> submitted a pull request <a href="https://github.com/yegor256/jekyll-github-deploy/pull/4">#4</a> with a new feature. The request was merged successfully into <code>master</code> branch.</p><p>Then, Rultor was instructed by myself that <code>master</code> branch should be released to RubyGems and a new version to set is 1.5:</p><figure><img src='http://img.yegor256.com/2014/07/rultor-jekyll-4.png' style='width:600px' alt='figure'/></figure><p>Rultor executed a simple script, <a href="http://doc.rultor.com/basics.html#release">pre-configured</a> in its <a href="https://github.com/yegor256/jekyll-github-deploy/blob/master/.rultor.yml"><code>.rultor.yml</code></a>:</p><div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">release</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">script</span><span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="s">"./test.sh"</span>
    <span class="p-Indicator">-</span> <span class="s">"rm</span><span class="nv"> </span><span class="s">-rf</span><span class="nv"> </span><span class="s">*.gem"</span>
    <span class="p-Indicator">-</span> <span class="s">"sed</span><span class="nv"> </span><span class="s">-i</span><span class="nv"> </span><span class="s">\"s/2.0-SNAPSHOT/${tag}/g\"</span><span class="nv"> </span><span class="s">jgd.gemspec"</span>
    <span class="p-Indicator">-</span> <span class="s">"gem</span><span class="nv"> </span><span class="s">build</span><span class="nv"> </span><span class="s">jgd.gemspec"</span>
    <span class="p-Indicator">-</span> <span class="s">"chmod</span><span class="nv"> </span><span class="s">0600</span><span class="nv"> </span><span class="s">../rubygems.yml"</span>
    <span class="p-Indicator">-</span> <span class="s">"gem</span><span class="nv"> </span><span class="s">push</span><span class="nv"> </span><span class="s">*.gem</span><span class="nv"> </span><span class="s">--config-file</span><span class="nv"> </span><span class="s">../rubygems.yml"</span></code></pre></div><p>The script is parameterized, as you see. There is one parameter that is passed by Rultor into the script: <code>${tag}</code>. This parameter was provided by myself in the Github issue, when I submitted a command to Rultor.</p><p>The script tests that the gem works (integration testing) and clean up afterwords:</p><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>./test.sh
<span class="nv">$ </span>rm -rf *.gem</code></pre></div><p>Then, it changes the version of itself in <code>jgd.gemspec</code> to the one provided in the <code>${tag}</code> (it is an environment variable), and builds a new <code>.gem</code>:</p><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>sed -i <span class="s2">"s/2.0-SNAPSHOT/${tag}/g"</span> jgd.gemspec
<span class="nv">$ </span>gem build jgd.gemspec</code></pre></div><p>Finally, it pushes a newly built <code>.gem</code> to RubyGems, using login credentials from <code>../rubygems.yml</code>. This file is created by Rultor right before starting the script (this mechanism is discussed below):</p><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>chmod <span class="m">0600</span> ../rubygems.yml
<span class="nv">$ </span>gem push *.gem --config-file ../rubygems.yml</code></pre></div><p>If everything works fine and RubyGems confirms successful deployment, Rultor reports to Github. This is exactly what happened in <a href="https://github.com/yegor256/jekyll-github-deploy/pull/4">pull request #4</a>.</p><h2 id="scenario-#4:-deploy-to-cloudbees">Scenario #4: Deploy to CloudBees</h2><p><a href="http://www.s3auth.com">s3auth.com</a> is a <a href="/2014/04/21/s3-http-basic-auth.html">Basic HTTP authentication gateway for Amazon S3 Buckets</a>. It is a Java web app. In its pull request <a href="https://github.com/yegor256/s3auth/pull/195">#195</a>, a resource leakage problem was fixed by <a href="https://github.com/carlosmiranda">@carlosmiranda</a> and the pull request was merged by Rultor.</p><p>Then, <a href="https://github.com/davvd">@davvd</a> instructed Rultor to deploy <code>master</code> branch to production environment. Rultor created <a href="/2014/07/29/docker-in-rultor.html">a new Docker container</a> and ran <code>mvn clean deploy</code> in it.</p><p>Maven deployed the application to <a href="http://www.cloudbees.com">CloudBees</a>:</p><figure><img src='http://img.yegor256.com/2014/07/rultor-s3auth-195.png' style='width:600px' alt='figure'/></figure><p>The overall procedure took 21 minutes, as you see the in the report generated by Rultor.</p><p>There is one important trick worth mentioning. Deployment to production always means using secure credentials, like login, password, SSH keys, etc.</p><p>In this particular example, <a href="https://wiki.cloudbees.com/bin/view/RUN/MavenGuide">Maven CloudBees Plugin</a> needed API key, secret and web application name. These three parameters are kept secure and can't be revealed in an "open source" way.</p><p>So, there is <a href="http://doc.rultor.com/reference.html#assets">a mechanism</a> that configures Rultor accordingly through its <a href="https://github.com/yegor256/s3auth/blob/master/.rultor.yml"><code>.rultor.yml</code></a> file (pay attention to the first few lines):</p><div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">assets</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">settings.xml</span><span class="p-Indicator">:</span> <span class="s">"yegor256/home#assets/s3auth/settings.xml"</span>
  <span class="l-Scalar-Plain">pubring.gpg</span><span class="p-Indicator">:</span> <span class="s">"yegor256/home#assets/pubring.gpg"</span>
  <span class="l-Scalar-Plain">secring.gpg</span><span class="p-Indicator">:</span> <span class="s">"yegor256/home#assets/secring.gpg"</span></code></pre></div><p>These YAML entries inform Rultor that it has to get <code>assets/s3auth/settings.xml</code> file from <code>yegor256/home</code> private (!) Github repository and put it into the working directory of Docker container, right before starting the Maven build.</p><p>This <code>settings.xml</code> file contains that secret data CloudBees plugin needs in order to deploy the application.</p><h2 id="you-can-do-the-same">You Can Do The Same</h2><p>Both Rultor and Travis are free hosted products, provided your projects are open source and hosted at Github.</p><p>Other good examples of Rultor+Travis usage can be seen in these Github issues: <a href="https://github.com/jcabi/jcabi-http/issues/47">jcabi/jcabi-http#47</a>, <a href="https://github.com/jcabi/jcabi-http/pull/48">jcabi/jcabi-http#48</a></p></article> </main><h2>Related Posts</h2><p>You may also find these posts interesting:</p><ul><li><a href="/2014/07/29/docker-in-rultor.html">Every Build in Its Own Docker Container</a></li><li><a href="/2014/07/24/rultor-automated-merging.html">Rultor.com, a Merging Bot</a></li><li><a href="/2014/07/21/read-only-master-branch.html">Master Branch Must Be Read-Only</a></li></ul></div><div class="disqus" role="complementary"><div id="disqus_thread"></div> <noscript> Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a> </noscript> <a href="http://disqus.com" class="dsq-brlink"> comments powered by <span class="logo-disqus">Disqus</span> </a></div><div class="wrapper"> <footer class="footer"><p> © <span itemprop="author">Yegor Bugayenko</span>, 2014</p> </footer></div></section></body></html>