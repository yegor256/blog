<!doctypehtml><html amp lang="en"><meta charset="utf-8"><title>Rultor + Travis</title><link rel="canonical"href="https://www.yegor256.com/2014/07/31/travis-and-rultor.html"><link rel="icon"type="image/png"href="/favicon.ico"><meta name="viewport"content="width=device-width,minimum-scale=1,initial-scale=1"><script type="application/ld+json">{
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "mainEntityOfPage":{
          "@type": "WebPage",
          "@id": "https://www.yegor256.com/2014/07/31/travis-and-rultor.html"
        },
        "headline": "Rultor + Travis",
        "image": {
          "@type": "ImageObject",
          "url": "https://www.yegor256.com/images/face-1024x1024.jpg",
          "height": 1400,
          "width": 1400
        },
        "datePublished": "2014-07-31",
        "dateModified": "2014-07-31",
        "author": {
          "@type": "Person",
          "name": "Yegor Bugayenko"
        },
        "publisher": {
          "@type": "Organization",
          "name": "yegor256.com",
          "logo": {
            "@type": "ImageObject",
            "url": "https://www.yegor256.com/images/face-512x512.jpg",
            "width": 512,
            "height": 512
          }
        },
        "description": "Rultor is a virtual team assistant that,
in tandem with Travis, optimizes your routine merging,
releasing and deploying operations
",
        "keywords": ["continuous integration", "docker continuous integration", "continuous delivery", "docker continuous delivery", "java continuous integration", "hosted continuous integration"]
      }</script><style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript><link rel="stylesheet"href="https://fonts.googleapis.com/css?family=Source+Code+Pro:400,500"><style amp-custom="amp-custom">@font-face{font-family:Cambria;src:url(https://www.yegor256.com/fonts/cambria/2EAA54_2_0.ttf)}body{font-family:Cambria,'Times New Roman',serif;padding:.5em;font-size:1.2em}article{width:600px;max-width:100%;margin-left:auto;margin-right:auto}code,pre{font-family:'Source Code Pro','Courier New',monospace;font-size:.8em}code{padding:0 .3em;background-color:#d3d3d3}a,a:hover,a:visited{color:inherit}.intro{color:red;font-size:.75em}.photo{border-radius:50%}pre{overflow-x:scroll}</style><script async src="https://cdn.ampproject.org/v0.js"></script><article><p class="intro">This is a mobile version, full one is <a href="https://www.yegor256.com/2014/07/31/travis-and-rultor.html">here</a>.<p><amp-img src="/images/face-256x256.jpg"width="80"height="80"alt="Yegor Bugayenko"class="photo"></amp-img><p>Yegor Bugayenko<br>31 July 2014<h1>Rultor + Travis</h1><p><a href="https://www.rultor.com">Rultor</a> is a coding team assistant. <a href="http://travis-ci.org">Travis</a> is a hosted <a href="/2014/10/08/continuous-integration-is-dead.html">continuous integration</a> system. In this article I’ll show how our open source projects are using them in tandem to achieve seamless continuous delivery.<p>I’ll show a few practical scenarios.<h2 id="scenario-1-merge-pull-request">Scenario #1: Merge Pull Request</h2><p><a href="https://github.com/jcabi/jcabi-mysql-maven-plugin"><code class="language-plaintext highlighter-rouge">jcabi-mysql-maven-plugin</code></a> is a Maven plugin for <a href="/2014/05/21/mysql-maven-plugin.html">MySQL integration testing</a>. <a href="https://github.com/ChristianRedl"><code class="language-plaintext highlighter-rouge">@ChristianRedl</code></a> submitted pull request <a href="https://github.com/jcabi/jcabi-mysql-maven-plugin/pull/35">#35</a> with a new feature. I reviewed the request and asked Rultor to merge it into <code class="language-plaintext highlighter-rouge">master</code>:<p>As you can see, an actual merge operation was made by Rultor. I gave him access to the project by adding his GitHub account to the list of project collaborators.<p>Before giving a “go ahead” to Rultor I checked the status of the pre-build reported by Travis:<p>Travis found a new commit in the pull request and immediately (without any interaction from my side) triggered a build in that branch. The build didn’t fail, that’s why Travis gave me a green sign. I looked at that sign and at the code. Since all problems in the code were corrected by the pull request author and Travis didn’t complain—I gave a “go” to Rultor.<h2 id="scenario-2-continuous-integration">Scenario #2: Continuous Integration</h2><p>Even though the previous step <a href="/2014/07/21/read-only-master-branch.html">guarantees</a> that <code class="language-plaintext highlighter-rouge">master</code> branch is always clean and stable, we’re using Travis to continuously integrate it. Every commit made to <code class="language-plaintext highlighter-rouge">master</code> triggers a new build in Travis. The result of the build changes the status of the project in Travis: either “failing” or “passing.”<p><a href="https://aspects.jcabi.com"><code class="language-plaintext highlighter-rouge">jcabi-aspects</code></a> is a collection of <a href="/2014/06/01/aop-aspectj-java-method-logging.html">AOP AspectJ aspects</a>. We configured Travis to build it continuously. This is the badge it produces (the left one):<p>Again, let me stress that even through <a href="/2014/07/21/read-only-master-branch.html">read-only master</a> is a strong protection against broken builds, it doesn’t guarantee that at any moment master is stable. For example, sometimes unit tests fail sporadically due to changes in calendar, in environment, in dependencies, in network connection qualities, etc.<p>Well, ideally, unit tests should either fail or pass because they are environment independent. However, in reality, unit tests are far from being ideal.<p>That’s why a combination of <a href="/2014/07/21/read-only-master-branch.html">read-only master</a> with Rultor and <a href="/2014/10/08/continuous-integration-is-dead.html">continuous integration</a> with Travis gives us higher stability.<h2 id="scenario-3-release-to-rubygems">Scenario #3: Release to RubyGems</h2><p><a href="https://github.com/yegor256/jekyll-github-deploy"><code class="language-plaintext highlighter-rouge">jekyll-github-deploy</code></a> is a Ruby gem that <a href="/2014/06/24/jekyll-github-deploy.html">automates deployment of Jekyll sites to GitHub Pages</a>. <a href="https://github.com/leucos"><code class="language-plaintext highlighter-rouge">@leucos</code></a> submitted a pull request <a href="https://github.com/yegor256/jekyll-github-deploy/pull/4">#4</a> with a new feature. The request was merged successfully into <code class="language-plaintext highlighter-rouge">master</code> branch.<p>Then, Rultor was instructed by myself that <code class="language-plaintext highlighter-rouge">master</code> branch should be released to RubyGems and a new version to set is 1.5:<p>Rultor executed a simple script, <a href="https://doc.rultor.com/basics.html#release">pre-configured</a> in its <a href="https://github.com/yegor256/jekyll-github-deploy/blob/master/.rultor.yml"><code class="language-plaintext highlighter-rouge">.rultor.yml</code></a>:<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>release:
  script: |
    ./test.sh
    rm -rf *.gem
    sed -i "s/2.0-SNAPSHOT/${tag}/g" jgd.gemspec
    gem build jgd.gemspec
    chmod 0600 ../rubygems.yml
    gem push *.gem --config-file ../rubygems.yml
</code></pre></div></div><p>The script is parameterized, as you see. There is one parameter that is passed by Rultor into the script: <code class="language-plaintext highlighter-rouge">${tag}</code>. This parameter was provided by myself in the GitHub issue, when I submitted a command to Rultor.<p>The script tests that the gem works (integration testing) and clean up afterwords:<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>./test.sh
<span class="nv">$ </span><span class="nb">rm</span> <span class="nt">-rf</span> <span class="k">*</span>.gem
</code></pre></div></div><p>Then, it changes the version of itself in <code class="language-plaintext highlighter-rouge">jgd.gemspec</code> to the one provided in the <code class="language-plaintext highlighter-rouge">${tag}</code> (it is an environment variable), and builds a new <code class="language-plaintext highlighter-rouge">.gem</code>:<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sed</span> <span class="nt">-i</span> <span class="s2">"s/2.0-SNAPSHOT/</span><span class="k">${</span><span class="nv">tag</span><span class="k">}</span><span class="s2">/g"</span> jgd.gemspec
<span class="nv">$ </span>gem build jgd.gemspec
</code></pre></div></div><p>Finally, it pushes a newly built <code class="language-plaintext highlighter-rouge">.gem</code> to <a href="/2014/08/26/publish-to-rubygems.html">RubyGems</a>, using login credentials from <code class="language-plaintext highlighter-rouge">../rubygems.yml</code>. This file is created by Rultor right before starting the script (this mechanism is discussed below):<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">chmod </span>0600 ../rubygems.yml
<span class="nv">$ </span>gem push <span class="k">*</span>.gem <span class="nt">--config-file</span> ../rubygems.yml
</code></pre></div></div><p>If everything works fine and RubyGems confirms successful deployment, Rultor reports to GitHub. This is exactly what happened in <a href="https://github.com/yegor256/jekyll-github-deploy/pull/4">pull request #4</a>.<h2 id="scenario-4-deploy-to-cloudbees">Scenario #4: Deploy to CloudBees</h2><p><a href="https://www.s3auth.com">s3auth.com</a> is a <a href="/2014/04/21/s3-http-basic-auth.html">Basic HTTP authentication gateway for Amazon S3 Buckets</a>. It is a Java web app. In its pull request <a href="https://github.com/yegor256/s3auth/pull/195">#195</a>, a resource leakage problem was fixed by <a href="https://github.com/carlosmiranda"><code class="language-plaintext highlighter-rouge">@carlosmiranda</code></a> and the pull request was merged by Rultor.<p>Then, <a href="https://github.com/davvd"><code class="language-plaintext highlighter-rouge">@davvd</code></a> instructed Rultor to deploy <code class="language-plaintext highlighter-rouge">master</code> branch to production environment. Rultor created <a href="/2014/07/29/docker-in-rultor.html">a new Docker container</a> and ran <code class="language-plaintext highlighter-rouge">mvn clean deploy</code> in it.<p>Maven deployed the application to <a href="https://www.cloudbees.com">CloudBees</a>:<p>The overall procedure took 21 minutes, as you see the in the report generated by Rultor.<p>There is one important trick worth mentioning. Deployment to production always means using secure credentials, like login, password, SSH keys, etc.<p>In this particular example, <a href="https://wiki.cloudbees.com/bin/view/RUN/MavenGuide">Maven CloudBees Plugin</a> needed API key, secret and web application name. These three parameters are kept secure and can’t be revealed in an “<a href="/2015/12/22/why-dont-you-contribute-to-open-source.html">open source</a>” way.<p>So, there is <a href="https://doc.rultor.com/reference.html#assets">a mechanism</a> that configures Rultor accordingly through its <a href="https://github.com/yegor256/s3auth/blob/master/.rultor.yml"><code class="language-plaintext highlighter-rouge">.rultor.yml</code></a> file (pay attention to the first few lines):<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>assets:
  settings.xml: "yegor256/home#assets/s3auth/settings.xml"
  pubring.gpg: "yegor256/home#assets/pubring.gpg"
  secring.gpg: "yegor256/home#assets/secring.gpg"
</code></pre></div></div><p>These YAML entries inform Rultor that it has to get <code class="language-plaintext highlighter-rouge">assets/s3auth/settings.xml</code> file from <code class="language-plaintext highlighter-rouge">yegor256/home</code> private (!) GitHub repository and put it into the working directory of Docker container, right before starting the Maven build.<p>This <code class="language-plaintext highlighter-rouge">settings.xml</code> file contains that secret data CloudBees plugin needs in order to deploy the application.<p><a href="/2014/08/25/deploy-to-cloudbees.html">How to Deploy to CloudBees, in One Click</a> explains this process even better.<h2 id="you-can-do-the-same">You Can Do The Same</h2><p>Both Rultor and Travis are free hosted products, provided your projects are open source and hosted at GitHub.<p>Other good examples of Rultor+Travis usage can be seen in these GitHub issues: <a href="https://github.com/jcabi/jcabi-http/issues/47"><code class="language-plaintext highlighter-rouge">jcabi/jcabi-http#47</code></a>, <a href="https://github.com/jcabi/jcabi-http/pull/48"><code class="language-plaintext highlighter-rouge">jcabi/jcabi-http#48</code></a><p>PS. You can do something similar with AppVeyor, for Windows platform: <a href="/2015/03/29/rultor-with-appveyor.html">How AppVeyor Helps Me to Validate Pull Requests Before Rultor Merges Them</a></article>