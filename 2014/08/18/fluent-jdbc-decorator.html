<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta charset="utf-8"/><meta name="description" content="jcabi-jdbc is a fluent wrapper of JDBC, making interaction with relational databases easier and much less verbose"/><meta name="keywords" content="jdbc fluent wrapper, jdbc wrapper, jdbc wrapper library, jdbc wrapper tool, lightweight jdbc wrapper"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta property="twitter:account_id" content="4503599630178231"/><meta name="blogcatalog" content="37407fab23a5d309f7bb5ef9fd22c6d5"/><link rel="icon" type="image/png" href="http://img.yegor256.com/icon-128x128.png"><link rel="shortcut icon" href="//img.yegor256.com/icon-128x128.png"/><link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="http://www.yegor256.com/rss.xml"/><link rel="author" href="//plus.google.com/u/0/114792568016408327418?rel=author"/><link rel="stylesheet" href="/css/layout.css?667e755"/><link rel="canonical" href="http://www.yegor256.com/2014/08/18/fluent-jdbc-decorator.html"/> <script src="/js/search.min.js?667e755"></script><script src="/js/all.js?667e755"></script><title>Fluent JDBC Decorator</title></head><body><div class="wrapper"> <header class="header"><div> <a href="/about-me.html"> <img src="//img.yegor256.com/yegor-bugayenko.jpg" class="photo" alt="photo"/> </a></div> <nav role="navigation"><ul class="menu social"><li><a href="http://www.twitter.com/yegor256" title="follow me in Twitter"><i class="ico ico-twitter"></i></a></li><li><a href="/rss" title="RSS feed"><i class="ico ico-rss"></i></a></li><li><a href="https://github.com/yegor256" title="my Github profile"><i class="ico ico-github"></i></a></li><li><a href="http://stackoverflow.com/users/187141/yegor256" title="my StackOverflow profile"><i class="ico ico-stackoverflow"></i></a></li><li><a href="https://www.facebook.com/yegor.bugayenko" title="follow me in Facebook"><i class="ico ico-facebook"></i></a></li><li><a href="https://plus.google.com/+YegorBugayenko/posts" title="follow me in Google+"><i class="ico ico-google"></i></a></li><li><a href="https://www.linkedin.com/in/yegor256" title="my LinkedIn profile"><i class="ico ico-linkedin"></i></a></li><li><a href="mailto:yegor@teamed.io" title="yegor@teamed.io"><i class="ico ico-email"></i></a></li></ul><ul class="menu"><li> <a href="/best.html" title="best articles to read">12 best articles</a> (out of <a href="/contents.html" title="blog contents">61</a>) <a href="/" title="home page">home</a></li></ul> </nav><div id="search"> <input id="search-query" class="field field-text" name="q" placeholder="Search" autocomplete="off"/><div id="search-results" style="display:none"><div class="entries"></div></div></div> <script id="search-results-template" type="text/mustache">
          {{#entries}}
            <div>
              <a href="{{url}}">{{title}}</a>
            </div>
          {{/entries}}
        </script></header></div> <section itemscope itemtype="http://schema.org/BlogPosting"><div class="wrapper"><p> <time itemprop="datePublished" datetime="2014-08-18T00:00:00+00:00"> 18 August 2014 </time></p> <header><h1 itemprop="name">Fluent JDBC Decorator</h1> </header><p><a href="/tag/jcabi.html" class='tag'>jcabi</a> <a href="/tag/java.html" class='tag'>java</a> <a href="/tag/jdbc.html" class='tag'>jdbc</a></p><div class="buttons"> <nav class="share" role="navigation"> <a href="http://www.facebook.com/sharer/sharer.php?u=http://www.yegor256.com/2014/08/18/fluent-jdbc-decorator.html" title="Share on Facebook" class="button"> <i class="ico ico-facebook"></i> </a> <a href="https://twitter.com/share?url=http://www.yegor256.com/2014/08/18/fluent-jdbc-decorator.html&amp;text=Fluent+JDBC+Decorator" title="Share on Twitter" class="button"> <i class="ico ico-twitter"></i> </a> <a href="https://plus.google.com/share?url=http://www.yegor256.com/2014/08/18/fluent-jdbc-decorator.html" title="Share on Google+" class="button"> <i class="ico ico-google"></i> </a> <a href="https://www.linkedin.com/cws/share?url=http://www.yegor256.com/2014/08/18/fluent-jdbc-decorator.html" title="Share on LinkedIn" class="button"> <i class="ico ico-linkedin"></i> </a> <a href="http://www.stumbleupon.com/submit?url=http://www.yegor256.com/2014/08/18/fluent-jdbc-decorator.html&amp;title=Fluent JDBC Decorator" title="Share on StumbleUpon" class="button"> <i class="ico ico-stumbleupon"></i> </a> <a href="http://digg.com/submit?phase=2&amp;url=http://www.yegor256.com/2014/08/18/fluent-jdbc-decorator.html&amp;title=Fluent JDBC Decorator" title="Share on Digg" class="button"> <i class="ico ico-digg"></i> </a> <a href="http://reddit.com/submit?url=http://www.yegor256.com/2014/08/18/fluent-jdbc-decorator.html&amp;title=Fluent JDBC Decorator" title="Share on Reddit" class="button"> <i class="ico ico-reddit"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=http://www.yegor256.com/2014/08/18/fluent-jdbc-decorator.html&amp;t=Fluent JDBC Decorator" title="Share on Hacker News" class="button"> <i class="ico ico-hackernews"></i> </a> </nav></div> <main role="main"> <article role="article" itemprop="articleBody"> <figure class='badge'><a href='http://aspects.jcabi.com'><img src='http://img.jcabi.com/logo-square.svg' style='width:64px' alt='badge'/></a></figure><p>This is how you fetch text from a SQL table with <a href="http://jdbc.jcabi.com">jcabi-jdbc</a>:</p><div class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">String</span> <span class="n">name</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">JdbcSession</span><span class="o">(</span><span class="n">source</span><span class="o">)</span>
  <span class="o">.</span><span class="na">sql</span><span class="o">(</span><span class="s">"SELECT name FROM employee WHERE id = ?"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="mi">1234</span><span class="o">)</span>
  <span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="k">new</span> <span class="n">SingleOutcome</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">));</span></code></pre></div><p>Simple and straight forward, isn't it? The library simplifies interaction with relational databases via JDBC, avoiding the need to use ORMs.</p><p><a href="http://jdbc.jcabi.com">jcabi-jdbc</a> is a lightweight wrapper of <a href="http://www.oracle.com/technetwork/java/javase/jdbc/index.html">JDBC</a>. It is very convenient to use when you don't need a full-scale ORM (like Hibernate), but want just to select, insert, or update a few rows in a relational database.</p><p>Every instance of <code>JdbcSession</code> is a "transaction" in a database. You start it by instantiating the class with a single parameter — data source.</p><p>You can obtain the data source from your connection pool. There are many implementations of connection pools. I would recommend that you use <a href="http://jolbox.com/">BoneCP</a>. Below is an example of how you would connect to PostgreSQL:</p><div class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@Cacheable</span><span class="o">(</span><span class="n">forever</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="n">DataSource</span> <span class="nf">source</span><span class="o">()</span> <span class="o">{</span>
  <span class="n">BoneCPDataSource</span> <span class="n">src</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">BoneCPDataSource</span><span class="o">();</span>
  <span class="n">src</span><span class="o">.</span><span class="na">setDriverClass</span><span class="o">(</span><span class="s">"org.postgresql.Driver"</span><span class="o">);</span>
  <span class="n">src</span><span class="o">.</span><span class="na">setJdbcUrl</span><span class="o">(</span><span class="s">"jdbc:postgresql://localhost/db_name"</span><span class="o">);</span>
  <span class="n">src</span><span class="o">.</span><span class="na">setUser</span><span class="o">(</span><span class="s">"jeff"</span><span class="o">);</span>
  <span class="n">src</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="s">"secret"</span><span class="o">);</span>
  <span class="k">return</span> <span class="n">src</span><span class="o">;</span>
<span class="o">}</span></code></pre></div><p>Be sure to pay attention to the <code>@Cacheable</code> annotation. <a href="/2014/08/03/cacheable-java-annotation.html">This post</a> explains how it can help you to cache Java method results for some time. Setting the <code>forever</code> attribute to <code>true</code> means that we don't want this method to be called more than once. Instead, we want the connection pool to be created just once, and every second call should return its existing instance (kind of like a Singleton pattern).</p><p><a href="http://jdbc.jcabi.com">jcabi-jdbc</a> website explains how you can <a href="http://jdbc.jcabi.com/example-insert.html">insert</a>, <a href="http://jdbc.jcabi.com/example-update.html">update</a>, or delete a row. You can also <a href="http://jdbc.jcabi.com/example-execute.html">execute any SQL statement</a>.</p><p>By default, <code>JdbcSession</code> closes the JDBC connection right after the first select/update/insert operation. Simply put, it is designed to be used mainly for single atomic transactions. However, it is possible to leave the connection open and continue, for example:</p><div class="highlight"><pre><code class="language-java" data-lang="java"><span class="k">new</span> <span class="nf">JdbcSession</span><span class="o">(</span><span class="n">source</span><span class="o">)</span>
  <span class="o">.</span><span class="na">autocommit</span><span class="o">(</span><span class="kc">false</span><span class="o">)</span>
  <span class="o">.</span><span class="na">sql</span><span class="o">(</span><span class="s">"START TRANSACTION"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">update</span><span class="o">()</span>
  <span class="o">.</span><span class="na">sql</span><span class="o">(</span><span class="s">"DELETE FROM employee WHERE name = ?"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="s">"Jeff Lebowski"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">update</span><span class="o">()</span>
  <span class="o">.</span><span class="na">sql</span><span class="o">(</span><span class="s">"INSERT INTO employee VALUES (?)"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="s">"Walter Sobchak"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="n">Outcome</span><span class="o">.</span><span class="na">VOID</span><span class="o">)</span>
  <span class="o">.</span><span class="na">commit</span><span class="o">();</span></code></pre></div><p>In this example we're executing three SQL statements one by one, leaving connection (and transaction) open unti <code>commit()</code> is called.</p></article> </main><h2>Related Posts</h2><p>You may also find these posts interesting:</p><ul><li><a href="/2014/09/02/java-ssh-client.html">Simple Java SSH Client</a></li><li><a href="/2014/08/15/retry-java-method-on-exception.html">How to Retry Java Method Call on Exception</a></li><li><a href="/2014/08/03/cacheable-java-annotation.html">Cache Java Method Results</a></li><li><a href="/2014/07/03/how-to-read-manifest-mf.html">How to Read MANIFEST.MF Files</a></li><li><a href="/2014/06/01/aop-aspectj-java-method-logging.html">Java Method Logging with AOP and Annotations</a></li></ul></div><div class="disqus" role="complementary"><div id="disqus_thread"></div> <noscript> Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a> </noscript> <a href="http://disqus.com" class="dsq-brlink"> comments powered by <span class="logo-disqus">Disqus</span> </a></div><div class="wrapper"> <footer class="footer"><p> © <span itemprop="author">Yegor Bugayenko</span>, 2014</p> </footer></div></section></body></html>