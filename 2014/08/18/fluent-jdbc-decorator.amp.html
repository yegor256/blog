<!DOCTYPE html>
<html amp lang="en">
  <head>

    <meta charset="utf-8">
    <title>Fluent JDBC Decorator</title>
    <link rel="canonical" href="https://www.yegor256.com/2014/08/18/fluent-jdbc-decorator.html">
    <link rel="icon" type="image/png" href="/favicon.ico">
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
    <script type="application/ld+json">
      {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "mainEntityOfPage":{
          "@type": "WebPage",
          "@id": "https://www.yegor256.com/2014/08/18/fluent-jdbc-decorator.html"
        },
        "headline": "Fluent JDBC Decorator",
        "image": {
          "@type": "ImageObject",
          "url": "https://www.yegor256.com/images/face-1200x1200.jpg",
          "height": 1400,
          "width": 1400
        },
        "datePublished": "2014-08-18",
        "dateModified": "2014-08-18",
        "author": {
          "@type": "Person",
          "name": "Yegor Bugayenko"
        },
        "publisher": {
          "@type": "Organization",
          "name": "yegor256.com",
          "logo": {
            "@type": "ImageObject",
            "url": "https://www.yegor256.com/images/face-512x512.jpg",
            "width": 512,
            "height": 512
          }
        },
        "description": "jcabi-jdbc is a fluent wrapper of JDBC, making
interaction with relational databases easier and
much less verbose
",
        "keywords": ["jdbc wrapper", "jdbc fluent wrapper", "jdbc wrapper library", "jdbc wrapper tool", "lightweight jdbc wrapper"]
      }
    </script>
    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style>
<noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Code+Pro:400,500">
    <style amp-custom="amp-custom">
      @font-face {
        font-family: 'Cambria';
        src: url('https://www.yegor256.com/fonts/cambria/2EAA54_2_0.ttf');
      }
      body { font-family: 'Cambria', 'Times New Roman', serif; padding: .5em; font-size: 1.2em; }
      article { width: 600px; max-width: 100%; margin-left: auto; margin-right: auto; }
      pre, code { font-family: 'Source Code Pro', 'Courier New', monospace; font-size: .8em; }
      code { padding: 0 .3em; background-color: lightgray; }
      a, a:hover, a:visited { color: inherit; }
      .intro { color: red; font-size: .75em; }
      .photo { border-radius: 50%; }
      pre { overflow-x:scroll; }
    </style>
    <script async src="https://cdn.ampproject.org/v0.js"></script>
  </head>
  <body>
    <article>
      <p class="intro">
        This is a mobile version, full one is
        <a href="https://www.yegor256.com/2014/08/18/fluent-jdbc-decorator.html">here</a>.
      </p>
      <p>
        <amp-img src="/images/face-256x256.jpg" width="80" height="80" alt="Yegor Bugayenko" class="photo"></amp-img>
      </p>
      <p>Yegor Bugayenko<br>18 August 2014</p>
      <h1>Fluent JDBC Decorator</h1>
      

<p>This is how you fetch text from a SQL table
with <a href="http://jdbc.jcabi.com">jcabi-jdbc</a>:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">String</span> <span class="n">name</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">JdbcSession</span><span class="o">(</span><span class="n">source</span><span class="o">)</span>
  <span class="o">.</span><span class="na">sql</span><span class="o">(</span><span class="s">"SELECT name FROM employee WHERE id = ?"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="mi">1234</span><span class="o">)</span>
  <span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="k">new</span> <span class="nc">SingleOutcome</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;(</span><span class="nc">String</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>
</code></pre></div></div>

<p>Simple and straight forward, isn’t it? The library
simplifies interaction with relational databases
via JDBC, avoiding the need to use
<a href="/2014/12/01/orm-offensive-anti-pattern.html">ORM</a>.</p>



<p><a href="http://jdbc.jcabi.com">jcabi-jdbc</a> is a lightweight wrapper of
<a href="http://www.oracle.com/technetwork/java/javase/jdbc/index.html">JDBC</a>.
It is very convenient to use when you don’t need a full-scale
<a href="/2014/12/01/orm-offensive-anti-pattern.html">ORM</a>
(like Hibernate), but want just to select, insert, or update
a few rows in a relational database.</p>

<p>Every instance of <code class="highlighter-rouge">JdbcSession</code> is a “transaction” in a database.
You start it by instantiating the class with a single parameter—data source.</p>

<p>You can obtain the data source from your connection pool. There are many
implementations of connection pools. I would recommend that you use
<a href="http://www.jolbox.com/">BoneCP</a>. Below is an example of how you would connect to PostgreSQL:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Cacheable</span><span class="o">(</span><span class="n">forever</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="nc">DataSource</span> <span class="nf">source</span><span class="o">()</span> <span class="o">{</span>
  <span class="nc">BoneCPDataSource</span> <span class="n">src</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BoneCPDataSource</span><span class="o">();</span>
  <span class="n">src</span><span class="o">.</span><span class="na">setDriverClass</span><span class="o">(</span><span class="s">"org.postgresql.Driver"</span><span class="o">);</span>
  <span class="n">src</span><span class="o">.</span><span class="na">setJdbcUrl</span><span class="o">(</span><span class="s">"jdbc:postgresql://localhost/db_name"</span><span class="o">);</span>
  <span class="n">src</span><span class="o">.</span><span class="na">setUser</span><span class="o">(</span><span class="s">"jeff"</span><span class="o">);</span>
  <span class="n">src</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="s">"secret"</span><span class="o">);</span>
  <span class="k">return</span> <span class="n">src</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Be sure to pay attention to the <code class="highlighter-rouge">@Cacheable</code> annotation.
<a href="/2014/08/03/cacheable-java-annotation.html">This post</a>
explains how it can help you to cache Java method results for some time.
Setting the <code class="highlighter-rouge">forever</code> attribute to <code class="highlighter-rouge">true</code> means that we don’t want this
method to be called more than once. Instead, we want the connection pool
to be created just once, and every second call should return its
existing instance (kind of like a
<a href="/2016/02/03/design-patterns-and-anti-patterns.html">Singleton pattern</a>).</p>

<p><a href="http://jdbc.jcabi.com">jcabi-jdbc</a> website explains how you
can <a href="http://jdbc.jcabi.com/example-insert.html">insert</a>,
<a href="http://jdbc.jcabi.com/example-update.html">update</a>, or
delete a row. You can also
<a href="http://jdbc.jcabi.com/example-execute.html">execute any SQL statement</a>.</p>

<p>By default, <code class="highlighter-rouge">JdbcSession</code> closes the JDBC connection right after the
first select/update/insert operation. Simply put, it is designed
to be used mainly for single atomic transactions. However, it is
possible to leave the connection open and continue, for example:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">new</span> <span class="nc">JdbcSession</span><span class="o">(</span><span class="n">source</span><span class="o">)</span>
  <span class="o">.</span><span class="na">autocommit</span><span class="o">(</span><span class="kc">false</span><span class="o">)</span>
  <span class="o">.</span><span class="na">sql</span><span class="o">(</span><span class="s">"START TRANSACTION"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">update</span><span class="o">()</span>
  <span class="o">.</span><span class="na">sql</span><span class="o">(</span><span class="s">"DELETE FROM employee WHERE name = ?"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="s">"Jeff Lebowski"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">update</span><span class="o">()</span>
  <span class="o">.</span><span class="na">sql</span><span class="o">(</span><span class="s">"INSERT INTO employee VALUES (?)"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="s">"Walter Sobchak"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="nc">Outcome</span><span class="o">.</span><span class="na">VOID</span><span class="o">)</span>
  <span class="o">.</span><span class="na">commit</span><span class="o">();</span>
</code></pre></div></div>

<p>In this example we’re executing three SQL statements one by one, leaving
connection (and transaction) open until <code class="highlighter-rouge">commit()</code> is called.</p>


    </article>
  </body>
</html>
