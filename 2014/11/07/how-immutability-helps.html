<!doctypehtml><html xmlns="https://www.w3.org/1999/xhtml"lang="en-US"xml:lang="en-US"itemscope=""itemtype="http://schema.org/WebSite"><meta charset="utf-8"><meta name="description"content="This article illustrates by example how immutability forces you to design small and cohesive objects, while mutability causes scope creep and tight coupling."><meta name="keywords"content="email sending java, immutability example java, immutable object example, java email api, java email send, java email send sdk, java send email html"><meta name="viewport"content="width=device-width,minimum-scale=1,initial-scale=1"><meta name="google-site-verification"content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8"><meta name="author"content="Yegor Bugayenko"><meta name="article:published_time"content="2014-11-07 00:00:00 +0000"><meta name="yandex-verification"content="7d2a0afee14d72bc"><meta name="og:site_name"content="Yegor Bugayenko"><meta name="og:type"content="article"><meta name="og:locale"content="en_US"><meta name="twitter:account_id"content="4503599630178231"><meta name="twitter:creator"content="@yegor256"><meta name="twitter:site"content="@yegor256"><meta name="twitter:title"property="og:title"content="How Immutability Helps"><meta name="twitter:description"property="og:description"content="This article illustrates by example how immutability forces you to design small and cohesive objects, while mutability causes scope creep and tight coupling."><meta name="twitter:url"property="og:url"content="https://www.yegor256.com/2014/11/07/how-immutability-helps.html"><meta name="telegram:channel"content="AAAAAEJFMRzsRTRxM3ec6A"><link rel="search"type="application/opensearchdescription+xml"href="/opensearch.xml"title="yegor256"><link rel="icon"href="/favicon.ico?bea9b23"type="image/x-icon"><link rel="shortcut icon"href="/favicon.ico?bea9b23"><link rel="apple-touch-icon"href="/favicon.ico?bea9b23"><link rel="alternate"type="application/rss+xml"title="RSS for yegor256.com"href="https://www.yegor256.com/rss.xml"><link rel="stylesheet"href="/css/layout.css?bea9b23"><link rel="stylesheet"href="/css/icons.css?bea9b23"><link rel="canonical"href="https://www.yegor256.com/2014/11/07/how-immutability-helps.html"><title>How Immutability Helps</title><script src="https://code.jquery.com/jquery-3.7.1.min.js"integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="crossorigin="anonymous"></script><script src="/js/all.js?bea9b23"></script><script id="dsq-count-scr"src="https://yegor256.disqus.com/count.js"async="async"></script><script>((e,a,t,n,o,c)=>{e.GoogleAnalyticsObject=n,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=+new Date,o=a.createElement(t),c=a.getElementsByTagName(t)[0],o.async=1,o.src="//www.google-analytics.com/analytics.js",c.parentNode.insertBefore(o,c)})(window,document,"script","ga"),ga("create","UA-1963507-32","auto"),ga("send","pageview"),Cd=document,Cr="&"+Math.random(),Cp="&s=1",Cd.cookie="b=b",Cd.cookie&&(Cp+="&c=1"),Cp+="&t="+(new Date).getTimezoneOffset(),self!=top&&(Cp+="&f=1"),navigator.javaEnabled()&&(Cp+="&j=1"),"undefined"!=typeof screen&&(Cp+="&w="+screen.width+"&h="+screen.height+"&d="+(screen.colorDepth||screen.pixelDepth))</script><script type="application/ld+json">{ "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "https://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/", "https://www.youtube.com/c/yegor256" ] }</script><div class="wrapper"><aside class="header-toggle unprintable"id="header-toggle"title="Show the menu"onclick='$("#header").show(),$("#header-toggle").hide()'>&#9776;</aside><header class="header"id="header"><div class="face"><a href="/about-me.html#form"class="sub"title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html"style="position:relative"><img src="/images/santa-hat.svg"alt="Santa hat"style="position:absolute;width:115px;left:-30px;top:-120px"> <img src="/images/face-256x256.jpg"class="photo"alt="Yegor Bugayenko"></a></div><nav><ul class="menu social notranslate"><li><a href="https://twitter.com/intent/follow?screen_name=yegor256"rel="nofollow"title="Follow me on Twitter"><i class="icon icon-twitter notranslate"aria-hidden="true"></i></a><li><a href="/rss.xml"rel="nofollow"title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate"aria-hidden="true"></i></a><li><a itemprop="sameAs"href="https://github.com/yegor256"rel="nofollow"title="My GitHub profile"><i class="icon icon-github notranslate"aria-hidden="true"></i></a><li><a itemprop="sameAs"href="http://stackoverflow.com/users/187141/yegor256"rel="nofollow"title="My Stack Overflow profile"><i class="icon icon-stackoverflow notranslate"aria-hidden="true"></i></a><li><a itemprop="sameAs"href="https://www.facebook.com/yegor256"rel="nofollow"title="Follow me on Facebook"><i class="icon icon-facebook notranslate"aria-hidden="true"></i></a><li><a itemprop="sameAs"href="https://instagram.com/yegor256"rel="nofollow"title="Follow me on Instagram"><i class="icon icon-instagram notranslate"aria-hidden="true"></i></a><li><a itemprop="sameAs"href="https://www.linkedin.com/in/yegor256"rel="nofollow"title="My LinkedIn profile"><i class="icon icon-linkedin notranslate"aria-hidden="true"></i></a><li><a itemprop="sameAs"href="https://www.youtube.com/c/yegor256?sub_confirmation=1"rel="nofollow"title="My Youtube video channel"><i class="icon icon-youtube notranslate"aria-hidden="true"></i></a><li><a href="https://soundcloud.com/yegor256"rel="nofollow"title="My podcast"><i class="icon icon-podcast notranslate"aria-hidden="true"></i></a><li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721"rel="nofollow"title="My iTunes podcast"><i class="icon icon-itunes notranslate"aria-hidden="true"></i></a><li><a href="https://t.me/yegor256news"rel="nofollow"title="My Telegram public channel"><i class="icon icon-telegram notranslate"aria-hidden="true"></i></a><li><a href="mailto:blog@yegor256.com"rel="nofollow"title="Email me any time"><i class="icon icon-mail notranslate"aria-hidden="true"></i></a></ul><ul class="menu"><li><a href="/"title="Home page">Home</a><li><a href="/best.html"title="Best articles to read">12&#160;Best</a><li><a href="/contents.html"title="The contents of the entire blog">All&#160;486</a><li><a href="/teaching.html"title="My courses and lectures">Teaching</a><li><a href="/talks.html"title="Future and past conference talks">Talks</a><li><a href="/books.html"title="The books I wrote">Books</a><li><a href="/research.html"title="My research directions and progress">Research</a><li><a href="/pets.html"title="My loved pet projects">Pets</a><li><a href="/trainings.html"title="On-site trainings">Trainings</a><li><a href="https://www.iccq.ru"title="International Conference on Code Quality">ICCQ</a><li><a href="https://www.kaicode.org"title="Open Source Festival">KaiCode</a><li><a href="/testimonials.html"title="What some people say about me">Testimonials</a><li><a href="/shift-m.html"title="Audio podcast about project management">Shift-M</a><li><a href="/paintings.html"title="My paintings for sale">Art</a></ul></nav><div class="search"><form action="https://www.google.com/search"itemprop="potentialAction"itemscope=""itemtype="http://schema.org/SearchAction"><meta itemprop="target"content="https://www.google.com/search?q={q}"><input name="sitesearch"value="yegor256.com"type="hidden"> <input itemprop="query-input"id="search-query"class="field field-text"required="required"onfocus='$(".google").css("visibility","visible")'name="q"placeholder="Type üÑµ to search"autocomplete="off"> <input type="image"src="/images/google-search-icon.svg"class="google"title="Search via Google"alt="Search via Google"></form></div><div class="hot"><ul><li>We are organizing the <strong>6th <a href="https://www.iccq.ru/2026.html">ICCQ</a> conference</strong> in collaboration with <a href="https://www.iis.nsk.su/en">IIS</a> (Novosibirsk) and, hopefully, IEEE Computer Society. We're looking for volunteers to help us. If interested, please email at <a href="mailto:orgs@iccq.ru">orgs@iccq.ru</a> (attach your LinkedIn and GitHub profiles).<li>Are you familiar with open source and have a decent GitHub portfolio of contributions? <strong>We need freelancers</strong>, working remotely and paid by result, for <a href="https://www.eolang.org">EO</a>, a new programming language. Join our Telegram group, we'll discuss: <a href="https://t.me/eolang_org">@eolang_org</a>.</ul></div></header></div><section itemscope=""itemtype="http://schema.org/BlogPosting"><div class="wrapper"><header><p class="printable"><img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2014/11/07/how-immutability-helps.html&amp;format=svg"style="width:125px;height:125px"alt="QR code"><p class="printable"><code itemprop="url">https://www.yegor256.com/141107.html</code><h1 itemprop="name headline mainEntityOfPage">How Immutability Helps</h1><aside class="book"><a href="https://amzn.to/2qFt4Tn"><img src="/images/books/elegant-objects/cover-eo1.png"class="book-cover"alt="book cover"></a>Read more about this subject in <a href="https://amzn.to/2qFt4Tn">Section&nbsp;2.6</a><br>of my book <a href="https://amzn.to/2qFt4Tn"><img src="/images/books/amazon-buy-button.png"class="amazon-button"alt="Click to buy"></a></aside><ul class="subline"><li><time itemprop="datePublished"datetime="2014-11-07T00:00:00+00:00">7 November 2014</time><li class="printable"itemscope=""itemprop="author"itemtype="http://schema.org/Person"><span itemprop="name">Yegor Bugayenko</span><li class="unprintable"><i class="icon icon-comments"></i> <a href="https://www.yegor256.com/2014/11/07/how-immutability-helps.html#disqus_thread"itemprop="discussionUrl">comments</a></ul><ul class="unprintable subline"><li title="The page is translated by ChatGPT from English to a few languages">Translated by <i class="icon icon-chatgpt notranslate"aria-hidden="true"></i> to<li title="Click to see this page translated to Chinese"><a href="https://www.yegor256.com/zh/2014/11/07/how-immutability-helps.html">‰∏≠Êñá</a><li title="Click to see this page translated to Russian"><a href="https://www.yegor256.com/ru/2014/11/07/how-immutability-helps.html">—Ä—É—Å—Å–∫–∏–π</a></ul><ul class="subline"><li>Discussed at:<li><a href="https://www.reddit.com/r/programming/comments/2llw2x/how_immutability_helps_in_object_design/">reddit</a></ul><p class="unprintable"><a href="/tag/java.html"class="tag notranslate"><img src="/images/icons/java-white.svg"alt="Java">java</a> <a href="/tag/jcabi.html"class="tag notranslate"><img src="/images/icons/jcabi-white.svg"alt="Maven">jcabi</a> <a href="/tag/oop.html"class="tag notranslate"><img src="/images/icons/cactus.svg"alt="OOP">oop</a><nav class="buttons notranslate desktop-only"><a href="https://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2014/11/07/how-immutability-helps.html"title="Share on Facebook"class="button"rel="nofollow"><span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate"aria-hidden="true"></i> </a><a href="https://twitter.com/share?url=https://www.yegor256.com/2014/11/07/how-immutability-helps.html&amp;text=How+Immutability+Helps"title="Share on Twitter"class="button"rel="nofollow"><span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate"aria-hidden="true"></i> </a><a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2014/11/07/how-immutability-helps.html"title="Share on LinkedIn"class="button"rel="nofollow"><span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate"aria-hidden="true"></i> </a><a href="https://reddit.com/submit?url=https://www.yegor256.com/2014/11/07/how-immutability-helps.html%3F2014-44&amp;title=How+Immutability+Helps"title="Share on Reddit"class="button"rel="nofollow"><span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate"aria-hidden="true"></i> </a><a href="https://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2014/11/07/how-immutability-helps.html%3F2014-44&amp;t=How+Immutability+Helps"title="Share on Hacker News"class="button"rel="nofollow"><span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate"aria-hidden="true"></i> </a><a href="#"title="Cite it via BibTeX"class="button"onclick='return $("#bibtex").toggle(),!1'><i class="icon icon-tex notranslate"aria-hidden="true"></i></a></nav></header><article class="main"itemprop="articleBody"><div><div id="bibtex"style="display:none"><p>Please, cite this blog post via <a href="https://www.bibtex.org/">BibTeX</a> as such:<pre style="color:#053c5e">@misc&#123;bugayenko2014blog1107,
  author = &#123;Bugayenko, Yegor&#125;,
  title = &#123;&#123;How Immutability Helps&#125;&#125;,
  howpublished = &#123;\url&#123;https://www.yegor256.com/141107.html&#125;&#125;,
  year = &#123;2014&#125;,
  month = &#123;nov&#125;,
  note = &#123;[Online; accessed 06-01-2026]&#125;
&#125;</pre></div><p>In a few recent posts, including <a href="/2014/09/16/getters-and-setters-are-evil.html">Getters/Setters. Evil. Period.</a> <a href="/2014/06/09/objects-should-be-immutable.html">Objects Should Be Immutable</a>, and <a href="/2014/10/03/di-containers-are-evil.html">Dependency Injection Containers are Code Polluters</a>, I universally labeled all mutable objects with ‚Äúsetters‚Äù (object methods starting with <code class="language-plaintext highlighter-rouge">set</code>) evil. My argumentation was based mostly on metaphors and abstract examples. Apparently, this wasn‚Äôt convincing enough for many of you‚ÄîI received a few requests asking to provide more specific and practical examples.<p>Thus, in order to illustrate my strongly negative attitude to ‚Äúmutability via setters,‚Äù I took an existing <a href="http://commons.apache.org/proper/commons-email/">commons-email</a> Java library from Apache and re-designed it my way, without setters and with ‚Äúobject thinking‚Äù in mind. I released my library as part of the <a href="https://www.jcabi.com">jcabi</a> family‚Äî<a href="https://email.jcabi.com">jcabi-email</a>. Let‚Äôs see what benefits we get from a ‚Äúpure‚Äù object-oriented and immutable approach, without getters.<p>Here is how your code will look, if you send an email using commons-email:<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Email</span> <span class="n">email</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SimpleEmail</span><span class="o">();</span>
<span class="n">email</span><span class="o">.</span><span class="na">setHostName</span><span class="o">(</span><span class="s">"smtp.googlemail.com"</span><span class="o">);</span>
<span class="n">email</span><span class="o">.</span><span class="na">setSmtpPort</span><span class="o">(</span><span class="mi">465</span><span class="o">);</span>
<span class="n">email</span><span class="o">.</span><span class="na">setAuthenticator</span><span class="o">(</span><span class="k">new</span> <span class="nc">DefaultAuthenticator</span><span class="o">(</span><span class="s">"user"</span><span class="o">,</span> <span class="s">"pwd"</span><span class="o">));</span>
<span class="n">email</span><span class="o">.</span><span class="na">setFrom</span><span class="o">(</span><span class="s">"yegor256@gmail.com"</span><span class="o">,</span> <span class="s">"Yegor Bugayenko"</span><span class="o">);</span>
<span class="n">email</span><span class="o">.</span><span class="na">addTo</span><span class="o">(</span><span class="s">"dude@jcabi.com"</span><span class="o">);</span>
<span class="n">email</span><span class="o">.</span><span class="na">setSubject</span><span class="o">(</span><span class="s">"how are you?"</span><span class="o">);</span>
<span class="n">email</span><span class="o">.</span><span class="na">setMsg</span><span class="o">(</span><span class="s">"Dude, how are you?"</span><span class="o">);</span>
<span class="n">email</span><span class="o">.</span><span class="na">send</span><span class="o">();</span>
</code></pre></div></div><p>Here is how you do the same with <a href="https://email.jcabi.com">jcabi-email</a>:<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Postman</span> <span class="n">postman</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Postman</span><span class="o">.</span><span class="na">Default</span><span class="o">(</span>
  <span class="k">new</span> <span class="nf">SMTP</span><span class="o">(</span><span class="s">"smtp.googlemail.com"</span><span class="o">,</span> <span class="mi">465</span><span class="o">,</span> <span class="s">"user"</span><span class="o">,</span> <span class="s">"pwd"</span><span class="o">)</span>
<span class="o">);</span>
<span class="nc">Envelope</span> <span class="n">envelope</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Envelope</span><span class="o">.</span><span class="na">MIME</span><span class="o">(</span>
  <span class="k">new</span> <span class="nc">Array</span><span class="o">&lt;</span><span class="nc">Stamp</span><span class="o">&gt;(</span>
    <span class="k">new</span> <span class="nf">StSender</span><span class="o">(</span><span class="s">"Yegor Bugayenko &lt;yegor256@gmail.com&gt;"</span><span class="o">),</span>
    <span class="k">new</span> <span class="nf">StRecipient</span><span class="o">(</span><span class="s">"dude@jcabi.com"</span><span class="o">),</span>
    <span class="k">new</span> <span class="nf">StSubject</span><span class="o">(</span><span class="s">"how are you?"</span><span class="o">)</span>
  <span class="o">),</span>
  <span class="k">new</span> <span class="nc">Array</span><span class="o">&lt;</span><span class="nc">Enclosure</span><span class="o">&gt;(</span>
    <span class="k">new</span> <span class="nf">EnPlain</span><span class="o">(</span><span class="s">"Dude, how are you?"</span><span class="o">)</span>
  <span class="o">)</span>
<span class="o">);</span>
<span class="n">postman</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="n">envelope</span><span class="o">);</span>
</code></pre></div></div><p>I think the difference is obvious.<p>In the first example, you‚Äôre dealing with a monster <a href="/2016/09/20/oop-without-classes.html">class</a> that can do everything for you, including sending your MIME message via SMTP, creating the message, configuring its parameters, adding MIME parts to it, etc. The <a href="http://svn.apache.org/viewvc/commons/proper/email/tags/EMAIL_1_3_3/src/main/java/org/apache/commons/mail/Email.java?revision=1609295&amp;view=co"><code class="language-plaintext highlighter-rouge">Email</code></a> class from commons-email is really a huge class‚Äî33 private properties, over a hundred methods, about two thousands lines of code. First, you configure the class through a bunch of setters and then you ask it to <code class="language-plaintext highlighter-rouge">send()</code> an email for you.<aside class="youtube"><a href="https://www.youtube.com/watch?v=KwP7Ay9Z-hc"><div class="box"><img src="https://i.ytimg.com/vi/KwP7Ay9Z-hc/mqdefault.jpg"alt="YouTube video #KwP7Ay9Z-hc"><div class="play"><i class="icon icon-play"></i></div></div></a><div>Immutable Objects vs. Common Sense (webinar #2); 6 May 2015.</div></aside><p>In the second example, we have seven objects instantiated via seven <code class="language-plaintext highlighter-rouge">new</code> calls. <code class="language-plaintext highlighter-rouge">Postman</code> is responsible for packaging a MIME message; <code class="language-plaintext highlighter-rouge">SMTP</code> is responsible for sending it via SMTP; stamps (<code class="language-plaintext highlighter-rouge">StSender</code>, <code class="language-plaintext highlighter-rouge">StRecipient</code>, and <code class="language-plaintext highlighter-rouge">StSubject</code>) are responsible for configuring the MIME message before delivery; enclosure <code class="language-plaintext highlighter-rouge">EnPlain</code> is responsible for creating a MIME part for the message we‚Äôre going to send. We construct these seven objects, encapsulating one into another, and then we ask the postman to <code class="language-plaintext highlighter-rouge">send()</code> the envelope for us.<h2 id="whats-wrong-with-a-mutable-email">What‚Äôs Wrong With a Mutable Email?</h2><p>From a user perspective, there is almost nothing wrong. <code class="language-plaintext highlighter-rouge">Email</code> is a powerful class with multiple controls‚Äîjust hit the right one and the job gets done. However, from a developer perspective <code class="language-plaintext highlighter-rouge">Email</code> class is a nightmare. Mostly because the class is very big and difficult to maintain.<p><em>Because the class is so big</em>, every time you want to extend it by introducing a new method, you‚Äôre facing the fact that you‚Äôre making the class even worse‚Äîlonger, less cohesive, less readable, less maintainable, etc. You have a feeling that you‚Äôre digging into something dirty and that there is no hope to make it cleaner, ever. I‚Äôm sure, you‚Äôre familiar with this feeling‚Äîmost legacy applications look that way. They have huge multi-line ‚Äúclasses‚Äù (in reality, COBOL programs written in Java) that were inherited from a few generations of programmers before you. When you start, you‚Äôre full of energy, but after a few minutes of scrolling such a ‚Äúclass‚Äù you say‚Äî‚Äúscrew it, it‚Äôs almost Saturday.‚Äù<aside class="youtube"><a href="https://www.youtube.com/watch?v=EnhRgXrHCC4"><div class="box"><img src="https://i.ytimg.com/vi/EnhRgXrHCC4/mqdefault.jpg"alt="YouTube video #EnhRgXrHCC4"><div class="play"><i class="icon icon-play"></i></div></div></a><div>How Immutability Helps in OOP (in Russian with English subtitles); 21 May 2016.</div></aside><p><em>Because the class is so big</em>, there is no data hiding or encapsulation any more‚Äî33 variables are accessible by over 100 methods. What is hidden? This <code class="language-plaintext highlighter-rouge">Email.java</code> file in reality is a big, procedural 2000-line script, called a ‚Äúclass‚Äù by mistake. Nothing is hidden, once you cross the border of the class by calling one of its methods. After that, you have full access to all the data you may need. Why is this bad? Well, why do we need <a href="/2016/11/21/naked-data.html">encapsulation</a> in the first place? In order to protect one programmer from another, aka <a href="/2016/01/26/defensive-programming.html">defensive programming</a>. While I‚Äôm busy changing the subject of the MIME message, I want to be sure that I‚Äôm not interfered with by some other method‚Äôs activity, that is changing a sender and touching my subject by mistake. Encapsulation helps us narrow down the scope of the problem, while this <code class="language-plaintext highlighter-rouge">Email</code> class is doing exactly the opposite.<p><em>Because the class is so big</em>, its unit testing is even more complicated than the class itself. Why? Because of multiple inter-dependencies between its methods and properties. In order to test <code class="language-plaintext highlighter-rouge">setCharset()</code> you have to prepare the entire object by calling a few other methods, then you have to call <code class="language-plaintext highlighter-rouge">send()</code> to make sure the message being sent actually uses the encoding you specified. Thus, in order to test a one-line method <code class="language-plaintext highlighter-rouge">setCharset()</code> you run the entire integration testing scenario of sending a full MIME message through SMTP. Obviously, if something gets changed in one of the methods, almost every test method will be affected. In other words, tests are very fragile, unreliable and over-complicated.<p>I can go on and on with this ‚Äú<em>because the class is so big</em>,‚Äù but I think it is obvious that a small, cohesive class is always better than a big one. It is obvious to me, to you, and to any object-oriented programmer. But why is it not so obvious to the developers of Apache Commons Email? I don‚Äôt think they are stupid or un-educated. What is it then?<h2 id="how-and-why-did-it-happen">How and Why Did It Happen?</h2><p>This is how it always happens. You start to design a class as something cohesive, solid, and small. Your intentions are very positive. Very soon you realize that there is something else that this class has to do. Then, something else. Then, even more.<p>The best way to make your class more and more powerful is by adding setters that inject configuration parameters into the class so that it can process them inside, isn‚Äôt it?<aside class="youtube"><a href="https://www.youtube.com/watch?v=p7m7_iiqaHI"><div class="box"><img src="https://i.ytimg.com/vi/p7m7_iiqaHI/mqdefault.jpg"alt="YouTube video #p7m7_iiqaHI"><div class="play"><i class="icon icon-play"></i></div></div></a><div>How Much Immutability Is Enough?; 19 May 2016.</div></aside><p>This is the root cause of the problem! The root cause is our ability to <em>insert</em> data into mutable objects via configuration methods, also known as ‚Äúsetters.‚Äù When an <a href="/2016/07/14/who-is-object.html">object</a> is mutable and allows us to add setters whenever we want, we will do it without limits.<p>Let me put it this way‚Äî<em>mutable classes tend to grow in size and lose cohesiveness</em>.<p>If commons-email authors made this <code class="language-plaintext highlighter-rouge">Email</code> class immutable in the beginning, they wouldn‚Äôt have been able to add so many methods into it and encapsulate so many properties. They wouldn‚Äôt be able to turn it into a monster. Why? Because an immutable object only accepts a state through a constructor. Can you imagine a 33-argument constructor? Of course, not.<p>When you make your class immutable in the first place, you are forced to keep it cohesive, small, solid and robust. Because you can‚Äôt encapsulate too much and you can‚Äôt modify what‚Äôs encapsulated. Just two or three arguments of a constructor and you‚Äôre done.<h2 id="how-did-i-design-an-immutable-email">How Did I Design An Immutable Email?</h2><figure class="badge"><a href="https://http.jcabi.com"><img src="https://www.jcabi.com/logo-square.svg"style="width:64px;max-width:100%"alt="badge"></a></figure><p>When I was designing <a href="https://github.com/jcabi/jcabi-email">jcabi-email</a> I started with a small and simple class: <a href="https://github.com/jcabi/jcabi-email/blob/1.3/src/main/java/com/jcabi/email/Postman.java"><code class="language-plaintext highlighter-rouge">Postman</code></a>. Well, it is an interface, since I never make <a href="/2016/04/26/why-inputstream-design-is-wrong.html">interface</a>-less classes. So, <code class="language-plaintext highlighter-rouge">Postman</code> is‚Ä¶ a post man. He is delivering messages to other people. First, I created a default version of it (I omit the ctor, for the sake of brevity):<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">javax.mail.Message</span><span class="o">;</span>
<span class="nd">@Immutable</span>
<span class="kd">class</span> <span class="nc">Postman</span><span class="o">.</span><span class="na">Default</span> <span class="kd">implements</span> <span class="nc">Postman</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">host</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">port</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">user</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">password</span><span class="o">;</span>
  <span class="nd">@Override</span>
  <span class="kt">void</span> <span class="nf">send</span><span class="o">(</span><span class="nc">Message</span> <span class="n">msg</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// create SMTP session</span>
    <span class="c1">// create transport</span>
    <span class="c1">// transport.connect(this.host, this.port, etc.)</span>
    <span class="c1">// transport.send(msg)</span>
    <span class="c1">// transport.close();</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><p>Good start, it works. What now? Well, the <a href="http://docs.oracle.com/javaee/7/api/javax/jms/Message.html"><code class="language-plaintext highlighter-rouge">Message</code></a> is difficult to construct. It is a complex class from JDK that requires some manipulations before it can become a nice HTML email. So I created an envelope, which will build this complex object for me (pay attention, both <a href="https://github.com/jcabi/jcabi-email/blob/1.3/src/main/java/com/jcabi/email/Postman.java"><code class="language-plaintext highlighter-rouge">Postman</code></a> and <a href="https://github.com/jcabi/jcabi-email/blob/1.3/src/main/java/com/jcabi/email/Envelope.java"><code class="language-plaintext highlighter-rouge">Envelope</code></a> are immutable and annotated with <a href="https://aspects.jcabi.com/apidocs-0.20/com/jcabi/aspects/Immutable.html">@Immutable</a> from <a href="https://aspects.jcabi.com/annotation-immutable.html">jcabi-aspects</a>):<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Immutable</span>
<span class="kd">interface</span> <span class="nc">Envelope</span> <span class="o">{</span>
  <span class="nc">Message</span> <span class="nf">unwrap</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div><p>I also refactor the <code class="language-plaintext highlighter-rouge">Postman</code> to accept an envelope, not a message:<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Immutable</span>
<span class="kd">interface</span> <span class="nc">Postman</span> <span class="o">{</span>
  <span class="kt">void</span> <span class="nf">send</span><span class="o">(</span><span class="nc">Envelope</span> <span class="n">env</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div><p>So far, so good. Now let‚Äôs try to create a simple implementation of <code class="language-plaintext highlighter-rouge">Envelope</code>:<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Immutable</span>
<span class="kd">class</span> <span class="nc">MIME</span> <span class="kd">implements</span> <span class="nc">Envelope</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="nc">Message</span> <span class="nf">unwrap</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">MimeMessage</span><span class="o">(</span>
      <span class="nc">Session</span><span class="o">.</span><span class="na">getDefaultInstance</span><span class="o">(</span><span class="k">new</span> <span class="nc">Properties</span><span class="o">())</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><p>It works, but it does nothing useful yet. It only creates an absolutely empty MIME message and returns it. How about adding a subject to it and both <code class="language-plaintext highlighter-rouge">To:</code> and <code class="language-plaintext highlighter-rouge">From:</code> addresses (pay attention, <a href="https://email.jcabi.com/apidocs-1.10/com/jcabi/email/Envelope.Mime.html"><code class="language-plaintext highlighter-rouge">MIME</code></a> class is also immutable):<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Immutable</span>
<span class="kd">class</span> <span class="nc">Envelope</span><span class="o">.</span><span class="na">MIME</span> <span class="kd">implements</span> <span class="nc">Envelope</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">subject</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">from</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="nc">Array</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">to</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">MIME</span><span class="o">(</span><span class="nc">String</span> <span class="n">subj</span><span class="o">,</span> <span class="nc">String</span> <span class="n">sender</span><span class="o">,</span> <span class="nc">Iterable</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">rcpts</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">subject</span> <span class="o">=</span> <span class="n">subj</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">from</span> <span class="o">=</span> <span class="n">sender</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">to</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Array</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;(</span><span class="n">rcpts</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="nc">Message</span> <span class="nf">unwrap</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">Message</span> <span class="n">msg</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MimeMessage</span><span class="o">(</span>
      <span class="nc">Session</span><span class="o">.</span><span class="na">getDefaultInstance</span><span class="o">(</span><span class="k">new</span> <span class="nc">Properties</span><span class="o">())</span>
    <span class="o">);</span>
    <span class="n">msg</span><span class="o">.</span><span class="na">setSubject</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">subject</span><span class="o">);</span>
    <span class="n">msg</span><span class="o">.</span><span class="na">setFrom</span><span class="o">(</span><span class="k">new</span> <span class="nc">InternetAddress</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">from</span><span class="o">));</span>
    <span class="k">for</span> <span class="o">(</span><span class="nc">String</span> <span class="n">email</span> <span class="o">:</span> <span class="k">this</span><span class="o">.</span><span class="na">to</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">msg</span><span class="o">.</span><span class="na">setRecipient</span><span class="o">(</span>
        <span class="nc">Message</span><span class="o">.</span><span class="na">RecipientType</span><span class="o">.</span><span class="na">TO</span><span class="o">,</span>
        <span class="k">new</span> <span class="nf">InternetAddress</span><span class="o">(</span><span class="n">email</span><span class="o">)</span>
      <span class="o">);</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">msg</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><p>Looks correct and it works. But it is still too primitive. How about <code class="language-plaintext highlighter-rouge">CC:</code> and <code class="language-plaintext highlighter-rouge">BCC:</code>? What about email text? How about PDF enclosures? What if I want to specify the encoding of the message? What about <code class="language-plaintext highlighter-rouge">Reply-To</code>?<p>Can I add all these parameters to the constructor? Remember, the class is immutable and I can‚Äôt introduce the <code class="language-plaintext highlighter-rouge">setReplyTo()</code> method. I have to pass the <code class="language-plaintext highlighter-rouge">replyTo</code> argument into its constructor. It‚Äôs impossible, because the constructor will have too many arguments, and nobody will be able to use it.<p>So, what do I do?<p>Well, I started to think: how can we break the concept of an ‚Äúenvelope‚Äù into smaller concepts‚Äîand this what I invented. Like a real-life envelope, my <code class="language-plaintext highlighter-rouge">MIME</code> object will have stamps. Stamps will be responsible for configuring an object <code class="language-plaintext highlighter-rouge">Message</code> (again, <a href="https://github.com/jcabi/jcabi-email/blob/1.3/src/main/java/com/jcabi/email/Stamp.java"><code class="language-plaintext highlighter-rouge">Stamp</code></a> is immutable, as well as all its implementers):<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Immutable</span>
<span class="kd">interface</span> <span class="nc">Stamp</span> <span class="o">{</span>
  <span class="kt">void</span> <span class="nf">attach</span><span class="o">(</span><span class="nc">Message</span> <span class="n">message</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div><p>Now, I can simplify my <a href="https://github.com/jcabi/jcabi-email/blob/1.3/src/main/java/com/jcabi/email/Envelope.java"><code class="language-plaintext highlighter-rouge">MIME</code></a> class to the following:<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Immutable</span>
<span class="kd">class</span> <span class="nc">Envelope</span><span class="o">.</span><span class="na">MIME</span> <span class="kd">implements</span> <span class="nc">Envelope</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="nc">Array</span><span class="o">&lt;</span><span class="nc">Stamp</span><span class="o">&gt;</span> <span class="n">stamps</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">MIME</span><span class="o">(</span><span class="nc">Iterable</span><span class="o">&lt;</span><span class="nc">Stamp</span><span class="o">&gt;</span> <span class="n">stmps</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">stamps</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Array</span><span class="o">&lt;</span><span class="nc">Stamp</span><span class="o">&gt;(</span><span class="n">stmps</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="nc">Message</span> <span class="nf">unwrap</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">Message</span> <span class="n">msg</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MimeMessage</span><span class="o">(</span>
      <span class="nc">Session</span><span class="o">.</span><span class="na">getDefaultInstance</span><span class="o">(</span><span class="k">new</span> <span class="nc">Properties</span><span class="o">())</span>
    <span class="o">);</span>
    <span class="k">for</span> <span class="o">(</span><span class="nc">Stamp</span> <span class="n">stamp</span> <span class="o">:</span> <span class="k">this</span><span class="o">.</span><span class="na">stamps</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">stamp</span><span class="o">.</span><span class="na">attach</span><span class="o">(</span><span class="n">msg</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">msg</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><p>Now, I will create stamps for the subject, for <code class="language-plaintext highlighter-rouge">To:</code>, for <code class="language-plaintext highlighter-rouge">From:</code>, for <code class="language-plaintext highlighter-rouge">CC:</code>, for <code class="language-plaintext highlighter-rouge">BCC:</code>, etc. As many stamps as I like. The class <code class="language-plaintext highlighter-rouge">MIME</code> will stay the same‚Äîsmall, cohesive, readable, solid, etc.<p>What is important here is why I made the decision to refactor while the class was relatively small. Indeed, I started to worry about these stamp classes when my <code class="language-plaintext highlighter-rouge">MIME</code> class was just 25 lines in size.<p>That is exactly the point of this article‚Äî<em>immutability forces you to design small and cohesive objects</em>.<p>Without immutability, I would have gone the same direction as commons-email. My <code class="language-plaintext highlighter-rouge">MIME</code> class would grow in size and sooner or later would become as big as <code class="language-plaintext highlighter-rouge">Email</code> from commons-email. The only thing that stopped me was the necessity to refactor it, because I wasn‚Äôt able to pass all arguments through a constructor.<p>Without immutability, I wouldn‚Äôt have had that motivator and I would have done what Apache developers did with commons-email‚Äîbloat the class and turn it into an unmaintainable <a href="/2017/09/12/evil-object-name-suffix-client.html">monster</a>.<p>That‚Äôs <a href="https://email.jcabi.com">jcabi-email</a>. I hope this example was illustrative enough and that you will start writing cleaner code with immutable objects.</div></article></div><script src="/js/disqus.js?bea9b23"></script><div class="disqus"role="complementary"aria-hidden="true"><p class="disqus_hint">Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.<div id="disqus_thread"class="disqus-thread"><a>&nbsp;</a></div><noscript><div><p class="red">JavaScript is disabled in your browser, that's why you can't see comments under this post.</div></noscript></div><div class="wrapper"><footer class="footer"><p>&copy; <span itemscope=""itemprop="copyrightHolder"itemtype="http://schema.org/Person"><span itemprop="name">Yegor Bugayenko</span> </span>, 2014&ndash;<span itemprop="copyrightYear">2026</span></footer></div></section><div class="wrapper unprintable"style="text-align:center;margin-top:2em"><a href="https://www.sixnines.io/h/3ba1652f"><img src="https://www.sixnines.io/b/3ba1652f?style=flat"alt="sixnines availability badge"></a>&nbsp; <a href="https://github.com/yegor256/blog/stargazers"><img src="https://img.shields.io/github/stars/yegor256/blog.svg?style=flat-square"alt="GitHub stars"></a></div>