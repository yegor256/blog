<!doctypehtml><html xmlns="http://www.w3.org/1999/xhtml"lang="en-US"xml:lang="en-US"itemscope=""itemtype="http://schema.org/WebSite"><meta charset="utf-8"><meta name="description"content="What is the right way to keep test classes in a repository? There is no single canonical approach, but a few principles may help you keep test files in order."><meta name="keywords"content=""><meta name="viewport"content="width=device-width,minimum-scale=1,initial-scale=1"><meta name="google-site-verification"content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8"><meta name="author"content="Yegor Bugayenko"><meta name="og:site_name"content="Yegor Bugayenko"><meta name="og:type"content="article"><meta name="og:locale"content="en_US"><meta name="twitter:account_id"content="4503599630178231"><meta name="twitter:creator"content="@yegor256"><meta name="twitter:site"content="@yegor256"><meta name="twitter:title"property="og:title"content="On the Layout of Tests"><meta name="twitter:description"property="og:description"content="What is the right way to keep test classes in a repository? There is no single canonical approach, but a few principles may help you keep test files in order."><meta name="twitter:url"property="og:url"content="https://www.yegor256.com/zh/2023/01/19/layout-of-tests.html"><meta name="telegram:channel"content="AAAAAEJFMRzsRTRxM3ec6A"><link rel="search"type="application/opensearchdescription+xml"href="/opensearch.xml"title="yegor256"><link rel="shortcut icon"href="/favicon.ico?d864995d304"><link rel="apple-touch-icon"href="/favicon.ico?d864995d304"><link rel="alternate"type="application/rss+xml"title="RSS for yegor256.com"href="https://www.yegor256.com/rss.xml"><link rel="stylesheet"href="/css/layout.css?d864995d304"><link rel="stylesheet"href="/css/icons.css?d864995d304"><link rel="canonical"href="https://www.yegor256.com/zh/2023/01/19/layout-of-tests.html"><title>On the Layout of Tests</title><div class="wrapper"><aside class="header-toggle unprintable"id="header-toggle"title="Show the menu"onclick='$("#header").show(),$("#header-toggle").hide()'>&#9776;</aside><header class="header"id="header"><div class="face"><a href="/about-me.html#form"class="sub"title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html"style="position:relative"><img src="/images/face-256x256.jpg"class="photo"alt="Yegor Bugayenko"></a></div><nav><ul class="menu social notranslate"><li><a href="https://twitter.com/intent/follow?screen_name=yegor256"rel="nofollow"title="Follow me on Twitter"><i class="icon icon-twitter notranslate"aria-hidden="true"></i></a><li><a href="/rss.xml"rel="nofollow"title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate"aria-hidden="true"></i></a><li><a itemprop="sameAs"href="https://github.com/yegor256"rel="nofollow"title="My GitHub profile"><i class="icon icon-github notranslate"aria-hidden="true"></i></a><li><a itemprop="sameAs"href="http://stackoverflow.com/users/187141/yegor256"rel="nofollow"title="My Stack Overflow profile"><i class="icon icon-stackoverflow notranslate"aria-hidden="true"></i></a><li><a itemprop="sameAs"href="https://www.facebook.com/yegor256"rel="nofollow"title="Follow me on Facebook"><i class="icon icon-facebook notranslate"aria-hidden="true"></i></a><li><a itemprop="sameAs"href="https://instagram.com/yegor256"rel="nofollow"title="Follow me on Instagram"><i class="icon icon-instagram notranslate"aria-hidden="true"></i></a><li><a itemprop="sameAs"href="https://www.linkedin.com/in/yegor256"rel="nofollow"title="My LinkedIn profile"><i class="icon icon-linkedin notranslate"aria-hidden="true"></i></a><li><a itemprop="sameAs"href="https://www.youtube.com/c/yegor256?sub_confirmation=1"rel="nofollow"title="My Youtube video channel"><i class="icon icon-youtube notranslate"aria-hidden="true"></i></a><li><a itemprop="sameAs"href="https://www.pinterest.com/yegor256/"rel="nofollow"title="My Pinterest boards"><i class="icon icon-pinterest notranslate"aria-hidden="true"></i></a><li><a itemprop="sameAs"href="https://angel.co/yegor256"rel="nofollow"title="My AngelList profile"><i class="icon icon-angellist notranslate"aria-hidden="true"></i></a><li><a href="https://soundcloud.com/yegor256"rel="nofollow"title="My podcast"><i class="icon icon-podcast notranslate"aria-hidden="true"></i></a><li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721"rel="nofollow"title="My iTunes podcast"><i class="icon icon-itunes notranslate"aria-hidden="true"></i></a><li><a href="https://t.me/yegor256news"rel="nofollow"title="My Telegram public channel"><i class="icon icon-telegram notranslate"aria-hidden="true"></i></a><li><a href="mailto:blog@yegor256.com"rel="nofollow"title="Email me any time"><i class="icon icon-mail notranslate"aria-hidden="true"></i></a></ul><ul class="menu"><li><a href="/"title="Home page">Home</a><li><a href="/best.html"title="Best articles to read">12&#160;Best</a><li><a href="/contents.html"title="The contents of the entire blog">All&#160;391</a><li><a href="/teaching.html"title="My courses and lectures">Teaching</a><li><a href="/talks.html"title="Future and past conference talks">Talks</a><li><a href="/books.html"title="The books I wrote">Books</a><li><a href="/research.html"title="My research directions and progress">Research</a><li><a href="/pets.html"title="My loved pet projects">Pets</a><li><a href="/testimonials.html"title="What some people say about me">Testimonials</a><li><a href="/shift-m.html"title="Audio podcast about project management">Shift-M</a><li><a href="/paintings.html"title="My paintings for sale">Art</a><li><a href="https://ru.yegor256.com/"title="Немного на русском языке о политике в России, Украине и мире">Политика</a></ul></nav><div class="search"><form action="https://www.google.com/search"itemprop="potentialAction"itemscope=""itemtype="http://schema.org/SearchAction"><meta itemprop="target"content="https://www.google.com/search?q={q}"><input name="sitesearch"value="yegor256.com"type="hidden"> <input itemprop="query-input"id="search-query"class="field field-text"required="required"onfocus='$(".google").css("visibility","visible")'name="q"placeholder="Search..."autocomplete="off"> <input type="image"src="/images/google-search-icon.svg"class="google"title="Search via Google"alt="Search via Google"></form></div><div class="hot"><ul></ul></div></header></div><section itemscope=""itemtype="http://schema.org/BlogPosting"><div class="wrapper"><header><h1 itemprop="name headline mainEntityOfPage">On the Layout of Tests</h1></header><article class="main"itemprop="articleBody"style="font-family:sans-serif;font-size:.9em;line-height:1.2em"><p style="color:#c42c00">The following text is a <em>partial</em> translation of the <a href="https://www.yegor256.com/2023/01/19/layout-of-tests.html">original English article</a>, performed by <a href="https://chat.openai.com/">ChatGPT</a> (gpt-3.5-turbo) and <a href="https://github.com/yegor256/jekyll-chatgpt-translate">this Jekyll plugin</a>:<p>我不知道你使用的编程语言是什么，但我最近在Java、Ruby、JavaScript、PHP、Python、C++和Rust中编码的经验告诉我，我将试图说服你坚持遵循的原则对于所有语言都是普遍适用的。这是关于测试文件的命名。对你来说，这可能看起来是一个不太重要的问题，但我想试图证明它并非如此。你是如何给测试类命名的？在src/test/java目录下你创建了多少个测试类？在仅用于测试但本身不是测试的类放在哪里？对于这些问题，你们大多数人的答案可能是“随意！”所以让我们试着找到一个更好的答案。<p>我的单元测试的主要目的是帮助我编码。它们是我的安全网 - 当我犯错误时它们会捕捉到我。例如，假设我回过头去编辑几年前编辑过的一些文件，当然，这一次我做错了。然后，我在项目中运行了所有的500个单元测试，…其中十个测试失败了。请注意，我不是说“失败”，因为就像建筑物周围的安全网一样，失败的测试是没有捕捉到掉下的锤子，也没有发现刚刚引入的错误的测试。因此，其中490个测试<em>失败</em>了，但有十个测试<em>成功</em>了。<p>接下来，我摸了摸脑袋，思考着——我到底做错了什么？我破坏了哪个文件？我只是改了几十行代码。错误具体在哪里？为了找出问题所在，我读取了测试的输出结果。我期望它们在控制台上打印的信息足够描述性，能够帮助我理解问题。我不想撤销所有的更改，重新开始，对吧？我想要快速跳转到含有错误的那一行，修复它，重新运行所有500个测试，看到它们全部通过，提交我的更改，然后结束一天的工作。<p>不用说，测试断言的描述性信息和测试方法的适当命名是成功的秘诀。让我们考虑一个简单的Phrases对象，我们在其中添加了一些英语短语，它会神奇地理解哪些是问候语（显然是使用机器学习）。对于这样一个类来说，下面这个Java/JUnit5的测试是非常糟糕的：<p>虽然这个测试要好得多，得益于<a href="https://www.hamcrest.org">Hamcrest</a>断言（如何命名测试方法是一个单独的故事，在<a href="https://stackoverflow.com/questions/155436/">这里</a>详细解释）。<p>第一个片段会打印一个相当晦涩的错误信息，而第二个片段将在我与我刚刚制造的错误作斗争中对我非常有帮助：这个信息会自我解释。我会很快理解问题所在。<p>描述性的信息将帮助我理解问题是什么。然而，我会知道问题出现在哪里吗？是哪个Java类？其实并不知道。是在<code class="language-plaintext highlighter-rouge">Phrases.java</code>中吗？还是在<code class="language-plaintext highlighter-rouge">Greetings.java</code>中，其由<code class="language-plaintext highlighter-rouge">Phrases.greetings()</code>返回？我只能通过测试类的<em>名称</em>获得这些信息。如果它被称为<code class="language-plaintext highlighter-rouge">PhrasesTest.java</code>—所有它捕获的错误<em>很可能</em>位于<code class="language-plaintext highlighter-rouge">Phrases.java</code>中。如果它被称为<code class="language-plaintext highlighter-rouge">GreetingsTest.java</code>—…你明白我的意思。<p>我的观点是测试类的名称不仅仅是一个名称。它是对一位好奇的程序员的指示：“去查看源文件，你可以从我的名称中推断出它的名称，删除<code class="language-plaintext highlighter-rouge">Test</code>后缀。”如果我试图按照这个指示去找，却找不到任何东西，我会非常沮丧，尤其是如果这个项目不是我的。我无法从其他地方获取所需的信息。测试类的名称是我最后的希望。<p>如果一个测试类变得太长了怎么办？它可能会有几十个或更多的测试方法。我们不希望一个类太大，对吧？错了！一个测试类不是一个类。它甚至不是一个实用类。它只是测试脚本的容器。之所以称之为类，是因为Java（以及许多其他语言）没有其他的代码组织工具。所以不用担心你的测试类变得过长。一个测试类中的5000行代码根本不是问题。再次强调，因为它不是一个类，它只是一组测试脚本的集合。<p>经常一些类或函数并不是测试，但必须在测试之间共享。（我相信你知道共享测试是一个反模式。是吗？）看看我是如何重构上面的单元测试的（它并不优雅，但请暂时忍耐一下！）：<p>在这里，在私有方法<code class="language-plaintext highlighter-rouge">prepare()</code>中，我有一个方便的<code class="language-plaintext highlighter-rouge">Phrases</code>类对象的构建器。这个构建器对于其他测试，比如<code class="language-plaintext highlighter-rouge">GreetingsTest</code>，可能是有益的。我不想从<code class="language-plaintext highlighter-rouge">PhrasesTest</code>复制它到<code class="language-plaintext highlighter-rouge">GreetingsTest</code>中。相反，我想把它放在一个可以重用的地方。这将是合适的地方（<code class="language-plaintext highlighter-rouge">foo</code>是我们所有类所属的Java包）。<p>静态方法<code class="language-plaintext highlighter-rouge">FooUtils.prepare()</code>现在位于<code class="language-plaintext highlighter-rouge">FooUtils</code>实用类（一个可怕的反模式！）中，该类位于<code class="language-plaintext highlighter-rouge">foo.support</code>包中。但是，请注意，不是在<code class="language-plaintext highlighter-rouge">foo</code>包中，而是在子包中，该子包在实际代码块中没有对应的目录：<code class="language-plaintext highlighter-rouge">src/main/java/foo/support</code>目录不存在。这对于几年后遇到这个代码库的程序员来说是一个明确的信息：所有位于<code class="language-plaintext highlighter-rouge">foo.support</code>的类仅属于测试流水线，并且它们本身不是测试。<p>正如您所知，实用类和私有静态方法是命令式编程的基础。面向对象的世界有更好的替代方案。特别是JUnit5为创建测试前提条件提供了相当优雅的机制：<a href="https://junit.org/junit5/docs/current/user-guide/#extensions-registration">测试扩展</a>。测试方法所需的一切都通过其参数提供，这些参数由扩展实例化，例如：<p>然后，测试将会是这样的：<p>现在，测试及其前提条件保存在两个不同的位置，并且它们之间的耦合度不如以前紧密。此外，前提条件可以很容易地被重用。魔术<code class="language-plaintext highlighter-rouge">@ExtendWith</code>注解可以附加到其他测试上。<code class="language-plaintext highlighter-rouge">PhrasesExtension</code>的实现可以变得更智能：它可以开始关注测试方法的参数类型以及附加到其上的自定义注解（这就是<a href="https://junit.org/junit5/docs/5.4.1/api/org/junit/jupiter/api/io/TempDir.html"><code class="language-plaintext highlighter-rouge">@TempDir</code></a>的工作原理）。<p>尽管JUnit扩展非常美丽，但我认为它们并不是将先决条件与测试方法解耦的最佳方式。JUnit扩展仍然相当紧密地与整个项目的测试套件耦合在一起，而不是与测试方法。如果你决定在其他项目中使用它们，你将无法这样做。<p>另外，如果你决定测试你的先决条件，你将无法以优雅的方式进行。当然，你可以在同一个目录中为它们编写测试，但在这种情况下，你将违反“一个活动类对应一个测试”的原则。<p>解决方案是：虚假对象。它们与其他活动对象一起存在，但具有特殊的“虚假”行为，例如（顺便说一句，我不喜欢工厂，但在这种情况下，可以接受）。<p>然后，测试将会是这样的：<p>存储库布局将如下所示：<p>请注意测试<code class="language-plaintext highlighter-rouge">FactoryOfPhrasesTest</code>。它测试的是“假”对象<code class="language-plaintext highlighter-rouge">FactoryOfPhrases</code>，它是生活类集合的一部分。阶段工厂与所有其他类一起提供。因此，它可以被其他项目使用，不仅仅用于测试目的。<p>总之，通常我建议保持测试类的清晰：只有测试方法应该存在其中。没有属性，当然也没有静态私有方法。一切必要条件都必须是“假”对象。<p>在Maven世界中，有单元测试类（以“Test”为后缀）和集成测试类（以“ITCase”为后缀）。它们之间的区别很大。虽然它们都由相同的“maven-compiler-plugin”在“test-compile”阶段进行编译，但它们不会一起执行。相反，单元测试在“test”阶段执行。如果任何单元测试失败，构建会立即失败。这是一种非常简单直接的方法，类似于其他构建自动化引擎。<p>集成测试分为四个步骤执行（这些是Maven阶段的名称）：<p>首先，在“pre-integration-test”阶段获取集成测试所需的资源。例如，可以启动一个MySQL数据库的测试实例。然后，在“integration-test”阶段执行具有“ITCase”的测试。目前忽略其执行结果，只将其记录在文件中。然后，在“post-integration-test”阶段释放资源。例如，关闭MySQL服务器。最后，在“verify”阶段验证测试结果，如果其中一些结果不符合要求，则构建失败。<p>我只在将它们作为特定实时类的集成测试时，将“ITCase”文件与“Test”文件放在一起。通常情况下，它们并不是这样——这就是为什么它们是集成测试的原因。它们可能会将多个类集成和测试在一起。在这种情况下，我会将它们放在一个单独的包中，并给它们任意的名称，这些名称与实时类的名称不匹配。<p>在这里，<code class="language-plaintext highlighter-rouge">GreetingsITCase.java</code> 是对 <code class="language-plaintext highlighter-rouge">Greetings.java</code> 进行集成测试的，而 <code class="language-plaintext highlighter-rouge">SimpleGuessingITCase.java</code> 则是对任何特定类进行集成测试的。显然，<code class="language-plaintext highlighter-rouge">foo.it</code> 包仅存在于测试中，并不存在于 <code class="language-plaintext highlighter-rouge">src/main/java</code> 中。<p>因此，第一条规则是：测试类只能有使用<code class="language-plaintext highlighter-rouge">@Test</code>注解的方法（在Java中）。<p>然后，第二条规则是：包含测试的包只能有与实际类一一对应且仅有<code class="language-plaintext highlighter-rouge">Test</code>或<code class="language-plaintext highlighter-rouge">ITCase</code>后缀的类，不能有其他内容。<p class="jekyll-chatgpt-translate">Translated by ChatGPT gpt-3.5-turbo/42 on 2023-11-22 at 10:24</article></div><div class="wrapper"><footer class="footer"><p>&copy; <span itemscope=""itemprop="copyrightHolder"itemtype="http://schema.org/Person"><span itemprop="name">Yegor Bugayenko</span> </span>2014&ndash;<span itemprop="copyrightYear">2023</span></footer></div></section><div class="wrapper unprintable"style="text-align:center;margin-top:2em"><a href="https://www.sixnines.io/h/3ba1652f"><img src="//www.sixnines.io/b/3ba1652f?style=flat"alt="sixnines availability badge"></a>&nbsp; <a href="https://github.com/yegor256/blog/stargazers"><img src="//img.shields.io/github/stars/yegor256/blog.svg?style=flat-square"alt="GitHub stars"></a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script><script src="/js/all.js?d864995d304"></script><script>var disqus_shortname="yegor256"</script><script id="dsq-count-scr"src="//yegor256.disqus.com/count.js"async="async"></script><script>((e,a,t,g,n)=>{e.GoogleAnalyticsObject="ga",e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=+new Date,g=a.createElement(t),n=a.getElementsByTagName(t)[0],g.async=1,g.src="//www.google-analytics.com/analytics.js",n.parentNode.insertBefore(g,n)})(window,document,"script"),ga("create","UA-1963507-32","auto"),ga("send","pageview")</script><script>Cd=document,Cr="&"+Math.random(),Cp="&s=1",Cd.cookie="b=b",Cd.cookie&&(Cp+="&c=1"),Cp+="&t="+(new Date).getTimezoneOffset(),self!=top&&(Cp+="&f=1")</script><script>navigator.javaEnabled()&&(Cp+="&j=1")</script><script>"undefined"!=typeof screen&&(Cp+="&w="+screen.width+"&h="+screen.height+"&d="+(screen.colorDepth||screen.pixelDepth))</script><script>Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+"&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+"' border='0' width='1' height='1'/>")</script><script type="application/ld+json">{ "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "https://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] }</script>