<!doctypehtml><html xmlns="https://www.w3.org/1999/xhtml"lang="en-US"xml:lang="en-US"itemscope=""itemtype="http://schema.org/WebSite"><meta charset="utf-8"><meta name="description"content="Checked InterruptedException in Java is a constant source of pain for many of us; here is my understanding of how it should be handled."><meta name="keywords"content=""><meta name="viewport"content="width=device-width,minimum-scale=1,initial-scale=1"><meta name="google-site-verification"content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8"><meta name="author"content="Yegor Bugayenko"><meta name="og:site_name"content="Yegor Bugayenko"><meta name="og:type"content="article"><meta name="og:locale"content="en_US"><meta name="twitter:account_id"content="4503599630178231"><meta name="twitter:creator"content="@yegor256"><meta name="twitter:site"content="@yegor256"><meta name="twitter:title"property="og:title"content="What Do You Do With InterruptedException?"><meta name="twitter:description"property="og:description"content="Checked InterruptedException in Java is a constant source of pain for many of us; here is my understanding of how it should be handled."><meta name="twitter:url"property="og:url"content="https://www.yegor256.com/zh/2015/10/20/interrupted-exception.html"><meta name="telegram:channel"content="AAAAAEJFMRzsRTRxM3ec6A"><link rel="search"type="application/opensearchdescription+xml"href="/opensearch.xml"title="yegor256"><link rel="shortcut icon"href="/favicon.ico?a92399eaa71"><link rel="apple-touch-icon"href="/favicon.ico?a92399eaa71"><link rel="alternate"type="application/rss+xml"title="RSS for yegor256.com"href="https://www.yegor256.com/rss.xml"><link rel="stylesheet"href="/css/layout.css?a92399eaa71"><link rel="stylesheet"href="/css/icons.css?a92399eaa71"><link rel="canonical"href="https://www.yegor256.com/zh/2015/10/20/interrupted-exception.html"><title>What Do You Do With InterruptedException?</title><div class="wrapper"><aside class="header-toggle unprintable"id="header-toggle"title="Show the menu"onclick='$("#header").show(),$("#header-toggle").hide()'>&#9776;</aside><header class="header"id="header"><div class="face"><a href="/about-me.html#form"class="sub"title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html"style="position:relative"><img src="/images/face-256x256.jpg"class="photo"alt="Yegor Bugayenko"></a></div><nav><ul class="menu social notranslate"><li><a href="https://twitter.com/intent/follow?screen_name=yegor256"rel="nofollow"title="Follow me on Twitter"><i class="icon icon-twitter notranslate"aria-hidden="true"></i></a><li><a href="/rss.xml"rel="nofollow"title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate"aria-hidden="true"></i></a><li><a itemprop="sameAs"href="https://github.com/yegor256"rel="nofollow"title="My GitHub profile"><i class="icon icon-github notranslate"aria-hidden="true"></i></a><li><a itemprop="sameAs"href="http://stackoverflow.com/users/187141/yegor256"rel="nofollow"title="My Stack Overflow profile"><i class="icon icon-stackoverflow notranslate"aria-hidden="true"></i></a><li><a itemprop="sameAs"href="https://www.facebook.com/yegor256"rel="nofollow"title="Follow me on Facebook"><i class="icon icon-facebook notranslate"aria-hidden="true"></i></a><li><a itemprop="sameAs"href="https://instagram.com/yegor256"rel="nofollow"title="Follow me on Instagram"><i class="icon icon-instagram notranslate"aria-hidden="true"></i></a><li><a itemprop="sameAs"href="https://www.linkedin.com/in/yegor256"rel="nofollow"title="My LinkedIn profile"><i class="icon icon-linkedin notranslate"aria-hidden="true"></i></a><li><a itemprop="sameAs"href="https://www.youtube.com/c/yegor256?sub_confirmation=1"rel="nofollow"title="My Youtube video channel"><i class="icon icon-youtube notranslate"aria-hidden="true"></i></a><li><a href="https://soundcloud.com/yegor256"rel="nofollow"title="My podcast"><i class="icon icon-podcast notranslate"aria-hidden="true"></i></a><li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721"rel="nofollow"title="My iTunes podcast"><i class="icon icon-itunes notranslate"aria-hidden="true"></i></a><li><a href="https://t.me/yegor256news"rel="nofollow"title="My Telegram public channel"><i class="icon icon-telegram notranslate"aria-hidden="true"></i></a><li><a href="mailto:blog@yegor256.com"rel="nofollow"title="Email me any time"><i class="icon icon-mail notranslate"aria-hidden="true"></i></a></ul><ul class="menu"><li><a href="/"title="Home page">Home</a><li><a href="/best.html"title="Best articles to read">12&#160;Best</a><li><a href="/contents.html"title="The contents of the entire blog">All&#160;393</a><li><a href="/teaching.html"title="My courses and lectures">Teaching</a><li><a href="/talks.html"title="Future and past conference talks">Talks</a><li><a href="/books.html"title="The books I wrote">Books</a><li><a href="/research.html"title="My research directions and progress">Research</a><li><a href="/pets.html"title="My loved pet projects">Pets</a><li><a href="/testimonials.html"title="What some people say about me">Testimonials</a><li><a href="/shift-m.html"title="Audio podcast about project management">Shift-M</a><li><a href="/paintings.html"title="My paintings for sale">Art</a><li><a href="https://ru.yegor256.com/"title="Немного на русском языке о политике в России, Украине и мире">Политика</a></ul></nav><div class="search"><form action="https://www.google.com/search"itemprop="potentialAction"itemscope=""itemtype="http://schema.org/SearchAction"><meta itemprop="target"content="https://www.google.com/search?q={q}"><input name="sitesearch"value="yegor256.com"type="hidden"> <input itemprop="query-input"id="search-query"class="field field-text"required="required"onfocus='$(".google").css("visibility","visible")'name="q"placeholder="Search..."autocomplete="off"> <input type="image"src="/images/google-search-icon.svg"class="google"title="Search via Google"alt="Search via Google"></form></div><div class="hot"><ul></ul></div></header></div><section itemscope=""itemtype="http://schema.org/BlogPosting"><div class="wrapper"><header><h1 itemprop="name headline mainEntityOfPage">What Do You Do With InterruptedException?</h1></header><article class="main"itemprop="articleBody"style="font-family:sans-serif;font-size:.9em;line-height:1.2em"><p style="color:#c42c00">The following text is a <em>partial</em> translation of the <a href="https://www.yegor256.com/2015/10/20/interrupted-exception.html">original English article</a>, performed by <a href="https://chat.openai.com/">ChatGPT</a> (gpt-3.5-turbo) and <a href="https://github.com/yegor256/jekyll-chatgpt-translate">this Jekyll plugin</a>:<p><a href="http://docs.oracle.com/javase/7/docs/api/java/lang/InterruptedException.html"><code class="language-plaintext highlighter-rouge">InterruptedException</code></a>是Java中的一个永久性痛点，尤其对于初级开发者而言。但它不应该是这样的。它是一个相当简单和易于理解的概念。让我试着描述和简化它。<p>让我们从这段代码开始：<p>它有什么作用？什么都没有，它只是无休止地旋转CPU。我们能终止它吗？在Java中不行。只有当整个JVM停止运行时，当你按下<code class="language-plaintext highlighter-rouge">Ctrl-C</code>时，它才会停止。在Java中没有办法终止一个线程，除非这个线程自行退出。这是我们必须记住的原则，其他一切都会显而易见。<p>让我们将这个无限循环放入一个线程中：<p>那么，当我们需要停止一个线程时，我们应该怎么做呢？<p>以下是在Java中的设计方法。每个线程中都有一个我们可以从外部设置的标志。线程可能会偶尔检查该标志并停止执行。自愿停止！以下是具体方法：<p>这是唯一一种请求线程停止的方法。在这个例子中有两种方法被使用。当我调用 <code class="language-plaintext highlighter-rouge">loop.interrupt()</code> 时，一个标志位会被设置为 <code class="language-plaintext highlighter-rouge">true</code>，这个标志位在线程 <code class="language-plaintext highlighter-rouge">loop</code> 内的某处。当我调用 <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Thread.html#interrupted%28%29"><code class="language-plaintext highlighter-rouge">interrupted()</code></a> 方法时，标志位会被返回并立即被设置为 <code class="language-plaintext highlighter-rouge">false</code>。是的，这就是这个方法的设计。它检查标志位，返回它，并将其设置为 <code class="language-plaintext highlighter-rouge">false</code>。这个设计很丑陋，我知道。<p>因此，如果我在线程内从未调用过 <code class="language-plaintext highlighter-rouge">Thread.interrupted()</code>，并且在标志位为 <code class="language-plaintext highlighter-rouge">true</code> 时不退出，那么无人能够停止我。实际上，我会忽略他们对 <code class="language-plaintext highlighter-rouge">interrupt()</code> 的调用。他们会请求我停止，但我会忽略他们。他们将无法中断我。<p>因此，总结我们迄今为止学到的知识，一个正确设计的线程会定期检查标志位并优雅地停止。如果代码不检查标志位并且从未调用 <code class="language-plaintext highlighter-rouge">Thread.interrupted()</code>，那么它接受这个事实：迟早会被点击 <code class="language-plaintext highlighter-rouge">Ctrl-C</code> 强制终止。<p>到目前为止，听起来合理吗？希望如此。<p>现在，JDK 中有一些方法可以为我们检查标志位，并在标志位被设置时抛出 <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/InterruptedException.html"><code class="language-plaintext highlighter-rouge">InterruptedException</code></a>。例如，这就是 <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Thread.html#sleep%28long%29"><code class="language-plaintext highlighter-rouge">Thread.sleep()</code></a> 方法的设计（采用了一种非常原始的方法）。<p>为什么要这样做？为什么不能等待并永远不检查标志？嗯，我相信这样做是有原因的。原因如下（如有错误，请纠正）：代码要么运行得飞快，要么具备中断准备，没有中间状态。<p>如果你的代码很快，你就不会检查中断标志，因为你不想处理任何中断。如果你的代码执行较慢，可能需要几秒钟的时间，那就明确声明并以某种方式处理中断。<p>这就是为什么<code class="language-plaintext highlighter-rouge">InterruptedException</code>是一个受检异常的原因。它的设计告诉你，如果你想暂停几毫秒，就要让你的代码具备中断准备。实际上，它的实现如下所示：<p>好吧，你可以让它浮动到一个更高的级别，那里的人将负责捕捉它。关键是有人必须捕捉它并处理这个线程。理想情况下，只是停止它，因为这就是标志的作用。如果抛出<code class="language-plaintext highlighter-rouge">InterruptedException</code>，这意味着有人检查了标志，我们的线程必须尽快完成正在进行的操作。<p>线程的所有者不希望再等待下去。我们必须尊重我们的所有者的决定。<p>因此，当你捕捉到<code class="language-plaintext highlighter-rouge">InterruptedException</code>时，你必须尽一切可能完成你正在进行的操作并退出。<p>现在，再看一下<code class="language-plaintext highlighter-rouge">Thread.sleep()</code>的代码：<p>记住，<code class="language-plaintext highlighter-rouge">Thread.interrupted()</code>不仅会返回标志位，还会将其设置为<code class="language-plaintext highlighter-rouge">false</code>。因此，一旦抛出<code class="language-plaintext highlighter-rouge">InterruptedException</code>，标志位会被重置。线程不再知道由所有者发送的中断请求。<p>线程的所有者要求我们停止，<code class="language-plaintext highlighter-rouge">Thread.sleep()</code>检测到该请求，将其移除，并抛出<code class="language-plaintext highlighter-rouge">InterruptedException</code>。如果再次调用<code class="language-plaintext highlighter-rouge">Thread.sleep()</code>，它将不知道那个中断请求，并且不会抛出任何异常。<p>明白我的意思了吗？不要轻易忽略<code class="language-plaintext highlighter-rouge">InterruptedException</code>，它非常重要。我们不能只是吞下它然后继续执行。那将严重违反整个Java多线程的理念。我们的所有者（即我们线程的所有者）要求我们停止，而我们却无视了。这是一个非常糟糕的主意。<p>这就是我们大多数人对<code class="language-plaintext highlighter-rouge">InterruptedException</code>所做的事情：<p>这看起来很合乎逻辑，但不能保证高级别实际上会停止一切并退出。它们只能在那里捕获运行时异常，线程仍将保持激活状态。线程的所有者会感到失望。<p>我们必须通知上一层级，我们刚刚捕获了一个中断请求。我们不能简单地抛出一个运行时异常。这样的行为太不负责任。整个线程接收了一个中断请求，我们只是将其吞下并转换为一个<code class="language-plaintext highlighter-rouge">RuntimeException</code>。我们不能如此轻率地对待这样一个严重的情况。<p>这是我们必须做的：<p>我们将标志位设置回<code class="language-plaintext highlighter-rouge">true</code>！<p>现在，没有人会责怪我们对一个有价值的标志持有不负责任的态度。我们发现它处于<code class="language-plaintext highlighter-rouge">true</code>状态，清除了它，将其设置回<code class="language-plaintext highlighter-rouge">true</code>，然后抛出了一个运行时异常。接下来会发生什么，我们不在乎。<p>我想就这样了。您可以在这里找到更详细和官方的问题描述：<a href="https://www.ibm.com/developerworks/library/j-jtp05236/">Java理论与实践：处理<code class="language-plaintext highlighter-rouge">InterruptedException</code></a>。<p class="jekyll-chatgpt-translate">Translated by ChatGPT gpt-3.5-turbo/42 on 2023-12-15 at 06:45</article></div><div class="wrapper"><footer class="footer"><p>&copy; <span itemscope=""itemprop="copyrightHolder"itemtype="http://schema.org/Person"><span itemprop="name">Yegor Bugayenko</span> </span>2014&ndash;<span itemprop="copyrightYear">2023</span></footer></div></section><div class="wrapper unprintable"style="text-align:center;margin-top:2em"><a href="https://www.sixnines.io/h/3ba1652f"><img src="//www.sixnines.io/b/3ba1652f?style=flat"alt="sixnines availability badge"></a>&nbsp; <a href="https://github.com/yegor256/blog/stargazers"><img src="//img.shields.io/github/stars/yegor256/blog.svg?style=flat-square"alt="GitHub stars"></a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script><script src="/js/all.js?a92399eaa71"></script><script>var disqus_shortname="yegor256"</script><script id="dsq-count-scr"src="//yegor256.disqus.com/count.js"async="async"></script><script>((e,a,t,g,n,c)=>{e.GoogleAnalyticsObject=g,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=+new Date,n=a.createElement(t),c=a.getElementsByTagName(t)[0],n.async=1,n.src="//www.google-analytics.com/analytics.js",c.parentNode.insertBefore(n,c)})(window,document,"script","ga"),ga("create","UA-1963507-32","auto"),ga("send","pageview")</script><script>Cd=document,Cr="&"+Math.random(),Cp="&s=1",Cd.cookie="b=b",Cd.cookie&&(Cp+="&c=1"),Cp+="&t="+(new Date).getTimezoneOffset(),self!=top&&(Cp+="&f=1")</script><script>navigator.javaEnabled()&&(Cp+="&j=1")</script><script>"undefined"!=typeof screen&&(Cp+="&w="+screen.width+"&h="+screen.height+"&d="+(screen.colorDepth||screen.pixelDepth))</script><script>Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+"&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+"' border='0' width='1' height='1'/>")</script><script type="application/ld+json">{ "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "https://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] }</script>