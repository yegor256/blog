<!DOCTYPE html>
<html amp lang="en">
  <head>

    <meta charset="utf-8">
    <title>Why InputStream Design Is Wrong</title>
    <link rel="canonical" href="https://www.yegor256.com/2016/04/26/why-inputstream-design-is-wrong.html">
    <link rel="icon" type="image/png" href="/favicon.ico">
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
    <script type="application/ld+json">
      {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "mainEntityOfPage":{
          "@type": "WebPage",
          "@id": "https://www.yegor256.com/2016/04/26/why-inputstream-design-is-wrong.html"
        },
        "headline": "Why InputStream Design Is Wrong",
        "image": {
          "@type": "ImageObject",
          "url": "/images/2016/04/a-serious-man.jpg",
          "height": 656,
          "width": 1200
        },
        "datePublished": "2016-04-26",
        "dateModified": "2016-04-26",
        "author": {
          "@type": "Person",
          "name": "Yegor Bugayenko"
        },
        "publisher": {
          "@type": "Organization",
          "name": "yegor256.com",
          "logo": {
            "@type": "ImageObject",
            "url": "https://www.yegor256.com/images/face-512x512.jpg",
            "width": 512,
            "height": 512
          }
        },
        "description": "Class InputStream in Java has three methods read(),
this is what I think is very wrong. Not only in
this class, but in general in OOP.
",
        "keywords": ["why InputStream is a class", "InputStream", "InputStream java", "method overloading", "method overloading java"]
      }
    </script>
    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style>
<noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Code+Pro:400,500">
    <style amp-custom="amp-custom">
      @font-face {
        font-family: 'Cambria';
        src: url('https://www.yegor256.com/fonts/cambria/2EAA54_2_0.ttf');
      }
      body { font-family: 'Cambria', 'Times New Roman', serif; padding: .5em; font-size: 1.2em; }
      article { width: 600px; max-width: 100%; margin-left: auto; margin-right: auto; }
      pre, code { font-family: 'Source Code Pro', 'Courier New', monospace; font-size: .8em; }
      code { padding: 0 .3em; background-color: lightgray; }
      a, a:hover, a:visited { color: inherit; }
      .intro { color: red; font-size: .75em; }
      .photo { border-radius: 50%; }
      pre { overflow-x:scroll; }
    </style>
    <script async src="https://cdn.ampproject.org/v0.js"></script>
  </head>
  <body>
    <article>
      <p class="intro">
        This is a mobile version, full one is
        <a href="https://www.yegor256.com/2016/04/26/why-inputstream-design-is-wrong.html">here</a>.
      </p>
      <p>
        <amp-img src="/images/face-256x256.jpg" width="80" height="80" alt="Yegor Bugayenko" class="photo"></amp-img>
      </p>
      <p>Yegor Bugayenko<br>26 April 2016</p>
      <h1>Why InputStream Design Is Wrong</h1>
      <p>It’s not just about <code class="language-plaintext highlighter-rouge">InputSteam</code>, this class is a good
example of a bad design. I’m talking about three overloaded
methods <code class="language-plaintext highlighter-rouge">read()</code>. I’ve mentioned this problem in Section 2.9
of <a href="/elegant-objects.html">Elegant Objects</a>. In a few words,
I strongly believe that interfaces must be “functionality poor.”
<code class="language-plaintext highlighter-rouge">InputStream</code> should have been an interface in the first place
and it should have had a single method <code class="language-plaintext highlighter-rouge">read(byte[])</code>. Then if
its authors wanted to give us extra functionality, they should have
created supplementary “smart” classes.</p>



<amp-img src="/images/2016/04/a-serious-man.jpg" alt="A Serious Man (2009) by Coen Brothers" height="656" width="1200" layout="responsive"></amp-img>

<p>This is how it looks now:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">InputStream</span> <span class="o">{</span>
  <span class="kt">int</span> <span class="nf">read</span><span class="o">();</span>
  <span class="kt">int</span> <span class="nf">read</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">buffer</span><span class="o">,</span> <span class="kt">int</span> <span class="n">offset</span><span class="o">,</span> <span class="kt">int</span> <span class="n">length</span><span class="o">);</span>
  <span class="kt">int</span> <span class="nf">read</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">buffer</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>What’s wrong? It’s very convenient to have the ability to read
a single byte, an array of bytes or even an array of bytes
with a direct positioning into a specific place in the buffer!</p>



<p>However, we are still lacking a few methods: for reading the bytes and
immediately saving into a file, converting to a text with a selected
encoding, sending them by email and posting on Twitter. It would be
great to have the features too, right in the poor <code class="language-plaintext highlighter-rouge">InputStream</code>.
I hope the Oracle Java team is working on them now.</p>

<p>In the mean time, let’s see what exactly is wrong with what these
bright engineers designed for us already. Or maybe let me show
how I would design <code class="language-plaintext highlighter-rouge">InputStream</code> and we’ll compare:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">interface</span> <span class="nc">InputStream</span> <span class="o">{</span>
  <span class="kt">int</span> <span class="nf">read</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">buffer</span><span class="o">,</span> <span class="kt">int</span> <span class="n">offset</span><span class="o">,</span> <span class="kt">int</span> <span class="n">length</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>This is my design. The <code class="language-plaintext highlighter-rouge">InputStream</code> is responsible for reading
bytes from the stream. There is one single method for this
feature. Is it convenient for everybody? Does it read and post
on Twitter? Not yet. Do we need that functionality? Of course we do,
but it doesn’t mean that we will add it to the interface. Instead,
we will create supplementary “smart” class:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">interface</span> <span class="nc">InputStream</span> <span class="o">{</span>
  <span class="kt">int</span> <span class="nf">read</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">buffer</span><span class="o">,</span> <span class="kt">int</span> <span class="n">offset</span><span class="o">,</span> <span class="kt">int</span> <span class="n">length</span><span class="o">);</span>
  <span class="kd">class</span> <span class="nc">Smart</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">InputStream</span> <span class="n">origin</span><span class="o">;</span>
    <span class="kd">public</span> <span class="nf">Smart</span><span class="o">(</span><span class="nc">InputStream</span> <span class="n">stream</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">this</span><span class="o">.</span><span class="na">origin</span> <span class="o">=</span> <span class="n">stream</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">read</span><span class="o">()</span> <span class="o">{</span>
      <span class="kd">final</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">buffer</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="mi">1</span><span class="o">];</span>
      <span class="kd">final</span> <span class="kt">int</span> <span class="n">read</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">buffer</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="o">);</span>
      <span class="kd">final</span> <span class="kt">int</span> <span class="n">result</span><span class="o">;</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">read</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">result</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">;</span>
      <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">buffer</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
      <span class="o">}</span>
      <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Now, we want to read a single byte from the stream. Here is how:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">final</span> <span class="nc">InputStream</span> <span class="n">input</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">FileInputStream</span><span class="o">(</span><span class="s">"/tmp/a.txt"</span><span class="o">);</span>
<span class="kd">final</span> <span class="kt">byte</span> <span class="n">b</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">InputStream</span><span class="o">.</span><span class="na">Smart</span><span class="o">(</span><span class="n">input</span><span class="o">).</span><span class="na">read</span><span class="o">();</span>
</code></pre></div></div>

<p>The functionality of reading a single byte is outside of <code class="language-plaintext highlighter-rouge">InputStream</code>,
because this is not its business. The stream doesn’t need to know
how to manage the data after it is read. All the stream
is <em>responsible</em> for is reading, not parsing or manipulating afterwards.</p>

<p>Interfaces must be small.</p>

<p>Obviously, <a href="/2023/08/01/method-overloading.html">method overloading</a>
in interfaces is a code smell. An interface
with more than <em>three methods</em> is a good candidate for refactoring. If methods
overload each other—it’s serious trouble.</p>

<p>Interfaces must be small!</p>

<p>You may say that the creators of <code class="language-plaintext highlighter-rouge">InputStream</code> cared about performance, that’s
why allowed us to implement <code class="language-plaintext highlighter-rouge">read()</code> in three different forms. Then I have
to ask again, why not create a method for reading and immediately post it
on Twitter? That would be fantastically fast. Isn’t it what we all want?
A fast software which nobody has any desire to read or maintain.</p>

<blockquote class="twitter-tweet" data-lang="en">
<p lang="en" dir="ltr">Most likely, what is wrong with this Java interface? <a href="https://twitter.com/hashtag/elegantobjects?src=hash&amp;ref_src=twsrc%5Etfw">#elegantobjects</a> <a href="https://twitter.com/hashtag/java?src=hash&amp;ref_src=twsrc%5Etfw">#java</a><br><br>interface Storage {<br>  int readInt();<br>  String readString();<br>  float readFloat();<br>}</p>— Yegor Bugayenko (@yegor256) <a href="https://twitter.com/yegor256/status/1114801713964355584?ref_src=twsrc%5Etfw">April 7, 2019</a>
</blockquote>



    </article>
  </body>
</html>
