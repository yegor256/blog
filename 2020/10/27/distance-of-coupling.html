<!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Encapsulation is a great idea, which doesn't work in practice; measuring the coupling distance between objects seems to be a better alternative." /> <meta name="keywords" content="coupling, coupling distance, distance between objects, java coupling, java coupling distance" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2020-10-27 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="New Metric: the Distance of Coupling"/> <meta name="twitter:description" property="og:description" content="Encapsulation is a great idea, which doesn't work in practice; measuring the coupling distance between objects seems to be a better alternative."/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2020/10/27/distance-of-coupling.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?d28bfe74ac6"/> <link rel="apple-touch-icon" href="/favicon.ico?d28bfe74ac6"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?d28bfe74ac6"/> <link rel="stylesheet" href="/css/icons.css?d28bfe74ac6"/> <link rel="canonical" href="https://www.yegor256.com/2020/10/27/distance-of-coupling.html" /> <title>New Metric: the Distance of Coupling </title> <meta name='og:image' content='https://www.yegor256.com/images/2020/10/chacun-sa-vie.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2020/10/chacun-sa-vie.jpg'/><meta name='og:image:width' content='1922'/> <meta name='twitter:image:width' content='1922'/><meta name='og:image:height' content='800'/> <meta name='twitter:image:height' content='800'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='Chacun sa vie (2017) by Claude Lelouch'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My Stack Overflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/yegor256news" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;374</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Art</a></li> <li><a href="https://ru.yegor256.com/" title="Немного на русском языке о политике в России, Украине и мире">Политика</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> Are you a Java developer? Ready to move to Moscow (Russia) and join my team for a full-time employment in Fortune-100 company? We are working with <a href="https://www.eolang.org">EO</a>, a new programming language. <a href="mailto:job@yegor256.com">Email me</a>, we'll discuss. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2020/10/27/distance-of-coupling.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2020/10/27/distance-of-coupling.html</code></p><h1 itemprop="name headline mainEntityOfPage">New Metric: the Distance of Coupling</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2020-10-27T00:00:00+00:00"> 27 October 2020 </time> </li> <li class="desktop-only" itemprop="locationCreated">Moscow, Russia</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="https://www.yegor256.com/2020/10/27/distance-of-coupling.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p class="unprintable"><a href='/tag/oop.html' class='tag notranslate'><img src='/images/books/elegant-objects/cactus.svg' alt='OOP'/>oop</a></p><nav class="buttons notranslate desktop-only"> <a href="https://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2020/10/27/distance-of-coupling.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2020/10/27/distance-of-coupling.html&amp;text=New+Metric%3A+the+Distance+of+Coupling" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2020/10/27/distance-of-coupling.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="https://reddit.com/submit?url=https://www.yegor256.com/2020/10/27/distance-of-coupling.html%3F2020-43&amp;title=New+Metric%3A+the+Distance+of+Coupling" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="https://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2020/10/27/distance-of-coupling.html%3F2020-43&amp;t=New+Metric%3A+the+Distance+of+Coupling" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p><a href="https://en.wikipedia.org/wiki/Encapsulation_%28computer_programming%29">Encapsulation</a>, as you know, is one of the <a href="https://www.indeed.com/career-advice/career-development/what-is-object-oriented-programming">four key principles</a> in <a href="https://en.wikipedia.org/wiki/Object-oriented_programming">object-oriented programming</a>. Encapsulation, according to <a href="https://amzn.to/3o7RnDZ">Grady Booch et al.</a>, is “the process of hiding all the secrets of an object that do not contribute to its essential characteristics.” Practically speaking, it’s about those <code class="highlighter-rouge">private</code> attributes that we use in Java and C++: they are not visible to the users of our objects, that’s why they can’t be modified or even read. Booch et al. believe that the purpose of encapsulation is “to provide explicit barriers among different abstractions,” which leads to “a clear separation of concerns.” However, does it really work as planned? Do we really have explicit barriers between objects? Let’s see.</p><figure class="jb_picture"><img itemprop="image" alt="Chacun sa vie (2017) by Claude Lelouch" src="/images/2020/10/chacun-sa-vie.jpg" longdesc="#b30cec40" /><figcaption id="b30cec40">Chacun sa vie (2017) by Claude Lelouch</figcaption></figure><p>First, I’m not the first and not the only one asking this question. <a href="http://amzn.to/266oJr4">David West</a> much earlier said that “in most ways, encapsulation is a discipline more than a real barrier,” and that “seldom is the integrity of an object protected in any absolute sense”. In practice, “it is up to the user of an object to respect that object’s encapsulation.’’ Indeed, let’s take a look at the class <code class="highlighter-rouge">Temperature</code> from my blog post about <a href="/2016/11/21/naked-data.html">naked data</a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">class</span> <span class="nc">Temperature</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">t</span><span class="o">;</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getT</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">t</span><span class="o">;</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setT</span><span class="o">(</span><span class="kt">int</span> <span class="n">t</span><span class="o">)</span> <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">t</span> <span class="o">=</span> <span class="n">t</span><span class="o">;</span> <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Can we say that the attribute <code class="highlighter-rouge">t</code> is truly <em>encapsulated</em>? Technically, it is: it’s impossible to modify it directly via the dot notation. Simply put, we can’t do this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nc">Temperature</span> <span class="n">x</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Temperature</span><span class="o">();</span>
<span class="n">x</span><span class="o">.</span><span class="na">t</span> <span class="o">=</span> <span class="mi">10</span><span class="o">;</span></code></pre></figure><p>And we can’t even do this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kt">int</span> <span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="na">t</span><span class="o">;</span></code></pre></figure><p>However, we can do exactly the same via the <a href="/2014/09/16/getters-and-setters-are-evil.html">getter</a> <code class="highlighter-rouge">getT()</code> and the setter <code class="highlighter-rouge">setT()</code>. Thus, the designer of the class <code class="highlighter-rouge">Temperature</code> gives us the ability to access its attribute, but indirectly, through <a href="/2014/09/16/getters-and-setters-are-evil.html">getters and setters</a>. I would say that the principle of encapsulation is being violated here, and, I’m sure, <a href="https://www.infoworld.com/article/2072302/more-on-getters-and-setters.html">Allen Holub</a> would agree with me. What is the solution? The <a href="/2016/11/21/naked-data.html">article</a> about naked data proposed the use of the <a href="http://media.pragprog.com/articles/jan_03_enbug.pdf">TellDontAsk principle</a> and that we should get rid of the getter:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">class</span> <span class="nc">Temperature</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">t</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nc">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="nc">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"%d F"</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">t</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Now the class <code class="highlighter-rouge">Temperature</code> doesn’t allow us to read its attribute <code class="highlighter-rouge">t</code>. Instead, we can only <em>tell</em> it to prepare a string presentation of the temperature and return that back to us. Maybe not exactly a classic example of the “tell” paradigm, since some data is coming back, but now it looks much better than before. The beauty of this refactoring is less <a href="/2018/09/18/fear-of-coupling.html">coupling</a> between the client and the object. With the getter (or direct access to the attribute via dot notation), the client was able to retrieve the numeric value of the temperature and recalculate it in Fahrenheit, assuming that it was in Celsius. With the <code class="highlighter-rouge">String</code> being returned the client would not do this. The string would only be used as a final product, not modifiable. Or maybe not?</p><p>What if the client does this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nc">Temperature</span> <span class="n">x</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Temperature</span><span class="o">();</span>
<span class="nc">String</span> <span class="n">txt</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
<span class="nc">String</span><span class="o">[]</span> <span class="n">parts</span> <span class="o">=</span> <span class="n">txt</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">" "</span><span class="o">);</span>
<span class="kt">int</span> <span class="n">t</span> <span class="o">=</span> <span class="nc">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">parts</span><span class="o">[</span><span class="mi">0</span><span class="o">]);</span></code></pre></figure><p>How does it look now? Isn’t this a violation of encapsulation? The result of <code class="highlighter-rouge">toString()</code> is not treated as it is supposed to be treated. Not as a solid string, but as data with some internal structure, which is <em>known</em> to the client. The <em>knowledge</em> the client possesses about the output is the key problem here. The client knows too much and uses this knowledge for its own benefit: to deconstruct the data and manipulate the result.</p><p>Can we really prohibit the client from doing this? There is no such feature in any programming language, to my knowledge. When the output of the method is delivered to the client, the client is allowed to do whatever is needed with it. This is that lack of respect to encapsulation, if I correctly understood Dr. West. And we are not even discussing the <a href="https://docs.oracle.com/javase/tutorial/reflect/">Reflection API</a>, which would allow us to take the <code class="highlighter-rouge">t</code> out of <code class="highlighter-rouge">Temperature</code> without even calling any methods.</p><aside class="quote">Encapsulation is not an explicit barrier, it exists for as long as we have the desire to respect it. </aside><p>Thus, encapsulation is <em>not</em> an explicit barrier. It exists for as long as we have the desire to respect it. If we don’t, nothing can stop us from abusing an object in any way we want. And even <code class="highlighter-rouge">private</code> attribute modifiers won’t help. Moreover, they will only create an illusion of encapsulation, while in reality everyone is able to do whatever they feel is suitable for their business case.</p><p>I have a proposal, though, which may help us make encapsulation more explicit.</p><p>What if we had the ability to control what’s happening with the data and objects <em>after</em> we return them to clients? What if we could prevent the client from doing a <code class="highlighter-rouge">split()</code> on the output of the <code class="highlighter-rouge">toString()</code> method? We could do this at compile time, I think, by going through all the code and checking how <em>far</em> the moments of interaction with our objects are from the places where they were returned. In the example above, the <em>distance</em> is two: 1) first, we do the <code class="highlighter-rouge">split</code>, 2) second, we do the <code class="highlighter-rouge">parseInt()</code>. Larger applications will have bigger numbers, of course.</p><aside class="youtube"> <a href="https://www.youtube.com/watch?v=fJvUTlPHSvU"><div class="box"> <img src="https://i.ytimg.com/vi/fJvUTlPHSvU/mqdefault.jpg" alt="YouTube video #fJvUTlPHSvU" /><div class="play"><i class="icon icon-play"></i></div></div></a><div>Encapsulation Is Dead, Let&#39;s Use Distance of Coupling Instead (Webinar #55); 18 March 2021.</div></aside><p>It seems that we can use this distance number as a metric for coupling between objects in the entire app. The larger the number (or the mean of all numbers), the worse the design: in good design we are not supposed to take something out of a method and then do some complex processing. We are, according to the TellDontAsk principle mentioned above, supposed to let our objects do the work and only return a quick summary of it. The distance metric will tell us exactly that: how many times, and by how much, we violated the principle of loose coupling.</p><p>Would you be interested in creating such an analyzer for, say, Java code?</p></div></article></div><div class="wrapper" aria-hidden="true"> <related-posts /></div><div class="disqus" role="complementary" aria-hidden="true"><p class="disqus_hint" > Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2022</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="https://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge" /></a> &nbsp; <a href="https://github.com/yegor256/blog/stargazers"> <img src="//img.shields.io/github/stars/yegor256/blog.svg?style=flat-square" alt="GitHub stars" /></a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?d28bfe74ac6"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "https://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html>
