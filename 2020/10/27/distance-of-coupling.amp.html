<!DOCTYPE html>
<html amp lang="en">
  <head>

    <meta charset="utf-8">
    <title>New Metric: the Distance of Coupling</title>
    <link rel="canonical" href="https://www.yegor256.com/2020/10/27/distance-of-coupling.html">
    <link rel="icon" type="image/png" href="/favicon.ico">
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
    <script type="application/ld+json">
      {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "mainEntityOfPage":{
          "@type": "WebPage",
          "@id": "https://www.yegor256.com/2020/10/27/distance-of-coupling.html"
        },
        "headline": "New Metric: the Distance of Coupling",
        "image": {
          "@type": "ImageObject",
          "url": "/images/2020/10/chacun-sa-vie.jpg",
          "height": 800,
          "width": 1922
        },
        "datePublished": "2020-10-27",
        "dateModified": "2020-10-27",
        "author": {
          "@type": "Person",
          "name": "Yegor Bugayenko"
        },
        "publisher": {
          "@type": "Organization",
          "name": "yegor256.com",
          "logo": {
            "@type": "ImageObject",
            "url": "https://www.yegor256.com/images/face-512x512.jpg",
            "width": 512,
            "height": 512
          }
        },
        "description": "Encapsulation is a great idea, which doesn't work in practice;
measuring the coupling distance between objects seems to be
a better alternative.
",
        "keywords": ["coupling", "java coupling", "coupling distance", "distance between objects", "java coupling distance"]
      }
    </script>
    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style>
<noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Code+Pro:400,500">
    <style amp-custom="amp-custom">
      @font-face {
        font-family: 'Cambria';
        src: url('https://www.yegor256.com/fonts/cambria/2EAA54_2_0.ttf');
      }
      body { font-family: 'Cambria', 'Times New Roman', serif; padding: .5em; font-size: 1.2em; }
      article { width: 600px; max-width: 100%; margin-left: auto; margin-right: auto; }
      pre, code { font-family: 'Source Code Pro', 'Courier New', monospace; font-size: .8em; }
      code { padding: 0 .3em; background-color: lightgray; }
      a, a:hover, a:visited { color: inherit; }
      .intro { color: red; font-size: .75em; }
      .photo { border-radius: 50%; }
      pre { overflow-x:scroll; }
    </style>
    <script async src="https://cdn.ampproject.org/v0.js"></script>
  </head>
  <body>
    <article>
      <p class="intro">
        This is a mobile version, full one is
        <a href="https://www.yegor256.com/2020/10/27/distance-of-coupling.html">here</a>.
      </p>
      <p>
        <amp-img src="/images/face-256x256.jpg" width="80" height="80" alt="Yegor Bugayenko" class="photo"></amp-img>
      </p>
      <p>Yegor Bugayenko<br>27 October 2020</p>
      <h1>New Metric: the Distance of Coupling</h1>
      <p><a href="https://en.wikipedia.org/wiki/Encapsulation_%28computer_programming%29">Encapsulation</a>,
as you know, is one of the
<a href="https://www.indeed.com/career-advice/career-development/what-is-object-oriented-programming">four key principles</a>
in <a href="https://en.wikipedia.org/wiki/Object-oriented_programming">object-oriented programming</a>.
Encapsulation, according to <a href="https://amzn.to/3o7RnDZ">Grady Booch et al.</a>,
is “the process of hiding all the secrets of an object
that do not contribute to its essential characteristics.”
Practically speaking, it’s about those <code class="language-plaintext highlighter-rouge">private</code>
attributes that we use in Java and C++: they are not visible to the users of
our objects, that’s why they can’t be modified or even read.
Booch et al. believe that the purpose of encapsulation is
“to provide explicit barriers among different abstractions,”
which leads to “a clear separation of concerns.”
However, does it really work as planned? Do we really have
explicit barriers between objects? Let’s see.</p>



<amp-img src="/images/2020/10/chacun-sa-vie.jpg" alt="Chacun sa vie (2017) by Claude Lelouch" height="800" width="1922" layout="responsive"></amp-img>

<p>First, I’m not the first and not the only one asking this question.
<a href="https://amzn.to/266oJr4">David West</a> much earlier said that “in most ways,
encapsulation is a discipline more than a real barrier,” and
that “seldom is the integrity of an object protected in any absolute sense”.
In practice, “it is up to the user of an object to respect that object’s encapsulation.’’
Indeed, let’s take a look at the class <code class="language-plaintext highlighter-rouge">Temperature</code> from my blog post
about <a href="/2016/11/21/naked-data.html">naked data</a>:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">Temperature</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">t</span><span class="o">;</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getT</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">t</span><span class="o">;</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setT</span><span class="o">(</span><span class="kt">int</span> <span class="n">t</span><span class="o">)</span> <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">t</span> <span class="o">=</span> <span class="n">t</span><span class="o">;</span> <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Can we say that the attribute <code class="language-plaintext highlighter-rouge">t</code> is truly <em>encapsulated</em>?
Technically, it is: it’s impossible
to modify it directly via the dot notation.
Simply put, we can’t do this:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Temperature</span> <span class="n">x</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Temperature</span><span class="o">();</span>
<span class="n">x</span><span class="o">.</span><span class="na">t</span> <span class="o">=</span> <span class="mi">10</span><span class="o">;</span>
</code></pre></div></div>

<p>And we can’t even do this:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="na">t</span><span class="o">;</span>
</code></pre></div></div>

<p>However, we can do exactly the same via the
<a href="/2014/09/16/getters-and-setters-are-evil.html">getter</a> <code class="language-plaintext highlighter-rouge">getT()</code>
and the setter <code class="language-plaintext highlighter-rouge">setT()</code>.
Thus, the designer of the class <code class="language-plaintext highlighter-rouge">Temperature</code> gives us the ability to access
its attribute, but indirectly, through
<a href="/2014/09/16/getters-and-setters-are-evil.html">getters and setters</a>.
I would say
that the principle of encapsulation is being violated here, and, I’m sure,
<a href="https://www.infoworld.com/article/2072302/more-on-getters-and-setters.html">Allen Holub</a>
would agree with me. What is the solution? The <a href="/2016/11/21/naked-data.html">article</a>
about naked data
proposed the use of the <a href="http://media.pragprog.com/articles/jan_03_enbug.pdf">TellDontAsk principle</a>
and that we should get rid of the getter:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">Temperature</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">t</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nc">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="nc">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"%d F"</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">t</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Now the class <code class="language-plaintext highlighter-rouge">Temperature</code> doesn’t allow us to read its attribute <code class="language-plaintext highlighter-rouge">t</code>.
Instead, we can only <em>tell</em> it to prepare a string presentation of the temperature
and return that back to us. Maybe not exactly a classic example of the “tell” paradigm,
since some data is coming back, but now it looks much better than before. The beauty
of this refactoring is less <a href="/2018/09/18/fear-of-coupling.html">coupling</a>
between the client and the object. With
the getter (or direct access to the attribute via dot notation), the client
was able to retrieve the numeric value of the temperature and recalculate it
in Fahrenheit, assuming that it was in Celsius. With the <code class="language-plaintext highlighter-rouge">String</code> being
returned the client would not do this. The string would only be used as a final
product, not modifiable. Or maybe not?</p>

<p>What if the client does this:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Temperature</span> <span class="n">x</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Temperature</span><span class="o">();</span>
<span class="nc">String</span> <span class="n">txt</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
<span class="nc">String</span><span class="o">[]</span> <span class="n">parts</span> <span class="o">=</span> <span class="n">txt</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">" "</span><span class="o">);</span>
<span class="kt">int</span> <span class="n">t</span> <span class="o">=</span> <span class="nc">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">parts</span><span class="o">[</span><span class="mi">0</span><span class="o">]);</span>
</code></pre></div></div>

<p>How does it look now? Isn’t this a violation of encapsulation?
The result of <code class="language-plaintext highlighter-rouge">toString()</code> is not treated
as it is supposed to be treated. Not as a solid string, but as data with
some internal structure, which is <em>known</em> to the client. The <em>knowledge</em> the
client possesses about the output is the key problem here. The client knows too
much and uses this knowledge for its own benefit: to deconstruct the
data and manipulate the result.</p>

<p>Can we really prohibit the client from doing this? There is no such feature
in any programming language, to my knowledge. When the output of the method
is delivered to the client, the client is allowed to do whatever is needed
with it. This is that lack of respect to encapsulation, if I correctly
understood Dr. West. And we are not even discussing
the <a href="https://docs.oracle.com/javase/tutorial/reflect/">Reflection API</a>, which
would allow us to take the <code class="language-plaintext highlighter-rouge">t</code> out of <code class="language-plaintext highlighter-rouge">Temperature</code> without even calling any methods.</p>



<p>Thus, encapsulation is <em>not</em> an explicit barrier. It exists for as long as we have
the desire to respect it. If we don’t, nothing can stop us from abusing an
object in any way we want. And even <code class="language-plaintext highlighter-rouge">private</code> attribute modifiers won’t help.
Moreover, they will only create an illusion of encapsulation, while in reality
everyone is able to do whatever they feel is suitable for their business case.</p>

<p>I have a proposal, though, which may help us make
encapsulation more explicit.</p>

<p>What if we had the ability to control what’s happening with the data
and objects <em>after</em> we return them to clients? What if we could prevent the client
from doing a <code class="language-plaintext highlighter-rouge">split()</code> on the output of the <code class="language-plaintext highlighter-rouge">toString()</code> method? We could do this at compile time, I think,
by going through all the code and checking how <em>far</em> the moments of interaction with our
objects are from the places where they were returned. In the example above,
the <em>distance</em> is two: 1) first, we do the <code class="language-plaintext highlighter-rouge">split</code>, 2) second, we do the <code class="language-plaintext highlighter-rouge">parseInt()</code>.
Larger applications will have bigger numbers, of course.</p>



<p>It seems that we can use this distance number as a metric for coupling between objects
in the entire app. The larger the number (or the mean of all numbers), the
worse the design: in good design we are not supposed to take something
out of a method and then do some complex processing. We are, according to
the TellDontAsk principle mentioned above, supposed to let our objects do the work and only
return a quick summary of it. The distance metric will tell us exactly that:
how many times, and by how much, we violated the principle of loose coupling.</p>

<p>Would you be interested in creating such an analyzer for, say, Java code?</p>

    </article>
  </body>
</html>
