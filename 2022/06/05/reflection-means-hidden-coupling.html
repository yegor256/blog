<!doctypehtml><html xmlns="https://www.w3.org/1999/xhtml"lang="en-US"xml:lang="en-US"itemscope=""itemtype="http://schema.org/WebSite"><meta charset="utf-8"><meta name="description"content="Reflection in object-oriented programming languages like Java is a powerful technique, but a very dangerous and harmful one."><meta name="keywords"content="oop reflection, reflection, reflection is bad, what is reflection, why reflection"><meta name="viewport"content="width=device-width,minimum-scale=1,initial-scale=1"><meta name="google-site-verification"content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8"><meta name="author"content="Yegor Bugayenko"><meta name="article:published_time"content="2022-06-05 00:00:00 +0000"><meta name="yandex-verification"content="7d2a0afee14d72bc"><meta name="og:site_name"content="Yegor Bugayenko"><meta name="og:type"content="article"><meta name="og:locale"content="en_US"><meta name="twitter:account_id"content="4503599630178231"><meta name="twitter:creator"content="@yegor256"><meta name="twitter:site"content="@yegor256"><meta name="twitter:title"property="og:title"content="Reflection Means Hidden Coupling"><meta name="twitter:description"property="og:description"content="Reflection in object-oriented programming languages like Java is a powerful technique, but a very dangerous and harmful one."><meta name="twitter:url"property="og:url"content="https://www.yegor256.com/2022/06/05/reflection-means-hidden-coupling.html"><meta name="telegram:channel"content="AAAAAEJFMRzsRTRxM3ec6A"><link rel="search"type="application/opensearchdescription+xml"href="/opensearch.xml"title="yegor256"><link rel="icon"href="/favicon.ico?06f2b2b"type="image/x-icon"><link rel="shortcut icon"href="/favicon.ico?06f2b2b"><link rel="apple-touch-icon"href="/favicon.ico?06f2b2b"><link rel="alternate"type="application/rss+xml"title="RSS for yegor256.com"href="https://www.yegor256.com/rss.xml"><link rel="stylesheet"href="/css/layout.css?06f2b2b"><link rel="stylesheet"href="/css/icons.css?06f2b2b"><link rel="canonical"href="https://www.yegor256.com/2022/06/05/reflection-means-hidden-coupling.html"><title>Reflection Means Hidden Coupling</title><meta name="og:image"content="https://www.yegor256.com/images/2022/02/wheelman.jpg"><meta name="twitter:image"content="https://www.yegor256.com/images/2022/02/wheelman.jpg"><meta name="og:image:width"content="777"><meta name="twitter:image:width"content="777"><meta name="og:image:height"content="459"><meta name="twitter:image:height"content="459"><meta name="twitter:card"content="summary"><meta name="twitter:image:alt"content="Wheelman (2017) by Jeremy Rush"><div class="wrapper"><aside class="header-toggle unprintable"id="header-toggle"title="Show the menu"onclick='$("#header").show(),$("#header-toggle").hide()'>&#9776;</aside><header class="header"id="header"><div class="face"><a href="/about-me.html#form"class="sub"title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html"style="position:relative"><img src="/images/face-256x256.jpg"class="photo"alt="Yegor Bugayenko"></a></div><nav><ul class="menu social notranslate"><li><a href="https://twitter.com/intent/follow?screen_name=yegor256"rel="nofollow"title="Follow me on Twitter"><i class="icon icon-twitter notranslate"aria-hidden="true"></i></a><li><a href="/rss.xml"rel="nofollow"title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate"aria-hidden="true"></i></a><li><a itemprop="sameAs"href="https://github.com/yegor256"rel="nofollow"title="My GitHub profile"><i class="icon icon-github notranslate"aria-hidden="true"></i></a><li><a itemprop="sameAs"href="http://stackoverflow.com/users/187141/yegor256"rel="nofollow"title="My Stack Overflow profile"><i class="icon icon-stackoverflow notranslate"aria-hidden="true"></i></a><li><a itemprop="sameAs"href="https://www.facebook.com/yegor256"rel="nofollow"title="Follow me on Facebook"><i class="icon icon-facebook notranslate"aria-hidden="true"></i></a><li><a itemprop="sameAs"href="https://instagram.com/yegor256"rel="nofollow"title="Follow me on Instagram"><i class="icon icon-instagram notranslate"aria-hidden="true"></i></a><li><a itemprop="sameAs"href="https://www.linkedin.com/in/yegor256"rel="nofollow"title="My LinkedIn profile"><i class="icon icon-linkedin notranslate"aria-hidden="true"></i></a><li><a itemprop="sameAs"href="https://www.youtube.com/c/yegor256?sub_confirmation=1"rel="nofollow"title="My Youtube video channel"><i class="icon icon-youtube notranslate"aria-hidden="true"></i></a><li><a href="https://soundcloud.com/yegor256"rel="nofollow"title="My podcast"><i class="icon icon-podcast notranslate"aria-hidden="true"></i></a><li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721"rel="nofollow"title="My iTunes podcast"><i class="icon icon-itunes notranslate"aria-hidden="true"></i></a><li><a href="https://t.me/yegor256news"rel="nofollow"title="My Telegram public channel"><i class="icon icon-telegram notranslate"aria-hidden="true"></i></a><li><a href="mailto:blog@yegor256.com"rel="nofollow"title="Email me any time"><i class="icon icon-mail notranslate"aria-hidden="true"></i></a></ul><ul class="menu"><li><a href="/"title="Home page">Home</a><li><a href="/best.html"title="Best articles to read">12&#160;Best</a><li><a href="/contents.html"title="The contents of the entire blog">All&#160;479</a><li><a href="/teaching.html"title="My courses and lectures">Teaching</a><li><a href="/talks.html"title="Future and past conference talks">Talks</a><li><a href="/books.html"title="The books I wrote">Books</a><li><a href="/research.html"title="My research directions and progress">Research</a><li><a href="/pets.html"title="My loved pet projects">Pets</a><li><a href="/trainings.html"title="On-site trainings">Trainings</a><li><a href="https://www.iccq.ru"title="International Conference on Code Quality">ICCQ</a><li><a href="https://www.kaicode.org"title="Open Source Festival">KaiCode</a><li><a href="/testimonials.html"title="What some people say about me">Testimonials</a><li><a href="/shift-m.html"title="Audio podcast about project management">Shift-M</a><li><a href="/paintings.html"title="My paintings for sale">Art</a></ul></nav><div class="search"><form action="https://www.google.com/search"itemprop="potentialAction"itemscope=""itemtype="http://schema.org/SearchAction"><meta itemprop="target"content="https://www.google.com/search?q={q}"><input name="sitesearch"value="yegor256.com"type="hidden"> <input itemprop="query-input"id="search-query"class="field field-text"required="required"onfocus='$(".google").css("visibility","visible")'name="q"placeholder="Search..."autocomplete="off"> <input type="image"src="/images/google-search-icon.svg"class="google"title="Search via Google"alt="Search via Google"></form></div><div class="hot"><ul><li>If you have an open source repository designed right, there is a chance to win up to $4,096 at <a href="https://www.kaicode.org">KaiCode'25</a>, our 8th annual open source festival. <a href="https://docs.google.com/forms/d/1nUlL2xvL1OOy3LoVF-g7MfB-9yeG68XB2wXW4MAoWrY">Submit</a> your project now, it's free!</ul></div></header></div><section itemscope=""itemtype="http://schema.org/BlogPosting"><div class="wrapper"><header><p class="printable"><img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2022/06/05/reflection-means-hidden-coupling.html&amp;format=svg"style="width:125px;height:125px"alt="QR code"><p class="printable"><code itemprop="url">https://www.yegor256.com/220605.html</code><h1 itemprop="name headline mainEntityOfPage">Reflection Means Hidden Coupling</h1><ul class="subline"><li><time itemprop="datePublished"datetime="2022-06-05T00:00:00+00:00">5 June 2022</time><li class="desktop-only"itemprop="locationCreated">Moscow, Russia<li class="printable"itemscope=""itemprop="author"itemtype="http://schema.org/Person"><span itemprop="name">Yegor Bugayenko</span><li class="unprintable"><i class="icon icon-comments"></i> <a href="https://www.yegor256.com/2022/06/05/reflection-means-hidden-coupling.html#disqus_thread"itemprop="discussionUrl">comments</a></ul><ul class="unprintable subline"><li title="The page is translated by ChatGPT from English to a few languages">Translated by <i class="icon icon-chatgpt notranslate"aria-hidden="true"></i> to<li title="Click to see this page translated to Chinese"><a href="https://www.yegor256.com/zh/2022/06/05/reflection-means-hidden-coupling.html">中文</a><li title="Click to see this page translated to Russian"><a href="https://www.yegor256.com/ru/2022/06/05/reflection-means-hidden-coupling.html">русский</a></ul><p class="unprintable"><a href="/tag/oop.html"class="tag notranslate"><img src="/images/icons/cactus.svg"alt="OOP">oop</a><nav class="buttons notranslate desktop-only"><a href="https://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2022/06/05/reflection-means-hidden-coupling.html"title="Share on Facebook"class="button"rel="nofollow"><span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate"aria-hidden="true"></i> </a><a href="https://twitter.com/share?url=https://www.yegor256.com/2022/06/05/reflection-means-hidden-coupling.html&amp;text=Reflection+Means+Hidden+Coupling"title="Share on Twitter"class="button"rel="nofollow"><span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate"aria-hidden="true"></i> </a><a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2022/06/05/reflection-means-hidden-coupling.html"title="Share on LinkedIn"class="button"rel="nofollow"><span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate"aria-hidden="true"></i> </a><a href="https://reddit.com/submit?url=https://www.yegor256.com/2022/06/05/reflection-means-hidden-coupling.html%3F2022-23&amp;title=Reflection+Means+Hidden+Coupling"title="Share on Reddit"class="button"rel="nofollow"><span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate"aria-hidden="true"></i> </a><a href="https://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2022/06/05/reflection-means-hidden-coupling.html%3F2022-23&amp;t=Reflection+Means+Hidden+Coupling"title="Share on Hacker News"class="button"rel="nofollow"><span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate"aria-hidden="true"></i> </a><a href="#"title="Cite it via BibTeX"class="button"onclick='return $("#bibtex").toggle(),!1'><i class="icon icon-tex notranslate"aria-hidden="true"></i></a></nav></header><article class="main"itemprop="articleBody"><div><div id="bibtex"style="display:none"><p>Please, cite this blog post via <a href="https://www.bibtex.org/">BibTeX</a> as such:<pre style="color:#053c5e">@misc&#123;bugayenko2022blog0605,
  author = &#123;Bugayenko, Yegor&#125;,
  title = &#123;&#123;Reflection Means Hidden Coupling&#125;&#125;,
  howpublished = &#123;\url&#123;https://www.yegor256.com/220605.html&#125;&#125;,
  year = &#123;2022&#125;,
  month = &#123;jun&#125;,
  note = &#123;[Online; accessed 01-07-2025]&#125;
&#125;</pre></div><p><a href="https://en.wikipedia.org/wiki/Reflective_programming">Reflective programming</a> (or reflection) happens when your code changes itself on the fly. For example, a method of a class, when we call it, among other things adds a new method to the class (also known as <a href="https://en.wikipedia.org/wiki/Monkey_patch">monkey patching</a>). Java, Python, PHP, JavaScript, you name it—they all have this “powerful” feature. What’s <a href="https://softwareengineering.stackexchange.com/questions/193526">wrong</a> with it? Well, it’s <a href="https://mattwarren.org/2016/12/14/Why-is-Reflection-slow/">slow</a>, <a href="https://owasp.org/www-community/vulnerabilities/Unsafe_use_of_Reflection">dangerous</a>, and hard to read and debug. But all that is nothing compared with the <em>coupling</em> it introduces to the code.<figure class="jb_picture"><img itemprop="image"alt="Wheelman (2017) by Jeremy Rush"src="/images/2022/02/wheelman.jpg"longdesc="#18fe7bad"><figcaption id="18fe7bad">Wheelman (2017) by Jeremy Rush</figcaption></figure><p>There are many situations when reflection can “help” you. Let’s go through all of them and see why the coupling they add to the code is unnecessary and harmful.<h2 id="type-checking-and-casting">Type Checking and Casting</h2><p>Here is the code:<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kt">int</span> <span class="nf">sizeOf</span><span class="o">(</span><span class="nc">Iterable</span> <span class="n">items</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">return</span> <span class="o">((</span><span class="nc">Collection</span><span class="o">)</span> <span class="n">items</span><span class="o">).</span><span class="na">size</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div><p>I’m not sure everybody would agree that this is reflection, but I believe it is: we check the structure of the class at runtime and then make a call to the method <code class="language-plaintext highlighter-rouge">size()</code> which doesn’t exist in the <code class="language-plaintext highlighter-rouge">Iterable</code>. This method only “shows up” at runtime, when we make a <a href="https://stackoverflow.com/questions/19017258">dynamic shortcut</a> to it in the bytecode.<p>Why is this bad, aside from the fact that 1) it’s <a href="https://www.buzdin.lv/2011/01/is-java-reflection-really-slow.html">slow</a>, 2) it’s more verbose and so <a href="https://armedia.com/blog/instanceof-avoid-in-code/">less readable</a>, and 3) it introduces a new point of failure since the object <code class="language-plaintext highlighter-rouge">items</code> may not be an instance of class <code class="language-plaintext highlighter-rouge">Collection</code>, leading to <a href="https://docs.oracle.com/javaee/5/api/javax/el/MethodNotFoundException.html"><code class="language-plaintext highlighter-rouge">MethodNotFoundException</code></a>?<p>The biggest problem the code above causes to the entire program is the coupling it introduces between itself and its clients, for example:<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kt">void</span> <span class="nf">calc</span><span class="o">(</span><span class="nc">Iterable</span><span class="o">&lt;?&gt;</span> <span class="n">list</span><span class="o">)</span> <span class="o">{</span>
  <span class="kt">int</span> <span class="n">s</span> <span class="o">=</span> <span class="n">sizeOf</span><span class="o">(</span><span class="n">list</span><span class="o">);</span>
  <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"The size is "</span> <span class="o">+</span> <span class="n">s</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div><p>This method may work or it may not. It will depend on the actual class of <code class="language-plaintext highlighter-rouge">list</code>. If it is <code class="language-plaintext highlighter-rouge">Collection</code>, the call to <code class="language-plaintext highlighter-rouge">sizeOf</code> will succeed. Otherwise, there will be a runtime failure. By looking at the method <code class="language-plaintext highlighter-rouge">calc</code> we can’t tell what is the right way to handle <code class="language-plaintext highlighter-rouge">list</code> in order to avoid runtime failure. We need to read the body of <code class="language-plaintext highlighter-rouge">sizeOf</code> and only then can we change <code class="language-plaintext highlighter-rouge">calc</code> to something like this:<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kt">void</span> <span class="nf">calc</span><span class="o">(</span><span class="nc">Iterable</span><span class="o">&lt;?&gt;</span> <span class="n">list</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">list</span> <span class="k">instanceof</span> <span class="nc">Collection</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">s</span> <span class="o">=</span> <span class="n">sizeOf</span><span class="o">(</span><span class="n">list</span><span class="o">);</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"The size is "</span> <span class="o">+</span> <span class="n">s</span><span class="o">);</span>
  <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"The size is unknown"</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><p>This code seems to be OK so far. However, what will happen when <code class="language-plaintext highlighter-rouge">sizeOf</code> changes its implementation to something like this (I took it from <a href="/2015/04/02/class-casting-is-anti-pattern.html">this article</a> about casting):<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kt">int</span> <span class="nf">sizeOf</span><span class="o">(</span><span class="nc">Iterable</span> <span class="n">items</span><span class="o">)</span> <span class="o">{</span>
  <span class="kt">int</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">items</span> <span class="k">instanceof</span> <span class="nc">Collection</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">size</span> <span class="o">=</span> <span class="o">((</span><span class="nc">Collection</span><span class="o">)</span> <span class="n">items</span><span class="o">).</span><span class="na">size</span><span class="o">();</span>
  <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
    <span class="k">for</span> <span class="o">(</span><span class="nc">Object</span> <span class="n">item</span> <span class="o">:</span> <span class="n">items</span><span class="o">)</span> <span class="o">{</span>
      <span class="o">++</span><span class="n">size</span><span class="o">;</span>
    <span class="o">}</span>
  <span class="o">}</span>
  <span class="k">return</span> <span class="n">size</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div><p>Now, <code class="language-plaintext highlighter-rouge">sizeOf</code> perfectly handles any type that’s coming in, whether it’s an instance of <code class="language-plaintext highlighter-rouge">Collection</code> or not. However, the method <code class="language-plaintext highlighter-rouge">calc</code> doesn’t know about the changes made in the method <code class="language-plaintext highlighter-rouge">sizeOf</code>. Instead, it still believes that <code class="language-plaintext highlighter-rouge">sizeOf</code> will break if it gets anything aside from <code class="language-plaintext highlighter-rouge">Collection</code>. To keep them in sync we have to remember that <code class="language-plaintext highlighter-rouge">calc</code> knows too much about <code class="language-plaintext highlighter-rouge">sizeOf</code> and will have to modify it when <code class="language-plaintext highlighter-rouge">sizeOf</code> changes. Thus, it’s valid to say that <code class="language-plaintext highlighter-rouge">calc</code> is coupled with <code class="language-plaintext highlighter-rouge">sizeOf</code> and this coupling is <em>hidden</em>: most probably, we will forget to modify <code class="language-plaintext highlighter-rouge">calc</code> when <code class="language-plaintext highlighter-rouge">sizeOf</code> gets a better implementation. Moreover, there could be many other places in the program similar to <code class="language-plaintext highlighter-rouge">calc</code>, which we must remember to modify when the method <code class="language-plaintext highlighter-rouge">sizeOf</code> changes. Obviously, we will forget about most of them.<p>This coupling, which is a big maintainability issue, was introduced thanks to the very existence of reflection in Java. If we had not been able to use <code class="language-plaintext highlighter-rouge">instanceof</code> operator and class casting (or did not even have them), the coupling would not be possible in the first place.<h2 id="forceful-testing">Forceful Testing</h2><p>Consider this code:<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="nc">String</span> <span class="n">author</span><span class="o">;</span>
  <span class="kd">private</span> <span class="nc">String</span> <span class="n">title</span><span class="o">;</span>
  <span class="nc">Book</span><span class="o">(</span><span class="nc">String</span> <span class="n">a</span><span class="o">,</span> <span class="nc">String</span> <span class="n">t</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">author</span> <span class="o">=</span> <span class="n">a</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">title</span> <span class="o">=</span> <span class="n">t</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">print</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span>
      <span class="s">"The book is: "</span> <span class="o">+</span> <span class="k">this</span><span class="o">.</span><span class="na">name</span><span class="o">()</span>
    <span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">private</span> <span class="nc">String</span> <span class="nf">name</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">title</span> <span class="o">+</span> <span class="s">" by "</span> <span class="o">+</span> <span class="k">this</span><span class="o">.</span><span class="na">author</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><p>How would you write a unit test for this class and for its method <code class="language-plaintext highlighter-rouge">print()</code>? Obviously, it’s almost impossible without refactoring the class. The method <code class="language-plaintext highlighter-rouge">print</code> sends text to the console, which we can’t easily mock since it’s “static.” The right way would be to make <code class="language-plaintext highlighter-rouge">System.out</code> injectable as a dependency, but some of us <a href="https://stackoverflow.com/questions/34571">believe</a> that reflection is a better option, which would allow us to test the private method <code class="language-plaintext highlighter-rouge">name</code> directly, without calling <code class="language-plaintext highlighter-rouge">print</code> first:<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">BookTest</span> <span class="o">{</span>
  <span class="nd">@Test</span>
  <span class="kt">void</span> <span class="nf">testNamingWorks</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">Book</span> <span class="n">b</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Book</span><span class="o">(</span>
      <span class="s">"David West"</span><span class="o">,</span> <span class="s">"Object Thinking"</span>
    <span class="o">);</span>
    <span class="nc">Method</span> <span class="n">m</span> <span class="o">=</span> <span class="n">book</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getDeclaredMethod</span><span class="o">(</span><span class="s">"name"</span><span class="o">);</span>
    <span class="n">m</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
    <span class="n">assertThat</span><span class="o">(</span>
      <span class="o">(</span><span class="nc">String</span><span class="o">)</span> <span class="n">m</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="n">book</span><span class="o">),</span>
      <span class="n">equalTo</span><span class="o">(</span><span class="s">"Object Thinking by David West"</span><span class="o">)</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><p>You can also use <a href="https://github.com/powermock/powermock">PowerMock</a> Java library to do many “beautiful” things with private methods.<p>The problem with this test is that it is tightly coupled with the object it tests: the test <em>knows</em> too much about the class <code class="language-plaintext highlighter-rouge">Book</code>. The test knows that the class contains a private method <code class="language-plaintext highlighter-rouge">name</code>. The test also knows that the method <code class="language-plaintext highlighter-rouge">name</code> will at some point be called by the method <code class="language-plaintext highlighter-rouge">print</code>. Instead of testing <code class="language-plaintext highlighter-rouge">print</code> the test tests what it’s not supposed to be aware of: the internals of the class <code class="language-plaintext highlighter-rouge">Book</code>.<p>The main purpose of a unit test is to be a “safety net” for us programmers trying to modify the code that was written earlier or much much earlier: if we break anything, the tests give us a timely signal, “highlighting” the place where the code was broken. If nothing is highlighted and the tests are green I can continue modifying the code. I rely on the information from my tests. I trust them.<p>I take the class <code class="language-plaintext highlighter-rouge">Book</code> and want to modify it, simply making the method <code class="language-plaintext highlighter-rouge">name</code> return <code class="language-plaintext highlighter-rouge">StringBuilder</code> instead of <code class="language-plaintext highlighter-rouge">String</code>. It’s a pretty innocent modification, which may be necessary for performance considerations. Before I start making any changes, I run all tests (it’s a <a href="https://wiki.c2.com/?TestEveryRefactoring">good practice</a>) and they all pass. Then I make my changes, expecting no tests to fail:<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>
  <span class="c1">// ...</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">print</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span>
      <span class="s">"The book is: "</span> <span class="o">+</span> <span class="k">this</span><span class="o">.</span><span class="na">name</span><span class="o">().</span><span class="na">toString</span><span class="o">()</span>
    <span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">private</span> <span class="nc">StringBuilder</span> <span class="nf">name</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">StringBuilder</span><span class="o">()</span>
      <span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">title</span><span class="o">)</span>
      <span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">" by "</span><span class="o">)</span>
      <span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">author</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><p>However, the test <code class="language-plaintext highlighter-rouge">BookTest</code> will fail, because it <em>expects</em> my class <code class="language-plaintext highlighter-rouge">Book</code> to have method <code class="language-plaintext highlighter-rouge">name</code> which returns <code class="language-plaintext highlighter-rouge">String</code>. If it’s not my test or I wrote it a long time ago, I would be frustrated to learn this fact: the test expects me to write my <em>private</em> methods only one specific way. Why? What’s wrong with returning <code class="language-plaintext highlighter-rouge">StringBuilder</code>? I would think that there is some hidden reason for this. Otherwise, why would a test demand anything from a private implementation of a class? Very soon, after some investigation I would find out that there is no reason. It’s just an assumption the test made about the internals of <code class="language-plaintext highlighter-rouge">Book</code> and this assumption has no reasons aside from “We didn’t have time to refactor the class and make <code class="language-plaintext highlighter-rouge">System.out</code> injectable.”<p>By the way, this testing approach is <a href="/2018/12/11/unit-testing-anti-patterns.html">known</a> as the “Inspector” test anti-pattern.<p>What would I do next? I would have to roll back my changes and then start refactoring the test <em>and</em> the class, in order to get rid of this assumption. However, changing the test and at the same time changing main code is, <a href="https://twitter.com/yegor256/status/1525758255225528320">I believe</a>, a <a href="https://stackoverflow.com/questions/1569168">dangerous practice</a>: most probably I will introduce some new bugs.<p>The tests are not a “safety net” for me anymore. I can’t trust them. I modify the code and I know that I didn’t break anything. However, the test gives me a red signal. How can I trust it if it lies in such a simple scenario?<p>This coupling between the unit test <code class="language-plaintext highlighter-rouge">BookTest</code> and the class <code class="language-plaintext highlighter-rouge">Book</code> would not happen if it was not possible to use reflection in the first place. If nobody had the ability to reach the private method in any way, the Inspector anti-pattern in unit tests would not be possible.<p><a href="/2017/02/07/private-method-is-new-class.html">Of course</a>, life would be even better if we also didn’t have private methods.<h2 id="factories">Factories</h2><p>Here is how a typical <a href="/2017/11/14/static-factory-methods.html">factory</a> may work:<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">interface</span> <span class="nc">Operator</span> <span class="o">{</span>
  <span class="kt">int</span> <span class="nf">calc</span><span class="o">(</span><span class="kt">int</span> <span class="n">a</span><span class="o">,</span> <span class="kt">int</span> <span class="n">b</span><span class="o">);</span>
<span class="o">}</span>
<span class="c1">// This is a Factory Method:</span>
<span class="nc">Operator</span> <span class="nf">make</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">try</span> <span class="o">{</span>
    <span class="k">return</span> <span class="nc">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">"Op"</span> <span class="o">+</span> <span class="n">name</span><span class="o">);</span>
  <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">ClassNotFoundException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalStateException</span><span class="o">(</span><span class="n">ex</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><p>The <a href="/2017/11/14/static-factory-methods.html">factory method</a> is <code class="language-plaintext highlighter-rouge">make</code>. It expects the name of the “operator” to be provided and then, using <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Class.html#forName-java.lang.String-"><code class="language-plaintext highlighter-rouge">Class.forName()</code></a> from the Java Reflection API, constructs the name of the class, finds it in the <a href="https://docs.oracle.com/javase/tutorial/essential/environment/paths.html">classpath</a>, and makes an instance of it. Now, say there are two classes both implementing the interface <code class="language-plaintext highlighter-rouge">Operator</code>:<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">OpPlus</span> <span class="kd">implements</span> <span class="nc">Operator</span> <span class="o">{</span>
  <span class="kt">int</span> <span class="nf">calc</span><span class="o">(</span><span class="kt">int</span> <span class="n">a</span><span class="o">,</span> <span class="kt">int</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
<span class="kd">class</span> <span class="nc">OpMinus</span> <span class="kd">implements</span> <span class="nc">Operator</span> <span class="o">{</span>
  <span class="kt">int</span> <span class="nf">calc</span><span class="o">(</span><span class="kt">int</span> <span class="n">a</span><span class="o">,</span> <span class="kt">int</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><p>Then we use them, first asking our factory method to make objects from operator names:<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="n">make</span><span class="o">(</span><span class="s">"Plus"</span><span class="o">).</span><span class="na">calc</span><span class="o">(</span>
  <span class="n">make</span><span class="o">(</span><span class="s">"Minus"</span><span class="o">).</span><span class="na">calc</span><span class="o">(</span><span class="mi">15</span><span class="o">,</span> <span class="mi">3</span><span class="o">),</span>
  <span class="n">make</span><span class="o">(</span><span class="s">"Minus"</span><span class="o">).</span><span class="na">calc</span><span class="o">(</span><span class="mi">8</span><span class="o">,</span> <span class="mi">7</span><span class="o">)</span>
<span class="o">);</span>
</code></pre></div></div><p>The <code class="language-plaintext highlighter-rouge">result</code> will be 13.<p>We would not be able to do this without reflection. We would have to do this instead:<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">OpPlus</span><span class="o">().</span><span class="na">calc</span><span class="o">(</span>
  <span class="k">new</span> <span class="nf">OpMinus</span><span class="o">().</span><span class="na">calc</span><span class="o">(</span><span class="mi">15</span><span class="o">,</span> <span class="mi">3</span><span class="o">),</span>
  <span class="k">new</span> <span class="nf">OpMinus</span><span class="o">().</span><span class="na">calc</span><span class="o">(</span><span class="mi">8</span><span class="o">,</span> <span class="mi">7</span><span class="o">)</span>
<span class="o">);</span>
</code></pre></div></div><p>If you ask me, this code looks much more readable and maintainable. First of all, because in any IDE that enables <a href="https://www.jetbrains.com/help/idea/navigating-through-the-source-code.html#go_to_declaration">code navigation</a> it would be possible to click on <code class="language-plaintext highlighter-rouge">OpMinus</code> or <code class="language-plaintext highlighter-rouge">OpPlus</code> and immediately jump to the body of the class. Second, the logic of class finding is provided out-of-the-box by JVM: I don’t need to guess what happens when <code class="language-plaintext highlighter-rouge">make("Plus")</code> is called.<p>There are a few reasons why people love static factories. I don’t agree with them. This <a href="/2017/11/14/static-factory-methods.html">blog post</a> explains why. Without reflection it wouldn’t be possible to have static factories at all and the code would be better and more maintainable.<h2 id="annotations">Annotations</h2><p>In Java you can attach an annotation (an instance of a <a href="/2016/07/06/data-transfer-object.html">DTO</a>-ish interface) to a class (or an element of it like a method or an argument). The information from the annotation can then be read at runtime or compile time. In modern frameworks like <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/beans/factory/annotation/Autowired.html">Spring</a> this feature is frequently used in order to automate <a href="https://stackoverflow.com/questions/19414734">objects wiring</a>: you just attach some annotations to your classes and the framework will find them, instantiate them, place them into a <a href="/2014/10/03/di-containers-are-evil.html">DI container</a>, and assign to other objects’ attributes.<p>I’ve <a href="/2014/10/03/di-containers-are-evil.html">said it earlier</a> that this very mechanism of discovering objects and <em>automatically</em> wiring them together is an anti-pattern. I’ve also <a href="/2016/04/12/java-annotations-are-evil.html">said earlier</a> that annotations are an anti-pattern. Neither dependency injection containers, not auto-wiring, nor annotations would exist if there was no reflection. Life would be much better and Java/OOP much cleaner.<p>The clients of annotated objects/classes are coupled with them, and this coupling is <em>hidden</em>. An annotated object can change its interface or modify annotations and the code will compile just fine. The problem will surface only later at runtime, when the expectations of other objects won’t be satisfied.<h2 id="serialization">Serialization</h2><p>When programmers don’t understand <a href="/2016/08/15/what-is-wrong-object-oriented-programming.html">object-oriented paradigm</a>, they make <a href="/2016/07/06/data-transfer-object.html">DTOs</a> instead of <a href="/2016/07/14/who-is-object.html">proper objects</a>. Then, in order to transfer a DTO over a network or save it to a file, they <a href="https://en.wikipedia.org/wiki/Serialization">serialize</a> or <a href="https://en.wikipedia.org/wiki/Marshalling_%28computer_science%29">marshall</a> them. It’s usually done by a special serialization engine, which takes a DTO, <a href="http://erights.org/data/serial/jhu-paper/intro.html">breaks</a> all possible encapsulation barriers, reads the values of all of its fields, and packages them into, say, a piece of JSON.<p>In order to let the serialization engine break encapsulation barriers, a programming language has to have reflection. First, because some fields of a DTO may be private and thus accessible only through reflection. Second, even if a DTO is designed “right” with all necessary <a href="/2014/09/16/getters-and-setters-are-evil.html">getters</a> for the private fields, still reflection is required in order to understand which getters are present and can be called.<p>The attitude serialization expresses towards objects is very similar to what <a href="/2014/12/01/orm-offensive-anti-pattern.html">ORM</a> does. Neither of them talk to objects, but instead they pretty “offensively” tear them apart, taking away what’s necessary, and leaving the poor objects unconscious. If in the future an object decides to change its structure, rename some fields, or change the types of returned values—other objects, which actually are coupled with the object through serialization, won’t notice anything. They will notice, but only at runtime, when “invalid data format” exceptions start floating up. The developers of the object won’t have a chance to notice that their changes to the interface of the object affect some other places in the code base.<p>We can say that serialization is a “perfect” method of coupling two objects such that neither one will know about it.<p>The <a href="/2016/07/14/who-is-object.html">very idea</a> of object-oriented programming is centered around the principle that an object is king. An object and only an object may decide what to do with the data it encapsulates. The existence of this principle and adherence to it helps avoid runtime errors usually caused by a simple scenario: A uses the data coming from B without telling B how it’s being used, then B changes the format or semantics of the data, and A fails to understand it.<p>Obviously, serialization in such an “abusive” way would not be possible, if there was no reflection in the first place. A more careful serialization would be possible and would be used, not through reflection but via <a href="/2016/04/05/printers-instead-of-getters.html">printers</a> implemented by objects.<hr><p>To conclude, reflection introduces coupling, which is hidden. This is the most dangerous type of coupling, because it’s hard to follow, it’s hard to find, and it’s hard to remove. Without reflection object-oriented design would be much cleaner and solid. But even if this feature does exist, I suggest you never use reflection in your programming language.<blockquote class="twitter-tweet"><p lang="en"dir="ltr">Do you use reflective programming (reflection)?</p>&mdash; Yegor Bugayenko (@yegor256) <a href="https://twitter.com/yegor256/status/1535919879886446592?ref_src=twsrc%5Etfw">June 12, 2022</a></blockquote><script async=""src="https://platform.twitter.com/widgets.js"charset="utf-8"></script></div></article></div><div class="disqus"role="complementary"aria-hidden="true"><p class="disqus_hint">Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.<div id="disqus_thread"class="disqus-thread"><a>&nbsp;</a></div><script>var disqus_config=function(){this.page.url=document.location.href.split("?")[0].split("#")[0],this.page.identifier=this.page.url};(()=>{var e=document,t=e.createElement("script");t.src="//yegor256.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)})()</script><noscript><div><p class="red">JavaScript is disabled in your browser, that's why you can't see comments under this post.</div></noscript></div><div class="wrapper"><footer class="footer"><p>&copy; <span itemscope=""itemprop="copyrightHolder"itemtype="http://schema.org/Person"><span itemprop="name">Yegor Bugayenko</span> </span>, 2014&ndash;<span itemprop="copyrightYear">2025</span></footer></div></section><div class="wrapper unprintable"style="text-align:center;margin-top:2em"><a href="https://www.sixnines.io/h/3ba1652f"><img src="https://www.sixnines.io/b/3ba1652f?style=flat"alt="sixnines availability badge"></a>&nbsp; <a href="https://github.com/yegor256/blog/stargazers"><img src="https:https://img.shields.io/github/stars/yegor256/blog.svg?style=flat-square"alt="GitHub stars"></a></div><script src="https://code.jquery.com/jquery-1.9.0.min.js"></script><script src="/js/all.js?06f2b2b"></script><script type="application/ld+json">{ "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "https://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] }</script>