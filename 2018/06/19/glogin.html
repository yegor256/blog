<!DOCTYPE html> <html xmlns="https://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="I created a simple Ruby gem that enabled GitHub OAuth login for a Ruby web app; works for me together with Sinatra, most probably will work with other frameworks." /> <meta name="keywords" content="github login ruby, github oauth login, ruby, ruby github oauth, ruby web github login" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2018-06-19 00:00:00 +0000"> <meta name="yandex-verification" content="7d2a0afee14d72bc" /> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Simplified GitHub Login for a Ruby Web App"/> <meta name="twitter:description" property="og:description" content="I created a simple Ruby gem that enabled GitHub OAuth login for a Ruby web app; works for me together with Sinatra, most probably will work with other frameworks."/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2018/06/19/glogin.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="icon" href="/favicon.ico?8aa6c60" type="image/x-icon"/> <link rel="shortcut icon" href="/favicon.ico?8aa6c60"/> <link rel="apple-touch-icon" href="/favicon.ico?8aa6c60"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?8aa6c60"/> <link rel="stylesheet" href="/css/icons.css?8aa6c60"/> <link rel="canonical" href="https://www.yegor256.com/2018/06/19/glogin.html" /> <title>Simplified GitHub Login for a Ruby Web App</title> <meta name='og:image' content='https://www.yegor256.com/images/2018/06/savages.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2018/06/savages.jpg'/><meta name='og:image:width' content='1463'/> <meta name='twitter:image:width' content='1463'/><meta name='og:image:height' content='955'/> <meta name='twitter:image:height' content='955'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='The Savages (2007) by Tamara Jenkins'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My Stack Overflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/yegor256news" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;475</a></li> <li ><a href="/teaching.html" title="My courses and lectures">Teaching</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/research.html" title="My research directions and progress">Research</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="https://www.iccq.ru" title="International Conference on Code Quality">ICCQ</a></li> <li ><a href="https://www.kaicode.org" title="Open Source Festival">KaiCode</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Art</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> If you have an open source repository designed right, there is a chance to win up to $4,096 at <a href="https://www.kaicode.org">KaiCode'25</a>, our 8th annual open source festival. <a href="https://docs.google.com/forms/d/1nUlL2xvL1OOy3LoVF-g7MfB-9yeG68XB2wXW4MAoWrY">Submit</a> your project now, it's free! </li> <li> Are you a Java developer? Ready to move to Moscow (Russia) and join my team for a full-time employment in Fortune-100 company? We are working with <a href="https://www.eolang.org">EO</a>, a new programming language. <a href="mailto:job@yegor256.com">Email me</a>, we'll discuss. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2018/06/19/glogin.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/180619.html</code></p><h1 itemprop="name headline mainEntityOfPage">Simplified GitHub Login for a Ruby Web App</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2018-06-19T00:00:00+00:00"> 19 June 2018 </time> </li> <li class="desktop-only" itemprop="locationCreated">Moscow, Russia</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="https://www.yegor256.com/2018/06/19/glogin.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><ul class="unprintable subline"> <li title="The page is translated by ChatGPT from English to a few languages"> Translated by <i class="icon icon-chatgpt notranslate" aria-hidden="true"></i> to </li> <li title="Click to see this page translated to Chinese"> <a href='https://www.yegor256.com/zh/2018/06/19/glogin.html'>中文</a> </li> <li title="Click to see this page translated to Russian"> <a href='https://www.yegor256.com/ru/2018/06/19/glogin.html'>русский</a> </li></ul><p class="unprintable"><a href='/tag/ruby.html' class='tag notranslate'><img src='/images/icons/ruby-white.svg' alt='Ruby'/>ruby</a></p><nav class="buttons notranslate desktop-only"> <a href="https://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2018/06/19/glogin.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2018/06/19/glogin.html&amp;text=Simplified+GitHub+Login+for+a+Ruby+Web+App" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2018/06/19/glogin.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="https://reddit.com/submit?url=https://www.yegor256.com/2018/06/19/glogin.html%3F2018-24&amp;title=Simplified+GitHub+Login+for+a+Ruby+Web+App" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="https://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2018/06/19/glogin.html%3F2018-24&amp;t=Simplified+GitHub+Login+for+a+Ruby+Web+App" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> <a href="#" title="Cite it via BibTeX" class="button" onclick="$('#bibtex').toggle(); return false;"> <i class="icon icon-tex notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><div id="bibtex" style="display: none"><p>Please, cite this blog post via <a href="https://www.bibtex.org/">BibTeX</a> as such:</p><pre style="color:#053c5e;">@misc&#123;bugayenko2018blog0619,
  author = &#123;Bugayenko, Yegor&#125;,
  title = &#123;&#123;Simplified GitHub Login for a Ruby Web App&#125;&#125;,
  howpublished = &#123;\url&#123;https://www.yegor256.com/180619.html&#125;&#125;,
  year = &#123;2018&#125;,
  month = &#123;jun&#125;,
  note = &#123;[Online; accessed 18-05-2025]&#125;
&#125;</pre></div><p>You know what <a href="https://en.wikipedia.org/wiki/OAuth">OAuth</a> login is, right? It’s when your users click “login” and get redirected to Facebook, Twitter, Google, or some other website which then identifies them. Then they go back to your website and you know who they are. It’s very convenient for them. It’s convenient for you too, since you don’t need to implement the login functionality and don’t need to keep their credentials in a database. I created a simple <a href="https://github.com/yegor256/glogin">Ruby gem</a> to simplify this operation for GitHub only. Here is how it works.</p><figure class="jb_picture"><img itemprop="image" alt="The Savages (2007) by Tamara Jenkins" src="/images/2018/06/savages.jpg" longdesc="#0d3acec9" /><figcaption id="0d3acec9">The Savages (2007) by Tamara Jenkins</figcaption></figure><p>First, you will have to register your application in GitHub, as <a href="https://developer.github.com/apps/building-integrations/setting-up-and-registering-oauth-apps/">this page</a> explains. This is how it works with <a href="https://www.sinatrarb.com/">Sinatra</a>, but you can do something similar in any framework.</p><p>First, somewhere in the global space, before the app starts:</p><div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s1">'glogin'</span>
<span class="n">configure</span> <span class="k">do</span>
  <span class="n">set</span> <span class="ss">:glogin</span><span class="p">,</span> <span class="no">GLogin</span><span class="o">::</span><span class="no">Auth</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span>
    <span class="c1"># You get this from GitHub, when you register your</span>
    <span class="c1"># web application:</span>
    <span class="n">client_id</span><span class="p">,</span>
    <span class="c1"># Make sure this value is coming from a secure</span>
    <span class="c1"># place and is NOT visible in the source code:</span>
    <span class="n">client_secret</span><span class="p">,</span>
    <span class="c1"># This is what you will register in GitHub as an</span>
    <span class="c1"># authorization callback URL:</span>
    <span class="s1">'https://www.example.com/github-callback'</span>
  <span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div><p>Next, for all web pages we need to parse a cookie, if it exists, and convert it into a user:</p><div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s1">'sinatra/cookies'</span>
<span class="n">before</span> <span class="s1">'/*'</span> <span class="k">do</span>
  <span class="k">if</span> <span class="n">cookies</span><span class="p">[</span><span class="ss">:glogin</span><span class="p">]</span>
    <span class="k">begin</span>
      <span class="vi">@user</span> <span class="o">=</span> <span class="no">GLogin</span><span class="o">::</span><span class="no">Cookie</span><span class="o">::</span><span class="no">Closed</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span>
        <span class="n">cookies</span><span class="p">[</span><span class="ss">:glogin</span><span class="p">],</span>
        <span class="c1"># This must be some long text to be used to</span>
        <span class="c1"># encrypt the value in the cookie:</span>
        <span class="n">encryption_secret</span>
      <span class="p">).</span><span class="nf">to_user</span>
    <span class="k">rescue</span> <span class="no">OpenSSL</span><span class="o">::</span><span class="no">Cipher</span><span class="o">::</span><span class="no">CipherError</span> <span class="o">=&gt;</span> <span class="n">_</span>
      <span class="c1"># Nothing happens here, the user is not logged in.</span>
      <span class="n">cookies</span><span class="p">.</span><span class="nf">delete</span><span class="p">(</span><span class="ss">:glogin</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div><p>If the <code class="language-plaintext highlighter-rouge">glogin</code> cookie comes in and contains valid data, a local variable <code class="language-plaintext highlighter-rouge">@user</code> will be set to something like this:</p><div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span> <span class="ss">login: </span><span class="s1">'yegor256'</span><span class="p">,</span> <span class="ss">avatar: </span><span class="s1">'http://...'</span> <span class="p">}</span>
</code></pre></div></div><p>Next, we need a URL for GitHub OAuth callback:</p><div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">get</span> <span class="s1">'/github-callback'</span> <span class="k">do</span>
  <span class="n">cookies</span><span class="p">[</span><span class="ss">:glogin</span><span class="p">]</span> <span class="o">=</span> <span class="no">GLogin</span><span class="o">::</span><span class="no">Cookie</span><span class="o">::</span><span class="no">Open</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span>
    <span class="n">settings</span><span class="p">.</span><span class="nf">glogin</span><span class="p">.</span><span class="nf">user</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:code</span><span class="p">]),</span>
    <span class="c1"># The same encryption secret that we were using above:</span>
    <span class="n">encryption_secret</span>
  <span class="p">).</span><span class="nf">to_s</span>
  <span class="n">redirect</span> <span class="n">to</span><span class="p">(</span><span class="s1">'/'</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div><p>Finally, we need a logout URL:</p><div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">get</span> <span class="s1">'/logout'</span> <span class="k">do</span>
  <span class="n">cookies</span><span class="p">.</span><span class="nf">delete</span><span class="p">(</span><span class="ss">:glogin</span><span class="p">)</span>
  <span class="n">redirect</span> <span class="n">to</span><span class="p">(</span><span class="s1">'/'</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div><p>One more thing is the login URL you will need for your front page. Here it is:</p><div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">settings</span><span class="p">.</span><span class="nf">glogin</span><span class="p">.</span><span class="nf">login_uri</span>
</code></pre></div></div><p>For unit testing you can just provide an empty string as a <code class="language-plaintext highlighter-rouge">secret</code> for <code class="language-plaintext highlighter-rouge">GLogin::Cookie::Open</code> and <code class="language-plaintext highlighter-rouge">GLogin::Cookie::Closed</code> and the encryption will be disabled: whatever comes from the cookie will be trusted. For testing it will be convenient to provide a user name in a query string, like this:</p><div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://localhost:9292/?glogin=tester
</code></pre></div></div><p>To enable that, it’s recommended you add this line (see how it works in <a href="https://github.com/zold-io/wts.zold.io">zold-io/wts.zold.io</a>):</p><div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s1">'sinatra/cookies'</span>
<span class="n">before</span> <span class="s1">'/*'</span> <span class="k">do</span>
  <span class="n">cookies</span><span class="p">[</span><span class="ss">:glogin</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="ss">:glogin</span><span class="p">]</span> <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="ss">:glogin</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">cookies</span><span class="p">[</span><span class="ss">:glogin</span><span class="p">]</span>
    <span class="c1"># same as above</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div><p>I use this gem in <a href="https://github.com/yegor256/sixnines">sixnines</a>, <a href="https://github.com/yegor256/0pdd">0pdd</a>, and <a href="https://github.com/zold-io/wts.zold.io">Zold</a> web apps on top of Sinatra (all open source).</p></div></article></div><div class="disqus" role="complementary" aria-hidden="true"><p class="disqus_hint" > Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0]; this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span>, 2014&ndash;<span itemprop="copyrightYear">2025</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="https://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge" /></a> &nbsp; <a href="https://github.com/yegor256/blog/stargazers"> <img src="//img.shields.io/github/stars/yegor256/blog.svg?style=flat-square" alt="GitHub stars" /></a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?8aa6c60"></script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "https://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html>
