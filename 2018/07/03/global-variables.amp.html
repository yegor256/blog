<!doctypehtml><html amp lang="en"><meta charset="utf-8"><title>What's Wrong With Global Variables?</title><link rel="canonical"href="https://www.yegor256.com/2018/07/03/global-variables.html"><link rel="icon"type="image/png"href="/favicon.ico"><meta name="viewport"content="width=device-width,minimum-scale=1,initial-scale=1"><script type="application/ld+json">{
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "mainEntityOfPage":{
          "@type": "WebPage",
          "@id": "https://www.yegor256.com/2018/07/03/global-variables.html"
        },
        "headline": "What's Wrong With Global Variables?",
        "image": {
          "@type": "ImageObject",
          "url": "/images/2018/07/el-chapo.jpg",
          "height": 698,
          "width": 1240
        },
        "datePublished": "2018-07-03",
        "dateModified": "2018-07-03",
        "author": {
          "@type": "Person",
          "name": "Yegor Bugayenko"
        },
        "publisher": {
          "@type": "Organization",
          "name": "yegor256.com",
          "logo": {
            "@type": "ImageObject",
            "url": "https://www.yegor256.com/images/face-512x512.jpg",
            "width": 512,
            "height": 512
          }
        },
        "description": "There are many reasons why global variables are
evil and must be avoided in an object-oriented context;
here is yet another one from me.
",
        "keywords": ["global variables", "oop global variables", "global variables evil", "global variables bad", "global variables wrong"]
      }</script><style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript><link rel="stylesheet"href="https://fonts.googleapis.com/css?family=Source+Code+Pro:400,500"><style amp-custom="amp-custom">@font-face{font-family:Cambria;src:url(https://www.yegor256.com/fonts/cambria/2EAA54_2_0.ttf)}body{font-family:Cambria,'Times New Roman',serif;padding:.5em;font-size:1.2em}article{width:600px;max-width:100%;margin-left:auto;margin-right:auto}code,pre{font-family:'Source Code Pro','Courier New',monospace;font-size:.8em}code{padding:0 .3em;background-color:#d3d3d3}a,a:hover,a:visited{color:inherit}.intro{color:red;font-size:.75em}.photo{border-radius:50%}pre{overflow-x:scroll}</style><script async src="https://cdn.ampproject.org/v0.js"></script><article><p class="intro">This is a mobile version, full one is <a href="https://www.yegor256.com/2018/07/03/global-variables.html">here</a>.<p><amp-img src="/images/face-256x256.jpg"width="80"height="80"alt="Yegor Bugayenko"class="photo"></amp-img><p>Yegor Bugayenko<br>3 July 2018<h1>What's Wrong With Global Variables?</h1><p>Only lazy people haven’t written already about how <a href="https://en.wikipedia.org/wiki/Global_variable">global variables</a> are evil. It started in 1973 when W. Wulf et al. <a href="https://dl.acm.org/citation.cfm?id=953355">claimed</a> that “the non-local variable is a major contributing factor in programs which are difficult to understand.” Since then, <a href="http://wiki.c2.com/?GlobalVariablesAreBad">many other reasons</a> where suggested to convince programmers to stop using global variables. I think <a href="https://softwareengineering.stackexchange.com/questions/148108/why-is-global-state-so-evil">I read them all</a>, but didn’t find the one that bothers me most of all: composability. In a nutshell, global variables make code difficult or impossible to compose in ways which are different from what its original author expected.</p><amp-img src="/images/2018/07/el-chapo.jpg"alt="El Chapo, Season 1 (2017) by Silvana Aguirre et al."height="698"width="1240"layout="responsive"></amp-img><p>I was recently writing a web front for <a href="https://www.zold.io">Zold</a> in Ruby, on top of <a href="https://sinatrarb.com/">Sinatra</a>. This is how a web server starts according to <a href="https://sinatrarb.com/intro.html">their documentation</a>:<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">App</span><span class="p">.</span><span class="nf">start!</span>
</code></pre></div></div><p>Here <code class="language-plaintext highlighter-rouge">start!</code> is a static method of the <code class="language-plaintext highlighter-rouge">App</code> class, which you have to declare as a child of their default parent <a href="https://github.com/sinatra/sinatra/blob/v2.0.3/lib/sinatra/base.rb#L893-L1896"><code class="language-plaintext highlighter-rouge">Sinatra::Base</code></a>. To tell the app which TCP port to listen to you have to preconfigure it:<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s1">'sinatra/base'</span>
<span class="k">class</span> <span class="nc">App</span> <span class="o">&lt;</span> <span class="no">Sinatra</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
    <span class="s1">'Hello, world!'</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="no">App</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="ss">:port</span><span class="p">,</span> <span class="mi">8080</span><span class="p">)</span>
<span class="no">App</span><span class="p">.</span><span class="nf">start!</span>
</code></pre></div></div><p>What do you do if you want to start two web servers? For the purpose of testing this may be a pretty logical requirement. For example, since Zold is a distributed network, it is necessary to test how a number of servers communicate to each other. I can’t do that! There is absolutely no way. Because Sinatra is designed with the assumption that only one server may exist in the entire application scope.<p>Can this really be fixed? Let’s take a look at <a href="https://github.com/sinatra/sinatra/">their code</a>. Class <code class="language-plaintext highlighter-rouge">Sinatra::Base</code> is essentially a <a href="/2016/06/27/singletons-must-die.html">Singleton</a>, which is not supposed to have more than one instance. When we call <code class="language-plaintext highlighter-rouge">App.set(:port, 8080)</code>, the value <code class="language-plaintext highlighter-rouge">8080</code> is saved into an attribute of a single instance. The number <code class="language-plaintext highlighter-rouge">8080</code> becomes available for all methods of <code class="language-plaintext highlighter-rouge">Sinatra::Base</code>, no matter what instance they are called from.<p>They are not using <a href="https://ruby-doc.org/docs/ruby-doc-bundle/UsersGuide/rg/globalvars.html">true</a> Ruby global variables, I believe, because they know that they are bad. Why exactly they are bad and what the <a href="/2014/05/05/oop-alternative-to-utility-classes.html">alternatives</a> are—slipped through their fingers.<p>Technically speaking, their design is “globally scoped.” <code class="language-plaintext highlighter-rouge">Sinatra::Base</code> treats the entire application as its scope of visibility. No matter who calls it, everything is visible, including what was created in previous calls and in previously instantiated objects. This “class” is a giant bag of global variables.<p>Every global variable is a troublemaker of that kind. While the application is small and its test coverage is low, global variables may not hurt. But the bigger the app and the more sophisticated its automated testing scenarios, the more difficult it will be to compose objects which depend on global variables, singletons, or class variables.<p>My recommendation? Under no circumstances even think about any global variables.<blockquote class="twitter-tweet"data-lang="en"><p lang="en"dir="ltr">What do you think about global variables? <a href="https://twitter.com/hashtag/elegantobjects?src=hash&amp;ref_src=twsrc%5Etfw">#elegantobjects</a> <a href="https://twitter.com/hashtag/oop?src=hash&amp;ref_src=twsrc%5Etfw">#oop</a></p>--- Yegor Bugayenko (@yegor256) <a href="https://twitter.com/yegor256/status/1018400337324118016?ref_src=twsrc%5Etfw">July 15, 2018</a></blockquote></article>