<!doctypehtml><html xmlns="https://www.w3.org/1999/xhtml"lang="en-US"xml:lang="en-US"itemscope=""itemtype="http://schema.org/WebSite"><meta charset="utf-8"><meta name="description"content="Instantiating objects via operator NEW is what we have to do in order to have those objects; however, it&apos;s important where this happens."><meta name="keywords"content="alan kay about oop, alan kay oop definition, message oriented programming, messages oop, operator new"><meta name="viewport"content="width=device-width,minimum-scale=1,initial-scale=1"><meta name="google-site-verification"content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8"><meta name="author"content="Yegor Bugayenko"><meta name="article:published_time"content="2018-01-02 00:00:00 +0000"><meta name="yandex-verification"content="7d2a0afee14d72bc"><meta name="og:site_name"content="Yegor Bugayenko"><meta name="og:type"content="article"><meta name="og:locale"content="en_US"><meta name="twitter:account_id"content="4503599630178231"><meta name="twitter:creator"content="@yegor256"><meta name="twitter:site"content="@yegor256"><meta name="twitter:title"property="og:title"content="Operator new() is Toxic"><meta name="twitter:description"property="og:description"content="Instantiating objects via operator NEW is what we have to do in order to have those objects; however, it&apos;s important where this happens."><meta name="twitter:url"property="og:url"content="https://www.yegor256.com/2018/01/02/operator-new-is-toxic.html"><meta name="telegram:channel"content="AAAAAEJFMRzsRTRxM3ec6A"><link rel="search"type="application/opensearchdescription+xml"href="/opensearch.xml"title="yegor256"><link rel="icon"href="/favicon.ico?6bac3c7"type="image/x-icon"><link rel="shortcut icon"href="/favicon.ico?6bac3c7"><link rel="apple-touch-icon"href="/favicon.ico?6bac3c7"><link rel="alternate"type="application/rss+xml"title="RSS for yegor256.com"href="https://www.yegor256.com/rss.xml"><link rel="stylesheet"href="/css/layout.css?6bac3c7"><link rel="stylesheet"href="/css/icons.css?6bac3c7"><link rel="canonical"href="https://www.yegor256.com/2018/01/02/operator-new-is-toxic.html"><title>Operator new() is Toxic</title><meta name="og:image"content="https://www.yegor256.com/images/2018/01/the-gift.jpg"><meta name="twitter:image"content="https://www.yegor256.com/images/2018/01/the-gift.jpg"><meta name="og:image:width"content="1280"><meta name="twitter:image:width"content="1280"><meta name="og:image:height"content="803"><meta name="twitter:image:height"content="803"><meta name="twitter:card"content="summary_large_image"><meta name="twitter:image:alt"content="The Gift (2015) by Joel Edgerton"><div class="wrapper"><aside class="header-toggle unprintable"id="header-toggle"title="Show the menu"onclick='$("#header").show(),$("#header-toggle").hide()'>&#9776;</aside><header class="header"id="header"><div class="face"><a href="/about-me.html#form"class="sub"title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html"style="position:relative"><img src="/images/face-256x256.jpg"class="photo"alt="Yegor Bugayenko"></a></div><nav><ul class="menu social notranslate"><li><a href="https://twitter.com/intent/follow?screen_name=yegor256"rel="nofollow"title="Follow me on Twitter"><i class="icon icon-twitter notranslate"aria-hidden="true"></i></a><li><a href="/rss.xml"rel="nofollow"title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate"aria-hidden="true"></i></a><li><a itemprop="sameAs"href="https://github.com/yegor256"rel="nofollow"title="My GitHub profile"><i class="icon icon-github notranslate"aria-hidden="true"></i></a><li><a itemprop="sameAs"href="http://stackoverflow.com/users/187141/yegor256"rel="nofollow"title="My Stack Overflow profile"><i class="icon icon-stackoverflow notranslate"aria-hidden="true"></i></a><li><a itemprop="sameAs"href="https://www.facebook.com/yegor256"rel="nofollow"title="Follow me on Facebook"><i class="icon icon-facebook notranslate"aria-hidden="true"></i></a><li><a itemprop="sameAs"href="https://instagram.com/yegor256"rel="nofollow"title="Follow me on Instagram"><i class="icon icon-instagram notranslate"aria-hidden="true"></i></a><li><a itemprop="sameAs"href="https://www.linkedin.com/in/yegor256"rel="nofollow"title="My LinkedIn profile"><i class="icon icon-linkedin notranslate"aria-hidden="true"></i></a><li><a itemprop="sameAs"href="https://www.youtube.com/c/yegor256?sub_confirmation=1"rel="nofollow"title="My Youtube video channel"><i class="icon icon-youtube notranslate"aria-hidden="true"></i></a><li><a href="https://soundcloud.com/yegor256"rel="nofollow"title="My podcast"><i class="icon icon-podcast notranslate"aria-hidden="true"></i></a><li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721"rel="nofollow"title="My iTunes podcast"><i class="icon icon-itunes notranslate"aria-hidden="true"></i></a><li><a href="https://t.me/yegor256news"rel="nofollow"title="My Telegram public channel"><i class="icon icon-telegram notranslate"aria-hidden="true"></i></a><li><a href="mailto:blog@yegor256.com"rel="nofollow"title="Email me any time"><i class="icon icon-mail notranslate"aria-hidden="true"></i></a></ul><ul class="menu"><li><a href="/"title="Home page">Home</a><li><a href="/best.html"title="Best articles to read">12&#160;Best</a><li><a href="/contents.html"title="The contents of the entire blog">All&#160;480</a><li><a href="/teaching.html"title="My courses and lectures">Teaching</a><li><a href="/talks.html"title="Future and past conference talks">Talks</a><li><a href="/books.html"title="The books I wrote">Books</a><li><a href="/research.html"title="My research directions and progress">Research</a><li><a href="/pets.html"title="My loved pet projects">Pets</a><li><a href="/trainings.html"title="On-site trainings">Trainings</a><li><a href="https://www.iccq.ru"title="International Conference on Code Quality">ICCQ</a><li><a href="https://www.kaicode.org"title="Open Source Festival">KaiCode</a><li><a href="/testimonials.html"title="What some people say about me">Testimonials</a><li><a href="/shift-m.html"title="Audio podcast about project management">Shift-M</a><li><a href="/paintings.html"title="My paintings for sale">Art</a></ul></nav><div class="search"><form action="https://www.google.com/search"itemprop="potentialAction"itemscope=""itemtype="http://schema.org/SearchAction"><meta itemprop="target"content="https://www.google.com/search?q={q}"><input name="sitesearch"value="yegor256.com"type="hidden"> <input itemprop="query-input"id="search-query"class="field field-text"required="required"onfocus='$(".google").css("visibility","visible")'name="q"placeholder="Search..."autocomplete="off"> <input type="image"src="/images/google-search-icon.svg"class="google"title="Search via Google"alt="Search via Google"></form></div><div class="hot"><ul><li>Are you familiar with open source and have a decent GitHub portfolio of contributions? <strong>We need freelancers</strong>, working remotely and paid by result, for <a href="https://www.eolang.org">EO</a>, a new programming language. Join our Telegram group, we'll discuss: <a href="https://t.me/eolang_org">@eolang_org</a>.</ul></div></header></div><section itemscope=""itemtype="http://schema.org/BlogPosting"><div class="wrapper"><header><p class="printable"><img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2018/01/02/operator-new-is-toxic.html&amp;format=svg"style="width:125px;height:125px"alt="QR code"><p class="printable"><code itemprop="url">https://www.yegor256.com/180102.html</code><h1 itemprop="name headline mainEntityOfPage">Operator new() is Toxic</h1><aside class="book"><a href="https://amzn.to/2qFt4Tn"><img src="/images/books/elegant-objects/cover-eo1.png"class="book-cover"alt="book cover"></a>Read more about this subject in <a href="https://amzn.to/2qFt4Tn">Section&nbsp;3.6</a><br>of my book <a href="https://amzn.to/2qFt4Tn"><img src="/images/books/amazon-buy-button.png"class="amazon-button"alt="Click to buy"></a></aside><ul class="subline"><li><time itemprop="datePublished"datetime="2018-01-02T00:00:00+00:00">2 January 2018</time><li class="desktop-only"itemprop="locationCreated">Moscow, Russia<li class="printable"itemscope=""itemprop="author"itemtype="http://schema.org/Person"><span itemprop="name">Yegor Bugayenko</span><li class="unprintable"><i class="icon icon-comments"></i> <a href="https://www.yegor256.com/2018/01/02/operator-new-is-toxic.html#disqus_thread"itemprop="discussionUrl">comments</a></ul><ul class="unprintable subline"><li title="The page is translated by ChatGPT from English to a few languages">Translated by <i class="icon icon-chatgpt notranslate"aria-hidden="true"></i> to<li title="Click to see this page translated to Chinese"><a href="https://www.yegor256.com/zh/2018/01/02/operator-new-is-toxic.html">中文</a><li title="Click to see this page translated to Russian"><a href="https://www.yegor256.com/ru/2018/01/02/operator-new-is-toxic.html">русский</a></ul><p class="unprintable"><a href="/tag/oop.html"class="tag notranslate"><img src="/images/icons/cactus.svg"alt="OOP">oop</a><nav class="buttons notranslate desktop-only"><a href="https://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2018/01/02/operator-new-is-toxic.html"title="Share on Facebook"class="button"rel="nofollow"><span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate"aria-hidden="true"></i> </a><a href="https://twitter.com/share?url=https://www.yegor256.com/2018/01/02/operator-new-is-toxic.html&amp;text=Operator+new%28%29+is+Toxic"title="Share on Twitter"class="button"rel="nofollow"><span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate"aria-hidden="true"></i> </a><a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2018/01/02/operator-new-is-toxic.html"title="Share on LinkedIn"class="button"rel="nofollow"><span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate"aria-hidden="true"></i> </a><a href="https://reddit.com/submit?url=https://www.yegor256.com/2018/01/02/operator-new-is-toxic.html%3F2018-00&amp;title=Operator+new%28%29+is+Toxic"title="Share on Reddit"class="button"rel="nofollow"><span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate"aria-hidden="true"></i> </a><a href="https://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2018/01/02/operator-new-is-toxic.html%3F2018-00&amp;t=Operator+new%28%29+is+Toxic"title="Share on Hacker News"class="button"rel="nofollow"><span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate"aria-hidden="true"></i> </a><a href="#"title="Cite it via BibTeX"class="button"onclick='return $("#bibtex").toggle(),!1'><i class="icon icon-tex notranslate"aria-hidden="true"></i></a></nav></header><article class="main"itemprop="articleBody"><div><div id="bibtex"style="display:none"><p>Please, cite this blog post via <a href="https://www.bibtex.org/">BibTeX</a> as such:<pre style="color:#053c5e">@misc&#123;bugayenko2018blog0102,
  author = &#123;Bugayenko, Yegor&#125;,
  title = &#123;&#123;Operator new() is Toxic&#125;&#125;,
  howpublished = &#123;\url&#123;https://www.yegor256.com/180102.html&#125;&#125;,
  year = &#123;2018&#125;,
  month = &#123;jan&#125;,
  note = &#123;[Online; accessed 14-09-2025]&#125;
&#125;</pre></div><p>To instantiate objects, in most object-oriented languages, including Java, Ruby, and C++, we use operator <code class="language-plaintext highlighter-rouge">new()</code>. Well, unless we use static factory methods, which we don’t use because <a href="/2017/11/14/static-factory-methods.html">they are evil</a>. Even though it looks so easy to make a new object any time we need it, I would recommend to be more careful with this rather toxic operator.<figure class="jb_picture"><img itemprop="image"alt="The Gift (2015) by Joel Edgerton"src="/images/2018/01/the-gift.jpg"longdesc="#63533835"><figcaption id="63533835">The Gift (2015) by Joel Edgerton</figcaption></figure><p>I’m sure you understand that the problem with this operator is that it couples objects, making testing and reuse very difficult or even impossible. Let’s say there is a story in a file that we need to read as a UTF-8 text (I’m using <a href="http://static.javadoc.io/org.cactoos/cactoos/0.25.6/org/cactoos/text/TextOf.html"><code class="language-plaintext highlighter-rouge">TextOf</code></a> from <a href="https://www.cactoos.org">Cactoos</a>):<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">Story</span> <span class="o">{</span>
  <span class="nc">String</span> <span class="nf">text</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">TextOf</span><span class="o">(</span>
      <span class="k">new</span> <span class="nf">File</span><span class="o">(</span><span class="s">"/tmp/story.txt"</span><span class="o">)</span>
    <span class="o">).</span><span class="na">asString</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><p>It seems super simple, but the problem is obvious: class <code class="language-plaintext highlighter-rouge">Story</code> can’t be reused. It can only read one particular file. Moreover, testing it will be rather difficult, since it reads the content from exactly one place, which can’t be changed at all. More formally this problem is known as an <em>unbreakable dependency</em>—we can’t break the link between <code class="language-plaintext highlighter-rouge">Story</code> and <code class="language-plaintext highlighter-rouge">/tmp/story.txt</code>—they are together forever.<p>To solve this we need to introduce a constructor and let <code class="language-plaintext highlighter-rouge">Story</code> accept the location of the content as an argument:<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">Story</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="nc">File</span> <span class="n">file</span><span class="o">;</span>
  <span class="nc">Story</span><span class="o">(</span><span class="nc">File</span> <span class="n">f</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">file</span> <span class="o">=</span> <span class="n">f</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nc">String</span> <span class="nf">text</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">TextOf</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">file</span><span class="o">).</span><span class="na">asString</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><p>Now, each user of the <code class="language-plaintext highlighter-rouge">Story</code> has to know the name of the file:<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">new</span> <span class="nc">Story</span><span class="o">(</span><span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="s">"/tmp/story.txt"</span><span class="o">));</span>
</code></pre></div></div><p>It’s not really convenient, especially for those users who were using <code class="language-plaintext highlighter-rouge">Story</code> before, knowing nothing about the file path. To help them we introduce a <a href="/2015/05/28/one-primary-constructor.html">secondary constructor</a>:<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">Story</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="nc">File</span> <span class="n">file</span><span class="o">;</span>
  <span class="nc">Story</span><span class="o">()</span> <span class="o">{</span> <span class="c1">// Here!</span>
    <span class="k">this</span><span class="o">(</span><span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="s">"/tmp/story.txt"</span><span class="o">));</span>
  <span class="o">}</span>
  <span class="nc">Story</span><span class="o">(</span><span class="nc">File</span> <span class="n">f</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">file</span> <span class="o">=</span> <span class="n">f</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nc">String</span> <span class="nf">text</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">TextOf</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">file</span><span class="o">).</span><span class="na">asString</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><p>Now we just make an instance through a no-arguments constructor, just like we did before:<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">new</span> <span class="nc">Story</span><span class="o">();</span>
</code></pre></div></div><p>I’m sure you’re well aware of this technique, which is also known as <a href="https://martinfowler.com/articles/injection.html">dependency injection</a>. I’m actually not saying anything new. What I want you to pay attention to here is the location and the amount of <code class="language-plaintext highlighter-rouge">new</code> operators in all three code snippets.<p>In the first snippet both <code class="language-plaintext highlighter-rouge">new</code> operators are in the method <code class="language-plaintext highlighter-rouge">text()</code>. In the second snippet we lost one of them. In the third snippet one operator is in the method, while the second one moved up, to the constructor.<p>Remember this fact and let’s move on.<p>What if the file is not in UTF-8 encoding but in <a href="https://en.wikipedia.org/wiki/KOI8-R">KOI8-R</a>? Class <code class="language-plaintext highlighter-rouge">TextOf</code> and then method <code class="language-plaintext highlighter-rouge">Story.text()</code> will throw an exception. However, class <code class="language-plaintext highlighter-rouge">TextOf</code> is capable of reading in any encoding, it just needs to have a secondary argument for its constructor:<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">new</span> <span class="nc">TextOf</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">file</span><span class="o">,</span> <span class="s">"KOI8_R"</span><span class="o">).</span><span class="na">asString</span><span class="o">();</span>
</code></pre></div></div><p>In order to make <code class="language-plaintext highlighter-rouge">Story</code> capable of using different encodings, we need to introduce a few additional secondary constructors and modify its primary constructor:<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">Story</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="nc">Text</span> <span class="n">text</span><span class="o">;</span>
  <span class="nc">Story</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">(</span><span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="s">"/tmp/story.txt"</span><span class="o">));</span>
  <span class="o">}</span>
  <span class="nc">Story</span><span class="o">(</span><span class="nc">File</span> <span class="n">f</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">(</span><span class="n">f</span><span class="o">,</span> <span class="nc">StandardEncodings</span><span class="o">.</span><span class="na">UTF_8</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="nc">Story</span><span class="o">(</span><span class="nc">File</span> <span class="n">f</span><span class="o">,</span> <span class="nc">Encoding</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">(</span><span class="k">new</span> <span class="nc">TextOf</span><span class="o">(</span><span class="n">f</span><span class="o">,</span> <span class="n">e</span><span class="o">));</span>
  <span class="o">}</span>
  <span class="nc">Story</span><span class="o">(</span><span class="nc">Text</span> <span class="n">t</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">text</span> <span class="o">=</span> <span class="n">t</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nc">String</span> <span class="nf">text</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">text</span><span class="o">.</span><span class="na">asString</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><p>It’s just dependency injection, but pay attention to the locations of the operator <code class="language-plaintext highlighter-rouge">new</code>. They are all in the constructors now and none of them are left in the method <code class="language-plaintext highlighter-rouge">text()</code>.<p>The tendency here is obvious to me: the more the <code class="language-plaintext highlighter-rouge">new</code> operators stay in the methods, the less reusable and testable is the class.<p>In other words, operator <code class="language-plaintext highlighter-rouge">new</code> is a rather toxic thing, so try to keep its usage to a minimum in your methods. Make sure you instantiate everything or almost everything in your secondary constructors.</div></article></div><div class="disqus"role="complementary"aria-hidden="true"><p class="disqus_hint">Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.<div id="disqus_thread"class="disqus-thread"><a>&nbsp;</a></div><script>var disqus_config=function(){this.page.url=document.location.href.split("?")[0].split("#")[0],this.page.identifier=this.page.url};(()=>{var e=document,t=e.createElement("script");t.src="//yegor256.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)})()</script><noscript><div><p class="red">JavaScript is disabled in your browser, that's why you can't see comments under this post.</div></noscript></div><div class="wrapper"><footer class="footer"><p>&copy; <span itemscope=""itemprop="copyrightHolder"itemtype="http://schema.org/Person"><span itemprop="name">Yegor Bugayenko</span> </span>, 2014&ndash;<span itemprop="copyrightYear">2025</span></footer></div></section><div class="wrapper unprintable"style="text-align:center;margin-top:2em"><a href="https://www.sixnines.io/h/3ba1652f"><img src="https://www.sixnines.io/b/3ba1652f?style=flat"alt="sixnines availability badge"></a>&nbsp; <a href="https://github.com/yegor256/blog/stargazers"><img src="https://img.shields.io/github/stars/yegor256/blog.svg?style=flat-square"alt="GitHub stars"></a></div><script src="https://code.jquery.com/jquery-1.9.0.min.js"></script><script src="/js/all.js?6bac3c7"></script><script type="application/ld+json">{ "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "https://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] }</script>