<!DOCTYPE html> <html xmlns="https://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="It is a platform-independent object repository, which hosts source code and validates its consistency on each modification." /> <meta name="keywords" content="object repository, object-oriented programming, oop, oop repository, storage of objects" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2021-10-21 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Objectionary: Dictionary and Factory for EO Objects"/> <meta name="twitter:description" property="og:description" content="It is a platform-independent object repository, which hosts source code and validates its consistency on each modification."/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2021/10/21/objectionary.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?26bc61e719d"/> <link rel="apple-touch-icon" href="/favicon.ico?26bc61e719d"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?26bc61e719d"/> <link rel="stylesheet" href="/css/icons.css?26bc61e719d"/> <link rel="canonical" href="https://www.yegor256.com/2021/10/21/objectionary.html" /> <title>Objectionary: Dictionary and Factory for EO Objects</title> <meta name='og:image' content='https://www.yegor256.com/images/2021/10/maend-and-hons.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2021/10/maend-and-hons.jpg'/><meta name='og:image:width' content='1821'/> <meta name='twitter:image:width' content='1821'/><meta name='og:image:height' content='1214'/> <meta name='twitter:image:height' content='1214'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='M√¶nd &amp; h√∏ns (2015) by Anders Thomas Jensen'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My Stack Overflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/yegor256news" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;456</a></li> <li ><a href="/teaching.html" title="My courses and lectures">Teaching</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/research.html" title="My research directions and progress">Research</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="https://www.iccq.ru" title="International Conference on Code Quality">ICCQ</a></li> <li ><a href="https://www.kaicode.org" title="Open Source Festival">KaiCode</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Art</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2021/10/21/objectionary.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2021/10/21/objectionary.html</code></p><h1 itemprop="name headline mainEntityOfPage">Objectionary: Dictionary and Factory for EO Objects</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2021-10-21T00:00:00+00:00"> 21 October 2021 </time> </li> <li class="desktop-only" itemprop="locationCreated">Moscow, Russia</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="https://www.yegor256.com/2021/10/21/objectionary.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><ul class="subline"> <li title="The page is translated by ChatGPT from English to a few languages"> Translated by <i class="icon icon-chatgpt notranslate" aria-hidden="true"></i> to </li> <li title="Click to see this page translated to Chinese"> <a href='https://www.yegor256.com/zh/2021/10/21/objectionary.html'>‰∏≠Êñá</a> </li> <li title="Click to see this page translated to Russian"> <a href='https://www.yegor256.com/ru/2021/10/21/objectionary.html'>—Ä—É—Å—Å–∫–∏–π</a> </li></ul><p class="unprintable"><a href='/tag/oop.html' class='tag notranslate'><img src='/images/icons/cactus.svg' alt='OOP'/>oop</a></p><nav class="buttons notranslate desktop-only"> <a href="https://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2021/10/21/objectionary.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2021/10/21/objectionary.html&amp;text=Objectionary%3A+Dictionary+and+Factory+for+EO+Objects" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2021/10/21/objectionary.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="https://reddit.com/submit?url=https://www.yegor256.com/2021/10/21/objectionary.html%3F2021-42&amp;title=Objectionary%3A+Dictionary+and+Factory+for+EO+Objects" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="https://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2021/10/21/objectionary.html%3F2021-42&amp;t=Objectionary%3A+Dictionary+and+Factory+for+EO+Objects" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> <a href="#" title="Cite it via BibTeX" class="button" onclick="$('#bibtex').toggle(); return false;"> <i class="icon icon-tex notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><div id="bibtex" style="display: none"><p>Please, cite this blog post via <a href="https://www.bibtex.org/">BibTeX</a> as such:</p><pre style="color:#053c5e;">@misc&#123;bugayenko2021blog1021,
  author = &#123;Bugayenko, Yegor&#125;,
  title = &#123;&#123;Objectionary: Dictionary and Factory for EO Objects&#125;&#125;,
  howpublished = &#123;\url&#123;https://www.yegor256.com/211021.html&#125;&#125;,
  year = &#123;2021&#125;,
  month = &#123;oct&#125;,
  note = &#123;[Online; accessed 03-05-2024]&#125;
&#125;</pre></div><figure class="badge"><a href="https://www.eolang.org"><img src="/images/books/elegant-objects/cactus.svg" style="width:128px;max-width:100%;" alt="badge" /></a></figure><p>Since the time of Kernighan and Ritchie we share binary code in libraries. You need to print some text with <a href="https://en.wikipedia.org/wiki/Printf_format_string"><code class="language-plaintext highlighter-rouge">printf()</code></a> in C++? You get <a href="https://en.wikipedia.org/wiki/Glibc">libc</a> library with <a href="https://stackoverflow.com/a/33188344/187141">700+</a> other functions inside. You need to copy a Java stream? You get <a href="https://commons.apache.org/proper/commons-io/">Apache Commons IO</a> with <a href="https://commons.apache.org/proper/commons-io/apidocs/org/apache/commons/io/IOUtils.html#copy-java.io.InputStream-java.io.OutputStream-"><code class="language-plaintext highlighter-rouge">copy()</code></a> and <a href="https://commons.apache.org/proper/commons-io/apidocs/index.html">140+</a> other methods and classes. The same happens in all languages I‚Äôm aware of, like Ruby, Python, JavaScript, PHP: you need an object, or a class, or a function, or a method‚Äîyou have to add the entire library to your build. Wouldn‚Äôt it be more elegant to deal with individual objects instead?</p><figure class="jb_picture"><img itemprop="image" alt="M√¶nd &amp; h√∏ns (2015) by Anders Thomas Jensen" src="/images/2021/10/maend-and-hons.jpg" longdesc="#5f493073" /><figcaption id="5f493073">M√¶nd &amp; h√∏ns (2015) by Anders Thomas Jensen</figcaption></figure><p>The idea is not new and not mine. I got it from the book <a href="https://amzn.to/266oJr4">Object Thinking</a> by David West, where he suggested creating an <em>Objectionary</em> (page 306), a ‚Äúcombination of dictionary and object factory,‚Äù with the following properties:</p><ul> <li>The total number of objects is less than 2000;</li> <li>Each object is an autonomous executable entity;</li> <li>Every object has a unique ID and a unique ‚Äúaddress‚Äù;</li> <li>Objects are nothing more than collections of objects;</li> <li>Objects require hardware-specific VMs for execution.</li></ul><figure class="badge"><a href="https://amzn.to/266oJr4"><img src="/images/2015/04/book-object-thinking.jpg" style="width:96px;max-width:100%;" alt="badge" /></a></figure><p>Seventeen years later (the book was published in 2004), we implemented the idea on top of <a href="https://www.eolang.org">EO</a>, our new programming language. The language is intentionally much simpler than Java or C++. You can read its more or less formal description <a href="https://arxiv.org/abs/2111.13384">here</a>.</p><p>To turn an EO program into an executable entity and release it to the <a href="https://www.objectionary.com">Objectionary</a>, one has to go through the following mandatory steps, assuming the JVM is used as a target platform (the steps marked with üåµ are implemented by our <a href="https://github.com/cqfn/eo">eo-maven-plugin</a>):</p><ul> <li><strong>Assemble</strong>üåµ:<ul> <li><strong>Parse</strong>üåµ: <code class="language-plaintext highlighter-rouge">.eo</code> ‚ûú <code class="language-plaintext highlighter-rouge">.xmir</code></li> <li><strong>Optimize</strong>üåµ: <code class="language-plaintext highlighter-rouge">.xmir</code> ‚ûú better <code class="language-plaintext highlighter-rouge">.xmir</code></li> <li><strong>Discover</strong>üåµ: find all foreign aliases</li> <li><strong>Pull</strong>üåµ: <a href="https://github.com/yegor256/objectionary">download</a> foreign <code class="language-plaintext highlighter-rouge">.eo</code> objects</li> <li><strong>Resolve</strong>üåµ: <a href="https://search.maven.org/">download</a> and unpack <code class="language-plaintext highlighter-rouge">.jar</code> artifacts</li> <li><strong>Place</strong>üåµ: move artifact <code class="language-plaintext highlighter-rouge">.class</code> files to <code class="language-plaintext highlighter-rouge">target/classes/</code></li> <li><strong>Mark</strong>üåµ: mark <code class="language-plaintext highlighter-rouge">.eo</code> sources found in <code class="language-plaintext highlighter-rouge">.jar</code> as foreign</li> <li>‚Üë Go back to <strong>Parse</strong> if some <code class="language-plaintext highlighter-rouge">.eo</code> files are still not parsed</li></ul></li> <li><strong>Transpile</strong>üåµ: <code class="language-plaintext highlighter-rouge">.xmir</code> ‚ûú <code class="language-plaintext highlighter-rouge">.java</code></li> <li><strong>Assemble</strong>üåµ: same as above, but for tests</li> <li><strong>Compile</strong>: <code class="language-plaintext highlighter-rouge">.java</code> ‚ûú <code class="language-plaintext highlighter-rouge">.class</code></li> <li><strong>Test</strong>: run all unit tests</li> <li><strong>Unplace</strong>üåµ: remove artifact <code class="language-plaintext highlighter-rouge">.class</code> files</li> <li><strong>Unspile</strong>üåµ: remove auto-generated <code class="language-plaintext highlighter-rouge">.java</code> files</li> <li><strong>Copy</strong>üåµ: copy <code class="language-plaintext highlighter-rouge">.eo</code> files to <code class="language-plaintext highlighter-rouge">EO-SOURCES/</code> inside <code class="language-plaintext highlighter-rouge">.jar</code></li> <li><strong>Deploy</strong>: package <code class="language-plaintext highlighter-rouge">.jar</code> artifact and put it into Maven Central</li> <li><strong>Push</strong>: send a pull request to <a href="https://github.com/yegor256/objectionary">yegor256/objectionary</a></li> <li><strong>Merge</strong>: we test and merge the pull request</li></ul><p>It is an iterative process, which loops over and over again until all required <code class="language-plaintext highlighter-rouge">.eo</code> objects are parsed and their atoms are present as <code class="language-plaintext highlighter-rouge">.class</code> files. Then, all <code class="language-plaintext highlighter-rouge">.xmir</code> files are transpiled to <code class="language-plaintext highlighter-rouge">.java</code> and then compiled to <code class="language-plaintext highlighter-rouge">.class</code> binaries. Then, tested, packaged, and deployed to Maven Central. Then, merged to the <code class="language-plaintext highlighter-rouge">master</code> branch of <a href="https://www.objectionary.com">Objectionary</a>, via a pull request.</p><p>The first part of the algorithm can be automated with <a href="https://github.com/cqfn/eo">our Maven plugin</a>, simply by placing <code class="language-plaintext highlighter-rouge">.eo</code> sources in <code class="language-plaintext highlighter-rouge">src/main/eo/</code> and adding this to <code class="language-plaintext highlighter-rouge">pom.xml</code>:</p><div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;project&gt;</span>
  <span class="nt">&lt;build&gt;</span>
    <span class="nt">&lt;plugins&gt;</span>
      <span class="nt">&lt;plugin&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.eolang<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>eo-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span><span class="c">&lt;!-- Take it from Maven Central --&gt;</span><span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;executions&gt;</span>
          <span class="nt">&lt;execution&gt;</span>
            <span class="nt">&lt;goals&gt;</span>
              <span class="nt">&lt;goal&gt;</span>register<span class="nt">&lt;/goal&gt;</span>
              <span class="nt">&lt;goal&gt;</span>assemble<span class="nt">&lt;/goal&gt;</span>
              <span class="nt">&lt;goal&gt;</span>transpile<span class="nt">&lt;/goal&gt;</span>
              <span class="nt">&lt;goal&gt;</span>copy<span class="nt">&lt;/goal&gt;</span>
              <span class="nt">&lt;goal&gt;</span>unplace<span class="nt">&lt;/goal&gt;</span>
              <span class="nt">&lt;goal&gt;</span>unspile<span class="nt">&lt;/goal&gt;</span>
            <span class="nt">&lt;/goals&gt;</span>
          <span class="nt">&lt;/execution&gt;</span>
        <span class="nt">&lt;/executions&gt;</span>
      <span class="nt">&lt;/plugin&gt;</span>
    <span class="nt">&lt;/plugins&gt;</span>
    [...]
  <span class="nt">&lt;/build&gt;</span>
  [...]
<span class="nt">&lt;/project&gt;</span>
</code></pre></div></div><p>The <code class="language-plaintext highlighter-rouge">register</code> goal will scan the <code class="language-plaintext highlighter-rouge">src/main/eo/</code> directory, find all <code class="language-plaintext highlighter-rouge">.eo</code> sources, and ‚Äúregister‚Äù them in a special CSV catalog at <code class="language-plaintext highlighter-rouge">target/eo-foreigns.csv</code>. Next, the <code class="language-plaintext highlighter-rouge">assemble</code> goal will call the following goals: <code class="language-plaintext highlighter-rouge">parse</code>, <code class="language-plaintext highlighter-rouge">optimize</code>, <code class="language-plaintext highlighter-rouge">discover</code>, <code class="language-plaintext highlighter-rouge">pull</code>, and <code class="language-plaintext highlighter-rouge">resolve</code>. All these goals use the CSV catalog when they parse, optimize, pull and so on.</p><p>When all of them are done, <code class="language-plaintext highlighter-rouge">assemble</code> checks the catalog: do any <code class="language-plaintext highlighter-rouge">.eo</code> files still require parsing? If they do, another cycle starts, again with parsing. When all <code class="language-plaintext highlighter-rouge">.eo</code> files are parsed, the goal <code class="language-plaintext highlighter-rouge">transpile</code> is executed, which turns <code class="language-plaintext highlighter-rouge">.xmir</code> files into <code class="language-plaintext highlighter-rouge">.java</code> and places them into <code class="language-plaintext highlighter-rouge">target/generated-sources</code>. The rest is done by the standard <a href="https://maven.apache.org/plugins/maven-compiler-plugin/"><code class="language-plaintext highlighter-rouge">maven-compiler-plugin</code></a>.</p><p>Let‚Äôs discuss each step in detail.</p><h2 id="parse-">Parse üåµ</h2><p>Say, this is the <code class="language-plaintext highlighter-rouge">.eo</code> source code at <code class="language-plaintext highlighter-rouge">src/main/eo/hello.eo</code>:</p><div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>+alias org.eolang.io.stdout
[] &gt; hello
  "Jeff" &gt; user
  stdout &gt; @
    "Hello, %s!"
    user
</code></pre></div></div><p>It will be parsed to this XMIR (XML Intermediate Representation):</p><div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;program&gt;</span>
  <span class="nt">&lt;o</span> <span class="na">name=</span><span class="s">"hello"</span> <span class="na">line=</span><span class="s">"1"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;o</span> <span class="na">name=</span><span class="s">"user"</span> <span class="na">data=</span><span class="s">"string"</span> <span class="na">line=</span><span class="s">"2"</span><span class="nt">&gt;</span>Jeff<span class="nt">&lt;/o&gt;</span>
    <span class="nt">&lt;o</span> <span class="na">name=</span><span class="s">"@"</span> <span class="na">base=</span><span class="s">"stdout"</span> <span class="na">line=</span><span class="s">"3"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;o</span> <span class="na">data=</span><span class="s">"string"</span> <span class="na">line=</span><span class="s">"4"</span><span class="nt">&gt;</span>Hello, %s!<span class="nt">&lt;/o&gt;</span>
      <span class="nt">&lt;o</span> <span class="na">base=</span><span class="s">"user"</span> <span class="na">line=</span><span class="s">"5"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/o&gt;</span>
  <span class="nt">&lt;/o&gt;</span>
<span class="nt">&lt;/program&gt;</span>
</code></pre></div></div><p>If you wonder what this XML means, read <a href="https://arxiv.org/abs/2111.13384">this document</a>: there is a section about XMIR.</p><h2 id="optimize-">Optimize üåµ</h2><p>At this step the XMIR produced by the parser goes through many XSL transformations, sometimes getting additional elements and attributes. Our example XMIR may get a new attribute <code class="language-plaintext highlighter-rouge">@ref</code>, pointing the reference to the object <code class="language-plaintext highlighter-rouge">user</code> to the line where the object was defined:</p><div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;program&gt;</span>
  <span class="nt">&lt;o</span> <span class="na">name=</span><span class="s">"hello"</span> <span class="na">line=</span><span class="s">"1"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;o</span> <span class="na">name=</span><span class="s">"user"</span> <span class="na">data=</span><span class="s">"string"</span> <span class="na">line=</span><span class="s">"2"</span><span class="nt">&gt;</span>Jeff<span class="nt">&lt;/o&gt;</span>
    <span class="nt">&lt;o</span> <span class="na">name=</span><span class="s">"@"</span> <span class="na">base=</span><span class="s">"stdout"</span> <span class="na">line=</span><span class="s">"3"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;o</span> <span class="na">data=</span><span class="s">"string"</span> <span class="na">line=</span><span class="s">"4"</span><span class="nt">&gt;</span>Hello, %s!<span class="nt">&lt;/o&gt;</span>
      <span class="nt">&lt;o</span> <span class="na">base=</span><span class="s">"user"</span> <span class="na">line=</span><span class="s">"5"</span> <span class="na">ref=</span><span class="s">"2"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/o&gt;</span>
  <span class="nt">&lt;/o&gt;</span>
<span class="nt">&lt;/program&gt;</span>
</code></pre></div></div><p>Some XSL transformation may check for grammar or semantic errors and add a new element <code class="language-plaintext highlighter-rouge">&lt;errors/&gt;</code> if something wrong is found. Thus, if parsing didn‚Äôt find any syntax errors, all other errors will be visible inside the XMIR document, for example, like this:</p><div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;program&gt;</span>
  <span class="nt">&lt;errors&gt;</span>
    <span class="nt">&lt;error</span> <span class="na">line=</span><span class="err">&gt;</span><span class="s">The</span> <span class="err">program</span> <span class="err">has</span> <span class="err">no</span> <span class="err">package&lt;/error</span><span class="nt">&gt;</span>
  <span class="nt">&lt;/errors&gt;</span>
  <span class="nt">&lt;o</span> <span class="na">name=</span><span class="s">"hello"</span> <span class="na">line=</span><span class="s">"1"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;o</span> <span class="na">name=</span><span class="s">"user"</span> <span class="na">data=</span><span class="s">"string"</span> <span class="na">line=</span><span class="s">"2"</span><span class="nt">&gt;</span>Jeff<span class="nt">&lt;/o&gt;</span>
    <span class="nt">&lt;o</span> <span class="na">name=</span><span class="s">"@"</span> <span class="na">base=</span><span class="s">"stdout"</span> <span class="na">line=</span><span class="s">"3"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;o</span> <span class="na">data=</span><span class="s">"string"</span> <span class="na">line=</span><span class="s">"4"</span><span class="nt">&gt;</span>Hello, %s!<span class="nt">&lt;/o&gt;</span>
      <span class="nt">&lt;o</span> <span class="na">base=</span><span class="s">"user"</span> <span class="na">line=</span><span class="s">"5"</span> <span class="na">ref=</span><span class="s">"2"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/o&gt;</span>
  <span class="nt">&lt;/o&gt;</span>
<span class="nt">&lt;/program&gt;</span>
</code></pre></div></div><p>By the way, this is not a real error, I just made it up.</p><h2 id="discover-">Discover üåµ</h2><p>At this step we find out which objects are ‚Äúforeign‚Äù. In our example, the object <code class="language-plaintext highlighter-rouge">user</code> is not foreign, since it‚Äôs defined in the code we have in front of us, while the object <code class="language-plaintext highlighter-rouge">stdout</code> is not defined here and that‚Äôs why is a foreign one.</p><p>Going through all <code class="language-plaintext highlighter-rouge">.xmir</code> files we can easily judge which object is foreign just by looking at their names. Once we see the reference to <code class="language-plaintext highlighter-rouge">org.eolang.io.stdout</code>, we check the presence of the file <code class="language-plaintext highlighter-rouge">org/eolang/io/stdout.eo</code> in the directory with all <code class="language-plaintext highlighter-rouge">.eo</code> sources. If the file is absent, we put the object name into the CSV catalog and claim it to be foreign.</p><h2 id="pull">Pull</h2><p>Here we simply try to find source code <code class="language-plaintext highlighter-rouge">.eo</code> files for all foreign objects in Objectionary, by looking at its <a href="https://github.com/yegor256/objectionary">GitHub repository</a>. For example, this is where we would find <a href="https://github.com/yegor256/objectionary/blob/master/objects/org/eolang/io/stdout.eo"><code class="language-plaintext highlighter-rouge">stdout.eo</code></a>. We find them there and pull to the local disc.</p><p>Pay attention, we pull the sources. Not binaries or compiled XMIR documents, but the sources in <code class="language-plaintext highlighter-rouge">.eo</code> format.</p><h2 id="resolve-">Resolve üåµ</h2><p>This is what <a href="https://github.com/yegor256/objectionary/blob/master/objects/org/eolang/io/stdout.eo"><code class="language-plaintext highlighter-rouge">stdout.eo</code></a> may look like, after the pull:</p><div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>+package org.eolang.io
+rt jvm org.eolang:eo-runtime:0.10.2
[text] &gt; stdout /bool
</code></pre></div></div><p>The object is an <em>atom</em>. This means that even though we have its source code, it‚Äôs not complete without a piece of platform-specific binary code. An atom is an object implemented by the runtime platform, where the EO program is executed (also known as <a href="https://en.wikipedia.org/wiki/Foreign_function_interface">FFI mechanism</a>). The line that starts with <code class="language-plaintext highlighter-rouge">+rt</code> (runtime) explains where to get the runtime code. The <code class="language-plaintext highlighter-rouge">jvm</code> part is the name of the runtime.</p><p>We go to <a href="https://search.maven.org/">Maven Central</a>, find there the artifact <a href="https://search.maven.org/artifact/org.eolang/eo-runtime"><code class="language-plaintext highlighter-rouge">org.eolang:eo-runtime:0.10.2</code></a>, and unpack it (it‚Äôs a zip archive with <code class="language-plaintext highlighter-rouge">.class</code> files after all).</p><p>By the way, a program may contain a number of <code class="language-plaintext highlighter-rouge">+rt</code> meta instructions, for example:</p><div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>+package org.eolang.io
+rt jvm org.eolang:eo-runtime:0.10.2
+rt ruby eo-core:0.5.8
+rt python eo-basics:0.0.3
[text] &gt; stdout /bool
</code></pre></div></div><p>Here, three runtime platforms will know where to get the missing code for the <code class="language-plaintext highlighter-rouge">stdout</code> atom: EO‚ûùJava will go to <a href="https://search.maven.org/">Maven Central</a> for the JAR artifact, EO‚ûùRuby will go to <a href="https://rubygems.org/">RubyGems</a> trying to find the gem by the name <code class="language-plaintext highlighter-rouge">eo-core</code> and version <code class="language-plaintext highlighter-rouge">0.5.8</code>, while EO‚ûùPython will go to <a href="https://pypi.org/">PyPi</a> trying to find <code class="language-plaintext highlighter-rouge">eo-basics</code> package with the version <code class="language-plaintext highlighter-rouge">0.0.3</code>.</p><h2 id="place-">Place üåµ</h2><p>Next we place all <code class="language-plaintext highlighter-rouge">.class</code> files found in the unpacked JAR, into the <code class="language-plaintext highlighter-rouge">target/classes</code> directory. We do this in order to help Maven Compiler Plugin find them in classpath.</p><h2 id="mark-">Mark üåµ</h2><p>In each JAR file that arrives we can find <code class="language-plaintext highlighter-rouge">.eo</code> sources. They are the programs this JAR file has had in classpath while it was built. We consider them as foreign objects too and add to the CSV catalog.</p><h2 id="transpile-">Transpile üåµ</h2><p>When all foreign objects which are registered in the catalog are downloaded, compiled, and optimized, we are ready to start <a href="https://en.wikipedia.org/wiki/Source-to-source_compiler"><em>transpiling</em></a>. Instead of compiling XMIR directly to Bytecode, we transpile it to <code class="language-plaintext highlighter-rouge">.java</code> and let Java compiler do the job of generating Bytecode.</p><p>We believe that there are a few benefits of transpiling to Java vs. compilation to Bytecode:</p><ul> <li>Output code is easier to read and debug,</li> <li>Optimization power of existing compilers is reused,</li> <li>Complexity of a transpiler is lower than of a compiler,</li> <li>Portability of the output code is higher.</li></ul><p>We already have two EO‚ûùJava transpilers: <a href="https://github.com/cqfn/eo">canonical one</a> and <a href="https://github.com/polystat/hse-transpiler">the one</a> made by <a href="https://www.hse.ru/en/">HSE University</a>. We also have EO‚ûùPython experimental <a href="https://github.com/polystat/eo2py">transpiler</a> made by students of <a href="https://innopolis.university/en/">Innopolis University</a>. Most probably, when you read this article, there will be more transpilers available.</p><p>Even though we believe in transpiling, it‚Äôs still possible to create EO‚ûùBytecode, EO‚ûùLLVM, or EO‚ûùx86 compilers. You are more than welcome to try!</p><h2 id="compile">Compile</h2><p>At this step, the standard <a href="https://maven.apache.org/plugins/maven-compiler-plugin/">Maven Compiler Plugin</a> finds auto-generated <code class="language-plaintext highlighter-rouge">.java</code> files in <code class="language-plaintext highlighter-rouge">target/generated-sources</code> and turns them into <code class="language-plaintext highlighter-rouge">.class</code> files.</p><h2 id="unplace-">Unplace üåµ</h2><p>Here, we remove all <code class="language-plaintext highlighter-rouge">.class</code> files unpacked from dependencies. This is necessary, in order to avoid getting them packaged into the final JAR.</p><p>We do placing and then unplacing simply because Maven Compiler Plugin <a href="https://stackoverflow.com/questions/3410548">doesn‚Äôt allow</a> us to extend classpath in runtime. If it would be possible, we would just download dependencies from Maven Central and add them to classpath, without unpacking, placing, and then unplacing.</p><h2 id="unspile-">Unspile üåµ</h2><p>Here, we delete all <code class="language-plaintext highlighter-rouge">.class</code> files from the <code class="language-plaintext highlighter-rouge">target/classes/</code> directory, which were auto-generated from <code class="language-plaintext highlighter-rouge">.eo</code>. We don‚Äôt want to ship binaries, which can be generated from <code class="language-plaintext highlighter-rouge">.eo</code> sources. We only want to ship atoms, which are <code class="language-plaintext highlighter-rouge">.java</code> files originally.</p><h2 id="copy-">Copy üåµ</h2><p>At this step we take all <code class="language-plaintext highlighter-rouge">.eo</code> sources from <code class="language-plaintext highlighter-rouge">src/main/eo/</code> and copy them to <code class="language-plaintext highlighter-rouge">target/classes/EO-SOURCES/</code> directory. Later, they will be packaged together with <code class="language-plaintext highlighter-rouge">.class</code> files into a <code class="language-plaintext highlighter-rouge">.jar</code>, which will be deployed to Maven Central. While copying, we replace <code class="language-plaintext highlighter-rouge">0.0.0</code> in the runtime version to the currently deploying version. Take a look at the file <a href="https://github.com/cqfn/eo/blob/master/eo-runtime/src/main/eo/org/eolang/io/stdout.eo"><code class="language-plaintext highlighter-rouge">stdout.eo</code></a>, in its source repository:</p><div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>+package org.eolang.io
+rt jvm org.eolang:eo-runtime:0.0.0
[text] &gt; stdout /bool
</code></pre></div></div><p>The version at the <code class="language-plaintext highlighter-rouge">+rt</code> line is <code class="language-plaintext highlighter-rouge">0.0.0</code>. When sources are copied to the JAR, this text is replaced.</p><p>The motivation to ship sources together with binaries is the following. When atom binaries are compiled from Java to Bytecode, they stay next to transpiled sources. They are compiled together. Moreover, unit tests also rely on both atom sources and auto-generated/transpiled sources. We want future users of the JAR to know what sources we had in place when the compilation was going on, to maybe let them reproduce it or at least know what were the surroundings of the binaries they get.</p><p>From a more practical standpoint, we need these sources in the JAR in order to let the <strong>Mark</strong> step understand what objects are worth pulling next to the atoms resolved.</p><h2 id="deploy">Deploy</h2><p>Here, we package everything from <code class="language-plaintext highlighter-rouge">target/classes/</code> into a JAR archive and <a href="/2014/08/19/how-to-release-to-maven-central.html">deploy</a> it to Maven Central.</p><p>I suggest deploying sources to GitHub Pages too, to let users see them on the Web. Also, it will be helpful later when we make a pull request to Objectionary. Check this <a href="https://github.com/yegor256/eo-files/blob/master/.rultor.yml#L17-L31"><code class="language-plaintext highlighter-rouge">.rultor.yml</code></a> script in one of my EO libraries, it deploys <code class="language-plaintext highlighter-rouge">.eo</code> sources to GitHub Pages, substituting <code class="language-plaintext highlighter-rouge">0.0.0</code> version markers in them correctly.</p><h2 id="push">Push</h2><p>When the deployment is finished and Maven Central updates its CDN servers, it‚Äôs time to submit a pull request to <a href="https://github.com/yegor256/objectionary">yegor256/objectionary</a>. The <code class="language-plaintext highlighter-rouge">.eo</code> sources of objects go into <code class="language-plaintext highlighter-rouge">objects/</code> and their unit tests go into <code class="language-plaintext highlighter-rouge">tests/</code>. Basically, we just copy <code class="language-plaintext highlighter-rouge">src/main/eo/</code> and <code class="language-plaintext highlighter-rouge">src/test/eo</code> over there. But, stop‚Ä¶ one important detail. In the sources, as was said earlier, we have <code class="language-plaintext highlighter-rouge">+rt</code> versions set to <code class="language-plaintext highlighter-rouge">0.0.0</code>. Here, when we copy to Objectionary, versions must be set to real numbers.</p><h2 id="merge">Merge</h2><p>When the pull request arrives, a GitHub Action pre-configured in the <a href="https://github.com/yegor256/objectionary">yegor256/objectionary</a> repository transpiles all <code class="language-plaintext highlighter-rouge">.eo</code> sources to all known platforms and runs all unit tests. If everything is clean, we review the pull request and decide whether the objects suggested go along with others already present in the Objectionary.</p><p>Once the pull request is merged, the objects become part of the centralized dictionary of all objects of EO. Take a look at <a href="https://github.com/yegor256/objectionary/pull/2">this pull request</a>, where a new object was submitted to Objectionary, after its atom was deployed to Maven Central.</p></div></article></div><script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script><div class="disqus" role="complementary" aria-hidden="true"><p class="disqus_hint" > Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0]; this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span>, 2014&ndash;<span itemprop="copyrightYear">2024</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="https://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge" /></a> &nbsp; <a href="https://github.com/yegor256/blog/stargazers"> <img src="//img.shields.io/github/stars/yegor256/blog.svg?style=flat-square" alt="GitHub stars" /></a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?26bc61e719d"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "https://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html>
