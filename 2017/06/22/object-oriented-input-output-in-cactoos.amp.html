<!doctypehtml><html amp lang="en"><meta charset="utf-8"><title>Object-Oriented Declarative Input/Output in Cactoos</title><link rel="canonical"href="https://www.yegor256.com/2017/06/22/object-oriented-input-output-in-cactoos.html"><link rel="icon"type="image/png"href="/favicon.ico"><meta name="viewport"content="width=device-width,minimum-scale=1,initial-scale=1"><script type="application/ld+json">{
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "mainEntityOfPage":{
          "@type": "WebPage",
          "@id": "https://www.yegor256.com/2017/06/22/object-oriented-input-output-in-cactoos.html"
        },
        "headline": "Object-Oriented Declarative Input/Output in Cactoos",
        "image": {
          "@type": "ImageObject",
          "url": "https://www.yegor256.com/images/face-1024x1024.jpg",
          "height": 1400,
          "width": 1400
        },
        "datePublished": "2017-06-22",
        "dateModified": "2017-06-22",
        "author": {
          "@type": "Person",
          "name": "Yegor Bugayenko"
        },
        "publisher": {
          "@type": "Organization",
          "name": "yegor256.com",
          "logo": {
            "@type": "ImageObject",
            "url": "https://www.yegor256.com/images/face-512x512.jpg",
            "width": 512,
            "height": 512
          }
        },
        "description": "Instead of calling static procedures we may want
to use objects, the way they are supposed to be used;
that's why Cactoos.
",
        "keywords": ["IO java", "read/write java", "object-oriented input/output", "cactoos", "input/output cactoos"]
      }</script><style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript><link rel="stylesheet"href="https://fonts.googleapis.com/css?family=Source+Code+Pro:400,500"><style amp-custom="amp-custom">@font-face{font-family:Cambria;src:url(https://www.yegor256.com/fonts/cambria/2EAA54_2_0.ttf)}body{font-family:Cambria,'Times New Roman',serif;padding:.5em;font-size:1.2em}article{width:600px;max-width:100%;margin-left:auto;margin-right:auto}code,pre{font-family:'Source Code Pro','Courier New',monospace;font-size:.8em}code{padding:0 .3em;background-color:#d3d3d3}a,a:hover,a:visited{color:inherit}.intro{color:red;font-size:.75em}.photo{border-radius:50%}pre{overflow-x:scroll}</style><script async src="https://cdn.ampproject.org/v0.js"></script><article><p class="intro">This is a mobile version, full one is <a href="https://www.yegor256.com/2017/06/22/object-oriented-input-output-in-cactoos.html">here</a>.<p><amp-img src="/images/face-256x256.jpg"width="80"height="80"alt="Yegor Bugayenko"class="photo"></amp-img><p>Yegor Bugayenko<br>22 June 2017<h1>Object-Oriented Declarative Input/Output in Cactoos</h1><p><a href="https://www.cactoos.org">Cactoos</a> is a library of object-oriented Java primitives <a href="https://github.com/yegor256/cactoos#contributors">we</a> started to work on just a few weeks ago. The intent was to propose a clean and more declarative alternative to <a href="https://en.wikipedia.org/wiki/Java_Development_Kit">JDK</a>, <a href="https://github.com/google/guava">Guava</a>, <a href="https://commons.apache.org/">Apache Commons</a>, and others. Instead of calling static <a href="/2014/05/05/oop-alternative-to-utility-classes.html">procedures</a> we want to use <a href="/2016/07/14/who-is-object.html">objects</a>, the way they are supposed to be used. Let’s see how input/output works in a <em>pure</em> <a href="/2016/08/15/what-is-wrong-object-oriented-programming.html">object-oriented</a> fashion.<p><strong>Disclaimer</strong>: The version I’m using at the time of writing is <a href="https://github.com/yegor256/cactoos/releases/tag/0.9">0.9</a>. Later versions may have different names of classes and a totally different design.<p>Let’s say you want to read a file. This is how you would do it with the static method <a href="https://docs.oracle.com/javase/7/docs/api/java/nio/file/Files.html#readAllBytes%28java.nio.file.Path%29"><code class="language-plaintext highlighter-rouge">readAllBytes()</code></a> from the <a href="/2014/05/05/oop-alternative-to-utility-classes.html">utility class</a> <a href="https://docs.oracle.com/javase/7/docs/api/java/nio/file/Files.html"><code class="language-plaintext highlighter-rouge">Files</code></a> in JDK7:<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">byte</span><span class="o">[]</span> <span class="n">content</span> <span class="o">=</span> <span class="nc">Files</span><span class="o">.</span><span class="na">readAllBytes</span><span class="o">(</span>
  <span class="k">new</span> <span class="nf">File</span><span class="o">(</span><span class="s">"/tmp/photo.jpg"</span><span class="o">).</span><span class="na">toPath</span><span class="o">()</span>
<span class="o">);</span>
</code></pre></div></div><p>This code is very imperative—it reads the file content right here and now, placing it into the array.<p>This is how you do it with <a href="https://github.com/yegor256/cactoos">Cactoos</a>:<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Bytes</span> <span class="n">source</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">InputAsBytes</span><span class="o">(</span>
  <span class="k">new</span> <span class="nf">FileAsInput</span><span class="o">(</span>
    <span class="k">new</span> <span class="nf">File</span><span class="o">(</span><span class="s">"/tmp/photo.jpg"</span><span class="o">)</span>
  <span class="o">)</span>
<span class="o">);</span>
</code></pre></div></div><p>Pay attention—there are no method calls yet. Just three constructors of three classes that compose a bigger object. The object <code class="language-plaintext highlighter-rouge">source</code> is of type <a href="http://static.javadoc.io/org.cactoos/cactoos/0.9/org/cactoos/Bytes.html"><code class="language-plaintext highlighter-rouge">Bytes</code></a> and represents the content of the file. To get that content out of it we call its method <code class="language-plaintext highlighter-rouge">asBytes()</code>:<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">bytes</span><span class="o">[]</span> <span class="n">content</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="na">asBytes</span><span class="o">();</span>
</code></pre></div></div><p>This is the moment when the file system is touched. This approach, as you can see, is absolutely declarative and thanks to that possesses all the benefits of object orientation.<p>Here is another example. Say you want to write some text into a file. Here is how you do it in Cactoos. First you need the <a href="http://static.javadoc.io/org.cactoos/cactoos/0.9/org/cactoos/Input.html"><code class="language-plaintext highlighter-rouge">Input</code></a>:<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Input</span> <span class="n">input</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BytesAsInput</span><span class="o">(</span>
  <span class="k">new</span> <span class="nf">TextAsBytes</span><span class="o">(</span>
    <span class="k">new</span> <span class="nf">StringAsText</span><span class="o">(</span>
      <span class="s">"Hello, world!"</span>
    <span class="o">)</span>
  <span class="o">)</span>
<span class="o">);</span>
</code></pre></div></div><p>Then you need the <a href="http://static.javadoc.io/org.cactoos/cactoos/0.9/org/cactoos/Output.html"><code class="language-plaintext highlighter-rouge">Output</code></a>:<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Output</span> <span class="n">output</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">FileAsOutput</span><span class="o">(</span>
  <span class="k">new</span> <span class="nf">File</span><span class="o">(</span><span class="s">"/tmp/hello.txt"</span><span class="o">)</span>
<span class="o">);</span>
</code></pre></div></div><p>Now, we want to copy the input to the output. There is no “copy” operation in <em>pure</em> OOP. Moreover, there must be no operations at all. Just objects. We have a class named <a href="http://static.javadoc.io/org.cactoos/cactoos/0.9/org/cactoos/io/TeeInput.html"><code class="language-plaintext highlighter-rouge">TeeInput</code></a>, which is an <code class="language-plaintext highlighter-rouge">Input</code> that copies everything you read from it to the <a href="http://static.javadoc.io/org.cactoos/cactoos/0.9/org/cactoos/Output.html"><code class="language-plaintext highlighter-rouge">Output</code></a>, similar to what <a href="https://commons.apache.org/proper/commons-io/javadocs/api-1.4/org/apache/commons/io/input/TeeInputStream.html"><code class="language-plaintext highlighter-rouge">TeeInputStream</code></a> from <a href="https://commons.apache.org/">Apache Commons</a> does, but encapsulated. So we don’t copy, we create an <a href="http://static.javadoc.io/org.cactoos/cactoos/0.9/org/cactoos/Input.html"><code class="language-plaintext highlighter-rouge">Input</code></a> that will copy if you <em>touch</em> it:<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Input</span> <span class="n">tee</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">TeeInput</span><span class="o">(</span><span class="n">input</span><span class="o">,</span> <span class="n">output</span><span class="o">);</span>
</code></pre></div></div><p>Now, we have to “touch” it. And we have to touch every single byte of it, in order to make sure they all are copied. If we just <code class="language-plaintext highlighter-rouge">read()</code> the first byte, only one byte will be copied to the file. The best way to touch them all is to calculate the size of the <code class="language-plaintext highlighter-rouge">tee</code> object, going byte by byte. We have an object for it, called <a href="http://static.javadoc.io/org.cactoos/cactoos/0.9/org/cactoos/io/LengthOfInput.html"><code class="language-plaintext highlighter-rouge">LengthOfInput</code></a>. It encapsulates an <a href="http://static.javadoc.io/org.cactoos/cactoos/0.9/org/cactoos/Input.html"><code class="language-plaintext highlighter-rouge">Input</code></a> and behaves like its length in bytes:<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Scalar</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">&gt;</span> <span class="n">length</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">LengthOfInput</span><span class="o">(</span><span class="n">tee</span><span class="o">);</span>
</code></pre></div></div><p>Then we take the value out of it and the file writing operation takes place:<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">long</span> <span class="n">len</span> <span class="o">=</span> <span class="n">length</span><span class="o">.</span><span class="na">value</span><span class="o">();</span>
</code></pre></div></div><p>Thus, the entire operation of writing the string to the file will look like this:<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">new</span> <span class="nc">LengthOfInput</span><span class="o">(</span>
  <span class="k">new</span> <span class="nf">TeeInput</span><span class="o">(</span>
    <span class="k">new</span> <span class="nf">BytesAsInput</span><span class="o">(</span>
      <span class="k">new</span> <span class="nf">TextAsBytes</span><span class="o">(</span>
        <span class="k">new</span> <span class="nf">StringAsText</span><span class="o">(</span>
          <span class="s">"Hello, world!"</span>
        <span class="o">)</span>
      <span class="o">)</span>
    <span class="o">),</span>
    <span class="k">new</span> <span class="nf">FileAsOutput</span><span class="o">(</span>
      <span class="k">new</span> <span class="nf">File</span><span class="o">(</span><span class="s">"/tmp/hello.txt"</span><span class="o">)</span>
    <span class="o">)</span>
  <span class="o">)</span>
<span class="o">).</span><span class="na">value</span><span class="o">();</span> <span class="c1">// happens here</span>
</code></pre></div></div><p>This is its procedural alternative from <a href="https://docs.oracle.com/javase/7/docs/api/java/nio/file/Files.html#write%28java.nio.file.Path,%20byte[],%20java.nio.file.OpenOption...%29">JDK7</a>:<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Files</span><span class="o">.</span><span class="na">write</span><span class="o">(</span>
  <span class="k">new</span> <span class="nf">File</span><span class="o">(</span><span class="s">"/tmp/hello.txt"</span><span class="o">).</span><span class="na">toPath</span><span class="o">(),</span>
  <span class="s">"Hello, world!"</span><span class="o">.</span><span class="na">getBytes</span><span class="o">()</span>
<span class="o">);</span>
</code></pre></div></div><p>“Why is object-oriented better, even though it’s longer?” I hear you ask. Because it perfectly <strong>decouples</strong> concepts, while the procedural one keeps them together.<p>Let’s say, you are designing a class that is supposed to encrypt some text and save it to a file. Here is how you would design it the procedural way (not a real encryption, of course):<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">Encoder</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="nc">File</span> <span class="n">target</span><span class="o">;</span>
  <span class="nc">Encoder</span><span class="o">(</span><span class="kd">final</span> <span class="nc">File</span> <span class="n">file</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">target</span> <span class="o">=</span> <span class="n">file</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kt">void</span> <span class="nf">encode</span><span class="o">(</span><span class="nc">String</span> <span class="n">text</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Files</span><span class="o">.</span><span class="na">write</span><span class="o">(</span>
      <span class="k">this</span><span class="o">.</span><span class="na">target</span><span class="o">,</span>
      <span class="n">text</span><span class="o">.</span><span class="na">replaceAll</span><span class="o">(</span><span class="s">"[a-z]"</span><span class="o">,</span> <span class="s">"*"</span><span class="o">)</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><p>Works fine, but what will happen when you decide to extend it to also write to an <a href="https://docs.oracle.com/javase/7/docs/api/java/io/OutputStream.html"><code class="language-plaintext highlighter-rouge">OutputStream</code></a>? How will you modify this class? How ugly will it look after that? That’s because the design is not object-oriented.<p>This is how you would do the same design, in an object-oriented way, with <a href="https://www.cactoos.org">Cactoos</a>:<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">Encoder</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="nc">Output</span> <span class="n">target</span><span class="o">;</span>
  <span class="nc">Encoder</span><span class="o">(</span><span class="kd">final</span> <span class="nc">File</span> <span class="n">file</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">(</span><span class="k">new</span> <span class="nc">FileAsOutput</span><span class="o">(</span><span class="n">file</span><span class="o">));</span>
  <span class="o">}</span>
  <span class="nc">Encoder</span><span class="o">(</span><span class="kd">final</span> <span class="nc">Output</span> <span class="n">output</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">target</span> <span class="o">=</span> <span class="n">output</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kt">void</span> <span class="nf">encode</span><span class="o">(</span><span class="nc">String</span> <span class="n">text</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">new</span> <span class="nf">LengthOfInput</span><span class="o">(</span>
      <span class="k">new</span> <span class="nf">TeeInput</span><span class="o">(</span>
        <span class="k">new</span> <span class="nf">BytesAsInput</span><span class="o">(</span>
          <span class="k">new</span> <span class="nf">TextAsBytes</span><span class="o">(</span>
            <span class="k">new</span> <span class="nf">StringAsText</span><span class="o">(</span>
              <span class="n">text</span><span class="o">.</span><span class="na">replaceAll</span><span class="o">(</span><span class="s">"[a-z]"</span><span class="o">,</span> <span class="s">"*"</span><span class="o">)</span>
            <span class="o">)</span>
          <span class="o">)</span>
        <span class="o">),</span>
        <span class="k">this</span><span class="o">.</span><span class="na">target</span>
      <span class="o">)</span>
    <span class="o">).</span><span class="na">value</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><p>What do we do with this design if we want <a href="https://docs.oracle.com/javase/7/docs/api/java/io/OutputStream.html"><code class="language-plaintext highlighter-rouge">OutputStream</code></a> to be accepted? We just add one <a href="/2015/05/28/one-primary-constructor.html">secondary</a> constructor:<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">Encoder</span> <span class="o">{</span>
  <span class="nc">Encoder</span><span class="o">(</span><span class="kd">final</span> <span class="nc">OutputStream</span> <span class="n">stream</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">(</span><span class="k">new</span> <span class="nc">OutputStreamAsOutput</span><span class="o">(</span><span class="n">stream</span><span class="o">));</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><p>Done. That’s how easy and elegant it is.<p>That’s because concepts are perfectly separated and functionality is encapsulated. In the procedural example the behavior of the object is located outside of it, in the method <code class="language-plaintext highlighter-rouge">encode()</code>. The file itself doesn’t know how to write, some outside procedure <a href="https://docs.oracle.com/javase/7/docs/api/java/nio/file/Files.html#write%28java.nio.file.Path,%20byte[],%20java.nio.file.OpenOption...%29"><code class="language-plaintext highlighter-rouge">Files.write()</code></a> knows that instead.<p>To the contrary, in the object-oriented design the <a href="http://static.javadoc.io/org.cactoos/cactoos/0.9/org/cactoos/io/FileAsOutput.html"><code class="language-plaintext highlighter-rouge">FileAsOutput</code></a> knows how to write, and nobody else does. The file writing functionality is encapsulated and this makes it possible to decorate the objects in any possible way, creating reusable and replaceable composite objects.<p>Do you see the beauty of OOP now?</article>