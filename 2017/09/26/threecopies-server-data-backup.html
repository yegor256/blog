<!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="How do you back up your server data? I created this web service to get rid of backup servers entirely." /> <meta name="keywords" content="data pipeline, online backup, server data backup, server-side backup service, threecopies" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2017-09-26 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="ThreeCopies.com&mdash;Server-Side Data Backup Service"/> <meta name="twitter:description" property="og:description" content="How do you back up your server data? I created this web service to get rid of backup servers entirely."/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2017/09/26/threecopies-server-data-backup.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?9b17558998c"/> <link rel="apple-touch-icon" href="/favicon.ico?9b17558998c"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?9b17558998c"/> <link rel="stylesheet" href="/css/icons.css?9b17558998c"/> <link rel="canonical" href="https://www.yegor256.com/2017/09/26/threecopies-server-data-backup.html" /> <title>ThreeCopies.com&mdash;Server-Side Data Backup Service </title> <meta name='og:image' content='https://www.yegor256.com/images/2017/09/threecopies.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2017/09/threecopies.jpg'/><meta name='og:image:width' content='1466'/> <meta name='twitter:image:width' content='1466'/><meta name='og:image:height' content='1132'/> <meta name='twitter:image:height' content='1132'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='Main picture'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/yegor256news" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;363</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Art</a></li> <li><a href="https://ru.yegor256.com/" title="Немного на русском языке о политике в России, Украине и мире">Политика</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2017/09/26/threecopies-server-data-backup.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2017/09/26/threecopies-server-data-backup.html</code></p><h1 itemprop="name headline mainEntityOfPage">ThreeCopies.com&mdash;Server-Side Data Backup Service</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2017-09-26T00:00:00+00:00"> 26 September 2017 </time> </li> <li class="desktop-only" itemprop="locationCreated">Odessa, Ukraine</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2017/09/26/threecopies-server-data-backup.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p class="unprintable"><a href='/tag/pets.html' class='tag notranslate'>pets</a></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2017/09/26/threecopies-server-data-backup.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2017/09/26/threecopies-server-data-backup.html&amp;text=ThreeCopies.com%26mdash%3BServer-Side+Data+Backup+Service" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2017/09/26/threecopies-server-data-backup.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2017/09/26/threecopies-server-data-backup.html%3F2017-39&amp;title=ThreeCopies.com%26mdash%3BServer-Side+Data+Backup+Service" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2017/09/26/threecopies-server-data-backup.html%3F2017-39&amp;t=ThreeCopies.com%26mdash%3BServer-Side+Data+Backup+Service" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div > <figure class="badge"><a href="http://www.threecopies.com"><img src="http://www.threecopies.com/images/logo.png" style="width:64px;max-width:100%;" alt="badge" /></a></figure><p>I have a number of data resources which exist in one place only and which I don’t really want to lose. For example, I have a hosted PHP website, and a MySQL database hosted at the same place. I also have a NoSQL database at Amazon DynamoDB, a PostgreSQL database at Heroku, and also… Well, there are many of them. How to back them up was always a question for me.</p><figure class="jb_picture"><img itemprop="image" alt="Main picture" src="/images/2017/09/threecopies.jpg" /></figure><p>The most straightforward way is to rent a cheap $15/mo server (or use an existing one) and configure Cron to run a custom bash script, which will pull the data from the MySQL database, package it, and upload it to some place where it will be safe, such as Amazon S3 bucket. Then, I would need another script for the PostgreSQL database, and another one for the FTP file archive, etc.</p><aside class="youtube"> <a href="https://www.youtube.com/watch?v=KYd24FN58wg"><div class="box"> <img src="https://i.ytimg.com/vi/KYd24FN58wg/mqdefault.jpg" alt="YouTube video #KYd24FN58wg" /><div class="play"><i class="icon icon-play"></i></div></div></a><div>Object-Oriented Java Web App from Scratch in One Hour: ThreeCopies.com (Webinar #28); 4 October 2017.</div></aside><p>This is actually how I was doing it for years. The drawbacks of this solution were always the same:</p><ul> <li>I needed to pay for the server.</li> <li>I needed to make sure the server was always up and running (Linux is far from reliable).</li> <li>I needed to back up my scripts too.</li> <li>I needed to SSH to the server every time I wanted to change a script, remember where they were, how they start, etc.</li></ul><p>The biggest issue is that every single owner of a data source faces exactly the same set of problems. “Why can’t I create a hosted solution for these scripts, to help everybody to back up their data,” I was asking myself for years. “Well, I can,” was the answer just a few weeks ago, and I created <a href="http://www.threecopies.com">ThreeCopies</a>.</p><p>It’s a very simple hosted executor of bash scripts, which you edit through a web interface. Then one of our servers starts a Docker container (<a href="https://hub.docker.com/r/yegor256/threecopies/">yegor256/threecopies</a> is the image, here is the <a href="https://github.com/yegor256/threecopies/blob/master/src/docker/Dockerfile"><code class="highlighter-rouge">Dockerfile</code></a>) and runs your script inside.</p><p>The script starts every hour, every day and every week. Hence the name: “three copies.” It’s good practice for data backup to create separate copies with different regularities. Also, you might want to put different data into different copies. To help your script understand which copy is running at any particular time we pass the <code class="highlighter-rouge">$period</code> environment variable into it, with the value of either <code class="highlighter-rouge">hour</code>, <code class="highlighter-rouge">day</code>, or <code class="highlighter-rouge">week</code>.</p><p>How your script pulls the data, packages it, and archives it, depends on the data. I created a short cheat sheet for most common scenarios. This is how I backup the MySQL database for <a href="http://www.thepmp.com">thePMP</a>, for example:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># I don't want to back up every hour</span>
<span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="k">${</span><span class="nv">period</span><span class="k">}</span><span class="s2">"</span> <span class="o">==</span> <span class="s2">"hour"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then </span><span class="nb">exit </span>0<span class="p">;</span> <span class="k">fi</span>

<span class="c"># I dump the entire database into the file</span>
mysqldump <span class="nt">--lock-tables</span><span class="o">=</span><span class="nb">false</span> <span class="nt">--host</span><span class="o">=</span>db.thepmp.com <span class="se">\</span>
  <span class="nt">--user</span><span class="o">=</span>thepmp <span class="nt">--password</span><span class="o">=</span><span class="k">*********</span> <span class="se">\</span>
  <span class="nt">--databases</span> thepmp <span class="o">&gt;</span> thepmp.sql

<span class="c"># I compress the file</span>
<span class="nv">tgz</span><span class="o">=</span><span class="s2">"</span><span class="si">$(</span><span class="nb">date</span> <span class="s2">"+%Y-%m-%d-%H-%M"</span><span class="si">)</span><span class="s2">.tgz"</span>
<span class="nb">tar </span>czf <span class="s2">"</span><span class="k">${</span><span class="nv">tgz</span><span class="k">}</span><span class="s2">"</span> thepmp.sql

<span class="c"># I upload it to Amazon S3 bucket</span>
<span class="nb">echo</span> <span class="s2">"[default]"</span> <span class="o">&gt;</span> ~/.s3cfg
<span class="nb">echo</span> <span class="s2">"access_key=AKIAICJKH*****CVLAFA"</span> <span class="o">&gt;&gt;</span> ~/.s3cfg
<span class="nb">echo</span> <span class="s2">"secret_key=yQv3g3ao654Ns**********H1xQSfZlTkseA0haG"</span> <span class="o">&gt;&gt;</span> ~/.s3cfg
s3cmd <span class="nt">--no-progress</span> put <span class="s2">"</span><span class="k">${</span><span class="nv">tgz</span><span class="k">}</span><span class="s2">"</span> <span class="s2">"s3://backup.yegor256.com/</span><span class="k">${</span><span class="nv">tgz</span><span class="k">}</span><span class="s2">"</span></code></pre></figure><p>The output of the script is available through the web interface and this is yet another benefit of this solution. It’s easy to monitor what went wrong and restart the script. All logs are available through the browser. No SSH, no terminals.</p><p>I would say that it’s a light version of <a href="https://aws.amazon.com/datapipeline/">AWS Data Pipeline</a>. <a href="http://www.threecopies.com">ThreeCopies</a> does exactly the same, but it’s easier to configure, and it’s cheaper. I’m charging $0.01 per script execution hour. And I actually charge per second, while AWS always charges for a full hour. For $5.00 you get 500 hours. For example, the script you see above takes about 5 minutes to complete (the database is not huge). If you skip the hourly executions, like I did above, you will consume 170 minutes of server time every month, which will cost you about <strong>$0.34 per year</strong>! This is much cheaper than a server and its monitoring, I believe.</p><p>One more thing before you go. ThreeCopies is written in Java 8 and is open source, find it <a href="https://github.com/yegor256/threecopies">in GitHub</a>. Feel free to inspect the code, find bugs, and contribute with fixes or improvements.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2021</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="https://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge" /></a> &nbsp; <a href="https://github.com/yegor256/blog/stargazers"> <img src="//img.shields.io/github/stars/yegor256/blog.svg?style=flat-square" alt="GitHub stars" /></a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?9b17558998c"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "https://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html>
