<!doctypehtml><html xmlns="https://www.w3.org/1999/xhtml"lang="en-US"xml:lang="en-US"itemscope=""itemtype="http://schema.org/WebSite"><meta charset="utf-8"><meta name="description"content="Don&apos;t make your classes thread-safe; instead, create thread-safe decorators to make thread safety configurable."><meta name="keywords"content="how to make class thread-safe, synchronized in java, synchronized java, thread safety, thread-safe java"><meta name="viewport"content="width=device-width,minimum-scale=1,initial-scale=1"><meta name="google-site-verification"content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8"><meta name="author"content="Yegor Bugayenko"><meta name="article:published_time"content="2017-01-17 00:00:00 +0000"><meta name="yandex-verification"content="7d2a0afee14d72bc"><meta name="og:site_name"content="Yegor Bugayenko"><meta name="og:type"content="article"><meta name="og:locale"content="en_US"><meta name="twitter:account_id"content="4503599630178231"><meta name="twitter:creator"content="@yegor256"><meta name="twitter:site"content="@yegor256"><meta name="twitter:title"property="og:title"content="Synchronized Decorators to Replace Thread-Safe Classes"><meta name="twitter:description"property="og:description"content="Don&apos;t make your classes thread-safe; instead, create thread-safe decorators to make thread safety configurable."><meta name="twitter:url"property="og:url"content="https://www.yegor256.com/2017/01/17/synchronized-decorators.html"><meta name="telegram:channel"content="AAAAAEJFMRzsRTRxM3ec6A"><link rel="search"type="application/opensearchdescription+xml"href="/opensearch.xml"title="yegor256"><link rel="icon"href="/favicon.ico?31ec049"type="image/x-icon"><link rel="shortcut icon"href="/favicon.ico?31ec049"><link rel="apple-touch-icon"href="/favicon.ico?31ec049"><link rel="alternate"type="application/rss+xml"title="RSS for yegor256.com"href="https://www.yegor256.com/rss.xml"><link rel="stylesheet"href="/css/layout.css?31ec049"><link rel="stylesheet"href="/css/icons.css?31ec049"><link rel="canonical"href="https://www.yegor256.com/2017/01/17/synchronized-decorators.html"><title>Synchronized Decorators to Replace Thread-Safe Classes</title><meta name="og:image"content="https://www.yegor256.com/images/2017/01/aladdin.jpg"><meta name="twitter:image"content="https://www.yegor256.com/images/2017/01/aladdin.jpg"><meta name="og:image:width"content="1200"><meta name="twitter:image:width"content="1200"><meta name="og:image:height"content="679"><meta name="twitter:image:height"content="679"><meta name="twitter:card"content="summary_large_image"><meta name="twitter:image:alt"content="Aladdin (1992) by Ron Clements and John Musker"><script src="https://code.jquery.com/jquery-3.7.1.min.js"integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="crossorigin="anonymous"></script><script src="/js/all.js?31ec049"></script><script id="dsq-count-scr"src="https://yegor256.disqus.com/count.js"async="async"></script><script>((e,a,t,n,o,c)=>{e.GoogleAnalyticsObject=n,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=+new Date,o=a.createElement(t),c=a.getElementsByTagName(t)[0],o.async=1,o.src="//www.google-analytics.com/analytics.js",c.parentNode.insertBefore(o,c)})(window,document,"script","ga"),ga("create","UA-1963507-32","auto"),ga("send","pageview"),Cd=document,Cr="&"+Math.random(),Cp="&s=1",Cd.cookie="b=b",Cd.cookie&&(Cp+="&c=1"),Cp+="&t="+(new Date).getTimezoneOffset(),self!=top&&(Cp+="&f=1"),navigator.javaEnabled()&&(Cp+="&j=1"),"undefined"!=typeof screen&&(Cp+="&w="+screen.width+"&h="+screen.height+"&d="+(screen.colorDepth||screen.pixelDepth))</script><script type="application/ld+json">{ "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "https://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/", "https://www.youtube.com/c/yegor256" ] }</script><div class="wrapper"><aside class="header-toggle unprintable"id="header-toggle"title="Show the menu"onclick='$("#header").show(),$("#header-toggle").hide()'>&#9776;</aside><header class="header"id="header"><div class="face"><a href="/about-me.html#form"class="sub"title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html"style="position:relative"><img src="/images/santa-hat.svg"alt="Santa hat"style="position:absolute;width:115px;left:-30px;top:-120px"> <img src="/images/face-256x256.jpg"class="photo"alt="Yegor Bugayenko"></a></div><nav><ul class="menu social notranslate"><li><a href="https://twitter.com/intent/follow?screen_name=yegor256"rel="nofollow"title="Follow me on Twitter"><i class="icon icon-twitter notranslate"aria-hidden="true"></i></a><li><a href="/rss.xml"rel="nofollow"title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate"aria-hidden="true"></i></a><li><a itemprop="sameAs"href="https://github.com/yegor256"rel="nofollow"title="My GitHub profile"><i class="icon icon-github notranslate"aria-hidden="true"></i></a><li><a itemprop="sameAs"href="http://stackoverflow.com/users/187141/yegor256"rel="nofollow"title="My Stack Overflow profile"><i class="icon icon-stackoverflow notranslate"aria-hidden="true"></i></a><li><a itemprop="sameAs"href="https://www.facebook.com/yegor256"rel="nofollow"title="Follow me on Facebook"><i class="icon icon-facebook notranslate"aria-hidden="true"></i></a><li><a itemprop="sameAs"href="https://instagram.com/yegor256"rel="nofollow"title="Follow me on Instagram"><i class="icon icon-instagram notranslate"aria-hidden="true"></i></a><li><a itemprop="sameAs"href="https://www.linkedin.com/in/yegor256"rel="nofollow"title="My LinkedIn profile"><i class="icon icon-linkedin notranslate"aria-hidden="true"></i></a><li><a itemprop="sameAs"href="https://www.youtube.com/c/yegor256?sub_confirmation=1"rel="nofollow"title="My Youtube video channel"><i class="icon icon-youtube notranslate"aria-hidden="true"></i></a><li><a href="https://soundcloud.com/yegor256"rel="nofollow"title="My podcast"><i class="icon icon-podcast notranslate"aria-hidden="true"></i></a><li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721"rel="nofollow"title="My iTunes podcast"><i class="icon icon-itunes notranslate"aria-hidden="true"></i></a><li><a href="https://t.me/yegor256news"rel="nofollow"title="My Telegram public channel"><i class="icon icon-telegram notranslate"aria-hidden="true"></i></a><li><a href="mailto:blog@yegor256.com"rel="nofollow"title="Email me any time"><i class="icon icon-mail notranslate"aria-hidden="true"></i></a></ul><ul class="menu"><li><a href="/"title="Home page">Home</a><li><a href="/best.html"title="Best articles to read">12&#160;Best</a><li><a href="/contents.html"title="The contents of the entire blog">All&#160;486</a><li><a href="/teaching.html"title="My courses and lectures">Teaching</a><li><a href="/talks.html"title="Future and past conference talks">Talks</a><li><a href="/books.html"title="The books I wrote">Books</a><li><a href="/research.html"title="My research directions and progress">Research</a><li><a href="/pets.html"title="My loved pet projects">Pets</a><li><a href="/trainings.html"title="On-site trainings">Trainings</a><li><a href="https://www.iccq.ru"title="International Conference on Code Quality">ICCQ</a><li><a href="https://www.kaicode.org"title="Open Source Festival">KaiCode</a><li><a href="/testimonials.html"title="What some people say about me">Testimonials</a><li><a href="/shift-m.html"title="Audio podcast about project management">Shift-M</a><li><a href="/paintings.html"title="My paintings for sale">Art</a></ul></nav><div class="search"><form action="https://www.google.com/search"itemprop="potentialAction"itemscope=""itemtype="http://schema.org/SearchAction"><meta itemprop="target"content="https://www.google.com/search?q={q}"><input name="sitesearch"value="yegor256.com"type="hidden"> <input itemprop="query-input"id="search-query"class="field field-text"required="required"onfocus='$(".google").css("visibility","visible")'name="q"placeholder="Type üÑµ to search"autocomplete="off"> <input type="image"src="/images/google-search-icon.svg"class="google"title="Search via Google"alt="Search via Google"></form></div><div class="hot"><ul><li>We are organizing the <strong>6th <a href="https://www.iccq.ru/2026.html">ICCQ</a> conference</strong> in collaboration with <a href="https://www.iis.nsk.su/en">IIS</a> (Novosibirsk) and, hopefully, IEEE Computer Society. We're looking for volunteers to help us. If interested, please email at <a href="mailto:orgs@iccq.ru">orgs@iccq.ru</a> (attach your LinkedIn and GitHub profiles).<li>Are you familiar with open source and have a decent GitHub portfolio of contributions? <strong>We need freelancers</strong>, working remotely and paid by result, for <a href="https://www.eolang.org">EO</a>, a new programming language. Join our Telegram group, we'll discuss: <a href="https://t.me/eolang_org">@eolang_org</a>.</ul></div></header></div><section itemscope=""itemtype="http://schema.org/BlogPosting"><div class="wrapper"><header><p class="printable"><img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2017/01/17/synchronized-decorators.html&amp;format=svg"style="width:125px;height:125px"alt="QR code"><p class="printable"><code itemprop="url">https://www.yegor256.com/170117.html</code><h1 itemprop="name headline mainEntityOfPage">Synchronized Decorators to Replace Thread-Safe Classes</h1><ul class="subline"><li><time itemprop="datePublished"datetime="2017-01-17T00:00:00+00:00">17 January 2017</time><li class="desktop-only"itemprop="locationCreated">Odessa, Ukraine<li class="printable"itemscope=""itemprop="author"itemtype="http://schema.org/Person"><span itemprop="name">Yegor Bugayenko</span><li class="unprintable"><i class="icon icon-comments"></i> <a href="https://www.yegor256.com/2017/01/17/synchronized-decorators.html#disqus_thread"itemprop="discussionUrl">comments</a></ul><ul class="unprintable subline"><li title="The page is translated by ChatGPT from English to a few languages">Translated by <i class="icon icon-chatgpt notranslate"aria-hidden="true"></i> to<li title="Click to see this page translated to Chinese"><a href="https://www.yegor256.com/zh/2017/01/17/synchronized-decorators.html">‰∏≠Êñá</a><li title="Click to see this page translated to Russian"><a href="https://www.yegor256.com/ru/2017/01/17/synchronized-decorators.html">—Ä—É—Å—Å–∫–∏–π</a></ul><p class="unprintable"><a href="/tag/java.html"class="tag notranslate"><img src="/images/icons/java-white.svg"alt="Java">java</a> <a href="/tag/oop.html"class="tag notranslate"><img src="/images/icons/cactus.svg"alt="OOP">oop</a><nav class="buttons notranslate desktop-only"><a href="https://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2017/01/17/synchronized-decorators.html"title="Share on Facebook"class="button"rel="nofollow"><span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate"aria-hidden="true"></i> </a><a href="https://twitter.com/share?url=https://www.yegor256.com/2017/01/17/synchronized-decorators.html&amp;text=Synchronized+Decorators+to+Replace+Thread-Safe+Classes"title="Share on Twitter"class="button"rel="nofollow"><span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate"aria-hidden="true"></i> </a><a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2017/01/17/synchronized-decorators.html"title="Share on LinkedIn"class="button"rel="nofollow"><span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate"aria-hidden="true"></i> </a><a href="https://reddit.com/submit?url=https://www.yegor256.com/2017/01/17/synchronized-decorators.html%3F2017-03&amp;title=Synchronized+Decorators+to+Replace+Thread-Safe+Classes"title="Share on Reddit"class="button"rel="nofollow"><span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate"aria-hidden="true"></i> </a><a href="https://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2017/01/17/synchronized-decorators.html%3F2017-03&amp;t=Synchronized+Decorators+to+Replace+Thread-Safe+Classes"title="Share on Hacker News"class="button"rel="nofollow"><span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate"aria-hidden="true"></i> </a><a href="#"title="Cite it via BibTeX"class="button"onclick='return $("#bibtex").toggle(),!1'><i class="icon icon-tex notranslate"aria-hidden="true"></i></a></nav></header><article class="main"itemprop="articleBody"><div><div id="bibtex"style="display:none"><p>Please, cite this blog post via <a href="https://www.bibtex.org/">BibTeX</a> as such:<pre style="color:#053c5e">@misc&#123;bugayenko2017blog0117,
  author = &#123;Bugayenko, Yegor&#125;,
  title = &#123;&#123;Synchronized Decorators to Replace Thread-Safe Classes&#125;&#125;,
  howpublished = &#123;\url&#123;https://www.yegor256.com/170117.html&#125;&#125;,
  year = &#123;2017&#125;,
  month = &#123;jan&#125;,
  note = &#123;[Online; accessed 01-01-2026]&#125;
&#125;</pre></div><p>You know what thread safety is, right? If not, there is a simple example below. All classes must be thread-safe, right? Not really. Some of them have to be thread-safe? Wrong again. I think none of them have to be thread-safe, while all of them have to provide synchronized decorators.<figure class="jb_picture"><img itemprop="image"alt="Aladdin (1992) by Ron Clements and John Musker"src="/images/2017/01/aladdin.jpg"longdesc="#f5aa3c20"><figcaption id="f5aa3c20">Aladdin (1992) by Ron Clements and John Musker</figcaption></figure><p>Let‚Äôs start with an example (it‚Äôs <a href="/2014/06/09/objects-should-be-immutable.html">mutable</a>, by the way):<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">Position</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">number</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">increment</span><span class="o">()</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">before</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">number</span><span class="o">;</span>
    <span class="kt">int</span> <span class="n">after</span> <span class="o">=</span> <span class="n">before</span> <span class="o">+</span> <span class="mi">1</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">number</span> <span class="o">=</span> <span class="n">after</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><p>What do you think‚Äîis it <a href="https://en.wikipedia.org/wiki/Thread_safety">thread-safe</a>? This term refers to whether an object of this class will operate without mistakes when used by multiple threads at the same time. Let‚Äôs say we have two threads working with the same object, <code class="language-plaintext highlighter-rouge">position</code>, and calling its method <code class="language-plaintext highlighter-rouge">increment()</code> at exactly the same moment in time.<p>We expect the <code class="language-plaintext highlighter-rouge">number</code> integer to be equal to 2 when both threads finish up, because each of them will increment it once, right? However, most likely this won‚Äôt happen.<aside class="youtube"><a href="https://www.youtube.com/watch?v=rC17YwowURQ"><div class="box"><img src="https://i.ytimg.com/vi/rC17YwowURQ/mqdefault.jpg"alt="YouTube video #rC17YwowURQ"><div class="play"><i class="icon icon-play"></i></div></div></a><div>Synchronized Decorators for Thread-Safety (Webinar #32); 7 February 2018.</div></aside><p>Let‚Äôs see what will happen. In both threads, <code class="language-plaintext highlighter-rouge">before</code> will equal <code class="language-plaintext highlighter-rouge">0</code> when they start. Then <code class="language-plaintext highlighter-rouge">after</code> will be set to <code class="language-plaintext highlighter-rouge">1</code>. Then, both threads will do <code class="language-plaintext highlighter-rouge">this.number = 1</code> and we will end up with <code class="language-plaintext highlighter-rouge">1</code> in <code class="language-plaintext highlighter-rouge">number</code> instead of the expected <code class="language-plaintext highlighter-rouge">2</code>. See the problem? Classes with such a flaw in their design are <strong>not thread-safe</strong>.<p>The simplest and most obvious solution is to make our method <a href="https://docs.oracle.com/javase/tutorial/essential/concurrency/syncmeth.html"><code class="language-plaintext highlighter-rouge">synchronized</code></a>. That will guarantee that no matter how many threads call it at the same time, they will all go sequentially, not in parallel: one thread after another. Of course, it will take longer, but it will prevent that mistake from happening:<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">Position</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">number</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kd">synchronized</span> <span class="kt">void</span> <span class="nf">increment</span><span class="o">()</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">before</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">number</span><span class="o">;</span>
    <span class="kt">int</span> <span class="n">after</span> <span class="o">=</span> <span class="n">before</span> <span class="o">+</span> <span class="mi">1</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">number</span> <span class="o">=</span> <span class="n">after</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><p>A class that guarantees it won‚Äôt break no matter how many threads are working with it is called <strong>thread-safe</strong>.<p>Now the question is: Do we have to make all classes thread-safe or only some of them? It would seem to be better to have all classes error-free, right? Why would anyone want an object that may break at some point? Well, not exactly. Remember, there is a performance concern involved; we don‚Äôt often have multiple threads, and we always want our objects to run as fast as possible. A between-threads synchronization mechanism will definitely slow us down.<p>I think the right approach is to have two classes. The first one is not thread-safe, while the other one is a <strong>synchronized decorator</strong>, which would look like this:<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">SyncPosition</span> <span class="kd">implements</span> <span class="nc">Position</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="nc">Position</span> <span class="n">origin</span><span class="o">;</span>
  <span class="nc">SyncPosition</span><span class="o">(</span><span class="nc">Position</span> <span class="n">pos</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">origin</span> <span class="o">=</span> <span class="n">pos</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kd">synchronized</span> <span class="kt">void</span> <span class="nf">increment</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">increment</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><p>Now, when we need our <code class="language-plaintext highlighter-rouge">position</code> object to be thread-safe, we decorate it with <code class="language-plaintext highlighter-rouge">SyncPosition</code>:<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Position</span> <span class="n">position</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SyncPosition</span><span class="o">(</span>
  <span class="k">new</span> <span class="nf">SimplePosition</span><span class="o">()</span>
<span class="o">);</span>
</code></pre></div></div><p>When we need a plain simple position, without any thread safety, we do this:<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Position</span> <span class="n">position</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SimplePosition</span><span class="o">();</span>
</code></pre></div></div><p>Making class functionality both rich <em>and</em> thread-safe is, in my opinion, a violation of that famous <a href="https://en.wikipedia.org/wiki/Single_responsibility_principle">single responsibility principle</a>.<p>By the way, this problem is very close to the one of <a href="/2016/01/26/defensive-programming.html">defensive programming</a> and validators.</div></article></div><script src="/js/disqus.js?31ec049"></script><div class="disqus"role="complementary"aria-hidden="true"><p class="disqus_hint">Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.<div id="disqus_thread"class="disqus-thread"><a>&nbsp;</a></div><noscript><div><p class="red">JavaScript is disabled in your browser, that's why you can't see comments under this post.</div></noscript></div><div class="wrapper"><footer class="footer"><p>&copy; <span itemscope=""itemprop="copyrightHolder"itemtype="http://schema.org/Person"><span itemprop="name">Yegor Bugayenko</span> </span>, 2014&ndash;<span itemprop="copyrightYear">2026</span></footer></div></section><div class="wrapper unprintable"style="text-align:center;margin-top:2em"><a href="https://www.sixnines.io/h/3ba1652f"><img src="https://www.sixnines.io/b/3ba1652f?style=flat"alt="sixnines availability badge"></a>&nbsp; <a href="https://github.com/yegor256/blog/stargazers"><img src="https://img.shields.io/github/stars/yegor256/blog.svg?style=flat-square"alt="GitHub stars"></a></div>