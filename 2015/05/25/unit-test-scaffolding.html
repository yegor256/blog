<!doctypehtml><html xmlns="https://www.w3.org/1999/xhtml"lang="en-US"xml:lang="en-US"itemscope=""itemtype="http://schema.org/WebSite"><meta charset="utf-8"><meta name="description"content="Most unit tests require mocks, stubs, and the preparation of some other structures before a test can be initiated; here is how I recommend you do that."><meta name="keywords"content="unit test scaffolding, unit testing best practices, unit testing mocks, unit testing of static, unit testing stubs"><meta name="viewport"content="width=device-width,minimum-scale=1,initial-scale=1"><meta name="google-site-verification"content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8"><meta name="author"content="Yegor Bugayenko"><meta name="article:published_time"content="2015-05-25 00:00:00 +0000"><meta name="yandex-verification"content="7d2a0afee14d72bc"><meta name="og:site_name"content="Yegor Bugayenko"><meta name="og:type"content="article"><meta name="og:locale"content="en_US"><meta name="twitter:account_id"content="4503599630178231"><meta name="twitter:creator"content="@yegor256"><meta name="twitter:site"content="@yegor256"><meta name="twitter:title"property="og:title"content="A Few Thoughts on Unit Test Scaffolding"><meta name="twitter:description"property="og:description"content="Most unit tests require mocks, stubs, and the preparation of some other structures before a test can be initiated; here is how I recommend you do that."><meta name="twitter:url"property="og:url"content="https://www.yegor256.com/2015/05/25/unit-test-scaffolding.html"><meta name="telegram:channel"content="AAAAAEJFMRzsRTRxM3ec6A"><link rel="search"type="application/opensearchdescription+xml"href="/opensearch.xml"title="yegor256"><link rel="icon"href="/favicon.ico?8844ff3"type="image/x-icon"><link rel="shortcut icon"href="/favicon.ico?8844ff3"><link rel="apple-touch-icon"href="/favicon.ico?8844ff3"><link rel="alternate"type="application/rss+xml"title="RSS for yegor256.com"href="https://www.yegor256.com/rss.xml"><link rel="stylesheet"href="/css/layout.css?8844ff3"><link rel="stylesheet"href="/css/icons.css?8844ff3"><link rel="canonical"href="https://www.yegor256.com/2015/05/25/unit-test-scaffolding.html"><title>A Few Thoughts on Unit Test Scaffolding</title><meta name="og:image"content="https://www.yegor256.com/images/2015/05/leon-the-professional.jpg"><meta name="twitter:image"content="https://www.yegor256.com/images/2015/05/leon-the-professional.jpg"><meta name="og:image:width"content="1200"><meta name="twitter:image:width"content="1200"><meta name="og:image:height"content="563"><meta name="twitter:image:height"content="563"><meta name="twitter:card"content="summary_large_image"><meta name="twitter:image:alt"content="L√©on: The Professional by Luc Besson"><div class="wrapper"><aside class="header-toggle unprintable"id="header-toggle"title="Show the menu"onclick='$("#header").show(),$("#header-toggle").hide()'>&#9776;</aside><header class="header"id="header"><div class="face"><a href="/about-me.html#form"class="sub"title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html"style="position:relative"><img src="/images/face-256x256.jpg"class="photo"alt="Yegor Bugayenko"></a></div><nav><ul class="menu social notranslate"><li><a href="https://twitter.com/intent/follow?screen_name=yegor256"rel="nofollow"title="Follow me on Twitter"><i class="icon icon-twitter notranslate"aria-hidden="true"></i></a><li><a href="/rss.xml"rel="nofollow"title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate"aria-hidden="true"></i></a><li><a itemprop="sameAs"href="https://github.com/yegor256"rel="nofollow"title="My GitHub profile"><i class="icon icon-github notranslate"aria-hidden="true"></i></a><li><a itemprop="sameAs"href="http://stackoverflow.com/users/187141/yegor256"rel="nofollow"title="My Stack Overflow profile"><i class="icon icon-stackoverflow notranslate"aria-hidden="true"></i></a><li><a itemprop="sameAs"href="https://www.facebook.com/yegor256"rel="nofollow"title="Follow me on Facebook"><i class="icon icon-facebook notranslate"aria-hidden="true"></i></a><li><a itemprop="sameAs"href="https://instagram.com/yegor256"rel="nofollow"title="Follow me on Instagram"><i class="icon icon-instagram notranslate"aria-hidden="true"></i></a><li><a itemprop="sameAs"href="https://www.linkedin.com/in/yegor256"rel="nofollow"title="My LinkedIn profile"><i class="icon icon-linkedin notranslate"aria-hidden="true"></i></a><li><a itemprop="sameAs"href="https://www.youtube.com/c/yegor256?sub_confirmation=1"rel="nofollow"title="My Youtube video channel"><i class="icon icon-youtube notranslate"aria-hidden="true"></i></a><li><a href="https://soundcloud.com/yegor256"rel="nofollow"title="My podcast"><i class="icon icon-podcast notranslate"aria-hidden="true"></i></a><li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721"rel="nofollow"title="My iTunes podcast"><i class="icon icon-itunes notranslate"aria-hidden="true"></i></a><li><a href="https://t.me/yegor256news"rel="nofollow"title="My Telegram public channel"><i class="icon icon-telegram notranslate"aria-hidden="true"></i></a><li><a href="mailto:blog@yegor256.com"rel="nofollow"title="Email me any time"><i class="icon icon-mail notranslate"aria-hidden="true"></i></a></ul><ul class="menu"><li><a href="/"title="Home page">Home</a><li><a href="/best.html"title="Best articles to read">12&#160;Best</a><li><a href="/contents.html"title="The contents of the entire blog">All&#160;485</a><li><a href="/teaching.html"title="My courses and lectures">Teaching</a><li><a href="/talks.html"title="Future and past conference talks">Talks</a><li><a href="/books.html"title="The books I wrote">Books</a><li><a href="/research.html"title="My research directions and progress">Research</a><li><a href="/pets.html"title="My loved pet projects">Pets</a><li><a href="/trainings.html"title="On-site trainings">Trainings</a><li><a href="https://www.iccq.ru"title="International Conference on Code Quality">ICCQ</a><li><a href="https://www.kaicode.org"title="Open Source Festival">KaiCode</a><li><a href="/testimonials.html"title="What some people say about me">Testimonials</a><li><a href="/shift-m.html"title="Audio podcast about project management">Shift-M</a><li><a href="/paintings.html"title="My paintings for sale">Art</a></ul></nav><div class="search"><form action="https://www.google.com/search"itemprop="potentialAction"itemscope=""itemtype="http://schema.org/SearchAction"><meta itemprop="target"content="https://www.google.com/search?q={q}"><input name="sitesearch"value="yegor256.com"type="hidden"> <input itemprop="query-input"id="search-query"class="field field-text"required="required"onfocus='$(".google").css("visibility","visible")'name="q"placeholder="Type üÑµ to search"autocomplete="off"> <input type="image"src="/images/google-search-icon.svg"class="google"title="Search via Google"alt="Search via Google"></form></div><div class="hot"><ul><li>We are organizing the <strong>6th <a href="https://www.iccq.ru/2026.html">ICCQ</a> conference</strong> in collaboration with <a href="https://www.iis.nsk.su/en">IIS</a> (Novosibirsk) and, hopefully, IEEE Computer Society. We're looking for volunteers to help us. If interested, please email at <a href="mailto:orgs@iccq.ru">orgs@iccq.ru</a> (attach your LinkedIn and GitHub profiles).<li>Are you familiar with open source and have a decent GitHub portfolio of contributions? <strong>We need freelancers</strong>, working remotely and paid by result, for <a href="https://www.eolang.org">EO</a>, a new programming language. Join our Telegram group, we'll discuss: <a href="https://t.me/eolang_org">@eolang_org</a>.</ul></div></header></div><section itemscope=""itemtype="http://schema.org/BlogPosting"><div class="wrapper"><header><p class="printable"><img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2015/05/25/unit-test-scaffolding.html&amp;format=svg"style="width:125px;height:125px"alt="QR code"><p class="printable"><code itemprop="url">https://www.yegor256.com/150525.html</code><h1 itemprop="name headline mainEntityOfPage">A Few Thoughts on Unit Test Scaffolding</h1><ul class="subline"><li><time itemprop="datePublished"datetime="2015-05-25T00:00:00+00:00">25 May 2015</time><li class="desktop-only"itemprop="locationCreated">Atherton, CA<li class="printable"itemscope=""itemprop="author"itemtype="http://schema.org/Person"><span itemprop="name">Yegor Bugayenko</span><li class="unprintable"><i class="icon icon-comments"></i> <a href="https://www.yegor256.com/2015/05/25/unit-test-scaffolding.html#disqus_thread"itemprop="discussionUrl">comments</a></ul><ul class="unprintable subline"><li title="The page is translated by ChatGPT from English to a few languages">Translated by <i class="icon icon-chatgpt notranslate"aria-hidden="true"></i> to<li title="Click to see this page translated to Chinese"><a href="https://www.yegor256.com/zh/2015/05/25/unit-test-scaffolding.html">‰∏≠Êñá</a><li title="Click to see this page translated to Russian"><a href="https://www.yegor256.com/ru/2015/05/25/unit-test-scaffolding.html">—Ä—É—Å—Å–∫–∏–π</a></ul><p class="unprintable"><a href="/tag/java.html"class="tag notranslate"><img src="/images/icons/java-white.svg"alt="Java">java</a> <a href="/tag/oop.html"class="tag notranslate"><img src="/images/icons/cactus.svg"alt="OOP">oop</a><nav class="buttons notranslate desktop-only"><a href="https://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2015/05/25/unit-test-scaffolding.html"title="Share on Facebook"class="button"rel="nofollow"><span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate"aria-hidden="true"></i> </a><a href="https://twitter.com/share?url=https://www.yegor256.com/2015/05/25/unit-test-scaffolding.html&amp;text=A+Few+Thoughts+on+Unit+Test+Scaffolding"title="Share on Twitter"class="button"rel="nofollow"><span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate"aria-hidden="true"></i> </a><a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2015/05/25/unit-test-scaffolding.html"title="Share on LinkedIn"class="button"rel="nofollow"><span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate"aria-hidden="true"></i> </a><a href="https://reddit.com/submit?url=https://www.yegor256.com/2015/05/25/unit-test-scaffolding.html%3F2015-21&amp;title=A+Few+Thoughts+on+Unit+Test+Scaffolding"title="Share on Reddit"class="button"rel="nofollow"><span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate"aria-hidden="true"></i> </a><a href="https://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2015/05/25/unit-test-scaffolding.html%3F2015-21&amp;t=A+Few+Thoughts+on+Unit+Test+Scaffolding"title="Share on Hacker News"class="button"rel="nofollow"><span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate"aria-hidden="true"></i> </a><a href="#"title="Cite it via BibTeX"class="button"onclick='return $("#bibtex").toggle(),!1'><i class="icon icon-tex notranslate"aria-hidden="true"></i></a></nav></header><article class="main"itemprop="articleBody"><div><div id="bibtex"style="display:none"><p>Please, cite this blog post via <a href="https://www.bibtex.org/">BibTeX</a> as such:<pre style="color:#053c5e">@misc&#123;bugayenko2015blog0525,
  author = &#123;Bugayenko, Yegor&#125;,
  title = &#123;&#123;A Few Thoughts on Unit Test Scaffolding&#125;&#125;,
  howpublished = &#123;\url&#123;https://www.yegor256.com/150525.html&#125;&#125;,
  year = &#123;2015&#125;,
  month = &#123;may&#125;,
  note = &#123;[Online; accessed 07-12-2025]&#125;
&#125;</pre></div><p>When I start to repeat myself in unit test methods by creating the same objects and preparing the data to run the test, I feel disappointed in my design. Long test methods with a lot of code duplication just don‚Äôt look right. To simplify and shorten them, there are basically two options, at least in Java: 1) private properties initialized through <code class="language-plaintext highlighter-rouge">@Before</code> and <code class="language-plaintext highlighter-rouge">@BeforeClass</code>, and 2) <a href="/2017/02/07/private-method-is-new-class.html">private static methods</a>. They both look anti-OOP to me, and I think there is an alternative. Let me explain.<figure class="jb_picture"><img itemprop="image"alt="L√©on: The Professional by Luc Besson"src="/images/2015/05/leon-the-professional.jpg"longdesc="#6f716aac"><figcaption id="6f716aac">L√©on: The Professional by Luc Besson</figcaption></figure><p>JUnit officially suggests a <a href="http://junit.org/faq.html#atests_2">test fixture</a>:<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">MetricsTest</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="nc">File</span> <span class="n">temp</span><span class="o">;</span>
  <span class="kd">private</span> <span class="nc">Folder</span> <span class="n">folder</span><span class="o">;</span>
  <span class="nd">@Before</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">prepare</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">temp</span> <span class="o">=</span> <span class="nc">Files</span><span class="o">.</span><span class="na">createTempDirectory</span><span class="o">(</span><span class="s">"test"</span><span class="o">);</span>
    <span class="k">this</span><span class="o">.</span><span class="na">folder</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DiscFolder</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">temp</span><span class="o">);</span>
    <span class="k">this</span><span class="o">.</span><span class="na">folder</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="s">"first.txt"</span><span class="o">,</span> <span class="s">"Hello, world!"</span><span class="o">);</span>
    <span class="k">this</span><span class="o">.</span><span class="na">folder</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="s">"second.txt"</span><span class="o">,</span> <span class="s">"Goodbye!"</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="nd">@After</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">clean</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">FileUtils</span><span class="o">.</span><span class="na">deleteDirectory</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">temp</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">calculatesTotalSize</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">assertEquals</span><span class="o">(</span><span class="mi">22</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Metrics</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">folder</span><span class="o">).</span><span class="na">size</span><span class="o">());</span>
  <span class="o">}</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">countsWordsInFiles</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">assertEquals</span><span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Metrics</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">folder</span><span class="o">).</span><span class="na">wc</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><p>I think it‚Äôs obvious what this test is doing. First, in <code class="language-plaintext highlighter-rouge">prepare()</code>, it creates a ‚Äútest fixture‚Äù of type <code class="language-plaintext highlighter-rouge">Folder</code>. That is used in all three tests as an argument for the <code class="language-plaintext highlighter-rouge">Metrics</code> constructor. The real class being tested here is <code class="language-plaintext highlighter-rouge">Metrics</code> while <code class="language-plaintext highlighter-rouge">this.folder</code> is something we need in order to test it.<aside class="youtube"><a href="https://www.youtube.com/watch?v=l6MpCBzwDbg"><div class="box"><img src="https://i.ytimg.com/vi/l6MpCBzwDbg/mqdefault.jpg"alt="YouTube video #l6MpCBzwDbg"><div class="play"><i class="icon icon-play"></i></div></div></a><div>What Fake Objects Are For? (webinar #8); 4 November 2015.</div></aside><p>What‚Äôs wrong with this test? There is one serious issue: <strong>coupling</strong> between test methods. Test methods (and all tests in general) must be perfectly isolated from each other. This means that changing one test must not affect any others. In this example, that is not the case. When I want to change the <code class="language-plaintext highlighter-rouge">countsWords()</code> test, I have to change the internals of <code class="language-plaintext highlighter-rouge">before()</code>, which will affect the other method in the test ‚Äúclass.‚Äù<p>With all due respect to JUnit, the idea of creating test fixtures in <code class="language-plaintext highlighter-rouge">@Before</code> and <code class="language-plaintext highlighter-rouge">@After</code> is wrong, mostly because it encourages developers to couple test methods.<p>Here is how we can improve our test and isolate test methods:<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">MetricsTest</span> <span class="o">{</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">calculatesTotalSize</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="nc">File</span> <span class="n">dir</span> <span class="o">=</span> <span class="nc">Files</span><span class="o">.</span><span class="na">createTempDirectory</span><span class="o">(</span><span class="s">"test-1"</span><span class="o">);</span>
    <span class="kd">final</span> <span class="nc">Folder</span> <span class="n">folder</span> <span class="o">=</span> <span class="nc">MetricsTest</span><span class="o">.</span><span class="na">folder</span><span class="o">(</span>
      <span class="n">dir</span><span class="o">,</span>
      <span class="s">"first.txt:Hello, world!"</span><span class="o">,</span>
      <span class="s">"second.txt:Goodbye!"</span>
    <span class="o">);</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">assertEquals</span><span class="o">(</span><span class="mi">22</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Metrics</span><span class="o">(</span><span class="n">folder</span><span class="o">).</span><span class="na">size</span><span class="o">());</span>
    <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
      <span class="nc">FileUtils</span><span class="o">.</span><span class="na">deleteDirectory</span><span class="o">(</span><span class="n">dir</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">countsWordsInFiles</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="nc">File</span> <span class="n">dir</span> <span class="o">=</span> <span class="nc">Files</span><span class="o">.</span><span class="na">createTempDirectory</span><span class="o">(</span><span class="s">"test-2"</span><span class="o">);</span>
    <span class="kd">final</span> <span class="nc">Folder</span> <span class="n">folder</span> <span class="o">=</span> <span class="nc">MetricsTest</span><span class="o">.</span><span class="na">folder</span><span class="o">(</span>
      <span class="n">dir</span><span class="o">,</span>
      <span class="s">"alpha.txt:Three words here"</span><span class="o">,</span>
      <span class="s">"beta.txt:two words"</span>
      <span class="s">"gamma.txt:one!"</span>
    <span class="o">);</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">assertEquals</span><span class="o">(</span><span class="mi">6</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Metrics</span><span class="o">(</span><span class="n">folder</span><span class="o">).</span><span class="na">wc</span><span class="o">());</span>
    <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
      <span class="nc">FileUtils</span><span class="o">.</span><span class="na">deleteDirectory</span><span class="o">(</span><span class="n">dir</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="nc">Folder</span> <span class="nf">folder</span><span class="o">(</span><span class="nc">File</span> <span class="n">dir</span><span class="o">,</span> <span class="nc">String</span><span class="o">...</span> <span class="n">parts</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Folder</span> <span class="n">folder</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DiscFolder</span><span class="o">(</span><span class="n">dir</span><span class="o">);</span>
    <span class="k">for</span> <span class="o">(</span><span class="kd">final</span> <span class="nc">String</span> <span class="n">part</span> <span class="o">:</span> <span class="n">parts</span><span class="o">)</span> <span class="o">{</span>
      <span class="kd">final</span> <span class="nc">String</span><span class="o">[]</span> <span class="n">pair</span> <span class="o">=</span> <span class="n">part</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">":"</span><span class="o">,</span> <span class="mi">2</span><span class="o">);</span>
      <span class="k">this</span><span class="o">.</span><span class="na">folder</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">pair</span><span class="o">[</span><span class="mi">0</span><span class="o">],</span> <span class="n">pair</span><span class="o">[</span><span class="mi">1</span><span class="o">]);</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">folder</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><p>Does it look better now? We‚Äôre not there yet, but now our test methods are perfectly isolated. If I want to change one of them, I‚Äôm not going to affect the others because I pass all configuration parameters to a private static utility (!) method <code class="language-plaintext highlighter-rouge">folder()</code>.<p>A utility method, huh? Yes, <a href="/2014/05/05/oop-alternative-to-utility-classes.html">it smells</a>.<p>The main issue with this design, even though it is way better than the previous one, is that it doesn‚Äôt prevent code duplication between test ‚Äúclasses.‚Äù If I need a similar test fixture of type <code class="language-plaintext highlighter-rouge">Folder</code> in another test case, I will have to move this static method there. Or even worse, I will have to create a utility class. Yes, there is <a href="/2015/02/20/utility-classes-vs-functional-programming.html">nothing worse</a> in object-oriented programming than utility classes.<p>A much better design would be to use ‚Äú<a href="/2014/09/23/built-in-fake-objects.html">fake</a>‚Äù objects instead of private static utilities. Here is how. First, we create a fake class and place it into <code class="language-plaintext highlighter-rouge">src/main/java</code>. This class can be used in tests and also in production code, if necessary (<code class="language-plaintext highlighter-rouge">Fk</code> for ‚Äúfake‚Äù):<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">FkFolder</span> <span class="kd">implements</span> <span class="nc">Folder</span><span class="o">,</span> <span class="nc">Closeable</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="nc">File</span> <span class="n">dir</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span><span class="o">[]</span> <span class="n">parts</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">FkFolder</span><span class="o">(</span><span class="nc">String</span><span class="o">...</span> <span class="n">prts</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">(</span><span class="nc">Files</span><span class="o">.</span><span class="na">createTempDirectory</span><span class="o">(</span><span class="s">"test-1"</span><span class="o">),</span> <span class="n">parts</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="nf">FkFolder</span><span class="o">(</span><span class="nc">File</span> <span class="n">file</span><span class="o">,</span> <span class="nc">String</span><span class="o">...</span> <span class="n">prts</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">dir</span> <span class="o">=</span> <span class="n">file</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">parts</span> <span class="o">=</span> <span class="n">parts</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="nc">Iterable</span><span class="o">&lt;</span><span class="nc">File</span><span class="o">&gt;</span> <span class="nf">files</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="nc">Folder</span> <span class="n">folder</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DiscFolder</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">dir</span><span class="o">);</span>
    <span class="k">for</span> <span class="o">(</span><span class="kd">final</span> <span class="nc">String</span> <span class="n">part</span> <span class="o">:</span> <span class="k">this</span><span class="o">.</span><span class="na">parts</span><span class="o">)</span> <span class="o">{</span>
      <span class="kd">final</span> <span class="nc">String</span><span class="o">[]</span> <span class="n">pair</span> <span class="o">=</span> <span class="n">part</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">":"</span><span class="o">,</span> <span class="mi">2</span><span class="o">);</span>
      <span class="n">folder</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">pair</span><span class="o">[</span><span class="mi">0</span><span class="o">],</span> <span class="n">pair</span><span class="o">[</span><span class="mi">1</span><span class="o">]);</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">folder</span><span class="o">.</span><span class="na">files</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">close</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">FileUtils</span><span class="o">.</span><span class="na">deleteDirectory</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">dir</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><p>Here is how our test will look now:<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">MetricsTest</span> <span class="o">{</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">calculatesTotalSize</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="nc">String</span><span class="o">[]</span> <span class="n">parts</span> <span class="o">=</span> <span class="o">{</span>
      <span class="s">"first.txt:Hello, world!"</span><span class="o">,</span>
      <span class="s">"second.txt:Goodbye!"</span>
    <span class="o">};</span>
    <span class="k">try</span> <span class="o">(</span><span class="kd">final</span> <span class="nc">Folder</span> <span class="n">folder</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">FkFolder</span><span class="o">(</span><span class="n">parts</span><span class="o">))</span> <span class="o">{</span>
      <span class="n">assertEquals</span><span class="o">(</span><span class="mi">22</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Metrics</span><span class="o">(</span><span class="n">folder</span><span class="o">).</span><span class="na">size</span><span class="o">());</span>
    <span class="o">}</span>
  <span class="o">}</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">countsWordsInFiles</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="nc">String</span><span class="o">[]</span> <span class="n">parts</span> <span class="o">=</span> <span class="o">{</span>
      <span class="s">"alpha.txt:Three words here"</span><span class="o">,</span>
      <span class="s">"beta.txt:two words"</span>
      <span class="s">"gamma.txt:one!"</span>
    <span class="o">};</span>
    <span class="k">try</span> <span class="o">(</span><span class="kd">final</span> <span class="nc">Folder</span> <span class="n">folder</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">FkFolder</span><span class="o">(</span><span class="n">parts</span><span class="o">))</span> <span class="o">{</span>
      <span class="n">assertEquals</span><span class="o">(</span><span class="mi">6</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Metrics</span><span class="o">(</span><span class="n">folder</span><span class="o">).</span><span class="na">wc</span><span class="o">());</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><p>What do you think? Isn‚Äôt it better than what JUnit offers? Isn‚Äôt it more reusable and extensible than utility methods?<p>To summarize, I believe scaffolding in unit testing must be done through <a href="/2014/09/23/built-in-fake-objects.html">fake objects</a> that are shipped together with production code.</div></article></div><div class="disqus"role="complementary"aria-hidden="true"><p class="disqus_hint">Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.<div id="disqus_thread"class="disqus-thread"><a>&nbsp;</a></div><script>let disqus_config=function(){this.page.url=document.location.href.split("?")[0].split("#")[0],this.page.identifier=this.page.url};(()=>{var t=document,e=t.createElement("script");e.src="https://yegor256.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)})()</script><noscript><div><p class="red">JavaScript is disabled in your browser, that's why you can't see comments under this post.</div></noscript></div><script id="dsq-count-scr"src="https://yegor256.disqus.com/count.js"async="async"></script><div class="wrapper"><footer class="footer"><p>&copy; <span itemscope=""itemprop="copyrightHolder"itemtype="http://schema.org/Person"><span itemprop="name">Yegor Bugayenko</span> </span>, 2014&ndash;<span itemprop="copyrightYear">2025</span></footer></div></section><div class="wrapper unprintable"style="text-align:center;margin-top:2em"><a href="https://www.sixnines.io/h/3ba1652f"><img src="https://www.sixnines.io/b/3ba1652f?style=flat"alt="sixnines availability badge"></a>&nbsp; <a href="https://github.com/yegor256/blog/stargazers"><img src="https://img.shields.io/github/stars/yegor256/blog.svg?style=flat-square"alt="GitHub stars"></a></div><script src="https://code.jquery.com/jquery-3.7.1.min.js"integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="crossorigin="anonymous"></script><script src="/js/all.js?8844ff3"></script><script type="application/ld+json">{ "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "https://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/", "https://www.youtube.com/c/yegor256" ] }</script>