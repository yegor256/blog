<!doctypehtml><html xmlns="https://www.w3.org/1999/xhtml"lang="en-US"xml:lang="en-US"itemscope=""itemtype="http://schema.org/WebSite"><meta charset="utf-8"><meta name="description"content="Humans should run &quot;fast&quot; tests to catch obvious mistakes, while servers should execute &quot;deep&quot; tests to ensure the highest quality."><meta name="keywords"content=""><meta name="viewport"content="width=device-width,minimum-scale=1,initial-scale=1"><meta name="google-site-verification"content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8"><meta name="author"content="Yegor Bugayenko"><meta name="og:site_name"content="Yegor Bugayenko"><meta name="og:type"content="article"><meta name="og:locale"content="en_US"><meta name="twitter:account_id"content="4503599630178231"><meta name="twitter:creator"content="@yegor256"><meta name="twitter:site"content="@yegor256"><meta name="twitter:title"property="og:title"content="Fast Tests Help Humans, Deep Tests Help Servers"><meta name="twitter:description"property="og:description"content="Humans should run &quot;fast&quot; tests to catch obvious mistakes, while servers should execute &quot;deep&quot; tests to ensure the highest quality."><meta name="twitter:url"property="og:url"content="https://www.yegor256.com/ru/2023/08/22/fast-vs-deep-testing.html"><meta name="telegram:channel"content="AAAAAEJFMRzsRTRxM3ec6A"><link rel="search"type="application/opensearchdescription+xml"href="/opensearch.xml"title="yegor256"><link rel="shortcut icon"href="/favicon.ico?3be988b2c92"><link rel="apple-touch-icon"href="/favicon.ico?3be988b2c92"><link rel="alternate"type="application/rss+xml"title="RSS for yegor256.com"href="https://www.yegor256.com/rss.xml"><link rel="stylesheet"href="/css/layout.css?3be988b2c92"><link rel="stylesheet"href="/css/icons.css?3be988b2c92"><link rel="canonical"href="https://www.yegor256.com/ru/2023/08/22/fast-vs-deep-testing.html"><title>Fast Tests Help Humans, Deep Tests Help Servers</title><div class="wrapper"><aside class="header-toggle unprintable"id="header-toggle"title="Show the menu"onclick='$("#header").show(),$("#header-toggle").hide()'>&#9776;</aside><header class="header"id="header"><div class="face"><a href="/about-me.html#form"class="sub"title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html"style="position:relative"><img src="/images/santa-hat.svg"alt="Santa hat"style="position:absolute;width:115px;left:-30px;top:-120px"> <img src="/images/face-256x256.jpg"class="photo"alt="Yegor Bugayenko"></a></div><nav><ul class="menu social notranslate"><li><a href="https://twitter.com/intent/follow?screen_name=yegor256"rel="nofollow"title="Follow me on Twitter"><i class="icon icon-twitter notranslate"aria-hidden="true"></i></a><li><a href="/rss.xml"rel="nofollow"title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate"aria-hidden="true"></i></a><li><a itemprop="sameAs"href="https://github.com/yegor256"rel="nofollow"title="My GitHub profile"><i class="icon icon-github notranslate"aria-hidden="true"></i></a><li><a itemprop="sameAs"href="http://stackoverflow.com/users/187141/yegor256"rel="nofollow"title="My Stack Overflow profile"><i class="icon icon-stackoverflow notranslate"aria-hidden="true"></i></a><li><a itemprop="sameAs"href="https://www.facebook.com/yegor256"rel="nofollow"title="Follow me on Facebook"><i class="icon icon-facebook notranslate"aria-hidden="true"></i></a><li><a itemprop="sameAs"href="https://instagram.com/yegor256"rel="nofollow"title="Follow me on Instagram"><i class="icon icon-instagram notranslate"aria-hidden="true"></i></a><li><a itemprop="sameAs"href="https://www.linkedin.com/in/yegor256"rel="nofollow"title="My LinkedIn profile"><i class="icon icon-linkedin notranslate"aria-hidden="true"></i></a><li><a itemprop="sameAs"href="https://www.youtube.com/c/yegor256?sub_confirmation=1"rel="nofollow"title="My Youtube video channel"><i class="icon icon-youtube notranslate"aria-hidden="true"></i></a><li><a href="https://soundcloud.com/yegor256"rel="nofollow"title="My podcast"><i class="icon icon-podcast notranslate"aria-hidden="true"></i></a><li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721"rel="nofollow"title="My iTunes podcast"><i class="icon icon-itunes notranslate"aria-hidden="true"></i></a><li><a href="https://t.me/yegor256news"rel="nofollow"title="My Telegram public channel"><i class="icon icon-telegram notranslate"aria-hidden="true"></i></a><li><a href="mailto:blog@yegor256.com"rel="nofollow"title="Email me any time"><i class="icon icon-mail notranslate"aria-hidden="true"></i></a></ul><ul class="menu"><li><a href="/"title="Home page">Home</a><li><a href="/best.html"title="Best articles to read">12&#160;Best</a><li><a href="/contents.html"title="The contents of the entire blog">All&#160;395</a><li><a href="/teaching.html"title="My courses and lectures">Teaching</a><li><a href="/talks.html"title="Future and past conference talks">Talks</a><li><a href="/books.html"title="The books I wrote">Books</a><li><a href="/research.html"title="My research directions and progress">Research</a><li><a href="/pets.html"title="My loved pet projects">Pets</a><li><a href="/testimonials.html"title="What some people say about me">Testimonials</a><li><a href="/shift-m.html"title="Audio podcast about project management">Shift-M</a><li><a href="/paintings.html"title="My paintings for sale">Art</a><li><a href="https://ru.yegor256.com/"title="Немного на русском языке о политике в России, Украине и мире">Политика</a></ul></nav><div class="search"><form action="https://www.google.com/search"itemprop="potentialAction"itemscope=""itemtype="http://schema.org/SearchAction"><meta itemprop="target"content="https://www.google.com/search?q={q}"><input name="sitesearch"value="yegor256.com"type="hidden"> <input itemprop="query-input"id="search-query"class="field field-text"required="required"onfocus='$(".google").css("visibility","visible")'name="q"placeholder="Search..."autocomplete="off"> <input type="image"src="/images/google-search-icon.svg"class="google"title="Search via Google"alt="Search via Google"></form></div><div class="hot"><ul></ul></div></header></div><section itemscope=""itemtype="http://schema.org/BlogPosting"><div class="wrapper"><header><h1 itemprop="name headline mainEntityOfPage">Fast Tests Help Humans, Deep Tests Help Servers</h1></header><article class="main"itemprop="articleBody"style="font-family:sans-serif;font-size:.9em;line-height:1.2em"><p style="color:#c42c00">The following text is a <em>partial</em> translation of the <a href="https://www.yegor256.com/2023/08/22/fast-vs-deep-testing.html">original English article</a>, performed by <a href="https://chat.openai.com/">ChatGPT</a> (gpt-3.5-turbo) and <a href="https://github.com/yegor256/jekyll-chatgpt-translate">this Jekyll plugin</a>:<p>Для выявления ошибок более сложного характера автоматизированные тесты превращаются в интеграционные тесты, которые включают использование внешних ресурсов в сценариях тестирования, а не их имитацию. Хотя такой подход повышает охват тестирования, он замедляет весь процесс сборки. Это подрывает саму идею автоматизированных тестов, которые должны быть средством безопасности и помогать программистам безопасно редактировать код. Разделение тестов на “быстрые” и “глубокие”, а затем разрешение людям запускать первые, а серверам - вторые, может быть хорошим решением проблемы.<p>Рассмотрим следующий Java-код с простым статическим методом <code class="language-plaintext highlighter-rouge">toString()</code>:<p>Он читает <code class="language-plaintext highlighter-rouge">stream</code> байт за байтом, добавляет их в буфер и возвращает буфер клиенту. Вот JUnit5 тест, который проверяет функциональность.<p>Пока все идет хорошо. Тест работает, и метод кажется верным. Более того, тест выполняется очень быстро - всего 5 мс на моем ноутбуке. Однако, при более близком рассмотрении, мы можем обнаружить ошибку в методе: он не закрывает входной поток. Эта проблема не влияет на тест, так как входной поток находится в памяти и не содержит ценных ресурсов, которые могут утекать. Однако, если мы введем новый тест, это выявит эту проблему:<p>Когда я запускаю этот тест, возникает исключение <code class="language-plaintext highlighter-rouge">FileNotFoundException</code> с сообщением <code class="language-plaintext highlighter-rouge">Too many open files</code>. Если я уменьшу верхнее ограничение в цикле for до 10000, ошибка исчезает. Это происходит из-за того, что максимальное количество открытых файлов в Mac OS X составляет <a href="https://superuser.com/a/443168">12 288</a>. Однако на Ubuntu это ограничение установлено <a href="https://askubuntu.com/questions/1049058">в 65536</a>. Таким образом, мой тест не обнаружит ошибку, если я запущу его на Ubuntu. Я уверен, что вы знаете, как исправить эту ошибку в методе toString().<p>Очевидно, что второй тест гораздо медленнее первого, занимая 650 мс на моем ноутбуке (в 130 раз медленнее!). Это просто пример теста, который помогает обнаружить ошибку, но требует много времени. Обычно интеграционные тесты проявляют такое негативное влияние на производительность, потому что они используют “внешние” ресурсы, которые медленные. Файловая система, используемая во втором тесте, является одним из таких внешних ресурсов.<p>650 мс могут не вызывать проблем, когда в молодом проекте всего несколько тестовых методов. Однако, с увеличением количества тестов, медленные тесты быстро становятся проблемой, так как время сборки увеличивается, что вызывает раздражение у программистов. Автоматизированные тесты, предназначенные для помощи разработчикам, превращаются в помеху. Если программисту приходится ждать несколько минут после каждого изменения кода, чтобы убедиться, что ничего не сломалось, возникает раздражение. Часто раздраженный программист может удалять эти медленные тесты.<p>Само собой разумеется, что удаление медленных тестов не является решением. Так что же является решением? Ускорение их? Не совсем. Почти всегда вызывает сложности, если не невозможно, ускорение интеграционных тестов, так как они по своей природе медленные по определенной причине. Единственный способ ускорить их - подменить эти медленные внешние ресурсы. Но эти ресурсы тестируются специально для обнаружения ошибок, которые могут быть упущены при модульном тестировании. Например, в нашем случае, если мы замокаем входной поток, второй тест не обнаружит ошибку. Поэтому второй (интеграционный) тест должен быть медленным, чтобы быть ценным.<p>Классификация тестов на <em>быстрые</em> и <em>глубокие</em> может быть решением. Первая категория включает тесты, которые мокируют как можно больше и выполняются не более 20 мс. Вторая категория состоит из тестов, которые проводят более глубокое исследование для обнаружения неуловимых ошибок, которые могут быть пропущены более быстрыми тестами. В большинстве случаев модульные тесты попадают в первую категорию, в то время как интеграционные тесты относятся ко второй. Различие между “модульными” и “интеграционными” тестами, по моему мнению, вводит в заблуждение. “Быстрые” и “глубокие” гораздо более понятные категории, так как очевидно, к какой категории относится тест. Если тест выполняется менее 20 мс, он быстрый; если нет, он глубокий.<p>Когда тесты разделены на быстрые и глубокие, их следует запускать в двух различных сценариях: программисты выполняют быстрые тесты во время написания кода, в то время как серверы выполняют глубокие тесты во время сборки и/или релиза программного обеспечения. В JUnit5 такую категоризацию можно достичь с помощью аннотации @Tag.<p>В большинстве случаев явные ошибки будут обнаружены быстрыми тестами, что дает программистам уверенность при редактировании кода. В редких случаях, когда быстрые тесты не удается выявить определенные ошибки, глубокие тесты их обнаружат. Только после этого программисты запустят медленные тесты на своих ноутбуках.<p>Вот как <code class="language-plaintext highlighter-rouge">pom.xml</code> может быть настроен, чтобы по умолчанию включить “быстрые” тесты:<p>В среде CI Maven должен быть запущен с использованием следующего флага:<p>Программист также может запустить “медленные” тесты на своем ноутбуке, используя тот же флаг командной строки. Однако это обычно делается только тогда, когда сервер выдает красный сигнал.<p>P.S. Кстати, у метода <code class="language-plaintext highlighter-rouge">toString()</code> есть еще одна ошибка, которую не обнаруживают ни первый, ни второй тесты. Сможете ли вы ее определить? Можете ли вы разработать тест, который выявит эту ошибку? Как бы вы классифицировали этот тест: “быстрый” или “глубокий”?<p class="jekyll-chatgpt-translate">Translated by ChatGPT gpt-3.5-turbo/42 on 2023-12-27 at 13:45</article></div><div class="wrapper"><footer class="footer"><p>&copy; <span itemscope=""itemprop="copyrightHolder"itemtype="http://schema.org/Person"><span itemprop="name">Yegor Bugayenko</span> </span>2014&ndash;<span itemprop="copyrightYear">2023</span></footer></div></section><div class="wrapper unprintable"style="text-align:center;margin-top:2em"><a href="https://www.sixnines.io/h/3ba1652f"><img src="//www.sixnines.io/b/3ba1652f?style=flat"alt="sixnines availability badge"></a>&nbsp; <a href="https://github.com/yegor256/blog/stargazers"><img src="//img.shields.io/github/stars/yegor256/blog.svg?style=flat-square"alt="GitHub stars"></a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script><script src="/js/all.js?3be988b2c92"></script><script>var disqus_shortname="yegor256"</script><script id="dsq-count-scr"src="//yegor256.disqus.com/count.js"async="async"></script><script>((e,a,t,g,n)=>{e.GoogleAnalyticsObject="ga",e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=+new Date,g=a.createElement(t),n=a.getElementsByTagName(t)[0],g.async=1,g.src="//www.google-analytics.com/analytics.js",n.parentNode.insertBefore(g,n)})(window,document,"script"),ga("create","UA-1963507-32","auto"),ga("send","pageview")</script><script>Cd=document,Cr="&"+Math.random(),Cp="&s=1",Cd.cookie="b=b",Cd.cookie&&(Cp+="&c=1"),Cp+="&t="+(new Date).getTimezoneOffset(),self!=top&&(Cp+="&f=1")</script><script>navigator.javaEnabled()&&(Cp+="&j=1")</script><script>"undefined"!=typeof screen&&(Cp+="&w="+screen.width+"&h="+screen.height+"&d="+(screen.colorDepth||screen.pixelDepth))</script><script>Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+"&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+"' border='0' width='1' height='1'/>")</script><script type="application/ld+json">{ "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "https://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] }</script>