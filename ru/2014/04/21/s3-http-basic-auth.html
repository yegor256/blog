<!doctypehtml><html xmlns="http://www.w3.org/1999/xhtml"lang="en-US"xml:lang="en-US"itemscope=""itemtype="http://schema.org/WebSite"><meta charset="utf-8"><meta name="description"content="Since Amazon S3 doesn&apos;t allow you to secure access to buckets with HTTP Basic Authentication, I&apos;ve created a free cloud service for this purpose"><meta name="keywords"content=""><meta name="viewport"content="width=device-width,minimum-scale=1,initial-scale=1"><meta name="google-site-verification"content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8"><meta name="author"content="Yegor Bugayenko"><meta name="og:site_name"content="Yegor Bugayenko"><meta name="og:type"content="article"><meta name="og:locale"content="en_US"><meta name="twitter:account_id"content="4503599630178231"><meta name="twitter:creator"content="@yegor256"><meta name="twitter:site"content="@yegor256"><meta name="twitter:title"property="og:title"content="Basic HTTP Auth for S3 Buckets"><meta name="twitter:description"property="og:description"content="Since Amazon S3 doesn&apos;t allow you to secure access to buckets with HTTP Basic Authentication, I&apos;ve created a free cloud service for this purpose"><meta name="twitter:url"property="og:url"content="https://www.yegor256.com/ru/2014/04/21/s3-http-basic-auth.html"><meta name="telegram:channel"content="AAAAAEJFMRzsRTRxM3ec6A"><link rel="search"type="application/opensearchdescription+xml"href="/opensearch.xml"title="yegor256"><link rel="shortcut icon"href="/favicon.ico?36c03a29597"><link rel="apple-touch-icon"href="/favicon.ico?36c03a29597"><link rel="alternate"type="application/rss+xml"title="RSS for yegor256.com"href="https://www.yegor256.com/rss.xml"><link rel="stylesheet"href="/css/layout.css?36c03a29597"><link rel="stylesheet"href="/css/icons.css?36c03a29597"><link rel="canonical"href="https://www.yegor256.com/ru/2014/04/21/s3-http-basic-auth.html"><title>Basic HTTP Auth for S3 Buckets</title><div class="wrapper"><aside class="header-toggle unprintable"id="header-toggle"title="Show the menu"onclick='$("#header").show(),$("#header-toggle").hide()'>&#9776;</aside><header class="header"id="header"><div class="face"><a href="/about-me.html#form"class="sub"title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html"style="position:relative"><img src="/images/face-256x256.jpg"class="photo"alt="Yegor Bugayenko"></a></div><nav><ul class="menu social notranslate"><li><a href="https://twitter.com/intent/follow?screen_name=yegor256"rel="nofollow"title="Follow me on Twitter"><i class="icon icon-twitter notranslate"aria-hidden="true"></i></a><li><a href="/rss.xml"rel="nofollow"title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate"aria-hidden="true"></i></a><li><a itemprop="sameAs"href="https://github.com/yegor256"rel="nofollow"title="My GitHub profile"><i class="icon icon-github notranslate"aria-hidden="true"></i></a><li><a itemprop="sameAs"href="http://stackoverflow.com/users/187141/yegor256"rel="nofollow"title="My Stack Overflow profile"><i class="icon icon-stackoverflow notranslate"aria-hidden="true"></i></a><li><a itemprop="sameAs"href="https://www.facebook.com/yegor256"rel="nofollow"title="Follow me on Facebook"><i class="icon icon-facebook notranslate"aria-hidden="true"></i></a><li><a itemprop="sameAs"href="https://instagram.com/yegor256"rel="nofollow"title="Follow me on Instagram"><i class="icon icon-instagram notranslate"aria-hidden="true"></i></a><li><a itemprop="sameAs"href="https://www.linkedin.com/in/yegor256"rel="nofollow"title="My LinkedIn profile"><i class="icon icon-linkedin notranslate"aria-hidden="true"></i></a><li><a itemprop="sameAs"href="https://www.youtube.com/c/yegor256?sub_confirmation=1"rel="nofollow"title="My Youtube video channel"><i class="icon icon-youtube notranslate"aria-hidden="true"></i></a><li><a itemprop="sameAs"href="https://www.pinterest.com/yegor256/"rel="nofollow"title="My Pinterest boards"><i class="icon icon-pinterest notranslate"aria-hidden="true"></i></a><li><a itemprop="sameAs"href="https://angel.co/yegor256"rel="nofollow"title="My AngelList profile"><i class="icon icon-angellist notranslate"aria-hidden="true"></i></a><li><a href="https://soundcloud.com/yegor256"rel="nofollow"title="My podcast"><i class="icon icon-podcast notranslate"aria-hidden="true"></i></a><li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721"rel="nofollow"title="My iTunes podcast"><i class="icon icon-itunes notranslate"aria-hidden="true"></i></a><li><a href="https://t.me/yegor256news"rel="nofollow"title="My Telegram public channel"><i class="icon icon-telegram notranslate"aria-hidden="true"></i></a><li><a href="mailto:blog@yegor256.com"rel="nofollow"title="Email me any time"><i class="icon icon-mail notranslate"aria-hidden="true"></i></a></ul><ul class="menu"><li><a href="/"title="Home page">Home</a><li><a href="/best.html"title="Best articles to read">12&#160;Best</a><li><a href="/contents.html"title="The contents of the entire blog">All&#160;390</a><li><a href="/teaching.html"title="My courses and lectures">Teaching</a><li><a href="/talks.html"title="Future and past conference talks">Talks</a><li><a href="/books.html"title="The books I wrote">Books</a><li><a href="/research.html"title="My research directions and progress">Research</a><li><a href="/pets.html"title="My loved pet projects">Pets</a><li><a href="/testimonials.html"title="What some people say about me">Testimonials</a><li><a href="/shift-m.html"title="Audio podcast about project management">Shift-M</a><li><a href="/paintings.html"title="My paintings for sale">Art</a><li><a href="https://ru.yegor256.com/"title="Немного на русском языке о политике в России, Украине и мире">Политика</a></ul></nav><div class="search"><form action="https://www.google.com/search"itemprop="potentialAction"itemscope=""itemtype="http://schema.org/SearchAction"><meta itemprop="target"content="https://www.google.com/search?q={q}"><input name="sitesearch"value="yegor256.com"type="hidden"> <input itemprop="query-input"id="search-query"class="field field-text"required="required"onfocus='$(".google").css("visibility","visible")'name="q"placeholder="Search..."autocomplete="off"> <input type="image"src="/images/google-search-icon.svg"class="google"title="Search via Google"alt="Search via Google"></form></div><div class="hot"><ul></ul></div></header></div><section itemscope=""itemtype="http://schema.org/BlogPosting"><div class="wrapper"><header><h1 itemprop="name headline mainEntityOfPage">Basic HTTP Auth for S3 Buckets</h1></header><article class="main"itemprop="articleBody"style="font-family:sans-serif;font-size:.9em;line-height:1.2em"><p style="color:#c42c00">The following text is a <em>partial</em> translation of the <a href="https://www.yegor256.com/2014/04/21/s3-http-basic-auth.html">original English article</a>, performed by <a href="https://chat.openai.com/">ChatGPT</a> (gpt-3.5-turbo) and <a href="https://github.com/yegor256/jekyll-chatgpt-translate">this Jekyll plugin</a>:<p><a href="http://aws.amazon.com/s3/">Amazon S3</a> - это простое и очень полезное хранилище двоичных объектов (также известных как “файлы”). Чтобы его использовать, вы создаете там “ведро” с уникальным именем и загружаете свои объекты.<p>После этого AWS гарантирует, что ваш объект будет доступен для загрузки через их <a href="http://docs.aws.amazon.com/AmazonS3/latest/API/APIRest.html">RESTful API</a>.<p>Несколько лет назад AWS представили функцию S3, называемую <a href="http://docs.aws.amazon.com/AmazonS3/latest/dev/WebsiteHosting.html">хостинг статических веб-сайтов</a>.<p>С помощью хостинга статических веб-сайтов вы просто включаете эту функцию, и все объекты в вашем ведре становятся доступными через общедоступный HTTP. Это потрясающая функция для размещения статического контента, такого как изображения, файлы JavaScript, видео и аудио контент.<p>При использовании хостинга вам необходимо изменить запись CNAME в своем DNS так, чтобы она указывала на <code class="language-plaintext highlighter-rouge">www.example.com.aws.amazon.com</code>. После изменения записи DNS ваш статический веб-сайт будет доступен по адресу <code class="language-plaintext highlighter-rouge">www.example.com</code>, как обычно.<p>Однако, при использовании Amazon S3 невозможно защитить ваш веб-сайт, потому что контент является исключительно статическим. Это означает, что вы не можете иметь страницу входа на переднем плане. С помощью этой услуги вы можете либо сделать ваши объекты абсолютно общедоступными - чтобы любой мог их видеть онлайн, либо присвоить им права доступа - но только для пользователей, подключенных через RESTful API.<p>Однако, мой случай использования услуги был немного сложнее. Я хотел разместить мой статический контент в виде объектов S3. Однако, я хотел сделать это, обеспечивая доступ к контенту только нескольким людям с использованием их веб-браузеров.<p>Протокол HTTP предлагает удобную функцию <a href="http://ru.wikipedia.org/wiki/Базовая_аутентификация">“базовой аутентификации”</a>, которая не требует дополнительных страниц сайта.<p>Когда запрос HTTP поступает на сервер, он не передает содержимое, а отправляет ответ со статусом 401. Этот ответ означает буквально “Я не знаю, кто вы, пожалуйста, аутентифицируйтесь”.<p>Браузер отображает свой собственный экран входа и запрашивает имя пользователя и пароль. После ввода учетных данных они объединяются, кодируются в <a href="http://ru.wikipedia.org/wiki/Base64">Base64</a> и добавляются в следующий запрос в заголовке HTTP <code class="language-plaintext highlighter-rouge">Authorization</code>.<p>Теперь браузер пытается снова получить ту же веб-страницу. Но на этот раз запрос HTTP содержит заголовок:<p>Вышеуказанное является всего лишь примером. В данном примере, закодированная в Base64 часть означает <code class="language-plaintext highlighter-rouge">joe:secret</code>, где <code class="language-plaintext highlighter-rouge">joe</code> - это имя пользователя, а <code class="language-plaintext highlighter-rouge">secret</code> - пароль, введенный пользователем.<p>На этот раз сервер имеет информацию для аутентификации и может принять решение, аутентифицирован ли данный пользователь (соответствует ли его пароль данным, хранящимся на сервере) и авторизован ли он (имеет ли он разрешение на доступ к запрашиваемой веб-странице).<p>Поскольку Amazon не предоставляет эту функцию, я решил создать простой веб-сервис, <a href="http://www.s3auth.com">s3auth.com</a>, который находится перед моими ведрами Amazon S3 и реализует механизм аутентификации и авторизации с помощью HTTP.<p>Вместо того чтобы делать мои объекты общедоступными, я делаю их приватными и указываю CNAME-запись на <code class="language-plaintext highlighter-rouge">relay.s3auth.com</code>. Затем HTTP-запросы от веб-браузеров поступают на мой сервер, подключаются к Amazon S3, извлекают мои объекты и доставляют их обратно в ответах HTTP.<p>Сервер реализует аутентификацию и авторизацию с использованием специального файла <code class="language-plaintext highlighter-rouge">.htpasswd</code> в корне моего ведра. Формат файла <code class="language-plaintext highlighter-rouge">.htpasswd</code> идентичен тому, который используется <a href="http://httpd.apache.org/docs/2.2/programs/htpasswd.html">сервером Apache HTTP</a> — один пользователь на строку. Каждая строка содержит имя пользователя и хэш-версию его пароля.<p>Я сделал этот программный продукт с открытым исходным кодом в основном для того, чтобы гарантировать своим пользователям, что сервер не хранит их личные данные в нигде, а действует только как прослойка. В результате, программный продукт находится на <a href="https://github.com/yegor256/s3auth">GitHub</a>.<p>В целях конфиденциальности и удобства, я использую только OAuth2 для учетных записей пользователей. Это означает, что я не знаю, кто мои пользователи. У меня нет их имен или адресов электронной почты, только их номера учетных записей в Facebook, Google Plus или GitHub. Конечно же, я могу найти их имена, используя эти номера, но эта информация все равно является общедоступной.<p>Сервер реализован на Java6. Для его размещения я использую один сервер Amazon EC2 <a href="http://aws.amazon.com/ec2/instance-types/">m1.small</a> Ubuntu. В настоящее время сервер, кажется, работает правильно и стабильно.<p>Помимо аутентификации и авторизации, сервер <a href="http://www.s3auth.com">s3auth.com</a> может отображать списки страниц - как Apache HTTP Server. Если у вас есть коллекция объектов в вашем контейнере, но отсутствует файл <code class="language-plaintext highlighter-rouge">index.html</code>, Amazon S3 выдает результат “страница не найдена”. В свою очередь, мой сервер отображает список объектов в контейнере, когда нет файла <code class="language-plaintext highlighter-rouge">index.html</code>, и позволяет перемещаться вверх или вниз по одной папке.<p>Когда функция версионирования включена для вашего контейнера, вы можете просмотреть все версии любого объекта в браузере. Для этого просто добавьте <code class="language-plaintext highlighter-rouge">?all-versions</code> в конец URL-адреса, чтобы отобразить список. Затем щелкните версию, чтобы сервер <a href="http://www.s3auth.com">s3auth.com</a> получил и отобразил ее.<p>Я создал эту службу в основном для себя, но, похоже, я не единственный с такими проблемами, описанными выше. В данный момент <a href="http://www.s3auth.com">s3auth.com</a> размещает более 300 доменов и отправляет более 10 Мб данных каждый час.<p>P.S. В этом посте объясняется, как <a href="http://www.s3auth.com">s3auth.com</a> может использоваться в качестве фронтэнда для вашего хранилища Maven: Как настроить частное хранилище Maven в Amazon S3.<p class="jekyll-chatgpt-translate">Translated by ChatGPT gpt-3.5-turbo/42 on 2023-11-17 at 17:07</article></div><div class="wrapper"><footer class="footer"><p>&copy; <span itemscope=""itemprop="copyrightHolder"itemtype="http://schema.org/Person"><span itemprop="name">Yegor Bugayenko</span> </span>2014&ndash;<span itemprop="copyrightYear">2023</span></footer></div></section><div class="wrapper unprintable"style="text-align:center;margin-top:2em"><a href="https://www.sixnines.io/h/3ba1652f"><img src="//www.sixnines.io/b/3ba1652f?style=flat"alt="sixnines availability badge"></a>&nbsp; <a href="https://github.com/yegor256/blog/stargazers"><img src="//img.shields.io/github/stars/yegor256/blog.svg?style=flat-square"alt="GitHub stars"></a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script><script src="/js/all.js?36c03a29597"></script><script>var disqus_shortname="yegor256"</script><script id="dsq-count-scr"src="//yegor256.disqus.com/count.js"async="async"></script><script>((e,a,t,g,n,c)=>{e.GoogleAnalyticsObject=g,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=+new Date,n=a.createElement(t),c=a.getElementsByTagName(t)[0],n.async=1,n.src="//www.google-analytics.com/analytics.js",c.parentNode.insertBefore(n,c)})(window,document,"script","ga"),ga("create","UA-1963507-32","auto"),ga("send","pageview")</script><script>Cd=document,Cr="&"+Math.random(),Cp="&s=1",Cd.cookie="b=b",Cd.cookie&&(Cp+="&c=1"),Cp+="&t="+(new Date).getTimezoneOffset(),self!=top&&(Cp+="&f=1")</script><script>navigator.javaEnabled()&&(Cp+="&j=1")</script><script>"undefined"!=typeof screen&&(Cp+="&w="+screen.width+"&h="+screen.height+"&d="+(screen.colorDepth||screen.pixelDepth))</script><script>Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+"&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+"' border='0' width='1' height='1'/>")</script><script type="application/ld+json">{ "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "https://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] }</script>