<!doctypehtml><html xmlns="https://www.w3.org/1999/xhtml"lang="en-US"xml:lang="en-US"itemscope=""itemtype="http://schema.org/WebSite"><meta charset="utf-8"><meta name="description"content="Always submit changes to the code in a separate pull request from the changes to its unit tests, in another pull request."><meta name="keywords"content=""><meta name="viewport"content="width=device-width,minimum-scale=1,initial-scale=1"><meta name="google-site-verification"content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8"><meta name="author"content="Yegor Bugayenko"><meta name="og:site_name"content="Yegor Bugayenko"><meta name="og:type"content="article"><meta name="og:locale"content="en_US"><meta name="twitter:account_id"content="4503599630178231"><meta name="twitter:creator"content="@yegor256"><meta name="twitter:site"content="@yegor256"><meta name="twitter:title"property="og:title"content="The Code and Its Tests in Different Pull Requests"><meta name="twitter:description"property="og:description"content="Always submit changes to the code in a separate pull request from the changes to its unit tests, in another pull request."><meta name="twitter:url"property="og:url"content="https://www.yegor256.com/ru/2022/08/04/code-and-tests-different-pull-requests.html"><meta name="telegram:channel"content="AAAAAEJFMRzsRTRxM3ec6A"><link rel="search"type="application/opensearchdescription+xml"href="/opensearch.xml"title="yegor256"><link rel="shortcut icon"href="/favicon.ico?f9162203ae1"><link rel="apple-touch-icon"href="/favicon.ico?f9162203ae1"><link rel="alternate"type="application/rss+xml"title="RSS for yegor256.com"href="https://www.yegor256.com/rss.xml"><link rel="stylesheet"href="/css/layout.css?f9162203ae1"><link rel="stylesheet"href="/css/icons.css?f9162203ae1"><link rel="canonical"href="https://www.yegor256.com/ru/2022/08/04/code-and-tests-different-pull-requests.html"><title>The Code and Its Tests in Different Pull Requests</title><div class="wrapper"><aside class="header-toggle unprintable"id="header-toggle"title="Show the menu"onclick='$("#header").show(),$("#header-toggle").hide()'>&#9776;</aside><header class="header"id="header"><div class="face"><a href="/about-me.html#form"class="sub"title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html"style="position:relative"><img src="/images/santa-hat.svg"alt="Santa hat"style="position:absolute;width:115px;left:-30px;top:-120px"> <img src="/images/face-256x256.jpg"class="photo"alt="Yegor Bugayenko"></a></div><nav><ul class="menu social notranslate"><li><a href="https://twitter.com/intent/follow?screen_name=yegor256"rel="nofollow"title="Follow me on Twitter"><i class="icon icon-twitter notranslate"aria-hidden="true"></i></a><li><a href="/rss.xml"rel="nofollow"title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate"aria-hidden="true"></i></a><li><a itemprop="sameAs"href="https://github.com/yegor256"rel="nofollow"title="My GitHub profile"><i class="icon icon-github notranslate"aria-hidden="true"></i></a><li><a itemprop="sameAs"href="http://stackoverflow.com/users/187141/yegor256"rel="nofollow"title="My Stack Overflow profile"><i class="icon icon-stackoverflow notranslate"aria-hidden="true"></i></a><li><a itemprop="sameAs"href="https://www.facebook.com/yegor256"rel="nofollow"title="Follow me on Facebook"><i class="icon icon-facebook notranslate"aria-hidden="true"></i></a><li><a itemprop="sameAs"href="https://instagram.com/yegor256"rel="nofollow"title="Follow me on Instagram"><i class="icon icon-instagram notranslate"aria-hidden="true"></i></a><li><a itemprop="sameAs"href="https://www.linkedin.com/in/yegor256"rel="nofollow"title="My LinkedIn profile"><i class="icon icon-linkedin notranslate"aria-hidden="true"></i></a><li><a itemprop="sameAs"href="https://www.youtube.com/c/yegor256?sub_confirmation=1"rel="nofollow"title="My Youtube video channel"><i class="icon icon-youtube notranslate"aria-hidden="true"></i></a><li><a href="https://soundcloud.com/yegor256"rel="nofollow"title="My podcast"><i class="icon icon-podcast notranslate"aria-hidden="true"></i></a><li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721"rel="nofollow"title="My iTunes podcast"><i class="icon icon-itunes notranslate"aria-hidden="true"></i></a><li><a href="https://t.me/yegor256news"rel="nofollow"title="My Telegram public channel"><i class="icon icon-telegram notranslate"aria-hidden="true"></i></a><li><a href="mailto:blog@yegor256.com"rel="nofollow"title="Email me any time"><i class="icon icon-mail notranslate"aria-hidden="true"></i></a></ul><ul class="menu"><li><a href="/"title="Home page">Home</a><li><a href="/best.html"title="Best articles to read">12&#160;Best</a><li><a href="/contents.html"title="The contents of the entire blog">All&#160;395</a><li><a href="/teaching.html"title="My courses and lectures">Teaching</a><li><a href="/talks.html"title="Future and past conference talks">Talks</a><li><a href="/books.html"title="The books I wrote">Books</a><li><a href="/research.html"title="My research directions and progress">Research</a><li><a href="/pets.html"title="My loved pet projects">Pets</a><li><a href="/testimonials.html"title="What some people say about me">Testimonials</a><li><a href="/shift-m.html"title="Audio podcast about project management">Shift-M</a><li><a href="/paintings.html"title="My paintings for sale">Art</a><li><a href="https://ru.yegor256.com/"title="Немного на русском языке о политике в России, Украине и мире">Политика</a></ul></nav><div class="search"><form action="https://www.google.com/search"itemprop="potentialAction"itemscope=""itemtype="http://schema.org/SearchAction"><meta itemprop="target"content="https://www.google.com/search?q={q}"><input name="sitesearch"value="yegor256.com"type="hidden"> <input itemprop="query-input"id="search-query"class="field field-text"required="required"onfocus='$(".google").css("visibility","visible")'name="q"placeholder="Search..."autocomplete="off"> <input type="image"src="/images/google-search-icon.svg"class="google"title="Search via Google"alt="Search via Google"></form></div><div class="hot"><ul></ul></div></header></div><section itemscope=""itemtype="http://schema.org/BlogPosting"><div class="wrapper"><header><h1 itemprop="name headline mainEntityOfPage">The Code and Its Tests in Different Pull Requests</h1></header><article class="main"itemprop="articleBody"style="font-family:sans-serif;font-size:.9em;line-height:1.2em"><p style="color:#c42c00">The following text is a <em>partial</em> translation of the <a href="https://www.yegor256.com/2022/08/04/code-and-tests-different-pull-requests.html">original English article</a>, performed by <a href="https://chat.openai.com/">ChatGPT</a> (gpt-3.5-turbo) and <a href="https://github.com/yegor256/jekyll-chatgpt-translate">this Jekyll plugin</a>:<p>Я предложил эту идею несколько недель назад <a href="https://twitter.com/yegor256/status/1525758255225528320">в Twitter</a> и получил в основном негативные реакции. Вот почему я написал этот блог пост, чтобы более подробно рассказать по этому поводу и попытаться вас убедить. Вот правило, которое я предлагаю: всегда представляйте изменения в коде отдельно от изменений в его модульных тестах. Проще говоря, в одном запросе на слияние вы изменяете тесты, возможно, отмечая некоторые из них как “отключенные”. Вы сливаете этот запрос на слияние, а затем делаете второй, изменяя код и, скорее всего, удаляя “отключенные” маркеры из тестов. Во втором запросе на слияние вы не трогаете содержимое тестов.<p>На первый взгляд это может показаться противоречием принципам TDD. Однако для меня этот подход выглядит как крайняя применение TDD, а не нарушение его. Сначала мы сливаем тесты, которые, скорее всего, сломают сборку, так как функциональность, которую они тестируют, еще не реализована. Чтобы избежать сломанного состояния сборки, мы отключаем новые тесты, которые мы добавили, и тесты, которые мы изменили. В <a href="https://junit.org/junit5/docs/current/user-guide/">JUnit 5</a> мы делаем это с помощью <a href="https://junit.org/junit5/docs/5.0.0-M2/api/org/junit/jupiter/api/Disabled.html"><code class="language-plaintext highlighter-rouge">@Disabled</code></a> аннотации.<p>Рецензенты проверяют ваши изменения, задавая себе вопросы: “Действительно ли нам нужна эта новая функциональность? Конфликтует ли она с существующей функциональностью? Есть ли смысл тестировать новую функциональность именно таким образом?” Они не думают о <em>как</em> функциональность будет реализована, им важны только <em>требования</em>, которые вы накладываете в своих тестах на продукт. На этом этапе рецензенты действуют примерно как инженеры по требованиям. Они проверяют <em>намерение</em>, а не <em>реализацию</em>.<p>Затем, во втором запросе на слияние, вы изменяете код, не трогая тесты. Теперь рецензенты могут быть уверены, что вы не изменили требования только для того, чтобы они лучше подходили для вашей реализации. Другими словами, они знают, что вы не <em>жульничали</em>. Поскольку вы не трогали тесты, это гарантия для рецензентов, что требования остаются стабильными, и вы изменяете только реализацию. Говоря деловым языком, вы не меняете <em>контракт</em>, если/когда понимаете, что не можете доставить то, что было <em>обещано</em>.<p>Более того, когда вы изменяете только тесты, не трогая код, рецензентам гораздо легче понять, принадлежат ли ваши изменения к проблеме, которую вы должны решать. Мы программисты часто делаем типичную ошибку: мы вносим изменения в код, некоторые тесты не проходят, мы исправляем тесты… неважно, “наши” это тесты или нет. Мы просто заставляем тесты пройти независимо от <em>причины</em> их неуспеха. Вместо того, чтобы <em>слушать</em> их, мы их затыкаем. Позже рецензенты могут не понять, почему некоторые тесты были изменены. Особенно если запрос на слияние большой. Они, скорее всего, просто доверятся вам и сольют запрос на слияние.<p>Вот почему разделение тестов и кода является решением. Сначала изменяются тесты, и рецензенты обратят внимание только на область тестов. Они легко поймают вас, если изменения слишком широкие и не связаны с проблемой, которую вы решаете. Затем изменяется код, и рецензентам не нужно беспокоиться о тестах вообще. Они не обращают на них внимания, они только рецензируют реализацию. Они знают, что вы не можете сломать тесты, поскольку конвейер сборки не позволит вам это сделать.<p>Что теперь вы думаете? Все это имеет смысл?<p class="jekyll-chatgpt-translate">Translated by ChatGPT gpt-3.5-turbo/42 on 2024-01-09 at 18:10</article></div><div class="wrapper"><footer class="footer"><p>&copy; <span itemscope=""itemprop="copyrightHolder"itemtype="http://schema.org/Person"><span itemprop="name">Yegor Bugayenko</span> </span>2014&ndash;<span itemprop="copyrightYear">2024</span></footer></div></section><div class="wrapper unprintable"style="text-align:center;margin-top:2em"><a href="https://www.sixnines.io/h/3ba1652f"><img src="//www.sixnines.io/b/3ba1652f?style=flat"alt="sixnines availability badge"></a>&nbsp; <a href="https://github.com/yegor256/blog/stargazers"><img src="//img.shields.io/github/stars/yegor256/blog.svg?style=flat-square"alt="GitHub stars"></a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script><script src="/js/all.js?f9162203ae1"></script><script>var disqus_shortname="yegor256"</script><script id="dsq-count-scr"src="//yegor256.disqus.com/count.js"async="async"></script><script>((e,a,t,g,n,c)=>{e.GoogleAnalyticsObject=g,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=+new Date,n=a.createElement(t),c=a.getElementsByTagName(t)[0],n.async=1,n.src="//www.google-analytics.com/analytics.js",c.parentNode.insertBefore(n,c)})(window,document,"script","ga"),ga("create","UA-1963507-32","auto"),ga("send","pageview")</script><script>Cd=document,Cr="&"+Math.random(),Cp="&s=1",Cd.cookie="b=b",Cd.cookie&&(Cp+="&c=1"),Cp+="&t="+(new Date).getTimezoneOffset(),self!=top&&(Cp+="&f=1")</script><script>navigator.javaEnabled()&&(Cp+="&j=1")</script><script>"undefined"!=typeof screen&&(Cp+="&w="+screen.width+"&h="+screen.height+"&d="+(screen.colorDepth||screen.pixelDepth))</script><script>Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+"&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+"' border='0' width='1' height='1'/>")</script><script type="application/ld+json">{ "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "https://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] }</script>