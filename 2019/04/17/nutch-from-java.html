<!doctypehtml><html xmlns="https://www.w3.org/1999/xhtml"lang="en-US"xml:lang="en-US"itemscope=""itemtype="http://schema.org/WebSite"><meta charset="utf-8"><meta name="description"content="Nutch is an open source framework for crawling web content, however it is designed primarily to be used from the command line; here I explain how to use it from inside Java."><meta name="keywords"content="java nutch, nutch, nutch apache, nutch in java, nutch without command line"><meta name="viewport"content="width=device-width,minimum-scale=1,initial-scale=1"><meta name="google-site-verification"content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8"><meta name="author"content="Yegor Bugayenko"><meta name="article:published_time"content="2019-04-17 00:00:00 +0000"><meta name="yandex-verification"content="7d2a0afee14d72bc"><meta name="og:site_name"content="Yegor Bugayenko"><meta name="og:type"content="article"><meta name="og:locale"content="en_US"><meta name="twitter:account_id"content="4503599630178231"><meta name="twitter:creator"content="@yegor256"><meta name="twitter:site"content="@yegor256"><meta name="twitter:title"property="og:title"content="How to Use Nutch From Java, Not From the Command Line"><meta name="twitter:description"property="og:description"content="Nutch is an open source framework for crawling web content, however it is designed primarily to be used from the command line; here I explain how to use it from inside Java."><meta name="twitter:url"property="og:url"content="https://www.yegor256.com/2019/04/17/nutch-from-java.html"><meta name="telegram:channel"content="AAAAAEJFMRzsRTRxM3ec6A"><link rel="search"type="application/opensearchdescription+xml"href="/opensearch.xml"title="yegor256"><link rel="icon"href="/favicon.ico?b19292d"type="image/x-icon"><link rel="shortcut icon"href="/favicon.ico?b19292d"><link rel="apple-touch-icon"href="/favicon.ico?b19292d"><link rel="alternate"type="application/rss+xml"title="RSS for yegor256.com"href="https://www.yegor256.com/rss.xml"><link rel="stylesheet"href="/css/layout.css?b19292d"><link rel="stylesheet"href="/css/icons.css?b19292d"><link rel="canonical"href="https://www.yegor256.com/2019/04/17/nutch-from-java.html"><title>How to Use Nutch From Java, Not From the Command Line</title><div class="wrapper"><aside class="header-toggle unprintable"id="header-toggle"title="Show the menu"onclick='$("#header").show(),$("#header-toggle").hide()'>&#9776;</aside><header class="header"id="header"><div class="face"><a href="/about-me.html#form"class="sub"title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html"style="position:relative"><img src="/images/face-256x256.jpg"class="photo"alt="Yegor Bugayenko"></a></div><nav><ul class="menu social notranslate"><li><a href="https://twitter.com/intent/follow?screen_name=yegor256"rel="nofollow"title="Follow me on Twitter"><i class="icon icon-twitter notranslate"aria-hidden="true"></i></a><li><a href="/rss.xml"rel="nofollow"title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate"aria-hidden="true"></i></a><li><a itemprop="sameAs"href="https://github.com/yegor256"rel="nofollow"title="My GitHub profile"><i class="icon icon-github notranslate"aria-hidden="true"></i></a><li><a itemprop="sameAs"href="http://stackoverflow.com/users/187141/yegor256"rel="nofollow"title="My Stack Overflow profile"><i class="icon icon-stackoverflow notranslate"aria-hidden="true"></i></a><li><a itemprop="sameAs"href="https://www.facebook.com/yegor256"rel="nofollow"title="Follow me on Facebook"><i class="icon icon-facebook notranslate"aria-hidden="true"></i></a><li><a itemprop="sameAs"href="https://instagram.com/yegor256"rel="nofollow"title="Follow me on Instagram"><i class="icon icon-instagram notranslate"aria-hidden="true"></i></a><li><a itemprop="sameAs"href="https://www.linkedin.com/in/yegor256"rel="nofollow"title="My LinkedIn profile"><i class="icon icon-linkedin notranslate"aria-hidden="true"></i></a><li><a itemprop="sameAs"href="https://www.youtube.com/c/yegor256?sub_confirmation=1"rel="nofollow"title="My Youtube video channel"><i class="icon icon-youtube notranslate"aria-hidden="true"></i></a><li><a href="https://soundcloud.com/yegor256"rel="nofollow"title="My podcast"><i class="icon icon-podcast notranslate"aria-hidden="true"></i></a><li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721"rel="nofollow"title="My iTunes podcast"><i class="icon icon-itunes notranslate"aria-hidden="true"></i></a><li><a href="https://t.me/yegor256news"rel="nofollow"title="My Telegram public channel"><i class="icon icon-telegram notranslate"aria-hidden="true"></i></a><li><a href="mailto:blog@yegor256.com"rel="nofollow"title="Email me any time"><i class="icon icon-mail notranslate"aria-hidden="true"></i></a></ul><ul class="menu"><li><a href="/"title="Home page">Home</a><li><a href="/best.html"title="Best articles to read">12&#160;Best</a><li><a href="/contents.html"title="The contents of the entire blog">All&#160;485</a><li><a href="/teaching.html"title="My courses and lectures">Teaching</a><li><a href="/talks.html"title="Future and past conference talks">Talks</a><li><a href="/books.html"title="The books I wrote">Books</a><li><a href="/research.html"title="My research directions and progress">Research</a><li><a href="/pets.html"title="My loved pet projects">Pets</a><li><a href="/trainings.html"title="On-site trainings">Trainings</a><li><a href="https://www.iccq.ru"title="International Conference on Code Quality">ICCQ</a><li><a href="https://www.kaicode.org"title="Open Source Festival">KaiCode</a><li><a href="/testimonials.html"title="What some people say about me">Testimonials</a><li><a href="/shift-m.html"title="Audio podcast about project management">Shift-M</a><li><a href="/paintings.html"title="My paintings for sale">Art</a></ul></nav><div class="search"><form action="https://www.google.com/search"itemprop="potentialAction"itemscope=""itemtype="http://schema.org/SearchAction"><meta itemprop="target"content="https://www.google.com/search?q={q}"><input name="sitesearch"value="yegor256.com"type="hidden"> <input itemprop="query-input"id="search-query"class="field field-text"required="required"onfocus='$(".google").css("visibility","visible")'name="q"placeholder="Type üÑµ to search"autocomplete="off"> <input type="image"src="/images/google-search-icon.svg"class="google"title="Search via Google"alt="Search via Google"></form></div><div class="hot"><ul><li>We are organizing the <strong>6th <a href="https://www.iccq.ru/2026.html">ICCQ</a> conference</strong> in collaboration with <a href="https://www.iis.nsk.su/en">IIS</a> (Novosibirsk) and, hopefully, IEEE Computer Society. We're looking for volunteers to help us. If interested, please email at <a href="mailto:orgs@iccq.ru">orgs@iccq.ru</a> (attach your LinkedIn and GitHub profiles).<li>Are you familiar with open source and have a decent GitHub portfolio of contributions? <strong>We need freelancers</strong>, working remotely and paid by result, for <a href="https://www.eolang.org">EO</a>, a new programming language. Join our Telegram group, we'll discuss: <a href="https://t.me/eolang_org">@eolang_org</a>.</ul></div></header></div><section itemscope=""itemtype="http://schema.org/BlogPosting"><div class="wrapper"><header><p class="printable"><img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2019/04/17/nutch-from-java.html&amp;format=svg"style="width:125px;height:125px"alt="QR code"><p class="printable"><code itemprop="url">https://www.yegor256.com/190417.html</code><h1 itemprop="name headline mainEntityOfPage">How to Use Nutch From Java, Not From the Command Line</h1><ul class="subline"><li><time itemprop="datePublished"datetime="2019-04-17T00:00:00+00:00">17 April 2019</time><li class="desktop-only"itemprop="locationCreated">Moscow, Russia<li class="printable"itemscope=""itemprop="author"itemtype="http://schema.org/Person"><span itemprop="name">Yegor Bugayenko</span><li class="unprintable"><i class="icon icon-comments"></i> <a href="https://www.yegor256.com/2019/04/17/nutch-from-java.html#disqus_thread"itemprop="discussionUrl">comments</a></ul><ul class="unprintable subline"><li title="The page is translated by ChatGPT from English to a few languages">Translated by <i class="icon icon-chatgpt notranslate"aria-hidden="true"></i> to<li title="Click to see this page translated to Chinese"><a href="https://www.yegor256.com/zh/2019/04/17/nutch-from-java.html">‰∏≠Êñá</a><li title="Click to see this page translated to Russian"><a href="https://www.yegor256.com/ru/2019/04/17/nutch-from-java.html">—Ä—É—Å—Å–∫–∏–π</a></ul><p class="unprintable"><a href="/tag/java.html"class="tag notranslate"><img src="/images/icons/java-white.svg"alt="Java">java</a><nav class="buttons notranslate desktop-only"><a href="https://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2019/04/17/nutch-from-java.html"title="Share on Facebook"class="button"rel="nofollow"><span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate"aria-hidden="true"></i> </a><a href="https://twitter.com/share?url=https://www.yegor256.com/2019/04/17/nutch-from-java.html&amp;text=How+to+Use+Nutch+From+Java%2C+Not+From+the+Command+Line"title="Share on Twitter"class="button"rel="nofollow"><span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate"aria-hidden="true"></i> </a><a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2019/04/17/nutch-from-java.html"title="Share on LinkedIn"class="button"rel="nofollow"><span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate"aria-hidden="true"></i> </a><a href="https://reddit.com/submit?url=https://www.yegor256.com/2019/04/17/nutch-from-java.html%3F2019-15&amp;title=How+to+Use+Nutch+From+Java%2C+Not+From+the+Command+Line"title="Share on Reddit"class="button"rel="nofollow"><span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate"aria-hidden="true"></i> </a><a href="https://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2019/04/17/nutch-from-java.html%3F2019-15&amp;t=How+to+Use+Nutch+From+Java%2C+Not+From+the+Command+Line"title="Share on Hacker News"class="button"rel="nofollow"><span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate"aria-hidden="true"></i> </a><a href="#"title="Cite it via BibTeX"class="button"onclick='return $("#bibtex").toggle(),!1'><i class="icon icon-tex notranslate"aria-hidden="true"></i></a></nav></header><article class="main"itemprop="articleBody"><div><div id="bibtex"style="display:none"><p>Please, cite this blog post via <a href="https://www.bibtex.org/">BibTeX</a> as such:<pre style="color:#053c5e">@misc&#123;bugayenko2019blog0417,
  author = &#123;Bugayenko, Yegor&#125;,
  title = &#123;&#123;How to Use Nutch From Java, Not From the Command Line&#125;&#125;,
  howpublished = &#123;\url&#123;https://www.yegor256.com/190417.html&#125;&#125;,
  year = &#123;2019&#125;,
  month = &#123;apr&#125;,
  note = &#123;[Online; accessed 10-12-2025]&#125;
&#125;</pre></div><figure class="badge"><a href="https://nutch.apache.org/"><img src="https://upload.wikimedia.org/wikipedia/commons/8/89/Nutch_logo.svg"style="width:92px;max-width:100%"alt="badge"></a></figure><p><a href="https://nutch.apache.org/">Apache Nutch</a> is an open source framework written in Java. Its purpose is to help us crawl a set of websites (or the entire Internet), fetch the content, and prepare it for indexing by, say, Solr. A pretty useful framework if you ask me, however it is designed to be used <del>only</del> mostly from the command line. You download the archive, unzip it, and run the binary file. It crawls and you get the data. However, I‚Äôve got a project where this crawling had to be embedded into my own Java app. I realized that there is a complete absence of any documentation for that. Hence this blog post. It explains how you can use Nutch from Java, not from the command line.<p>I‚Äôll be talking about Nutch 1.15. There is a later version 2+, but I didn‚Äôt manage to make it work. If you know how, leave your comment below.<p>I‚Äôd recommend you read <a href="https://examples.javacodegeeks.com/enterprise-java/apache-hadoop/apache-hadoop-nutch-tutorial/">this tutorial</a> first, to understand how Nutch works from the command line. Well, it helped me anyway.<p>Now, let‚Äôs see how we can use Nutch without the command line. First, you need these dependencies in your <code class="language-plaintext highlighter-rouge">pom.xml</code> (Nutch uses <a href="https://hadoop.apache.org/">Apache Hadoop</a>, that‚Äôs why we need the second dependency):<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;project&gt;</span>
  <span class="nt">&lt;dependencies&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>org.apache.nutch<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>nutch<span class="nt">&lt;/artifactId&gt;</span>
      <span class="nt">&lt;version&gt;</span>1.15<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>org.apache.hadoop<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>hadoop-common<span class="nt">&lt;/artifactId&gt;</span>
      <span class="nt">&lt;version&gt;</span>2.7.2<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
    [...]
  <span class="nt">&lt;/dependencies&gt;</span>
  [...]
<span class="nt">&lt;/project&gt;</span>
</code></pre></div></div><p>Next, this is your Java code, which does all the work:<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.nio.file.Files</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.nio.file.Paths</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collection</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Comparator</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.stream.Collectors</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.io.FileUtils</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.hadoop.conf.Configuration</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.nutch.crawl.CrawlDb</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.nutch.crawl.Generator</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.nutch.crawl.Injector</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.nutch.fetcher.Fetcher</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.nutch.parse.ParseSegment</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.nutch.tools.FileDumper</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">...</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="c1">// Create a default configuration object, which will read</span>
    <span class="c1">// the content of nutch-default.xml file from the classpath,</span>
    <span class="c1">// parse it and take its entire content as the default</span>
    <span class="c1">// configuration. Funny, but this interface is from Hadoop:</span>
    <span class="nc">Configuration</span> <span class="n">conf</span> <span class="o">=</span> <span class="nc">NutchConfiguration</span><span class="o">.</span><span class="na">create</span><span class="o">();</span>
    <span class="c1">// Now it's possible to reset some configuration parameters</span>
    <span class="c1">// by using this set() method. This one is mandatory, if you</span>
    <span class="c1">// don't set it the crawling won't work. The value is used</span>
    <span class="c1">// as User-Agent HTTP header.</span>
    <span class="n">conf</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="s">"http.agent.name"</span><span class="o">,</span> <span class="s">"me, myself, and I"</span><span class="o">);</span>
    <span class="c1">// This one is also mandatory and we will discuss its</span>
    <span class="c1">// value below. You need to point Nutch to the directory</span>
    <span class="c1">// with compiled plugins and this collection is NOT in</span>
    <span class="c1">// its default JAR package, unfortunately.</span>
    <span class="n">conf</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="s">"plugin.folders"</span><span class="o">,</span> <span class="nc">System</span><span class="o">.</span><span class="na">getProperty</span><span class="o">(</span><span class="s">"nutch.plugins.dir"</span><span class="o">));</span>
    <span class="c1">// First, we need to have a directory where everything will</span>
    <span class="c1">// happen. I assume you are familiar with Maven, so let's use</span>
    <span class="c1">// its default temporary directory "target":</span>
    <span class="nc">Path</span> <span class="n">home</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Path</span><span class="o">(</span><span class="s">"target"</span><span class="o">);</span>
    <span class="c1">// Next, we have to create a file with a list of URLs Nutch will</span>
    <span class="c1">// start crawling from:</span>
    <span class="nc">String</span><span class="o">[]</span> <span class="n">urls</span> <span class="o">=</span> <span class="o">{</span> <span class="s">"https://www.zerocracy.com"</span> <span class="o">};</span>
    <span class="kd">final</span> <span class="nc">Path</span> <span class="n">targets</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Path</span><span class="o">(</span><span class="n">home</span><span class="o">,</span> <span class="s">"urls"</span><span class="o">);</span>
    <span class="nc">Files</span><span class="o">.</span><span class="na">createDirectory</span><span class="o">(</span><span class="nc">Paths</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">targets</span><span class="o">.</span><span class="na">toString</span><span class="o">()));</span>
    <span class="nc">Files</span><span class="o">.</span><span class="na">write</span><span class="o">(</span>
      <span class="nc">Paths</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">targets</span><span class="o">.</span><span class="na">toString</span><span class="o">(),</span> <span class="s">"list-of-urls.txt"</span><span class="o">),</span>
      <span class="nc">String</span><span class="o">.</span><span class="na">join</span><span class="o">(</span><span class="s">"\n"</span><span class="o">,</span> <span class="n">urls</span><span class="o">).</span><span class="na">getBytes</span><span class="o">()</span>
    <span class="o">);</span>
    <span class="c1">// Next, we have to point Nutch to the directory with the</span>
    <span class="c1">// text file and let it "inject" our URLs into its database:</span>
    <span class="k">new</span> <span class="nf">Injector</span><span class="o">(</span><span class="n">conf</span><span class="o">).</span><span class="na">inject</span><span class="o">(</span>
      <span class="k">new</span> <span class="nf">Path</span><span class="o">(</span><span class="n">home</span><span class="o">,</span> <span class="s">"crawldb"</span><span class="o">),</span> <span class="c1">// the directory with its database</span>
      <span class="k">new</span> <span class="nf">Path</span><span class="o">(</span><span class="n">home</span><span class="o">,</span> <span class="s">"urls"</span><span class="o">),</span> <span class="c1">// the directory with text files with URLs</span>
      <span class="kc">true</span><span class="o">,</span> <span class="kc">true</span> <span class="c1">// no idea what this is</span>
    <span class="o">);</span>
    <span class="c1">// Now, it's time to do a few cycles of fetching, parsing, and</span>
    <span class="c1">// updating. This is how Nutch works, in increments. Each increment</span>
    <span class="c1">// will bring new web pages to the database. The more increments</span>
    <span class="c1">// you run, the deeper Nutch will go into the Internet. Five here</span>
    <span class="c1">// is a very small number. If you really want to crawl deeper,</span>
    <span class="c1">// you will need hundreds of increments. I guess, anyway. I haven't tried it.</span>
    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="o">;</span> <span class="o">++</span><span class="n">idx</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">this</span><span class="o">.</span><span class="na">cycle</span><span class="o">(</span><span class="n">home</span><span class="o">,</span> <span class="n">conf</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="c1">// Now it's time to dump what is fetched to a new directory,</span>
    <span class="c1">// which will contain HTML pages and all other files when</span>
    <span class="c1">// finished.</span>
    <span class="nc">Files</span><span class="o">.</span><span class="na">createDirectory</span><span class="o">(</span><span class="nc">Paths</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="k">new</span> <span class="nc">Path</span><span class="o">(</span><span class="n">home</span><span class="o">,</span> <span class="s">"dump"</span><span class="o">).</span><span class="na">toString</span><span class="o">()));</span>
    <span class="k">new</span> <span class="nf">FileDumper</span><span class="o">().</span><span class="na">dump</span><span class="o">(</span>
      <span class="k">new</span> <span class="nf">File</span><span class="o">(</span><span class="k">new</span> <span class="nc">Path</span><span class="o">(</span><span class="n">home</span><span class="o">,</span> <span class="s">"dump"</span><span class="o">).</span><span class="na">toString</span><span class="o">()),</span> <span class="c1">// where to dump</span>
      <span class="k">new</span> <span class="nf">File</span><span class="o">(</span><span class="k">new</span> <span class="nc">Path</span><span class="o">(</span><span class="n">home</span><span class="o">,</span> <span class="s">"segments"</span><span class="o">).</span><span class="na">toString</span><span class="o">()),</span>
      <span class="kc">null</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="kc">true</span>
    <span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">private</span> <span class="kt">void</span> <span class="nf">cycle</span><span class="o">(</span><span class="nc">Path</span> <span class="n">home</span><span class="o">,</span> <span class="nc">Configuration</span> <span class="n">conf</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// This is the directory with "segments". Each fetching cycle</span>
    <span class="c1">// will produce its own collection of files. Each collection</span>
    <span class="c1">// is called a segment.</span>
    <span class="kd">final</span> <span class="nc">Path</span> <span class="n">segments</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Path</span><span class="o">(</span><span class="n">home</span><span class="o">,</span> <span class="s">"segments"</span><span class="o">);</span>
    <span class="c1">// First, we generate a list of target URLs to fetch from:</span>
    <span class="k">new</span> <span class="nf">Generator</span><span class="o">(</span><span class="n">conf</span><span class="o">).</span><span class="na">generate</span><span class="o">(</span>
      <span class="k">new</span> <span class="nf">Path</span><span class="o">(</span><span class="n">home</span><span class="o">,</span> <span class="s">"crawldb"</span><span class="o">),</span>
      <span class="k">new</span> <span class="nf">Path</span><span class="o">(</span><span class="n">home</span><span class="o">,</span> <span class="s">"segments"</span><span class="o">),</span>
      <span class="mi">1</span><span class="o">,</span> <span class="mi">1000L</span><span class="o">,</span> <span class="nc">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()</span>
    <span class="o">);</span>
    <span class="c1">// Then, we get the path of the current segment:</span>
    <span class="kd">final</span> <span class="nc">Path</span> <span class="n">sgmt</span> <span class="o">=</span> <span class="nc">Batch</span><span class="o">.</span><span class="na">segment</span><span class="o">(</span><span class="n">segments</span><span class="o">);</span>
    <span class="c1">// Then, we fetch, parse and update:</span>
    <span class="k">new</span> <span class="nf">Fetcher</span><span class="o">(</span><span class="n">conf</span><span class="o">).</span><span class="na">fetch</span><span class="o">(</span><span class="n">sgmt</span><span class="o">,</span> <span class="mi">10</span><span class="o">);</span>
    <span class="k">new</span> <span class="nf">ParseSegment</span><span class="o">(</span><span class="n">conf</span><span class="o">).</span><span class="na">parse</span><span class="o">(</span><span class="n">sgmt</span><span class="o">);</span>
    <span class="k">new</span> <span class="nf">CrawlDb</span><span class="o">(</span><span class="n">conf</span><span class="o">).</span><span class="na">update</span><span class="o">(</span>
      <span class="k">new</span> <span class="nf">Path</span><span class="o">(</span><span class="n">home</span><span class="o">,</span> <span class="s">"crawldb"</span><span class="o">),</span>
      <span class="nc">Files</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="nc">Paths</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">segments</span><span class="o">.</span><span class="na">toString</span><span class="o">()))</span>
          <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">p</span> <span class="o">-&gt;</span> <span class="k">new</span> <span class="nc">Path</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">toString</span><span class="o">()))</span>
          <span class="o">.</span><span class="na">toArray</span><span class="o">(</span><span class="nc">Path</span><span class="o">[]::</span><span class="k">new</span><span class="o">),</span>
      <span class="kc">true</span><span class="o">,</span> <span class="kc">true</span>
    <span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="nc">Path</span> <span class="nf">segment</span><span class="o">(</span><span class="kd">final</span> <span class="nc">Path</span> <span class="n">dir</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
    <span class="c1">// Get the path of the most recent segment in the list,</span>
    <span class="c1">// sorted by the date/time of their creation.</span>
    <span class="kd">final</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Path</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="nc">Files</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="nc">Paths</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">dir</span><span class="o">.</span><span class="na">toString</span><span class="o">()))</span>
      <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">p</span> <span class="o">-&gt;</span> <span class="k">new</span> <span class="nc">Path</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">toString</span><span class="o">()))</span>
      <span class="o">.</span><span class="na">sorted</span><span class="o">(</span><span class="nc">Comparator</span><span class="o">.</span><span class="na">comparing</span><span class="o">(</span><span class="nl">Path:</span><span class="o">:</span><span class="n">toString</span><span class="o">))</span>
      <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="nc">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>
    <span class="k">return</span> <span class="n">list</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">list</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">-</span> <span class="mi">1</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><p>Pay attention that <code class="language-plaintext highlighter-rouge">Path</code> here is not the <a href="https://docs.oracle.com/javase/8/docs/api/java/nio/file/Path.html"><code class="language-plaintext highlighter-rouge">Path</code></a> from JDK. It‚Äôs the <a href="https://hadoop.apache.org/docs/r2.7.2/api/org/apache/hadoop/fs/Path.html"><code class="language-plaintext highlighter-rouge">Path</code></a> from Hadoop. Don‚Äôt ask me why.<p>This seems to be a pretty straight-forward algorithm, however there is one tricky part. Nutch, in order to work, needs a number of plugins, which are standalone JAR packages, which it doesn‚Äôt include in its default JAR. They exist in its binary distribution and they are pretty heavy (over 250MB in Nutch 1.15). Nutch expects you to download the entire distribution, unpack, and run the binary <code class="language-plaintext highlighter-rouge">nutch</code> they provide, which will work with the provided plugins.<p>What can we do, now that we are in Java, not in the command line? Here is what I suggest:<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;project&gt;</span>
  <span class="nt">&lt;build&gt;</span>
    <span class="nt">&lt;plugins&gt;</span>
      <span class="nt">&lt;plugin&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>com.googlecode.maven-download-plugin<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>download-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>1.4.1<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;executions&gt;</span>
          <span class="nt">&lt;execution&gt;</span>
            <span class="nt">&lt;id&gt;</span>download-nutch<span class="nt">&lt;/id&gt;</span>
            <span class="nt">&lt;phase&gt;</span>generate-resources<span class="nt">&lt;/phase&gt;</span>
            <span class="nt">&lt;goals&gt;</span>
              <span class="nt">&lt;goal&gt;</span>wget<span class="nt">&lt;/goal&gt;</span>
            <span class="nt">&lt;/goals&gt;</span>
            <span class="nt">&lt;configuration&gt;</span>
              <span class="nt">&lt;url&gt;</span>http://artfiles.org/apache.org/nutch/1.15/apache-nutch-1.15-bin.zip<span class="nt">&lt;/url&gt;</span>
              <span class="nt">&lt;unpack&gt;</span>true<span class="nt">&lt;/unpack&gt;</span>
              <span class="nt">&lt;outputDirectory&gt;</span>${project.build.directory}<span class="nt">&lt;/outputDirectory&gt;</span>
              <span class="nt">&lt;overwrite&gt;</span>false<span class="nt">&lt;/overwrite&gt;</span>
            <span class="nt">&lt;/configuration&gt;</span>
          <span class="nt">&lt;/execution&gt;</span>
        <span class="nt">&lt;/executions&gt;</span>
      <span class="nt">&lt;/plugin&gt;</span>
    <span class="nt">&lt;/plugins&gt;</span>
  <span class="nt">&lt;/build&gt;</span>
  [...]
<span class="nt">&lt;/project&gt;</span>
</code></pre></div></div><p>This Maven plugin will download the entire binary distribution of Nutch and will unpack it to <code class="language-plaintext highlighter-rouge">target/apache-nutch-1.15</code>. The plugins will be in <code class="language-plaintext highlighter-rouge">target/apache-nutch-1.15/plugins</code>. The only thing we still need to do is to set the system property for the unit test:<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;project&gt;</span>
  <span class="nt">&lt;build&gt;</span>
    <span class="nt">&lt;pluginManagement&gt;</span>
      <span class="nt">&lt;plugins&gt;</span>
        <span class="nt">&lt;plugin&gt;</span>
          <span class="nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="nt">&lt;/groupId&gt;</span>
          <span class="nt">&lt;artifactId&gt;</span>maven-surefire-plugin<span class="nt">&lt;/artifactId&gt;</span>
          <span class="nt">&lt;configuration&gt;</span>
            <span class="nt">&lt;systemPropertyVariables&gt;</span>
              <span class="nt">&lt;nutch.plugins.dir&gt;</span>${project.build.directory}/apache-nutch-1.15/plugins<span class="nt">&lt;/nutch.plugins.dir&gt;</span>
            <span class="nt">&lt;/systemPropertyVariables&gt;</span>
          <span class="nt">&lt;/configuration&gt;</span>
        <span class="nt">&lt;/plugin&gt;</span>
      <span class="nt">&lt;/plugins&gt;</span>
    <span class="nt">&lt;/pluginManagement&gt;</span>
    [...]
  <span class="nt">&lt;/build&gt;</span>
  [...]
<span class="nt">&lt;/project&gt;</span>
</code></pre></div></div><p>Actually, one more thing we have to do: copy the contents of the directory <code class="language-plaintext highlighter-rouge">conf</code> from their binary distribution to our <code class="language-plaintext highlighter-rouge">src/main/resources</code> directory. There are many files, including the most important <code class="language-plaintext highlighter-rouge">nutch-default.xml</code>. They all have to be available on classpath, otherwise Nutch will complain in so many places and won‚Äôt be able to load the <code class="language-plaintext highlighter-rouge">Configuration</code>.<p>You can see how it all works together in this GitHub repository I created to illustrate the example: <a href="https://github.com/yegor256/nutch-in-java">yegor256/nutch-in-java</a>.<p>If you have any questions or suggestions, feel free to submit a pull request or comment here.</div></article></div><div class="disqus"role="complementary"aria-hidden="true"><p class="disqus_hint">Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.<div id="disqus_thread"class="disqus-thread"><a>&nbsp;</a></div><script>let disqus_config=function(){this.page.url=document.location.href.split("?")[0].split("#")[0],this.page.identifier=this.page.url};(()=>{var t=document,e=t.createElement("script");e.src="https://yegor256.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)})()</script><noscript><div><p class="red">JavaScript is disabled in your browser, that's why you can't see comments under this post.</div></noscript></div><script id="dsq-count-scr"src="https://yegor256.disqus.com/count.js"async="async"></script><div class="wrapper"><footer class="footer"><p>&copy; <span itemscope=""itemprop="copyrightHolder"itemtype="http://schema.org/Person"><span itemprop="name">Yegor Bugayenko</span> </span>, 2014&ndash;<span itemprop="copyrightYear">2025</span></footer></div></section><div class="wrapper unprintable"style="text-align:center;margin-top:2em"><a href="https://www.sixnines.io/h/3ba1652f"><img src="https://www.sixnines.io/b/3ba1652f?style=flat"alt="sixnines availability badge"></a>&nbsp; <a href="https://github.com/yegor256/blog/stargazers"><img src="https://img.shields.io/github/stars/yegor256/blog.svg?style=flat-square"alt="GitHub stars"></a></div><script src="https://code.jquery.com/jquery-3.7.1.min.js"integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="crossorigin="anonymous"></script><script src="/js/all.js?b19292d"></script><script type="application/ld+json">{ "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "https://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/", "https://www.youtube.com/c/yegor256" ] }</script>