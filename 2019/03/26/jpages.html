<!DOCTYPE html> <html xmlns="https://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Most of us are used to data transfer objects, which are the corner stone of modern web frameworks; however, they are not object-oriented design." /> <meta name="keywords" content="java http framework, java web framework, java web oop, oop java web, oop web framework" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2019-03-26 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="How to Create a Java Web Framework from Scratch, the Right Object-Oriented Way"/> <meta name="twitter:description" property="og:description" content="Most of us are used to data transfer objects, which are the corner stone of modern web frameworks; however, they are not object-oriented design."/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2019/03/26/jpages.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?eaa38fae980"/> <link rel="apple-touch-icon" href="/favicon.ico?eaa38fae980"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?eaa38fae980"/> <link rel="stylesheet" href="/css/icons.css?eaa38fae980"/> <link rel="canonical" href="https://www.yegor256.com/2019/03/26/jpages.html" /> <title>How to Create a Java Web Framework from Scratch, the Right Object-Oriented Way</title> <meta name='og:image' content='https://www.yegor256.com/images/2019/03/breakfast-at-tiffanys.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2019/03/breakfast-at-tiffanys.jpg'/><meta name='og:image:width' content='1920'/> <meta name='twitter:image:width' content='1920'/><meta name='og:image:height' content='1080'/> <meta name='twitter:image:height' content='1080'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='Breakfast at Tiffany&#39;s (1961) by Blake Edwards'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My Stack Overflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/yegor256news" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;396</a></li> <li ><a href="/teaching.html" title="My courses and lectures">Teaching</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/research.html" title="My research directions and progress">Research</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Art</a></li> <li><a href="https://ru.yegor256.com/" title="Немного на русском языке о политике в России, Украине и мире">Политика</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2019/03/26/jpages.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2019/03/26/jpages.html</code></p><h1 itemprop="name headline mainEntityOfPage">How to Create a Java Web Framework from Scratch, the Right Object-Oriented Way</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2019-03-26T00:00:00+00:00"> 26 March 2019 </time> </li> <li class="desktop-only" itemprop="locationCreated">Moscow, Russia</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="https://www.yegor256.com/2019/03/26/jpages.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><ul class="subline"> <li title="The page is translated by ChatGPT from English to a few languages"> Translated by <i class="icon icon-chatgpt notranslate" aria-hidden="true"></i> to </li> <li title="Click to see this page translated to Chinese"> <a href='https://www.yegor256.com/zh/2019/03/26/jpages.html'>中文</a> </li> <li title="Click to see this page translated to Russian"> <a href='https://www.yegor256.com/ru/2019/03/26/jpages.html'>русский</a> </li></ul><p class="unprintable"><a href='/tag/java.html' class='tag notranslate'><img src='/images/icons/java-white.svg' alt='Java'/>java</a> <a href='/tag/oop.html' class='tag notranslate'><img src='/images/icons/cactus.svg' alt='OOP'/>oop</a></p><nav class="buttons notranslate desktop-only"> <a href="https://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2019/03/26/jpages.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2019/03/26/jpages.html&amp;text=How+to+Create+a+Java+Web+Framework+from+Scratch%2C+the+Right+Object-Oriented+Way" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2019/03/26/jpages.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="https://reddit.com/submit?url=https://www.yegor256.com/2019/03/26/jpages.html%3F2019-12&amp;title=How+to+Create+a+Java+Web+Framework+from+Scratch%2C+the+Right+Object-Oriented+Way" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="https://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2019/03/26/jpages.html%3F2019-12&amp;t=How+to+Create+a+Java+Web+Framework+from+Scratch%2C+the+Right+Object-Oriented+Way" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> <a href="#" title="Cite it via BibTeX" class="button" onclick="$('#bibtex').toggle(); return false;"> <i class="icon icon-tex notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><div id="bibtex" style="display: none"><p>Please, cite this blog post via <a href="https://www.bibtex.org/">BibTeX</a> as such:</p><pre style="color:#053c5e;">@misc&#123;bugayenko2019blog0326,
  author = &#123;Bugayenko, Yegor&#125;,
  title = &#123;&#123;How to Create a Java Web Framework from Scratch, the Right Object-Oriented Way&#125;&#125;,
  howpublished = &#123;\url&#123;https://www.yegor256.com/190326.html&#125;&#125;,
  year = &#123;2019&#125;,
  month = &#123;mar&#125;,
  note = &#123;[Online; accessed 01-04-2024]&#125;
&#125;</pre></div><p>How do you design a web application in Java? You install Spring, read the manual, create <a href="/2015/03/09/objects-end-with-er.html">controllers</a>, create some views, add some <a href="/2016/04/12/java-annotations-are-evil.html">annotations</a>, and it works. What would you do if there were no <a href="https://spring.io/">Spring</a> (and no Ruby on Rails in Ruby, and no Symphony in PHP, and no … etc.)? Let’s try to create a web application from scratch, starting from a pure Java SDK and ending with a fully functional web app, covered by unit tests. I recorded a <a href="https://www.youtube.com/watch?v=bVzEPOZ_mDU">webinar no.42</a> about it just a few weeks ago, but this article should explain it all in even more detail.</p><figure class="jb_picture"><img itemprop="image" alt="Breakfast at Tiffany&#39;s (1961) by Blake Edwards" src="/images/2019/03/breakfast-at-tiffanys.jpg" longdesc="#d8d1a27d" /><figcaption id="d8d1a27d">Breakfast at Tiffany&#39;s (1961) by Blake Edwards</figcaption></figure><p>First of all we have to create an HTTP server, which will open a server socket, listen to incoming connections, read everything they have to say (HTTP requests) and return the information any web browser would like (HTTP responses). You know how <a href="https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol">HTTP</a> works, right? If you don’t, here is a quick reminder:</p><p>A web browser sends a request to the server and the request looks like this (it’s a plain text piece of data):</p><div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GET /index.html HTTP/1.1
Host: www.example.com
</code></pre></div></div><p>The server has to read this text, prepare the answer (which has to be the HTML page readable by the browser) and return it like this:</p><div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>HTTP/1.1 200 OK
Content-Type: text/html; charset=UTF-8
Content-Length: 26

&lt;html&gt;Hello, world!&lt;/html&gt;
</code></pre></div></div><p>That’s it. It’s a very simple and, I would say, primitive protocol. The implementation of a web server in Java is not so complex either. Here it is, in a very simplistic form:</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.InputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.OutputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.net.ServerSocket</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.net.Socket</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.net.SocketTimeoutException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">...</span> <span class="n">argv</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">(</span><span class="nc">ServerSocket</span> <span class="n">server</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ServerSocket</span><span class="o">(</span><span class="mi">8080</span><span class="o">))</span> <span class="o">{</span>
      <span class="n">server</span><span class="o">.</span><span class="na">setSoTimeout</span><span class="o">(</span><span class="mi">1000</span><span class="o">);</span>
      <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">(</span><span class="nc">Socket</span> <span class="n">socket</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="na">accept</span><span class="o">())</span> <span class="o">{</span>
          <span class="k">try</span> <span class="o">(</span><span class="nc">InputStream</span> <span class="n">input</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">();</span>
            <span class="nc">OutputStream</span> <span class="n">output</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">())</span> <span class="o">{</span>
            <span class="kt">byte</span><span class="o">[]</span> <span class="n">buffer</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="mi">10000</span><span class="o">];</span>
            <span class="kt">int</span> <span class="n">total</span> <span class="o">=</span> <span class="n">input</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">buffer</span><span class="o">);</span>
            <span class="nc">String</span> <span class="n">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">String</span><span class="o">(</span><span class="nc">Arrays</span><span class="o">.</span><span class="na">copyOfRange</span><span class="o">(</span><span class="n">buffer</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">total</span><span class="o">));</span>
            <span class="nc">String</span> <span class="n">response</span> <span class="o">=</span> <span class="s">"HTTP/1.1 200 OK\r\n\r\nHello, world!"</span><span class="o">;</span>
            <span class="n">output</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">response</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>
          <span class="o">}</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">SocketTimeoutException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
          <span class="k">if</span> <span class="o">(</span><span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">isInterrupted</span><span class="o">())</span> <span class="o">{</span>
              <span class="k">break</span><span class="o">;</span>
          <span class="o">}</span>
        <span class="o">}</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><p>Try to run it, it should work. You should be able to open the <code class="language-plaintext highlighter-rouge">http://localhost:8080</code> page in your browser and see the <code class="language-plaintext highlighter-rouge">Hello, world!</code> text.</p><p>It’s not yet a web app, but just a skeleton, which does simple dispatching of HTTP requests into HTTP responses. There is no serious OOP in it though. It’s pretty procedural, but it works. Now we should focus on a more important question: How do we add more features to the web app and make it possible to process different pages, render larger content, and handle errors? The <code class="language-plaintext highlighter-rouge">request</code> variable in the snippet above should be somehow converted to a <code class="language-plaintext highlighter-rouge">response</code>.</p><aside class="youtube"> <a href="https://www.youtube.com/watch?v=bVzEPOZ_mDU"><div class="box"> <img src="https://i.ytimg.com/vi/bVzEPOZ_mDU/mqdefault.jpg" alt="YouTube video #bVzEPOZ_mDU" /><div class="play"><i class="icon icon-play"></i></div></div></a><div>A practical example of making an object-oriented HTTP server in Java (webinar #42); 13 February 2019.</div></aside><p>The easiest way would be 1) to convert the request into a <a href="/2016/07/06/data-transfer-object.html">DTO</a> with all the details inside, then 2) send it to a “controller” that knows what to do with the data from the DTO, and then 3) receive a response DTO from the controller, take the data out and render the response. This is how Spring and <del>most</del> all other frameworks do it. However, we won’t follow this path, we will try to do it DTO-free and <a href="/2014/11/20/seven-virtues-of-good-object.html">purely</a> object-oriented.</p><p>I have to say that there could be multiple designs, all in an OOP style. I’ll show you now only one of those options. You’re no doubt aware of our <a href="https://www.takes.org">Takes</a> framework, which was born a few years ago—it has its own design, also object-oriented. But the one I’m going to suggest now seems to be better. You might come up with something else too, so don’t hesitate to post your ideas in the comments below or even create a GitHub repo and share your thoughts right there.</p><p>I suggest we introduce two interfaces: <code class="language-plaintext highlighter-rouge">Resource</code> and <code class="language-plaintext highlighter-rouge">Output</code>. The <code class="language-plaintext highlighter-rouge">Resource</code> is the server side entity, which mutates depending on the request parameters that are coming in. For example, when all we know about the request is that it is <code class="language-plaintext highlighter-rouge">GET /</code>, it is one resource. But if we also know that the request has, for example, <code class="language-plaintext highlighter-rouge">Accept: text/plain</code>, we can mutate the request and create a new one, which delivers plain text. Here is the interface:</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">interface</span> <span class="nc">Resource</span> <span class="o">{</span>
  <span class="nc">Resource</span> <span class="nf">refine</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">,</span> <span class="nc">String</span> <span class="n">value</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div><p>Here is how we create it and mutate:</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Resource</span> <span class="n">r</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DefaultResource</span><span class="o">()</span>
  <span class="o">.</span><span class="na">refine</span><span class="o">(</span><span class="s">"X-Method"</span><span class="o">,</span> <span class="s">"GET"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">refine</span><span class="o">(</span><span class="s">"X-Query"</span><span class="o">,</span> <span class="s">"/"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">refine</span><span class="o">(</span><span class="s">"Accept"</span><span class="o">,</span> <span class="s">"text/plain"</span><span class="o">);</span>
</code></pre></div></div><p>Pay attention: each call to <code class="language-plaintext highlighter-rouge">.refine()</code> returns a new instance of interface <code class="language-plaintext highlighter-rouge">Resource</code>. All of them are immutable, just like objects <a href="/2014/06/09/objects-should-be-immutable.html">have to be</a>. Thanks to this design we don’t separate <a href="/2016/11/21/naked-data.html">data</a> from their processor. The resource is the data and the processor. Each resource knows what to do with the data, and receives only the data it is supposed to receive. Technically, we just implement <em>request dispatching</em>, but in an object-oriented way.</p><p>Then, we need to convert the resource to the response. We give the resource the ability to render itself to the response. We don’t want the <a href="/2016/11/21/naked-data.html">data</a>, in form of some DTO, to escape the resource. We want the resource <a href="/2016/04/05/printers-instead-of-getters.html">to print</a> the response. How about giving an additional method <code class="language-plaintext highlighter-rouge">print()</code> to the resource:</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">interface</span> <span class="nc">Resource</span> <span class="o">{</span>
  <span class="nc">Resource</span> <span class="nf">refine</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">,</span> <span class="nc">String</span> <span class="n">value</span><span class="o">);</span>
  <span class="kt">void</span> <span class="nf">print</span><span class="o">(</span><span class="nc">Output</span> <span class="n">output</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div><p>And then the interface <code class="language-plaintext highlighter-rouge">Output</code> looks like this:</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">interface</span> <span class="nc">Output</span> <span class="o">{</span>
  <span class="kt">void</span> <span class="nf">print</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">,</span> <span class="nc">String</span> <span class="n">value</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div><p>Here is a primitive implementation of <code class="language-plaintext highlighter-rouge">Output</code>:</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">StringBuilderOutput</span> <span class="kd">implements</span> <span class="nc">Output</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="nc">StringBuilder</span> <span class="n">buffer</span><span class="o">;</span>
  <span class="nc">StringBuilderOutput</span><span class="o">(</span><span class="nc">StringBuilder</span> <span class="n">buf</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">buffer</span> <span class="o">=</span> <span class="n">buf</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">print</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">,</span> <span class="nc">String</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">buffer</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">this</span><span class="o">.</span><span class="na">buffer</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"HTTP/1.1 200 OK\r\n"</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">name</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">"X-Body"</span><span class="o">))</span> <span class="o">{</span>
      <span class="k">this</span><span class="o">.</span><span class="na">buffer</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"\r\n"</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="n">value</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
      <span class="k">this</span><span class="o">.</span><span class="na">buffer</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">name</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="s">": "</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="n">value</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="s">"\r\n"</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><p>To build an HTTP response we can do this:</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">StringBuilder</span> <span class="n">builder</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuilder</span><span class="o">();</span>
<span class="nc">Output</span> <span class="n">output</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuilderOutput</span><span class="o">(</span><span class="n">builder</span><span class="o">);</span>
<span class="n">output</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"Content-Type"</span><span class="o">,</span> <span class="s">"text/plain"</span><span class="o">);</span>
<span class="n">output</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"Content-Length"</span><span class="o">,</span> <span class="s">"13"</span><span class="o">);</span>
<span class="n">output</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"X-Body"</span><span class="o">,</span> <span class="s">"Hello, world!"</span><span class="o">);</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">builder</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
</code></pre></div></div><p>Now let’s create a class which will take an incoming request <code class="language-plaintext highlighter-rouge">String</code> and produce a response <code class="language-plaintext highlighter-rouge">String</code>, using an instance of <code class="language-plaintext highlighter-rouge">Resource</code> as a <em>dispatcher</em>:</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Session</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="nc">Resource</span> <span class="n">resource</span><span class="o">;</span>
  <span class="nc">Session</span><span class="o">(</span><span class="nc">Resource</span> <span class="n">res</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">resource</span> <span class="o">=</span> <span class="n">res</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nc">String</span> <span class="nf">response</span><span class="o">(</span><span class="nc">String</span> <span class="n">request</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
    <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="n">pairs</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>
    <span class="nc">String</span><span class="o">[]</span> <span class="n">lines</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">"\r\n"</span><span class="o">);</span>
    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">idx</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="n">lines</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="o">++</span><span class="n">idx</span><span class="o">)</span> <span class="o">{</span>
      <span class="nc">String</span><span class="o">[]</span> <span class="n">parts</span> <span class="o">=</span> <span class="n">lines</span><span class="o">[</span><span class="n">idx</span><span class="o">].</span><span class="na">split</span><span class="o">(</span><span class="s">":"</span><span class="o">);</span>
      <span class="n">pairs</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">parts</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="na">trim</span><span class="o">(),</span> <span class="n">parts</span><span class="o">[</span><span class="mi">1</span><span class="o">].</span><span class="na">trim</span><span class="o">());</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">lines</span><span class="o">[</span><span class="n">idx</span><span class="o">].</span><span class="na">empty</span><span class="o">())</span> <span class="o">{</span>
        <span class="k">break</span><span class="o">;</span>
      <span class="o">}</span>
    <span class="o">}</span>
    <span class="nc">String</span><span class="o">[]</span> <span class="n">parts</span> <span class="o">=</span> <span class="n">lines</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="na">split</span><span class="o">(</span><span class="s">" "</span><span class="o">);</span>
    <span class="n">pairs</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"X-Method"</span><span class="o">,</span> <span class="n">parts</span><span class="o">[</span><span class="mi">0</span><span class="o">]);</span>
    <span class="n">pairs</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"X-Query"</span><span class="o">,</span> <span class="n">parts</span><span class="o">[</span><span class="mi">1</span><span class="o">]);</span>
    <span class="n">pairs</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"X-Protocol"</span><span class="o">,</span> <span class="n">parts</span><span class="o">[</span><span class="mi">2</span><span class="o">]);</span>
    <span class="nc">App</span><span class="o">.</span><span class="na">Resource</span> <span class="n">res</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">resource</span><span class="o">;</span>
    <span class="k">for</span> <span class="o">(</span><span class="nc">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="n">pair</span> <span class="o">:</span> <span class="n">pairs</span><span class="o">.</span><span class="na">entrySet</span><span class="o">())</span> <span class="o">{</span>
      <span class="n">res</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="na">refine</span><span class="o">(</span><span class="n">pair</span><span class="o">.</span><span class="na">getKey</span><span class="o">(),</span> <span class="n">pair</span><span class="o">.</span><span class="na">getValue</span><span class="o">());</span>
    <span class="o">}</span>
    <span class="nc">StringBuilder</span> <span class="n">buf</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuilder</span><span class="o">();</span>
    <span class="n">res</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="k">new</span> <span class="nc">StringBuilderOutput</span><span class="o">(</span><span class="n">buf</span><span class="o">));</span>
    <span class="k">return</span> <span class="n">buf</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><p>First, we parse the request, breaking its header into lines and ignoring the body of the request. You can modify the code to parse the body and pass it into the <code class="language-plaintext highlighter-rouge">refine()</code> method too, using <code class="language-plaintext highlighter-rouge">X-Body</code> as the key. At the moment, the code above doesn’t do that. But you get the idea. The parsing part of the snippet prepares the pairs it can find in the request and passes them one by one to the encapsulated resource, mutating it until it gets to the final form. A simple resource that always returns text might look like this:</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">TextResource</span> <span class="kd">implements</span> <span class="nc">Resource</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">body</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">TextResource</span><span class="o">(</span><span class="nc">String</span> <span class="n">text</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">body</span> <span class="o">=</span> <span class="n">text</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="nc">Resource</span> <span class="nf">refine</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">,</span> <span class="nc">String</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">print</span><span class="o">(</span><span class="nc">Output</span> <span class="n">output</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">output</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"Content-Type"</span><span class="o">,</span> <span class="s">"text/plain"</span><span class="o">);</span>
    <span class="n">output</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"Content-Length"</span><span class="o">,</span> <span class="nc">Integer</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">body</span><span class="o">.</span><span class="na">length</span><span class="o">()));</span>
    <span class="n">output</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"X-Body"</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">body</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><p>A resource that pays attention to the query string and dispatches the request to other resources, depending on the path in the query, might look like this:</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">new</span> <span class="nc">Resource</span><span class="o">()</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="nc">Resource</span> <span class="nf">refine</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">,</span> <span class="nc">String</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">name</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">"X-Query"</span><span class="o">))</span> <span class="o">{</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">value</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">"/"</span><span class="o">))</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">TextResource</span><span class="o">(</span><span class="s">"Hello, world!"</span><span class="o">);</span>
      <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">value</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">"/balance"</span><span class="o">))</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">TextResource</span><span class="o">(</span><span class="s">"256"</span><span class="o">);</span>
      <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">value</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">"/id"</span><span class="o">))</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">TextResource</span><span class="o">(</span><span class="s">"yegor"</span><span class="o">);</span>
      <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">TextResource</span><span class="o">(</span><span class="s">"Not found!"</span><span class="o">);</span>
      <span class="o">}</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
    <span class="o">}</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">print</span><span class="o">(</span><span class="kd">final</span> <span class="nc">Output</span> <span class="n">output</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">throws</span> <span class="nf">IllegalStateException</span><span class="o">(</span><span class="s">"This shouldn't happen"</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><p>I hope you got the idea. The code above is rather sketchy, and the majority of use cases are not implemented, but you can do that yourself, if you are interested. The code is in the <a href="https://github.com/yegor256/jpages">yegor256/jpages</a> repository. Don’t hesitate to contribute with a pull request and make this small framework real.</p></div></article></div><div class="wrapper" aria-hidden="true"> <related-posts /></div><div class="disqus" role="complementary" aria-hidden="true"><p class="disqus_hint" > Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2024</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="https://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge" /></a> &nbsp; <a href="https://github.com/yegor256/blog/stargazers"> <img src="//img.shields.io/github/stars/yegor256/blog.svg?style=flat-square" alt="GitHub stars" /></a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?eaa38fae980"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "https://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html>
