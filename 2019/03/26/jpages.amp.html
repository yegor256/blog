<!doctypehtml><html amp lang="en"><meta charset="utf-8"><title>How to Create a Java Web Framework from Scratch, the Right Object-Oriented Way</title><link rel="canonical"href="https://www.yegor256.com/2019/03/26/jpages.html"><link rel="icon"type="image/png"href="/favicon.ico"><meta name="viewport"content="width=device-width,minimum-scale=1,initial-scale=1"><script type="application/ld+json">{
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "mainEntityOfPage":{
          "@type": "WebPage",
          "@id": "https://www.yegor256.com/2019/03/26/jpages.html"
        },
        "headline": "How to Create a Java Web Framework from Scratch, the Right Object-Oriented Way",
        "image": {
          "@type": "ImageObject",
          "url": "/images/2019/03/breakfast-at-tiffanys.jpg",
          "height": 1080,
          "width": 1920
        },
        "datePublished": "2019-03-26",
        "dateModified": "2019-03-26",
        "author": {
          "@type": "Person",
          "name": "Yegor Bugayenko"
        },
        "publisher": {
          "@type": "Organization",
          "name": "yegor256.com",
          "logo": {
            "@type": "ImageObject",
            "url": "https://www.yegor256.com/images/face-512x512.jpg",
            "width": 512,
            "height": 512
          }
        },
        "description": "Most of us are used to data transfer objects, which
are the corner stone of modern web frameworks; however,
they are not object-oriented design.
",
        "keywords": ["java web framework", "java http framework", "oop web framework", "java web oop", "oop java web"]
      }</script><style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript><link rel="stylesheet"href="https://fonts.googleapis.com/css?family=Source+Code+Pro:400,500"><style amp-custom="amp-custom">@font-face{font-family:Cambria;src:url(https://www.yegor256.com/fonts/cambria/2EAA54_2_0.ttf)}body{font-family:Cambria,'Times New Roman',serif;padding:.5em;font-size:1.2em}article{width:600px;max-width:100%;margin-left:auto;margin-right:auto}code,pre{font-family:'Source Code Pro','Courier New',monospace;font-size:.8em}code{padding:0 .3em;background-color:#d3d3d3}a,a:hover,a:visited{color:inherit}.intro{color:red;font-size:.75em}.photo{border-radius:50%}pre{overflow-x:scroll}</style><script async src="https://cdn.ampproject.org/v0.js"></script><article><p class="intro">This is a mobile version, full one is <a href="https://www.yegor256.com/2019/03/26/jpages.html">here</a>.<p><amp-img src="/images/face-256x256.jpg"width="80"height="80"alt="Yegor Bugayenko"class="photo"></amp-img><p>Yegor Bugayenko<br>26 March 2019<h1>How to Create a Java Web Framework from Scratch, the Right Object-Oriented Way</h1><p>How do you design a web application in Java? You install Spring, read the manual, create <a href="/2015/03/09/objects-end-with-er.html">controllers</a>, create some views, add some <a href="/2016/04/12/java-annotations-are-evil.html">annotations</a>, and it works. What would you do if there were no <a href="https://spring.io/">Spring</a> (and no Ruby on Rails in Ruby, and no Symphony in PHP, and no … etc.)? Let’s try to create a web application from scratch, starting from a pure Java SDK and ending with a fully functional web app, covered by unit tests. I recorded a <a href="https://www.youtube.com/watch?v=bVzEPOZ_mDU">webinar no.42</a> about it just a few weeks ago, but this article should explain it all in even more detail.</p><amp-img src="/images/2019/03/breakfast-at-tiffanys.jpg"alt="Breakfast at Tiffany's (1961) by Blake Edwards"height="1080"width="1920"layout="responsive"></amp-img><p>First of all we have to create an HTTP server, which will open a server socket, listen to incoming connections, read everything they have to say (HTTP requests) and return the information any web browser would like (HTTP responses). You know how <a href="https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol">HTTP</a> works, right? If you don’t, here is a quick reminder:<p>A web browser sends a request to the server and the request looks like this (it’s a plain text piece of data):<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GET /index.html HTTP/1.1
Host: www.example.com
</code></pre></div></div><p>The server has to read this text, prepare the answer (which has to be the HTML page readable by the browser) and return it like this:<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>HTTP/1.1 200 OK
Content-Type: text/html; charset=UTF-8
Content-Length: 26

&lt;html&gt;Hello, world!&lt;/html&gt;
</code></pre></div></div><p>That’s it. It’s a very simple and, I would say, primitive protocol. The implementation of a web server in Java is not so complex either. Here it is, in a very simplistic form:<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.InputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.OutputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.net.ServerSocket</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.net.Socket</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.net.SocketTimeoutException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">...</span> <span class="n">argv</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">(</span><span class="nc">ServerSocket</span> <span class="n">server</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ServerSocket</span><span class="o">(</span><span class="mi">8080</span><span class="o">))</span> <span class="o">{</span>
      <span class="n">server</span><span class="o">.</span><span class="na">setSoTimeout</span><span class="o">(</span><span class="mi">1000</span><span class="o">);</span>
      <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">(</span><span class="nc">Socket</span> <span class="n">socket</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="na">accept</span><span class="o">())</span> <span class="o">{</span>
          <span class="k">try</span> <span class="o">(</span><span class="nc">InputStream</span> <span class="n">input</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">();</span>
            <span class="nc">OutputStream</span> <span class="n">output</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">())</span> <span class="o">{</span>
            <span class="kt">byte</span><span class="o">[]</span> <span class="n">buffer</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="mi">10000</span><span class="o">];</span>
            <span class="kt">int</span> <span class="n">total</span> <span class="o">=</span> <span class="n">input</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">buffer</span><span class="o">);</span>
            <span class="nc">String</span> <span class="n">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">String</span><span class="o">(</span><span class="nc">Arrays</span><span class="o">.</span><span class="na">copyOfRange</span><span class="o">(</span><span class="n">buffer</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">total</span><span class="o">));</span>
            <span class="nc">String</span> <span class="n">response</span> <span class="o">=</span> <span class="s">"HTTP/1.1 200 OK\r\n\r\nHello, world!"</span><span class="o">;</span>
            <span class="n">output</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">response</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>
          <span class="o">}</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">SocketTimeoutException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
          <span class="k">if</span> <span class="o">(</span><span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">isInterrupted</span><span class="o">())</span> <span class="o">{</span>
              <span class="k">break</span><span class="o">;</span>
          <span class="o">}</span>
        <span class="o">}</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><p>Try to run it, it should work. You should be able to open the <code class="language-plaintext highlighter-rouge">http://localhost:8080</code> page in your browser and see the <code class="language-plaintext highlighter-rouge">Hello, world!</code> text.<p>It’s not yet a web app, but just a skeleton, which does simple dispatching of HTTP requests into HTTP responses. There is no serious OOP in it though. It’s pretty procedural, but it works. Now we should focus on a more important question: How do we add more features to the web app and make it possible to process different pages, render larger content, and handle errors? The <code class="language-plaintext highlighter-rouge">request</code> variable in the snippet above should be somehow converted to a <code class="language-plaintext highlighter-rouge">response</code>.<p>The easiest way would be 1) to convert the request into a <a href="/2016/07/06/data-transfer-object.html">DTO</a> with all the details inside, then 2) send it to a “controller” that knows what to do with the data from the DTO, and then 3) receive a response DTO from the controller, take the data out and render the response. This is how Spring and <del>most</del> all other frameworks do it. However, we won’t follow this path, we will try to do it DTO-free and <a href="/2014/11/20/seven-virtues-of-good-object.html">purely</a> object-oriented.<p>I have to say that there could be multiple designs, all in an OOP style. I’ll show you now only one of those options. You’re no doubt aware of our <a href="https://www.takes.org">Takes</a> framework, which was born a few years ago—it has its own design, also object-oriented. But the one I’m going to suggest now seems to be better. You might come up with something else too, so don’t hesitate to post your ideas in the comments below or even create a GitHub repo and share your thoughts right there.<p>I suggest we introduce two interfaces: <code class="language-plaintext highlighter-rouge">Resource</code> and <code class="language-plaintext highlighter-rouge">Output</code>. The <code class="language-plaintext highlighter-rouge">Resource</code> is the server side entity, which mutates depending on the request parameters that are coming in. For example, when all we know about the request is that it is <code class="language-plaintext highlighter-rouge">GET /</code>, it is one resource. But if we also know that the request has, for example, <code class="language-plaintext highlighter-rouge">Accept: text/plain</code>, we can mutate the request and create a new one, which delivers plain text. Here is the interface:<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">interface</span> <span class="nc">Resource</span> <span class="o">{</span>
  <span class="nc">Resource</span> <span class="nf">refine</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">,</span> <span class="nc">String</span> <span class="n">value</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div><p>Here is how we create it and mutate:<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Resource</span> <span class="n">r</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DefaultResource</span><span class="o">()</span>
  <span class="o">.</span><span class="na">refine</span><span class="o">(</span><span class="s">"X-Method"</span><span class="o">,</span> <span class="s">"GET"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">refine</span><span class="o">(</span><span class="s">"X-Query"</span><span class="o">,</span> <span class="s">"/"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">refine</span><span class="o">(</span><span class="s">"Accept"</span><span class="o">,</span> <span class="s">"text/plain"</span><span class="o">);</span>
</code></pre></div></div><p>Pay attention: each call to <code class="language-plaintext highlighter-rouge">.refine()</code> returns a new instance of interface <code class="language-plaintext highlighter-rouge">Resource</code>. All of them are immutable, just like objects <a href="/2014/06/09/objects-should-be-immutable.html">have to be</a>. Thanks to this design we don’t separate <a href="/2016/11/21/naked-data.html">data</a> from their processor. The resource is the data and the processor. Each resource knows what to do with the data, and receives only the data it is supposed to receive. Technically, we just implement <em>request dispatching</em>, but in an object-oriented way.<p>Then, we need to convert the resource to the response. We give the resource the ability to render itself to the response. We don’t want the <a href="/2016/11/21/naked-data.html">data</a>, in form of some DTO, to escape the resource. We want the resource <a href="/2016/04/05/printers-instead-of-getters.html">to print</a> the response. How about giving an additional method <code class="language-plaintext highlighter-rouge">print()</code> to the resource:<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">interface</span> <span class="nc">Resource</span> <span class="o">{</span>
  <span class="nc">Resource</span> <span class="nf">refine</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">,</span> <span class="nc">String</span> <span class="n">value</span><span class="o">);</span>
  <span class="kt">void</span> <span class="nf">print</span><span class="o">(</span><span class="nc">Output</span> <span class="n">output</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div><p>And then the interface <code class="language-plaintext highlighter-rouge">Output</code> looks like this:<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">interface</span> <span class="nc">Output</span> <span class="o">{</span>
  <span class="kt">void</span> <span class="nf">print</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">,</span> <span class="nc">String</span> <span class="n">value</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div><p>Here is a primitive implementation of <code class="language-plaintext highlighter-rouge">Output</code>:<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">StringBuilderOutput</span> <span class="kd">implements</span> <span class="nc">Output</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="nc">StringBuilder</span> <span class="n">buffer</span><span class="o">;</span>
  <span class="nc">StringBuilderOutput</span><span class="o">(</span><span class="nc">StringBuilder</span> <span class="n">buf</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">buffer</span> <span class="o">=</span> <span class="n">buf</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">print</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">,</span> <span class="nc">String</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">buffer</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">this</span><span class="o">.</span><span class="na">buffer</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"HTTP/1.1 200 OK\r\n"</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">name</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">"X-Body"</span><span class="o">))</span> <span class="o">{</span>
      <span class="k">this</span><span class="o">.</span><span class="na">buffer</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"\r\n"</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="n">value</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
      <span class="k">this</span><span class="o">.</span><span class="na">buffer</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">name</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="s">": "</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="n">value</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="s">"\r\n"</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><p>To build an HTTP response we can do this:<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">StringBuilder</span> <span class="n">builder</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuilder</span><span class="o">();</span>
<span class="nc">Output</span> <span class="n">output</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuilderOutput</span><span class="o">(</span><span class="n">builder</span><span class="o">);</span>
<span class="n">output</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"Content-Type"</span><span class="o">,</span> <span class="s">"text/plain"</span><span class="o">);</span>
<span class="n">output</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"Content-Length"</span><span class="o">,</span> <span class="s">"13"</span><span class="o">);</span>
<span class="n">output</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"X-Body"</span><span class="o">,</span> <span class="s">"Hello, world!"</span><span class="o">);</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">builder</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
</code></pre></div></div><p>Now let’s create a class which will take an incoming request <code class="language-plaintext highlighter-rouge">String</code> and produce a response <code class="language-plaintext highlighter-rouge">String</code>, using an instance of <code class="language-plaintext highlighter-rouge">Resource</code> as a <em>dispatcher</em>:<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Session</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="nc">Resource</span> <span class="n">resource</span><span class="o">;</span>
  <span class="nc">Session</span><span class="o">(</span><span class="nc">Resource</span> <span class="n">res</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">resource</span> <span class="o">=</span> <span class="n">res</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nc">String</span> <span class="nf">response</span><span class="o">(</span><span class="nc">String</span> <span class="n">request</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
    <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="n">pairs</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>
    <span class="nc">String</span><span class="o">[]</span> <span class="n">lines</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">"\r\n"</span><span class="o">);</span>
    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">idx</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="n">lines</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="o">++</span><span class="n">idx</span><span class="o">)</span> <span class="o">{</span>
      <span class="nc">String</span><span class="o">[]</span> <span class="n">parts</span> <span class="o">=</span> <span class="n">lines</span><span class="o">[</span><span class="n">idx</span><span class="o">].</span><span class="na">split</span><span class="o">(</span><span class="s">":"</span><span class="o">);</span>
      <span class="n">pairs</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">parts</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="na">trim</span><span class="o">(),</span> <span class="n">parts</span><span class="o">[</span><span class="mi">1</span><span class="o">].</span><span class="na">trim</span><span class="o">());</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">lines</span><span class="o">[</span><span class="n">idx</span><span class="o">].</span><span class="na">empty</span><span class="o">())</span> <span class="o">{</span>
        <span class="k">break</span><span class="o">;</span>
      <span class="o">}</span>
    <span class="o">}</span>
    <span class="nc">String</span><span class="o">[]</span> <span class="n">parts</span> <span class="o">=</span> <span class="n">lines</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="na">split</span><span class="o">(</span><span class="s">" "</span><span class="o">);</span>
    <span class="n">pairs</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"X-Method"</span><span class="o">,</span> <span class="n">parts</span><span class="o">[</span><span class="mi">0</span><span class="o">]);</span>
    <span class="n">pairs</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"X-Query"</span><span class="o">,</span> <span class="n">parts</span><span class="o">[</span><span class="mi">1</span><span class="o">]);</span>
    <span class="n">pairs</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"X-Protocol"</span><span class="o">,</span> <span class="n">parts</span><span class="o">[</span><span class="mi">2</span><span class="o">]);</span>
    <span class="nc">App</span><span class="o">.</span><span class="na">Resource</span> <span class="n">res</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">resource</span><span class="o">;</span>
    <span class="k">for</span> <span class="o">(</span><span class="nc">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="n">pair</span> <span class="o">:</span> <span class="n">pairs</span><span class="o">.</span><span class="na">entrySet</span><span class="o">())</span> <span class="o">{</span>
      <span class="n">res</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="na">refine</span><span class="o">(</span><span class="n">pair</span><span class="o">.</span><span class="na">getKey</span><span class="o">(),</span> <span class="n">pair</span><span class="o">.</span><span class="na">getValue</span><span class="o">());</span>
    <span class="o">}</span>
    <span class="nc">StringBuilder</span> <span class="n">buf</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuilder</span><span class="o">();</span>
    <span class="n">res</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="k">new</span> <span class="nc">StringBuilderOutput</span><span class="o">(</span><span class="n">buf</span><span class="o">));</span>
    <span class="k">return</span> <span class="n">buf</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><p>First, we parse the request, breaking its header into lines and ignoring the body of the request. You can modify the code to parse the body and pass it into the <code class="language-plaintext highlighter-rouge">refine()</code> method too, using <code class="language-plaintext highlighter-rouge">X-Body</code> as the key. At the moment, the code above doesn’t do that. But you get the idea. The parsing part of the snippet prepares the pairs it can find in the request and passes them one by one to the encapsulated resource, mutating it until it gets to the final form. A simple resource that always returns text might look like this:<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">TextResource</span> <span class="kd">implements</span> <span class="nc">Resource</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">body</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">TextResource</span><span class="o">(</span><span class="nc">String</span> <span class="n">text</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">body</span> <span class="o">=</span> <span class="n">text</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="nc">Resource</span> <span class="nf">refine</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">,</span> <span class="nc">String</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">print</span><span class="o">(</span><span class="nc">Output</span> <span class="n">output</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">output</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"Content-Type"</span><span class="o">,</span> <span class="s">"text/plain"</span><span class="o">);</span>
    <span class="n">output</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"Content-Length"</span><span class="o">,</span> <span class="nc">Integer</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">body</span><span class="o">.</span><span class="na">length</span><span class="o">()));</span>
    <span class="n">output</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"X-Body"</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">body</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><p>A resource that pays attention to the query string and dispatches the request to other resources, depending on the path in the query, might look like this:<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">new</span> <span class="nc">Resource</span><span class="o">()</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="nc">Resource</span> <span class="nf">refine</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">,</span> <span class="nc">String</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">name</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">"X-Query"</span><span class="o">))</span> <span class="o">{</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">value</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">"/"</span><span class="o">))</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">TextResource</span><span class="o">(</span><span class="s">"Hello, world!"</span><span class="o">);</span>
      <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">value</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">"/balance"</span><span class="o">))</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">TextResource</span><span class="o">(</span><span class="s">"256"</span><span class="o">);</span>
      <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">value</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">"/id"</span><span class="o">))</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">TextResource</span><span class="o">(</span><span class="s">"yegor"</span><span class="o">);</span>
      <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">TextResource</span><span class="o">(</span><span class="s">"Not found!"</span><span class="o">);</span>
      <span class="o">}</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
    <span class="o">}</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">print</span><span class="o">(</span><span class="kd">final</span> <span class="nc">Output</span> <span class="n">output</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">throws</span> <span class="nf">IllegalStateException</span><span class="o">(</span><span class="s">"This shouldn't happen"</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><p>I hope you got the idea. The code above is rather sketchy, and the majority of use cases are not implemented, but you can do that yourself, if you are interested. The code is in the <a href="https://github.com/yegor256/jpages">yegor256/jpages</a> repository. Don’t hesitate to contribute with a pull request and make this small framework real.</article>